{"dependencies":[{"name":"@tensorflow/tfjs-core","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":17,"column":0,"index":703},"end":{"line":17,"column":67,"index":770}}],"key":"qIleUpSDMUXFynEGc51k60/pDSs=","exportNames":["*"],"imports":1}},{"name":"./Multiply","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":18,"column":0,"index":771},"end":{"line":18,"column":38,"index":809}}],"key":"1n3upWdb1/4tv8y+cZP1u3RwscI=","exportNames":["*"],"imports":1}},{"name":"./Reshape","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":19,"column":0,"index":810},"end":{"line":19,"column":36,"index":846}}],"key":"EUWK+oKi/AwokPOQ1jng5DYfQSc=","exportNames":["*"],"imports":1}},{"name":"./Sum","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":20,"column":0,"index":847},"end":{"line":20,"column":28,"index":875}}],"key":"d7Y5U7PWKSyphQklNUED/rT1MrQ=","exportNames":["*"],"imports":1}},{"name":"./Transpose","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":21,"column":0,"index":876},"end":{"line":21,"column":40,"index":916}}],"key":"F6S1ekgW6WEHcH6rql/beO2khwY=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.einsum = einsum;\n  Object.defineProperty(exports, \"einsumConfig\", {\n    enumerable: true,\n    get: function () {\n      return einsumConfig;\n    }\n  });\n  var _tensorflowTfjsCore = require(_dependencyMap[0], \"@tensorflow/tfjs-core\");\n  var _Multiply = require(_dependencyMap[1], \"./Multiply\");\n  var _Reshape = require(_dependencyMap[2], \"./Reshape\");\n  var _Sum = require(_dependencyMap[3], \"./Sum\");\n  var _Transpose = require(_dependencyMap[4], \"./Transpose\");\n  /**\n   * @license\n   * Copyright 2021 Google LLC. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   */\n\n  function einsum(args) {\n    const {\n      inputs,\n      backend,\n      attrs\n    } = args;\n    const {\n      equation\n    } = attrs;\n    const tensors = inputs;\n    const {\n      allDims,\n      summedDims,\n      idDims\n    } = _tensorflowTfjsCore.backend_util.decodeEinsumEquation(equation, tensors.length);\n    _tensorflowTfjsCore.backend_util.checkEinsumDimSizes(allDims.length, idDims, tensors);\n    const {\n      path,\n      steps\n    } = _tensorflowTfjsCore.backend_util.getEinsumComputePath(summedDims, idDims);\n    const nSteps = steps.length;\n    let out = null;\n    let numDimsRemaining = allDims.length;\n    const tensorsToDispose = [];\n    for (let i = 0; i < nSteps; ++i) {\n      for (const idTerm of steps[i]) {\n        const {\n          permutationIndices: perm,\n          expandDims: dimsToExpand\n        } = _tensorflowTfjsCore.backend_util.getEinsumPermutation(numDimsRemaining, idDims[idTerm]);\n        let x;\n        if (_tensorflowTfjsCore.backend_util.isIdentityPermutation(perm)) {\n          x = tensors[idTerm];\n        } else {\n          x = (0, _Transpose.transpose)({\n            inputs: {\n              x: tensors[idTerm]\n            },\n            backend,\n            attrs: {\n              perm\n            }\n          });\n          tensorsToDispose.push(x);\n        }\n        const targetShape = x.shape.slice();\n        for (let k = 0; k < dimsToExpand.length; ++k) {\n          targetShape.splice(dimsToExpand[k], 0, 1);\n        }\n        if (!_tensorflowTfjsCore.util.arraysEqual(x.shape, targetShape)) {\n          x = (0, _Reshape.reshape)({\n            inputs: {\n              x\n            },\n            backend,\n            attrs: {\n              shape: targetShape\n            }\n          });\n          tensorsToDispose.push(x);\n        }\n        if (out === null) {\n          out = x;\n        } else {\n          // tslint:disable-next-line: no-unnecessary-type-assertion\n          out = (0, _Multiply.multiply)({\n            inputs: {\n              a: x,\n              b: out\n            },\n            backend\n          });\n          tensorsToDispose.push(out);\n        }\n      }\n      if (i < nSteps - 1) {\n        if (path[i] >= 0) {\n          out = (0, _Sum.sum)({\n            inputs: {\n              x: out\n            },\n            backend,\n            attrs: {\n              axis: path[i] - (allDims.length - numDimsRemaining),\n              keepDims: false\n            }\n          });\n          tensorsToDispose.push(out);\n        }\n        numDimsRemaining--;\n      }\n    }\n    // Clean up intermediate tensors.\n    for (const tensorInfo of tensorsToDispose) {\n      if (tensorInfo === out) {\n        continue;\n      }\n      backend.disposeIntermediateTensorInfo(tensorInfo);\n    }\n    return out;\n  }\n  const einsumConfig = {\n    kernelName: _tensorflowTfjsCore.Einsum,\n    backendName: 'webgl',\n    kernelFunc: einsum\n  };\n});","lineCount":142,"map":[[7,2,22,0,"exports"],[7,9,22,0],[7,10,22,0,"einsum"],[7,16,22,0],[7,19,22,0,"einsum"],[7,25,22,0],[8,2,85,0,"Object"],[8,8,85,0],[8,9,85,0,"defineProperty"],[8,23,85,0],[8,24,85,0,"exports"],[8,31,85,0],[9,4,85,0,"enumerable"],[9,14,85,0],[10,4,85,0,"get"],[10,7,85,0],[10,18,85,0,"get"],[10,19,85,0],[11,6,85,0],[11,13,85,0,"einsumConfig"],[11,25,85,0],[12,4,85,0],[13,2,85,0],[14,2,17,0],[14,6,17,0,"_tensorflowTfjsCore"],[14,25,17,0],[14,28,17,0,"require"],[14,35,17,0],[14,36,17,0,"_dependencyMap"],[14,50,17,0],[15,2,18,0],[15,6,18,0,"_Multiply"],[15,15,18,0],[15,18,18,0,"require"],[15,25,18,0],[15,26,18,0,"_dependencyMap"],[15,40,18,0],[16,2,19,0],[16,6,19,0,"_Reshape"],[16,14,19,0],[16,17,19,0,"require"],[16,24,19,0],[16,25,19,0,"_dependencyMap"],[16,39,19,0],[17,2,20,0],[17,6,20,0,"_Sum"],[17,10,20,0],[17,13,20,0,"require"],[17,20,20,0],[17,21,20,0,"_dependencyMap"],[17,35,20,0],[18,2,21,0],[18,6,21,0,"_Transpose"],[18,16,21,0],[18,19,21,0,"require"],[18,26,21,0],[18,27,21,0,"_dependencyMap"],[18,41,21,0],[19,2,1,0],[20,0,2,0],[21,0,3,0],[22,0,4,0],[23,0,5,0],[24,0,6,0],[25,0,7,0],[26,0,8,0],[27,0,9,0],[28,0,10,0],[29,0,11,0],[30,0,12,0],[31,0,13,0],[32,0,14,0],[33,0,15,0],[34,0,16,0],[36,2,22,7],[36,11,22,16,"einsum"],[36,17,22,22,"einsum"],[36,18,22,23,"args"],[36,22,22,27],[36,24,22,29],[37,4,23,4],[37,10,23,10],[38,6,23,12,"inputs"],[38,12,23,18],[39,6,23,20,"backend"],[39,13,23,27],[40,6,23,29,"attrs"],[41,4,23,35],[41,5,23,36],[41,8,23,39,"args"],[41,12,23,43],[42,4,24,4],[42,10,24,10],[43,6,24,12,"equation"],[44,4,24,21],[44,5,24,22],[44,8,24,25,"attrs"],[44,13,24,30],[45,4,25,4],[45,10,25,10,"tensors"],[45,17,25,17],[45,20,25,20,"inputs"],[45,26,25,26],[46,4,26,4],[46,10,26,10],[47,6,26,12,"allDims"],[47,13,26,19],[48,6,26,21,"summedDims"],[48,16,26,31],[49,6,26,33,"idDims"],[50,4,26,40],[50,5,26,41],[50,8,26,44,"backend_util"],[50,27,26,56],[50,28,26,56,"backend_util"],[50,40,26,56],[50,41,26,57,"decodeEinsumEquation"],[50,61,26,77],[50,62,26,78,"equation"],[50,70,26,86],[50,72,26,88,"tensors"],[50,79,26,95],[50,80,26,96,"length"],[50,86,26,102],[50,87,26,103],[51,4,27,4,"backend_util"],[51,23,27,16],[51,24,27,16,"backend_util"],[51,36,27,16],[51,37,27,17,"checkEinsumDimSizes"],[51,56,27,36],[51,57,27,37,"allDims"],[51,64,27,44],[51,65,27,45,"length"],[51,71,27,51],[51,73,27,53,"idDims"],[51,79,27,59],[51,81,27,61,"tensors"],[51,88,27,68],[51,89,27,69],[52,4,28,4],[52,10,28,10],[53,6,28,12,"path"],[53,10,28,16],[54,6,28,18,"steps"],[55,4,28,24],[55,5,28,25],[55,8,28,28,"backend_util"],[55,27,28,40],[55,28,28,40,"backend_util"],[55,40,28,40],[55,41,28,41,"getEinsumComputePath"],[55,61,28,61],[55,62,28,62,"summedDims"],[55,72,28,72],[55,74,28,74,"idDims"],[55,80,28,80],[55,81,28,81],[56,4,29,4],[56,10,29,10,"nSteps"],[56,16,29,16],[56,19,29,19,"steps"],[56,24,29,24],[56,25,29,25,"length"],[56,31,29,31],[57,4,30,4],[57,8,30,8,"out"],[57,11,30,11],[57,14,30,14],[57,18,30,18],[58,4,31,4],[58,8,31,8,"numDimsRemaining"],[58,24,31,24],[58,27,31,27,"allDims"],[58,34,31,34],[58,35,31,35,"length"],[58,41,31,41],[59,4,32,4],[59,10,32,10,"tensorsToDispose"],[59,26,32,26],[59,29,32,29],[59,31,32,31],[60,4,33,4],[60,9,33,9],[60,13,33,13,"i"],[60,14,33,14],[60,17,33,17],[60,18,33,18],[60,20,33,20,"i"],[60,21,33,21],[60,24,33,24,"nSteps"],[60,30,33,30],[60,32,33,32],[60,34,33,34,"i"],[60,35,33,35],[60,37,33,37],[61,6,34,8],[61,11,34,13],[61,17,34,19,"idTerm"],[61,23,34,25],[61,27,34,29,"steps"],[61,32,34,34],[61,33,34,35,"i"],[61,34,34,36],[61,35,34,37],[61,37,34,39],[62,8,35,12],[62,14,35,18],[63,10,35,20,"permutationIndices"],[63,28,35,38],[63,30,35,40,"perm"],[63,34,35,44],[64,10,35,46,"expandDims"],[64,20,35,56],[64,22,35,58,"dimsToExpand"],[65,8,35,71],[65,9,35,72],[65,12,35,75,"backend_util"],[65,31,35,87],[65,32,35,87,"backend_util"],[65,44,35,87],[65,45,35,88,"getEinsumPermutation"],[65,65,35,108],[65,66,35,109,"numDimsRemaining"],[65,82,35,125],[65,84,35,127,"idDims"],[65,90,35,133],[65,91,35,134,"idTerm"],[65,97,35,140],[65,98,35,141],[65,99,35,142],[66,8,36,12],[66,12,36,16,"x"],[66,13,36,17],[67,8,37,12],[67,12,37,16,"backend_util"],[67,31,37,28],[67,32,37,28,"backend_util"],[67,44,37,28],[67,45,37,29,"isIdentityPermutation"],[67,66,37,50],[67,67,37,51,"perm"],[67,71,37,55],[67,72,37,56],[67,74,37,58],[68,10,38,16,"x"],[68,11,38,17],[68,14,38,20,"tensors"],[68,21,38,27],[68,22,38,28,"idTerm"],[68,28,38,34],[68,29,38,35],[69,8,39,12],[69,9,39,13],[69,15,40,17],[70,10,41,16,"x"],[70,11,41,17],[70,14,41,20],[70,18,41,20,"transpose"],[70,28,41,29],[70,29,41,29,"transpose"],[70,38,41,29],[70,40,41,30],[71,12,41,32,"inputs"],[71,18,41,38],[71,20,41,40],[72,14,41,42,"x"],[72,15,41,43],[72,17,41,45,"tensors"],[72,24,41,52],[72,25,41,53,"idTerm"],[72,31,41,59],[73,12,41,61],[73,13,41,62],[74,12,41,64,"backend"],[74,19,41,71],[75,12,41,73,"attrs"],[75,17,41,78],[75,19,41,80],[76,14,41,82,"perm"],[77,12,41,87],[78,10,41,89],[78,11,41,90],[78,12,41,91],[79,10,42,16,"tensorsToDispose"],[79,26,42,32],[79,27,42,33,"push"],[79,31,42,37],[79,32,42,38,"x"],[79,33,42,39],[79,34,42,40],[80,8,43,12],[81,8,44,12],[81,14,44,18,"targetShape"],[81,25,44,29],[81,28,44,32,"x"],[81,29,44,33],[81,30,44,34,"shape"],[81,35,44,39],[81,36,44,40,"slice"],[81,41,44,45],[81,42,44,46],[81,43,44,47],[82,8,45,12],[82,13,45,17],[82,17,45,21,"k"],[82,18,45,22],[82,21,45,25],[82,22,45,26],[82,24,45,28,"k"],[82,25,45,29],[82,28,45,32,"dimsToExpand"],[82,40,45,44],[82,41,45,45,"length"],[82,47,45,51],[82,49,45,53],[82,51,45,55,"k"],[82,52,45,56],[82,54,45,58],[83,10,46,16,"targetShape"],[83,21,46,27],[83,22,46,28,"splice"],[83,28,46,34],[83,29,46,35,"dimsToExpand"],[83,41,46,47],[83,42,46,48,"k"],[83,43,46,49],[83,44,46,50],[83,46,46,52],[83,47,46,53],[83,49,46,55],[83,50,46,56],[83,51,46,57],[84,8,47,12],[85,8,48,12],[85,12,48,16],[85,13,48,17,"util"],[85,32,48,21],[85,33,48,21,"util"],[85,37,48,21],[85,38,48,22,"arraysEqual"],[85,49,48,33],[85,50,48,34,"x"],[85,51,48,35],[85,52,48,36,"shape"],[85,57,48,41],[85,59,48,43,"targetShape"],[85,70,48,54],[85,71,48,55],[85,73,48,57],[86,10,49,16,"x"],[86,11,49,17],[86,14,49,20],[86,18,49,20,"reshape"],[86,26,49,27],[86,27,49,27,"reshape"],[86,34,49,27],[86,36,49,28],[87,12,49,30,"inputs"],[87,18,49,36],[87,20,49,38],[88,14,49,40,"x"],[89,12,49,42],[89,13,49,43],[90,12,49,45,"backend"],[90,19,49,52],[91,12,49,54,"attrs"],[91,17,49,59],[91,19,49,61],[92,14,49,63,"shape"],[92,19,49,68],[92,21,49,70,"targetShape"],[93,12,49,82],[94,10,49,84],[94,11,49,85],[94,12,49,86],[95,10,50,16,"tensorsToDispose"],[95,26,50,32],[95,27,50,33,"push"],[95,31,50,37],[95,32,50,38,"x"],[95,33,50,39],[95,34,50,40],[96,8,51,12],[97,8,52,12],[97,12,52,16,"out"],[97,15,52,19],[97,20,52,24],[97,24,52,28],[97,26,52,30],[98,10,53,16,"out"],[98,13,53,19],[98,16,53,22,"x"],[98,17,53,23],[99,8,54,12],[99,9,54,13],[99,15,55,17],[100,10,56,16],[101,10,57,16,"out"],[101,13,57,19],[101,16,57,22],[101,20,57,22,"multiply"],[101,29,57,30],[101,30,57,30,"multiply"],[101,38,57,30],[101,40,57,31],[102,12,57,33,"inputs"],[102,18,57,39],[102,20,57,41],[103,14,57,43,"a"],[103,15,57,44],[103,17,57,46,"x"],[103,18,57,47],[104,14,57,49,"b"],[104,15,57,50],[104,17,57,52,"out"],[105,12,57,56],[105,13,57,57],[106,12,57,59,"backend"],[107,10,57,67],[107,11,57,68],[107,12,57,69],[108,10,58,16,"tensorsToDispose"],[108,26,58,32],[108,27,58,33,"push"],[108,31,58,37],[108,32,58,38,"out"],[108,35,58,41],[108,36,58,42],[109,8,59,12],[110,6,60,8],[111,6,61,8],[111,10,61,12,"i"],[111,11,61,13],[111,14,61,16,"nSteps"],[111,20,61,22],[111,23,61,25],[111,24,61,26],[111,26,61,28],[112,8,62,12],[112,12,62,16,"path"],[112,16,62,20],[112,17,62,21,"i"],[112,18,62,22],[112,19,62,23],[112,23,62,27],[112,24,62,28],[112,26,62,30],[113,10,63,16,"out"],[113,13,63,19],[113,16,63,22],[113,20,63,22,"sum"],[113,24,63,25],[113,25,63,25,"sum"],[113,28,63,25],[113,30,63,26],[114,12,64,20,"inputs"],[114,18,64,26],[114,20,64,28],[115,14,64,30,"x"],[115,15,64,31],[115,17,64,33,"out"],[116,12,64,37],[116,13,64,38],[117,12,65,20,"backend"],[117,19,65,27],[118,12,66,20,"attrs"],[118,17,66,25],[118,19,66,27],[119,14,67,24,"axis"],[119,18,67,28],[119,20,67,30,"path"],[119,24,67,34],[119,25,67,35,"i"],[119,26,67,36],[119,27,67,37],[119,31,67,41,"allDims"],[119,38,67,48],[119,39,67,49,"length"],[119,45,67,55],[119,48,67,58,"numDimsRemaining"],[119,64,67,74],[119,65,67,75],[120,14,68,24,"keepDims"],[120,22,68,32],[120,24,68,34],[121,12,69,20],[122,10,70,16],[122,11,70,17],[122,12,70,18],[123,10,71,16,"tensorsToDispose"],[123,26,71,32],[123,27,71,33,"push"],[123,31,71,37],[123,32,71,38,"out"],[123,35,71,41],[123,36,71,42],[124,8,72,12],[125,8,73,12,"numDimsRemaining"],[125,24,73,28],[125,26,73,30],[126,6,74,8],[127,4,75,4],[128,4,76,4],[129,4,77,4],[129,9,77,9],[129,15,77,15,"tensorInfo"],[129,25,77,25],[129,29,77,29,"tensorsToDispose"],[129,45,77,45],[129,47,77,47],[130,6,78,8],[130,10,78,12,"tensorInfo"],[130,20,78,22],[130,25,78,27,"out"],[130,28,78,30],[130,30,78,32],[131,8,79,12],[132,6,80,8],[133,6,81,8,"backend"],[133,13,81,15],[133,14,81,16,"disposeIntermediateTensorInfo"],[133,43,81,45],[133,44,81,46,"tensorInfo"],[133,54,81,56],[133,55,81,57],[134,4,82,4],[135,4,83,4],[135,11,83,11,"out"],[135,14,83,14],[136,2,84,0],[137,2,85,7],[137,8,85,13,"einsumConfig"],[137,20,85,25],[137,23,85,28],[138,4,86,4,"kernelName"],[138,14,86,14],[138,16,86,16,"Einsum"],[138,35,86,22],[138,36,86,22,"Einsum"],[138,42,86,22],[139,4,87,4,"backendName"],[139,15,87,15],[139,17,87,17],[139,24,87,24],[140,4,88,4,"kernelFunc"],[140,14,88,14],[140,16,88,16,"einsum"],[141,2,89,0],[141,3,89,1],[142,0,89,2],[142,3]],"functionMap":{"names":["<global>","einsum"],"mappings":"AAA;OCqB;CD8D"},"hasCjsExports":false},"type":"js/module"}]}