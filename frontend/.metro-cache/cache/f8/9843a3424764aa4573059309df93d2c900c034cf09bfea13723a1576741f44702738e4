{"dependencies":[{"name":"@tensorflow/tfjs-core","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":17,"column":0,"index":703},"end":{"line":17,"column":53,"index":756}}],"key":"qIleUpSDMUXFynEGc51k60/pDSs=","exportNames":["*"],"imports":1}},{"name":"../cum_gpu","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":18,"column":0,"index":757},"end":{"line":18,"column":40,"index":797}}],"key":"+GFjeSs1zRPNzgjOHRWIE6tRwr4=","exportNames":["*"],"imports":1}},{"name":"./Identity","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":19,"column":0,"index":798},"end":{"line":19,"column":38,"index":836}}],"key":"fmoGkMbvl3R/HMlCKK1PD8/q2lc=","exportNames":["*"],"imports":1}},{"name":"./Transpose","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":20,"column":0,"index":837},"end":{"line":20,"column":40,"index":877}}],"key":"F6S1ekgW6WEHcH6rql/beO2khwY=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.cumImpl = cumImpl;\n  var _tensorflowTfjsCore = require(_dependencyMap[0], \"@tensorflow/tfjs-core\");\n  var _cum_gpu = require(_dependencyMap[1], \"../cum_gpu\");\n  var _Identity = require(_dependencyMap[2], \"./Identity\");\n  var _Transpose = require(_dependencyMap[3], \"./Transpose\");\n  /**\n   * @license\n   * Copyright 2022 Google LLC. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   */\n\n  function cumImpl(op, x, backend, axis, exclusive, reverse) {\n    const xRank = x.shape.length;\n    const permutation = _tensorflowTfjsCore.backend_util.getAxesPermutation([axis], xRank);\n    let permutedX = x;\n    if (permutation != null) {\n      permutedX = (0, _Transpose.transpose)({\n        inputs: {\n          x\n        },\n        backend,\n        attrs: {\n          perm: permutation\n        }\n      });\n    }\n    const permutedAxis = _tensorflowTfjsCore.backend_util.getInnerMostAxes(1, xRank)[0];\n    if (permutedAxis !== xRank - 1) {\n      throw new Error(`WebGL cumprod shader expects an inner-most axis=${x.shape.length - 1} ` + `but got axis=${axis}`);\n    }\n    const size = permutedX.shape[permutedAxis];\n    let result = (0, _Identity.identity)({\n      inputs: {\n        x: permutedX\n      },\n      backend\n    });\n    // Use cum parallel algorithm, inspired by:\n    // https://developer.nvidia.com/gpugems/gpugems3/part-vi-gpu-computing/chapter-39-parallel-prefix-sum-scan-cuda\n    // Note: although the algorithm is called sum, it works for any associtative\n    // operator with an identity.\n    for (let i = 0; i <= Math.ceil(Math.log2(size)) - 1; i++) {\n      const program = new _cum_gpu.CumProgram(op, permutedX.shape, false, reverse);\n      const customValues = [[i]];\n      const prevResult = result;\n      result = backend.runWebGLProgram(program, [result], result.dtype, customValues);\n      backend.disposeIntermediateTensorInfo(prevResult);\n    }\n    // For exclusive cum, shift the end result in the direction of product or sum\n    // and add 1 for product or 0 for sum to the front index.\n    if (exclusive) {\n      const program = new _cum_gpu.CumProgram(op, permutedX.shape, exclusive, reverse);\n      const prevResult = result;\n      result = backend.runWebGLProgram(program, [result], result.dtype);\n      backend.disposeIntermediateTensorInfo(prevResult);\n    }\n    if (permutation != null) {\n      const reversePermutation = _tensorflowTfjsCore.backend_util.getUndoAxesPermutation(permutation);\n      const reverseTransposedResult = (0, _Transpose.transpose)({\n        inputs: {\n          x: result\n        },\n        backend,\n        attrs: {\n          perm: reversePermutation\n        }\n      });\n      backend.disposeIntermediateTensorInfo(result);\n      backend.disposeIntermediateTensorInfo(permutedX);\n      return reverseTransposedResult;\n    }\n    return result;\n  }\n});","lineCount":91,"map":[[7,2,21,0,"exports"],[7,9,21,0],[7,10,21,0,"cumImpl"],[7,17,21,0],[7,20,21,0,"cumImpl"],[7,27,21,0],[8,2,17,0],[8,6,17,0,"_tensorflowTfjsCore"],[8,25,17,0],[8,28,17,0,"require"],[8,35,17,0],[8,36,17,0,"_dependencyMap"],[8,50,17,0],[9,2,18,0],[9,6,18,0,"_cum_gpu"],[9,14,18,0],[9,17,18,0,"require"],[9,24,18,0],[9,25,18,0,"_dependencyMap"],[9,39,18,0],[10,2,19,0],[10,6,19,0,"_Identity"],[10,15,19,0],[10,18,19,0,"require"],[10,25,19,0],[10,26,19,0,"_dependencyMap"],[10,40,19,0],[11,2,20,0],[11,6,20,0,"_Transpose"],[11,16,20,0],[11,19,20,0,"require"],[11,26,20,0],[11,27,20,0,"_dependencyMap"],[11,41,20,0],[12,2,1,0],[13,0,2,0],[14,0,3,0],[15,0,4,0],[16,0,5,0],[17,0,6,0],[18,0,7,0],[19,0,8,0],[20,0,9,0],[21,0,10,0],[22,0,11,0],[23,0,12,0],[24,0,13,0],[25,0,14,0],[26,0,15,0],[27,0,16,0],[29,2,21,7],[29,11,21,16,"cumImpl"],[29,18,21,23,"cumImpl"],[29,19,21,24,"op"],[29,21,21,26],[29,23,21,28,"x"],[29,24,21,29],[29,26,21,31,"backend"],[29,33,21,38],[29,35,21,40,"axis"],[29,39,21,44],[29,41,21,46,"exclusive"],[29,50,21,55],[29,52,21,57,"reverse"],[29,59,21,64],[29,61,21,66],[30,4,22,4],[30,10,22,10,"xRank"],[30,15,22,15],[30,18,22,18,"x"],[30,19,22,19],[30,20,22,20,"shape"],[30,25,22,25],[30,26,22,26,"length"],[30,32,22,32],[31,4,23,4],[31,10,23,10,"permutation"],[31,21,23,21],[31,24,23,24,"backend_util"],[31,43,23,36],[31,44,23,36,"backend_util"],[31,56,23,36],[31,57,23,37,"getAxesPermutation"],[31,75,23,55],[31,76,23,56],[31,77,23,57,"axis"],[31,81,23,61],[31,82,23,62],[31,84,23,64,"xRank"],[31,89,23,69],[31,90,23,70],[32,4,24,4],[32,8,24,8,"permutedX"],[32,17,24,17],[32,20,24,20,"x"],[32,21,24,21],[33,4,25,4],[33,8,25,8,"permutation"],[33,19,25,19],[33,23,25,23],[33,27,25,27],[33,29,25,29],[34,6,26,8,"permutedX"],[34,15,26,17],[34,18,26,20],[34,22,26,20,"transpose"],[34,32,26,29],[34,33,26,29,"transpose"],[34,42,26,29],[34,44,26,30],[35,8,26,32,"inputs"],[35,14,26,38],[35,16,26,40],[36,10,26,42,"x"],[37,8,26,44],[37,9,26,45],[38,8,26,47,"backend"],[38,15,26,54],[39,8,26,56,"attrs"],[39,13,26,61],[39,15,26,63],[40,10,26,65,"perm"],[40,14,26,69],[40,16,26,71,"permutation"],[41,8,26,83],[42,6,26,85],[42,7,26,86],[42,8,26,87],[43,4,27,4],[44,4,28,4],[44,10,28,10,"permutedAxis"],[44,22,28,22],[44,25,28,25,"backend_util"],[44,44,28,37],[44,45,28,37,"backend_util"],[44,57,28,37],[44,58,28,38,"getInnerMostAxes"],[44,74,28,54],[44,75,28,55],[44,76,28,56],[44,78,28,58,"xRank"],[44,83,28,63],[44,84,28,64],[44,85,28,65],[44,86,28,66],[44,87,28,67],[45,4,29,4],[45,8,29,8,"permutedAxis"],[45,20,29,20],[45,25,29,25,"xRank"],[45,30,29,30],[45,33,29,33],[45,34,29,34],[45,36,29,36],[46,6,30,8],[46,12,30,14],[46,16,30,18,"Error"],[46,21,30,23],[46,22,30,24],[46,73,30,75,"x"],[46,74,30,76],[46,75,30,77,"shape"],[46,80,30,82],[46,81,30,83,"length"],[46,87,30,89],[46,90,30,92],[46,91,30,93],[46,94,30,96],[46,97,31,12],[46,113,31,28,"axis"],[46,117,31,32],[46,119,31,34],[46,120,31,35],[47,4,32,4],[48,4,33,4],[48,10,33,10,"size"],[48,14,33,14],[48,17,33,17,"permutedX"],[48,26,33,26],[48,27,33,27,"shape"],[48,32,33,32],[48,33,33,33,"permutedAxis"],[48,45,33,45],[48,46,33,46],[49,4,34,4],[49,8,34,8,"result"],[49,14,34,14],[49,17,34,17],[49,21,34,17,"identity"],[49,30,34,25],[49,31,34,25,"identity"],[49,39,34,25],[49,41,34,26],[50,6,34,28,"inputs"],[50,12,34,34],[50,14,34,36],[51,8,34,38,"x"],[51,9,34,39],[51,11,34,41,"permutedX"],[52,6,34,51],[52,7,34,52],[53,6,34,54,"backend"],[54,4,34,62],[54,5,34,63],[54,6,34,64],[55,4,35,4],[56,4,36,4],[57,4,37,4],[58,4,38,4],[59,4,39,4],[59,9,39,9],[59,13,39,13,"i"],[59,14,39,14],[59,17,39,17],[59,18,39,18],[59,20,39,20,"i"],[59,21,39,21],[59,25,39,25,"Math"],[59,29,39,29],[59,30,39,30,"ceil"],[59,34,39,34],[59,35,39,35,"Math"],[59,39,39,39],[59,40,39,40,"log2"],[59,44,39,44],[59,45,39,45,"size"],[59,49,39,49],[59,50,39,50],[59,51,39,51],[59,54,39,54],[59,55,39,55],[59,57,39,57,"i"],[59,58,39,58],[59,60,39,60],[59,62,39,62],[60,6,40,8],[60,12,40,14,"program"],[60,19,40,21],[60,22,40,24],[60,26,40,28,"CumProgram"],[60,34,40,38],[60,35,40,38,"CumProgram"],[60,45,40,38],[60,46,40,39,"op"],[60,48,40,41],[60,50,40,43,"permutedX"],[60,59,40,52],[60,60,40,53,"shape"],[60,65,40,58],[60,67,40,60],[60,72,40,65],[60,74,40,67,"reverse"],[60,81,40,74],[60,82,40,75],[61,6,41,8],[61,12,41,14,"customValues"],[61,24,41,26],[61,27,41,29],[61,28,41,30],[61,29,41,31,"i"],[61,30,41,32],[61,31,41,33],[61,32,41,34],[62,6,42,8],[62,12,42,14,"prevResult"],[62,22,42,24],[62,25,42,27,"result"],[62,31,42,33],[63,6,43,8,"result"],[63,12,43,14],[63,15,44,12,"backend"],[63,22,44,19],[63,23,44,20,"runWebGLProgram"],[63,38,44,35],[63,39,44,36,"program"],[63,46,44,43],[63,48,44,45],[63,49,44,46,"result"],[63,55,44,52],[63,56,44,53],[63,58,44,55,"result"],[63,64,44,61],[63,65,44,62,"dtype"],[63,70,44,67],[63,72,44,69,"customValues"],[63,84,44,81],[63,85,44,82],[64,6,45,8,"backend"],[64,13,45,15],[64,14,45,16,"disposeIntermediateTensorInfo"],[64,43,45,45],[64,44,45,46,"prevResult"],[64,54,45,56],[64,55,45,57],[65,4,46,4],[66,4,47,4],[67,4,48,4],[68,4,49,4],[68,8,49,8,"exclusive"],[68,17,49,17],[68,19,49,19],[69,6,50,8],[69,12,50,14,"program"],[69,19,50,21],[69,22,50,24],[69,26,50,28,"CumProgram"],[69,34,50,38],[69,35,50,38,"CumProgram"],[69,45,50,38],[69,46,50,39,"op"],[69,48,50,41],[69,50,50,43,"permutedX"],[69,59,50,52],[69,60,50,53,"shape"],[69,65,50,58],[69,67,50,60,"exclusive"],[69,76,50,69],[69,78,50,71,"reverse"],[69,85,50,78],[69,86,50,79],[70,6,51,8],[70,12,51,14,"prevResult"],[70,22,51,24],[70,25,51,27,"result"],[70,31,51,33],[71,6,52,8,"result"],[71,12,52,14],[71,15,52,17,"backend"],[71,22,52,24],[71,23,52,25,"runWebGLProgram"],[71,38,52,40],[71,39,52,41,"program"],[71,46,52,48],[71,48,52,50],[71,49,52,51,"result"],[71,55,52,57],[71,56,52,58],[71,58,52,60,"result"],[71,64,52,66],[71,65,52,67,"dtype"],[71,70,52,72],[71,71,52,73],[72,6,53,8,"backend"],[72,13,53,15],[72,14,53,16,"disposeIntermediateTensorInfo"],[72,43,53,45],[72,44,53,46,"prevResult"],[72,54,53,56],[72,55,53,57],[73,4,54,4],[74,4,55,4],[74,8,55,8,"permutation"],[74,19,55,19],[74,23,55,23],[74,27,55,27],[74,29,55,29],[75,6,56,8],[75,12,56,14,"reversePermutation"],[75,30,56,32],[75,33,56,35,"backend_util"],[75,52,56,47],[75,53,56,47,"backend_util"],[75,65,56,47],[75,66,56,48,"getUndoAxesPermutation"],[75,88,56,70],[75,89,56,71,"permutation"],[75,100,56,82],[75,101,56,83],[76,6,57,8],[76,12,57,14,"reverseTransposedResult"],[76,35,57,37],[76,38,57,40],[76,42,57,40,"transpose"],[76,52,57,49],[76,53,57,49,"transpose"],[76,62,57,49],[76,64,57,50],[77,8,57,52,"inputs"],[77,14,57,58],[77,16,57,60],[78,10,57,62,"x"],[78,11,57,63],[78,13,57,65,"result"],[79,8,57,72],[79,9,57,73],[80,8,57,75,"backend"],[80,15,57,82],[81,8,57,84,"attrs"],[81,13,57,89],[81,15,57,91],[82,10,57,93,"perm"],[82,14,57,97],[82,16,57,99,"reversePermutation"],[83,8,57,118],[84,6,57,120],[84,7,57,121],[84,8,57,122],[85,6,58,8,"backend"],[85,13,58,15],[85,14,58,16,"disposeIntermediateTensorInfo"],[85,43,58,45],[85,44,58,46,"result"],[85,50,58,52],[85,51,58,53],[86,6,59,8,"backend"],[86,13,59,15],[86,14,59,16,"disposeIntermediateTensorInfo"],[86,43,59,45],[86,44,59,46,"permutedX"],[86,53,59,55],[86,54,59,56],[87,6,60,8],[87,13,60,15,"reverseTransposedResult"],[87,36,60,38],[88,4,61,4],[89,4,62,4],[89,11,62,11,"result"],[89,17,62,17],[90,2,63,0],[91,0,63,1],[91,3]],"functionMap":{"names":["<global>","cumImpl"],"mappings":"AAA;OCoB;CD0C"},"hasCjsExports":false},"type":"js/module"}]}