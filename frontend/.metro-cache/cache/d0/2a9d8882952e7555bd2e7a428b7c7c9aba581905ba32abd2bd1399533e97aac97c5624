{"dependencies":[{"name":"@tensorflow/tfjs-core","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":17,"column":0,"index":703},"end":{"line":17,"column":89,"index":792}}],"key":"qIleUpSDMUXFynEGc51k60/pDSs=","exportNames":["*"],"imports":1}},{"name":"../cpu_util","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":18,"column":0,"index":793},"end":{"line":18,"column":47,"index":840}}],"key":"5L5S4GXlh/uJh1MrXQbkPSVOWm4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.conv2DBackpropFilter = conv2DBackpropFilter;\n  Object.defineProperty(exports, \"conv2DBackpropFilterConfig\", {\n    enumerable: true,\n    get: function () {\n      return conv2DBackpropFilterConfig;\n    }\n  });\n  var _tensorflowTfjsCore = require(_dependencyMap[0], \"@tensorflow/tfjs-core\");\n  var _cpu_util = require(_dependencyMap[1], \"../cpu_util\");\n  /**\n   * @license\n   * Copyright 2020 Google LLC. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   */\n\n  function conv2DBackpropFilter(args) {\n    const {\n      inputs,\n      backend,\n      attrs\n    } = args;\n    const {\n      x,\n      dy\n    } = inputs;\n    const {\n      strides,\n      pad,\n      dataFormat,\n      dimRoundingMode,\n      filterShape\n    } = attrs;\n    (0, _cpu_util.assertNotComplex)([x, dy], 'conv2dBackpropFilter');\n    const $dataFormat = _tensorflowTfjsCore.backend_util.convertConv2DDataFormat(dataFormat);\n    const convInfo = _tensorflowTfjsCore.backend_util.computeConv2DInfo(x.shape, filterShape, strides, 1 /* dilations */, pad, dimRoundingMode, false /* depthwise */, $dataFormat);\n    const {\n      strideHeight,\n      strideWidth,\n      filterHeight,\n      filterWidth\n    } = convInfo;\n    const isChannelsLast = convInfo.dataFormat === 'channelsLast';\n    const dW = new _tensorflowTfjsCore.TensorBuffer(convInfo.filterShape, 'float32');\n    const leftPad = convInfo.padInfo.left;\n    const topPad = convInfo.padInfo.top;\n    const xVals = backend.data.get(x.dataId).values;\n    const dyVals = backend.data.get(dy.dataId).values;\n    const xBuf = new _tensorflowTfjsCore.TensorBuffer(x.shape, x.dtype, xVals);\n    const dyBuf = new _tensorflowTfjsCore.TensorBuffer(dy.shape, dy.dtype, dyVals);\n    for (let wR = 0; wR < filterHeight; ++wR) {\n      const yRMin = Math.max(0, Math.ceil((topPad - wR) / strideHeight));\n      const yRMax = Math.min(convInfo.outHeight, (convInfo.inHeight + topPad - wR) / strideHeight);\n      for (let wC = 0; wC < filterWidth; ++wC) {\n        const yCMin = Math.max(0, Math.ceil((leftPad - wC) / strideWidth));\n        const yCMax = Math.min(convInfo.outWidth, (convInfo.inWidth + leftPad - wC) / strideWidth);\n        for (let d1 = 0; d1 < convInfo.inChannels; ++d1) {\n          for (let d2 = 0; d2 < convInfo.outChannels; ++d2) {\n            let dotProd = 0;\n            for (let b = 0; b < convInfo.batchSize; ++b) {\n              for (let yR = yRMin; yR < yRMax; ++yR) {\n                const xR = wR + yR * strideHeight - topPad;\n                for (let yC = yCMin; yC < yCMax; ++yC) {\n                  const xC = wC + yC * strideWidth - leftPad;\n                  if (isChannelsLast) {\n                    dotProd += xBuf.get(b, xR, xC, d1) * dyBuf.get(b, yR, yC, d2);\n                  } else {\n                    dotProd += xBuf.get(b, d1, xR, xC) * dyBuf.get(b, d2, yR, yC);\n                  }\n                }\n              }\n            }\n            dW.set(dotProd, wR, wC, d1, d2);\n          }\n        }\n      }\n    }\n    return backend.makeTensorInfo(dW.shape, dW.dtype, dW.values);\n  }\n  const conv2DBackpropFilterConfig = {\n    kernelName: _tensorflowTfjsCore.Conv2DBackpropFilter,\n    backendName: 'cpu',\n    kernelFunc: conv2DBackpropFilter\n  };\n});","lineCount":101,"map":[[7,2,19,0,"exports"],[7,9,19,0],[7,10,19,0,"conv2DBackpropFilter"],[7,30,19,0],[7,33,19,0,"conv2DBackpropFilter"],[7,53,19,0],[8,2,67,0,"Object"],[8,8,67,0],[8,9,67,0,"defineProperty"],[8,23,67,0],[8,24,67,0,"exports"],[8,31,67,0],[9,4,67,0,"enumerable"],[9,14,67,0],[10,4,67,0,"get"],[10,7,67,0],[10,18,67,0,"get"],[10,19,67,0],[11,6,67,0],[11,13,67,0,"conv2DBackpropFilterConfig"],[11,39,67,0],[12,4,67,0],[13,2,67,0],[14,2,17,0],[14,6,17,0,"_tensorflowTfjsCore"],[14,25,17,0],[14,28,17,0,"require"],[14,35,17,0],[14,36,17,0,"_dependencyMap"],[14,50,17,0],[15,2,18,0],[15,6,18,0,"_cpu_util"],[15,15,18,0],[15,18,18,0,"require"],[15,25,18,0],[15,26,18,0,"_dependencyMap"],[15,40,18,0],[16,2,1,0],[17,0,2,0],[18,0,3,0],[19,0,4,0],[20,0,5,0],[21,0,6,0],[22,0,7,0],[23,0,8,0],[24,0,9,0],[25,0,10,0],[26,0,11,0],[27,0,12,0],[28,0,13,0],[29,0,14,0],[30,0,15,0],[31,0,16,0],[33,2,19,7],[33,11,19,16,"conv2DBackpropFilter"],[33,31,19,36,"conv2DBackpropFilter"],[33,32,19,37,"args"],[33,36,19,41],[33,38,19,43],[34,4,20,4],[34,10,20,10],[35,6,20,12,"inputs"],[35,12,20,18],[36,6,20,20,"backend"],[36,13,20,27],[37,6,20,29,"attrs"],[38,4,20,35],[38,5,20,36],[38,8,20,39,"args"],[38,12,20,43],[39,4,21,4],[39,10,21,10],[40,6,21,12,"x"],[40,7,21,13],[41,6,21,15,"dy"],[42,4,21,18],[42,5,21,19],[42,8,21,22,"inputs"],[42,14,21,28],[43,4,22,4],[43,10,22,10],[44,6,22,12,"strides"],[44,13,22,19],[45,6,22,21,"pad"],[45,9,22,24],[46,6,22,26,"dataFormat"],[46,16,22,36],[47,6,22,38,"dimRoundingMode"],[47,21,22,53],[48,6,22,55,"filterShape"],[49,4,22,67],[49,5,22,68],[49,8,22,71,"attrs"],[49,13,22,76],[50,4,23,4],[50,8,23,4,"assertNotComplex"],[50,17,23,20],[50,18,23,20,"assertNotComplex"],[50,34,23,20],[50,36,23,21],[50,37,23,22,"x"],[50,38,23,23],[50,40,23,25,"dy"],[50,42,23,27],[50,43,23,28],[50,45,23,30],[50,67,23,52],[50,68,23,53],[51,4,24,4],[51,10,24,10,"$dataFormat"],[51,21,24,21],[51,24,24,24,"backend_util"],[51,43,24,36],[51,44,24,36,"backend_util"],[51,56,24,36],[51,57,24,37,"convertConv2DDataFormat"],[51,80,24,60],[51,81,24,61,"dataFormat"],[51,91,24,71],[51,92,24,72],[52,4,25,4],[52,10,25,10,"convInfo"],[52,18,25,18],[52,21,25,21,"backend_util"],[52,40,25,33],[52,41,25,33,"backend_util"],[52,53,25,33],[52,54,25,34,"computeConv2DInfo"],[52,71,25,51],[52,72,25,52,"x"],[52,73,25,53],[52,74,25,54,"shape"],[52,79,25,59],[52,81,25,61,"filterShape"],[52,92,25,72],[52,94,25,74,"strides"],[52,101,25,81],[52,103,25,83],[52,104,25,84],[52,105,25,85],[52,122,25,102,"pad"],[52,125,25,105],[52,127,25,107,"dimRoundingMode"],[52,142,25,122],[52,144,25,124],[52,149,25,129],[52,150,25,130],[52,167,25,147,"$dataFormat"],[52,178,25,158],[52,179,25,159],[53,4,26,4],[53,10,26,10],[54,6,26,12,"strideHeight"],[54,18,26,24],[55,6,26,26,"strideWidth"],[55,17,26,37],[56,6,26,39,"filterHeight"],[56,18,26,51],[57,6,26,53,"filterWidth"],[58,4,26,65],[58,5,26,66],[58,8,26,69,"convInfo"],[58,16,26,77],[59,4,27,4],[59,10,27,10,"isChannelsLast"],[59,24,27,24],[59,27,27,27,"convInfo"],[59,35,27,35],[59,36,27,36,"dataFormat"],[59,46,27,46],[59,51,27,51],[59,65,27,65],[60,4,28,4],[60,10,28,10,"dW"],[60,12,28,12],[60,15,28,15],[60,19,28,19,"TensorBuffer"],[60,38,28,31],[60,39,28,31,"TensorBuffer"],[60,51,28,31],[60,52,28,32,"convInfo"],[60,60,28,40],[60,61,28,41,"filterShape"],[60,72,28,52],[60,74,28,54],[60,83,28,63],[60,84,28,64],[61,4,29,4],[61,10,29,10,"leftPad"],[61,17,29,17],[61,20,29,20,"convInfo"],[61,28,29,28],[61,29,29,29,"padInfo"],[61,36,29,36],[61,37,29,37,"left"],[61,41,29,41],[62,4,30,4],[62,10,30,10,"topPad"],[62,16,30,16],[62,19,30,19,"convInfo"],[62,27,30,27],[62,28,30,28,"padInfo"],[62,35,30,35],[62,36,30,36,"top"],[62,39,30,39],[63,4,31,4],[63,10,31,10,"xVals"],[63,15,31,15],[63,18,31,18,"backend"],[63,25,31,25],[63,26,31,26,"data"],[63,30,31,30],[63,31,31,31,"get"],[63,34,31,34],[63,35,31,35,"x"],[63,36,31,36],[63,37,31,37,"dataId"],[63,43,31,43],[63,44,31,44],[63,45,31,45,"values"],[63,51,31,51],[64,4,32,4],[64,10,32,10,"dyVals"],[64,16,32,16],[64,19,32,19,"backend"],[64,26,32,26],[64,27,32,27,"data"],[64,31,32,31],[64,32,32,32,"get"],[64,35,32,35],[64,36,32,36,"dy"],[64,38,32,38],[64,39,32,39,"dataId"],[64,45,32,45],[64,46,32,46],[64,47,32,47,"values"],[64,53,32,53],[65,4,33,4],[65,10,33,10,"xBuf"],[65,14,33,14],[65,17,33,17],[65,21,33,21,"TensorBuffer"],[65,40,33,33],[65,41,33,33,"TensorBuffer"],[65,53,33,33],[65,54,33,34,"x"],[65,55,33,35],[65,56,33,36,"shape"],[65,61,33,41],[65,63,33,43,"x"],[65,64,33,44],[65,65,33,45,"dtype"],[65,70,33,50],[65,72,33,52,"xVals"],[65,77,33,57],[65,78,33,58],[66,4,34,4],[66,10,34,10,"dyBuf"],[66,15,34,15],[66,18,34,18],[66,22,34,22,"TensorBuffer"],[66,41,34,34],[66,42,34,34,"TensorBuffer"],[66,54,34,34],[66,55,34,35,"dy"],[66,57,34,37],[66,58,34,38,"shape"],[66,63,34,43],[66,65,34,45,"dy"],[66,67,34,47],[66,68,34,48,"dtype"],[66,73,34,53],[66,75,34,55,"dyVals"],[66,81,34,61],[66,82,34,62],[67,4,35,4],[67,9,35,9],[67,13,35,13,"wR"],[67,15,35,15],[67,18,35,18],[67,19,35,19],[67,21,35,21,"wR"],[67,23,35,23],[67,26,35,26,"filterHeight"],[67,38,35,38],[67,40,35,40],[67,42,35,42,"wR"],[67,44,35,44],[67,46,35,46],[68,6,36,8],[68,12,36,14,"yRMin"],[68,17,36,19],[68,20,36,22,"Math"],[68,24,36,26],[68,25,36,27,"max"],[68,28,36,30],[68,29,36,31],[68,30,36,32],[68,32,36,34,"Math"],[68,36,36,38],[68,37,36,39,"ceil"],[68,41,36,43],[68,42,36,44],[68,43,36,45,"topPad"],[68,49,36,51],[68,52,36,54,"wR"],[68,54,36,56],[68,58,36,60,"strideHeight"],[68,70,36,72],[68,71,36,73],[68,72,36,74],[69,6,37,8],[69,12,37,14,"yRMax"],[69,17,37,19],[69,20,37,22,"Math"],[69,24,37,26],[69,25,37,27,"min"],[69,28,37,30],[69,29,37,31,"convInfo"],[69,37,37,39],[69,38,37,40,"outHeight"],[69,47,37,49],[69,49,37,51],[69,50,37,52,"convInfo"],[69,58,37,60],[69,59,37,61,"inHeight"],[69,67,37,69],[69,70,37,72,"topPad"],[69,76,37,78],[69,79,37,81,"wR"],[69,81,37,83],[69,85,37,87,"strideHeight"],[69,97,37,99],[69,98,37,100],[70,6,38,8],[70,11,38,13],[70,15,38,17,"wC"],[70,17,38,19],[70,20,38,22],[70,21,38,23],[70,23,38,25,"wC"],[70,25,38,27],[70,28,38,30,"filterWidth"],[70,39,38,41],[70,41,38,43],[70,43,38,45,"wC"],[70,45,38,47],[70,47,38,49],[71,8,39,12],[71,14,39,18,"yCMin"],[71,19,39,23],[71,22,39,26,"Math"],[71,26,39,30],[71,27,39,31,"max"],[71,30,39,34],[71,31,39,35],[71,32,39,36],[71,34,39,38,"Math"],[71,38,39,42],[71,39,39,43,"ceil"],[71,43,39,47],[71,44,39,48],[71,45,39,49,"leftPad"],[71,52,39,56],[71,55,39,59,"wC"],[71,57,39,61],[71,61,39,65,"strideWidth"],[71,72,39,76],[71,73,39,77],[71,74,39,78],[72,8,40,12],[72,14,40,18,"yCMax"],[72,19,40,23],[72,22,40,26,"Math"],[72,26,40,30],[72,27,40,31,"min"],[72,30,40,34],[72,31,40,35,"convInfo"],[72,39,40,43],[72,40,40,44,"outWidth"],[72,48,40,52],[72,50,40,54],[72,51,40,55,"convInfo"],[72,59,40,63],[72,60,40,64,"inWidth"],[72,67,40,71],[72,70,40,74,"leftPad"],[72,77,40,81],[72,80,40,84,"wC"],[72,82,40,86],[72,86,40,90,"strideWidth"],[72,97,40,101],[72,98,40,102],[73,8,41,12],[73,13,41,17],[73,17,41,21,"d1"],[73,19,41,23],[73,22,41,26],[73,23,41,27],[73,25,41,29,"d1"],[73,27,41,31],[73,30,41,34,"convInfo"],[73,38,41,42],[73,39,41,43,"inChannels"],[73,49,41,53],[73,51,41,55],[73,53,41,57,"d1"],[73,55,41,59],[73,57,41,61],[74,10,42,16],[74,15,42,21],[74,19,42,25,"d2"],[74,21,42,27],[74,24,42,30],[74,25,42,31],[74,27,42,33,"d2"],[74,29,42,35],[74,32,42,38,"convInfo"],[74,40,42,46],[74,41,42,47,"outChannels"],[74,52,42,58],[74,54,42,60],[74,56,42,62,"d2"],[74,58,42,64],[74,60,42,66],[75,12,43,20],[75,16,43,24,"dotProd"],[75,23,43,31],[75,26,43,34],[75,27,43,35],[76,12,44,20],[76,17,44,25],[76,21,44,29,"b"],[76,22,44,30],[76,25,44,33],[76,26,44,34],[76,28,44,36,"b"],[76,29,44,37],[76,32,44,40,"convInfo"],[76,40,44,48],[76,41,44,49,"batchSize"],[76,50,44,58],[76,52,44,60],[76,54,44,62,"b"],[76,55,44,63],[76,57,44,65],[77,14,45,24],[77,19,45,29],[77,23,45,33,"yR"],[77,25,45,35],[77,28,45,38,"yRMin"],[77,33,45,43],[77,35,45,45,"yR"],[77,37,45,47],[77,40,45,50,"yRMax"],[77,45,45,55],[77,47,45,57],[77,49,45,59,"yR"],[77,51,45,61],[77,53,45,63],[78,16,46,28],[78,22,46,34,"xR"],[78,24,46,36],[78,27,46,39,"wR"],[78,29,46,41],[78,32,46,44,"yR"],[78,34,46,46],[78,37,46,49,"strideHeight"],[78,49,46,61],[78,52,46,64,"topPad"],[78,58,46,70],[79,16,47,28],[79,21,47,33],[79,25,47,37,"yC"],[79,27,47,39],[79,30,47,42,"yCMin"],[79,35,47,47],[79,37,47,49,"yC"],[79,39,47,51],[79,42,47,54,"yCMax"],[79,47,47,59],[79,49,47,61],[79,51,47,63,"yC"],[79,53,47,65],[79,55,47,67],[80,18,48,32],[80,24,48,38,"xC"],[80,26,48,40],[80,29,48,43,"wC"],[80,31,48,45],[80,34,48,48,"yC"],[80,36,48,50],[80,39,48,53,"strideWidth"],[80,50,48,64],[80,53,48,67,"leftPad"],[80,60,48,74],[81,18,49,32],[81,22,49,36,"isChannelsLast"],[81,36,49,50],[81,38,49,52],[82,20,50,36,"dotProd"],[82,27,50,43],[82,31,50,47,"xBuf"],[82,35,50,51],[82,36,50,52,"get"],[82,39,50,55],[82,40,50,56,"b"],[82,41,50,57],[82,43,50,59,"xR"],[82,45,50,61],[82,47,50,63,"xC"],[82,49,50,65],[82,51,50,67,"d1"],[82,53,50,69],[82,54,50,70],[82,57,51,40,"dyBuf"],[82,62,51,45],[82,63,51,46,"get"],[82,66,51,49],[82,67,51,50,"b"],[82,68,51,51],[82,70,51,53,"yR"],[82,72,51,55],[82,74,51,57,"yC"],[82,76,51,59],[82,78,51,61,"d2"],[82,80,51,63],[82,81,51,64],[83,18,52,32],[83,19,52,33],[83,25,53,37],[84,20,54,36,"dotProd"],[84,27,54,43],[84,31,54,47,"xBuf"],[84,35,54,51],[84,36,54,52,"get"],[84,39,54,55],[84,40,54,56,"b"],[84,41,54,57],[84,43,54,59,"d1"],[84,45,54,61],[84,47,54,63,"xR"],[84,49,54,65],[84,51,54,67,"xC"],[84,53,54,69],[84,54,54,70],[84,57,55,40,"dyBuf"],[84,62,55,45],[84,63,55,46,"get"],[84,66,55,49],[84,67,55,50,"b"],[84,68,55,51],[84,70,55,53,"d2"],[84,72,55,55],[84,74,55,57,"yR"],[84,76,55,59],[84,78,55,61,"yC"],[84,80,55,63],[84,81,55,64],[85,18,56,32],[86,16,57,28],[87,14,58,24],[88,12,59,20],[89,12,60,20,"dW"],[89,14,60,22],[89,15,60,23,"set"],[89,18,60,26],[89,19,60,27,"dotProd"],[89,26,60,34],[89,28,60,36,"wR"],[89,30,60,38],[89,32,60,40,"wC"],[89,34,60,42],[89,36,60,44,"d1"],[89,38,60,46],[89,40,60,48,"d2"],[89,42,60,50],[89,43,60,51],[90,10,61,16],[91,8,62,12],[92,6,63,8],[93,4,64,4],[94,4,65,4],[94,11,65,11,"backend"],[94,18,65,18],[94,19,65,19,"makeTensorInfo"],[94,33,65,33],[94,34,65,34,"dW"],[94,36,65,36],[94,37,65,37,"shape"],[94,42,65,42],[94,44,65,44,"dW"],[94,46,65,46],[94,47,65,47,"dtype"],[94,52,65,52],[94,54,65,54,"dW"],[94,56,65,56],[94,57,65,57,"values"],[94,63,65,63],[94,64,65,64],[95,2,66,0],[96,2,67,7],[96,8,67,13,"conv2DBackpropFilterConfig"],[96,34,67,39],[96,37,67,42],[97,4,68,4,"kernelName"],[97,14,68,14],[97,16,68,16,"Conv2DBackpropFilter"],[97,35,68,36],[97,36,68,36,"Conv2DBackpropFilter"],[97,56,68,36],[98,4,69,4,"backendName"],[98,15,69,15],[98,17,69,17],[98,22,69,22],[99,4,70,4,"kernelFunc"],[99,14,70,14],[99,16,70,16,"conv2DBackpropFilter"],[100,2,71,0],[100,3,71,1],[101,0,71,2],[101,3]],"functionMap":{"names":["<global>","conv2DBackpropFilter"],"mappings":"AAA;OCkB;CD+C"},"hasCjsExports":false},"type":"js/module"}]}