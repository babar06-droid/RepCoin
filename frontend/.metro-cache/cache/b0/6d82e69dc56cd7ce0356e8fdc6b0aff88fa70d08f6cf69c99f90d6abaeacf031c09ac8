{"dependencies":[{"name":"../engine","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":17,"column":0,"index":703},"end":{"line":17,"column":35,"index":738}}],"key":"zbTTi8rtwr8rjl75PzEo829Yvss=","exportNames":["*"],"imports":1}},{"name":"../globals","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":18,"column":0,"index":739},"end":{"line":18,"column":43,"index":782}}],"key":"rU7cy1Ex6BVXJU7MHjl4QiD+5lg=","exportNames":["*"],"imports":1}},{"name":"../ops/add","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":19,"column":0,"index":783},"end":{"line":19,"column":33,"index":816}}],"key":"7ECkFW8cIZ5BD7vBhwC0T14nXmk=","exportNames":["*"],"imports":1}},{"name":"../ops/div","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":20,"column":0,"index":817},"end":{"line":20,"column":33,"index":850}}],"key":"k/BZM+SZS6CPUrneNct7M5x21sM=","exportNames":["*"],"imports":1}},{"name":"../ops/fill","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":21,"column":0,"index":851},"end":{"line":21,"column":35,"index":886}}],"key":"yVUK14gi4e3jKH5qrdOIDyqkGzA=","exportNames":["*"],"imports":1}},{"name":"../ops/mul","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":22,"column":0,"index":887},"end":{"line":22,"column":33,"index":920}}],"key":"8VMM/o0r3nOvGtT2jgKf2KxknFk=","exportNames":["*"],"imports":1}},{"name":"../ops/sqrt","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":23,"column":0,"index":921},"end":{"line":23,"column":35,"index":956}}],"key":"PcaQNhscTwV8sF4HCdr2G4ztorg=","exportNames":["*"],"imports":1}},{"name":"../ops/square","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":24,"column":0,"index":957},"end":{"line":24,"column":39,"index":996}}],"key":"dzrBPVh0nJ0Zsg34oq5kewvGmfA=","exportNames":["*"],"imports":1}},{"name":"./optimizer","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":25,"column":0,"index":997},"end":{"line":25,"column":40,"index":1037}}],"key":"hbQXeB4H5XapH+aEsxZCo0wGw68=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"AdagradOptimizer\", {\n    enumerable: true,\n    get: function () {\n      return AdagradOptimizer;\n    }\n  });\n  var _engine = require(_dependencyMap[0], \"../engine\");\n  var _globals = require(_dependencyMap[1], \"../globals\");\n  var _opsAdd = require(_dependencyMap[2], \"../ops/add\");\n  var _opsDiv = require(_dependencyMap[3], \"../ops/div\");\n  var _opsFill = require(_dependencyMap[4], \"../ops/fill\");\n  var _opsMul = require(_dependencyMap[5], \"../ops/mul\");\n  var _opsSqrt = require(_dependencyMap[6], \"../ops/sqrt\");\n  var _opsSquare = require(_dependencyMap[7], \"../ops/square\");\n  var _optimizer = require(_dependencyMap[8], \"./optimizer\");\n  /**\n   * @license\n   * Copyright 2018 Google LLC. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   */\n\n  /** @doclink Optimizer */\n  class AdagradOptimizer extends _optimizer.Optimizer {\n    /** @nocollapse */\n    static get className() {\n      // Name matters for Python compatibility.\n      // This is a getter instead of a property because when it's a property, it\n      // prevents the entire class from being tree-shaken.\n      return 'Adagrad';\n    }\n    constructor(learningRate, initialAccumulatorValue = 0.1) {\n      super();\n      this.learningRate = learningRate;\n      this.initialAccumulatorValue = initialAccumulatorValue;\n      this.accumulatedGrads = [];\n    }\n    applyGradients(variableGradients) {\n      const variableNames = Array.isArray(variableGradients) ? variableGradients.map(item => item.name) : Object.keys(variableGradients);\n      variableNames.forEach((name, i) => {\n        const value = _engine.ENGINE.registeredVariables[name];\n        if (this.accumulatedGrads[i] == null) {\n          const trainable = false;\n          this.accumulatedGrads[i] = {\n            originalName: `${name}/accumulator`,\n            variable: (0, _globals.tidy)(() => (0, _opsFill.fill)(value.shape, this.initialAccumulatorValue).variable(trainable))\n          };\n        }\n        const gradient = Array.isArray(variableGradients) ? variableGradients[i].tensor : variableGradients[name];\n        if (gradient == null) {\n          return;\n        }\n        const accumulatedGrad = this.accumulatedGrads[i].variable;\n        (0, _globals.tidy)(() => {\n          const newAccumulatedGrad = (0, _opsAdd.add)(accumulatedGrad, (0, _opsSquare.square)(gradient));\n          accumulatedGrad.assign(newAccumulatedGrad);\n          const newValue = (0, _opsAdd.add)((0, _opsMul.mul)((0, _opsDiv.div)(gradient, (0, _opsSqrt.sqrt)((0, _opsAdd.add)(newAccumulatedGrad, _engine.ENGINE.backend.epsilon()))), -this.learningRate), value);\n          value.assign(newValue);\n        });\n      });\n      this.incrementIterations();\n    }\n    dispose() {\n      if (this.accumulatedGrads != null) {\n        (0, _globals.dispose)(this.accumulatedGrads.map(v => v.variable));\n      }\n    }\n    async getWeights() {\n      // Order matters for Python compatibility.\n      return [await this.saveIterations()].concat(this.accumulatedGrads.map(v => ({\n        name: v.originalName,\n        tensor: v.variable\n      })));\n    }\n    async setWeights(weightValues) {\n      weightValues = await this.extractIterations(weightValues);\n      const trainable = false;\n      this.accumulatedGrads = weightValues.map(v => ({\n        originalName: v.name,\n        variable: v.tensor.variable(trainable)\n      }));\n    }\n    getConfig() {\n      return {\n        'learningRate': this.learningRate,\n        'initialAccumulatorValue': this.initialAccumulatorValue\n      };\n    }\n    /** @nocollapse */\n    static fromConfig(cls, config) {\n      return new cls(config['learningRate'], config['initialAccumulatorValue']);\n    }\n  }\n});","lineCount":110,"map":[[7,2,27,0,"Object"],[7,8,27,0],[7,9,27,0,"defineProperty"],[7,23,27,0],[7,24,27,0,"exports"],[7,31,27,0],[8,4,27,0,"enumerable"],[8,14,27,0],[9,4,27,0,"get"],[9,7,27,0],[9,18,27,0,"get"],[9,19,27,0],[10,6,27,0],[10,13,27,0,"AdagradOptimizer"],[10,29,27,0],[11,4,27,0],[12,2,27,0],[13,2,17,0],[13,6,17,0,"_engine"],[13,13,17,0],[13,16,17,0,"require"],[13,23,17,0],[13,24,17,0,"_dependencyMap"],[13,38,17,0],[14,2,18,0],[14,6,18,0,"_globals"],[14,14,18,0],[14,17,18,0,"require"],[14,24,18,0],[14,25,18,0,"_dependencyMap"],[14,39,18,0],[15,2,19,0],[15,6,19,0,"_opsAdd"],[15,13,19,0],[15,16,19,0,"require"],[15,23,19,0],[15,24,19,0,"_dependencyMap"],[15,38,19,0],[16,2,20,0],[16,6,20,0,"_opsDiv"],[16,13,20,0],[16,16,20,0,"require"],[16,23,20,0],[16,24,20,0,"_dependencyMap"],[16,38,20,0],[17,2,21,0],[17,6,21,0,"_opsFill"],[17,14,21,0],[17,17,21,0,"require"],[17,24,21,0],[17,25,21,0,"_dependencyMap"],[17,39,21,0],[18,2,22,0],[18,6,22,0,"_opsMul"],[18,13,22,0],[18,16,22,0,"require"],[18,23,22,0],[18,24,22,0,"_dependencyMap"],[18,38,22,0],[19,2,23,0],[19,6,23,0,"_opsSqrt"],[19,14,23,0],[19,17,23,0,"require"],[19,24,23,0],[19,25,23,0,"_dependencyMap"],[19,39,23,0],[20,2,24,0],[20,6,24,0,"_opsSquare"],[20,16,24,0],[20,19,24,0,"require"],[20,26,24,0],[20,27,24,0,"_dependencyMap"],[20,41,24,0],[21,2,25,0],[21,6,25,0,"_optimizer"],[21,16,25,0],[21,19,25,0,"require"],[21,26,25,0],[21,27,25,0,"_dependencyMap"],[21,41,25,0],[22,2,1,0],[23,0,2,0],[24,0,3,0],[25,0,4,0],[26,0,5,0],[27,0,6,0],[28,0,7,0],[29,0,8,0],[30,0,9,0],[31,0,10,0],[32,0,11,0],[33,0,12,0],[34,0,13,0],[35,0,14,0],[36,0,15,0],[37,0,16,0],[39,2,26,0],[40,2,27,7],[40,8,27,13,"AdagradOptimizer"],[40,24,27,29],[40,33,27,38,"Optimizer"],[40,43,27,47],[40,44,27,47,"Optimizer"],[40,53,27,47],[40,54,27,48],[41,4,28,4],[42,4,29,4],[42,15,29,15,"className"],[42,24,29,24,"className"],[42,25,29,24],[42,27,29,27],[43,6,30,8],[44,6,31,8],[45,6,32,8],[46,6,33,8],[46,13,33,15],[46,22,33,24],[47,4,34,4],[48,4,35,4,"constructor"],[48,15,35,15,"constructor"],[48,16,35,16,"learningRate"],[48,28,35,28],[48,30,35,30,"initialAccumulatorValue"],[48,53,35,53],[48,56,35,56],[48,59,35,59],[48,61,35,61],[49,6,36,8],[49,11,36,13],[49,12,36,14],[49,13,36,15],[50,6,37,8],[50,10,37,12],[50,11,37,13,"learningRate"],[50,23,37,25],[50,26,37,28,"learningRate"],[50,38,37,40],[51,6,38,8],[51,10,38,12],[51,11,38,13,"initialAccumulatorValue"],[51,34,38,36],[51,37,38,39,"initialAccumulatorValue"],[51,60,38,62],[52,6,39,8],[52,10,39,12],[52,11,39,13,"accumulatedGrads"],[52,27,39,29],[52,30,39,32],[52,32,39,34],[53,4,40,4],[54,4,41,4,"applyGradients"],[54,18,41,18,"applyGradients"],[54,19,41,19,"variableGradients"],[54,36,41,36],[54,38,41,38],[55,6,42,8],[55,12,42,14,"variableNames"],[55,25,42,27],[55,28,42,30,"Array"],[55,33,42,35],[55,34,42,36,"isArray"],[55,41,42,43],[55,42,42,44,"variableGradients"],[55,59,42,61],[55,60,42,62],[55,63,43,12,"variableGradients"],[55,80,43,29],[55,81,43,30,"map"],[55,84,43,33],[55,85,43,34,"item"],[55,89,43,38],[55,93,43,42,"item"],[55,97,43,46],[55,98,43,47,"name"],[55,102,43,51],[55,103,43,52],[55,106,44,12,"Object"],[55,112,44,18],[55,113,44,19,"keys"],[55,117,44,23],[55,118,44,24,"variableGradients"],[55,135,44,41],[55,136,44,42],[56,6,45,8,"variableNames"],[56,19,45,21],[56,20,45,22,"forEach"],[56,27,45,29],[56,28,45,30],[56,29,45,31,"name"],[56,33,45,35],[56,35,45,37,"i"],[56,36,45,38],[56,41,45,43],[57,8,46,12],[57,14,46,18,"value"],[57,19,46,23],[57,22,46,26,"ENGINE"],[57,29,46,32],[57,30,46,32,"ENGINE"],[57,36,46,32],[57,37,46,33,"registeredVariables"],[57,56,46,52],[57,57,46,53,"name"],[57,61,46,57],[57,62,46,58],[58,8,47,12],[58,12,47,16],[58,16,47,20],[58,17,47,21,"accumulatedGrads"],[58,33,47,37],[58,34,47,38,"i"],[58,35,47,39],[58,36,47,40],[58,40,47,44],[58,44,47,48],[58,46,47,50],[59,10,48,16],[59,16,48,22,"trainable"],[59,25,48,31],[59,28,48,34],[59,33,48,39],[60,10,49,16],[60,14,49,20],[60,15,49,21,"accumulatedGrads"],[60,31,49,37],[60,32,49,38,"i"],[60,33,49,39],[60,34,49,40],[60,37,49,43],[61,12,50,20,"originalName"],[61,24,50,32],[61,26,50,34],[61,29,50,37,"name"],[61,33,50,41],[61,47,50,55],[62,12,51,20,"variable"],[62,20,51,28],[62,22,51,30],[62,26,51,30,"tidy"],[62,34,51,34],[62,35,51,34,"tidy"],[62,39,51,34],[62,41,51,35],[62,47,51,41],[62,51,51,41,"fill"],[62,59,51,45],[62,60,51,45,"fill"],[62,64,51,45],[62,66,51,46,"value"],[62,71,51,51],[62,72,51,52,"shape"],[62,77,51,57],[62,79,51,59],[62,83,51,63],[62,84,51,64,"initialAccumulatorValue"],[62,107,51,87],[62,108,51,88],[62,109,52,25,"variable"],[62,117,52,33],[62,118,52,34,"trainable"],[62,127,52,43],[62,128,52,44],[63,10,53,16],[63,11,53,17],[64,8,54,12],[65,8,55,12],[65,14,55,18,"gradient"],[65,22,55,26],[65,25,55,29,"Array"],[65,30,55,34],[65,31,55,35,"isArray"],[65,38,55,42],[65,39,55,43,"variableGradients"],[65,56,55,60],[65,57,55,61],[65,60,56,16,"variableGradients"],[65,77,56,33],[65,78,56,34,"i"],[65,79,56,35],[65,80,56,36],[65,81,56,37,"tensor"],[65,87,56,43],[65,90,57,16,"variableGradients"],[65,107,57,33],[65,108,57,34,"name"],[65,112,57,38],[65,113,57,39],[66,8,58,12],[66,12,58,16,"gradient"],[66,20,58,24],[66,24,58,28],[66,28,58,32],[66,30,58,34],[67,10,59,16],[68,8,60,12],[69,8,61,12],[69,14,61,18,"accumulatedGrad"],[69,29,61,33],[69,32,61,36],[69,36,61,40],[69,37,61,41,"accumulatedGrads"],[69,53,61,57],[69,54,61,58,"i"],[69,55,61,59],[69,56,61,60],[69,57,61,61,"variable"],[69,65,61,69],[70,8,62,12],[70,12,62,12,"tidy"],[70,20,62,16],[70,21,62,16,"tidy"],[70,25,62,16],[70,27,62,17],[70,33,62,23],[71,10,63,16],[71,16,63,22,"newAccumulatedGrad"],[71,34,63,40],[71,37,63,43],[71,41,63,43,"add"],[71,48,63,46],[71,49,63,46,"add"],[71,52,63,46],[71,54,63,47,"accumulatedGrad"],[71,69,63,62],[71,71,63,64],[71,75,63,64,"square"],[71,85,63,70],[71,86,63,70,"square"],[71,92,63,70],[71,94,63,71,"gradient"],[71,102,63,79],[71,103,63,80],[71,104,63,81],[72,10,64,16,"accumulatedGrad"],[72,25,64,31],[72,26,64,32,"assign"],[72,32,64,38],[72,33,64,39,"newAccumulatedGrad"],[72,51,64,57],[72,52,64,58],[73,10,65,16],[73,16,65,22,"newValue"],[73,24,65,30],[73,27,65,33],[73,31,65,33,"add"],[73,38,65,36],[73,39,65,36,"add"],[73,42,65,36],[73,44,65,37],[73,48,65,37,"mul"],[73,55,65,40],[73,56,65,40,"mul"],[73,59,65,40],[73,61,65,41],[73,65,65,41,"div"],[73,72,65,44],[73,73,65,44,"div"],[73,76,65,44],[73,78,65,45,"gradient"],[73,86,65,53],[73,88,65,55],[73,92,65,55,"sqrt"],[73,100,65,59],[73,101,65,59,"sqrt"],[73,105,65,59],[73,107,65,60],[73,111,65,60,"add"],[73,118,65,63],[73,119,65,63,"add"],[73,122,65,63],[73,124,65,64,"newAccumulatedGrad"],[73,142,65,82],[73,144,65,84,"ENGINE"],[73,151,65,90],[73,152,65,90,"ENGINE"],[73,158,65,90],[73,159,65,91,"backend"],[73,166,65,98],[73,167,65,99,"epsilon"],[73,174,65,106],[73,175,65,107],[73,176,65,108],[73,177,65,109],[73,178,65,110],[73,179,65,111],[73,181,65,113],[73,182,65,114],[73,186,65,118],[73,187,65,119,"learningRate"],[73,199,65,131],[73,200,65,132],[73,202,65,134,"value"],[73,207,65,139],[73,208,65,140],[74,10,66,16,"value"],[74,15,66,21],[74,16,66,22,"assign"],[74,22,66,28],[74,23,66,29,"newValue"],[74,31,66,37],[74,32,66,38],[75,8,67,12],[75,9,67,13],[75,10,67,14],[76,6,68,8],[76,7,68,9],[76,8,68,10],[77,6,69,8],[77,10,69,12],[77,11,69,13,"incrementIterations"],[77,30,69,32],[77,31,69,33],[77,32,69,34],[78,4,70,4],[79,4,71,4,"dispose"],[79,11,71,11,"dispose"],[79,12,71,11],[79,14,71,14],[80,6,72,8],[80,10,72,12],[80,14,72,16],[80,15,72,17,"accumulatedGrads"],[80,31,72,33],[80,35,72,37],[80,39,72,41],[80,41,72,43],[81,8,73,12],[81,12,73,12,"dispose"],[81,20,73,19],[81,21,73,19,"dispose"],[81,28,73,19],[81,30,73,20],[81,34,73,24],[81,35,73,25,"accumulatedGrads"],[81,51,73,41],[81,52,73,42,"map"],[81,55,73,45],[81,56,73,46,"v"],[81,57,73,47],[81,61,73,51,"v"],[81,62,73,52],[81,63,73,53,"variable"],[81,71,73,61],[81,72,73,62],[81,73,73,63],[82,6,74,8],[83,4,75,4],[84,4,76,4],[84,10,76,10,"getWeights"],[84,20,76,20,"getWeights"],[84,21,76,20],[84,23,76,23],[85,6,77,8],[86,6,78,8],[86,13,78,15],[86,14,78,16],[86,20,78,22],[86,24,78,26],[86,25,78,27,"saveIterations"],[86,39,78,41],[86,40,78,42],[86,41,78,43],[86,42,78,44],[86,43,78,45,"concat"],[86,49,78,51],[86,50,78,52],[86,54,78,56],[86,55,78,57,"accumulatedGrads"],[86,71,78,73],[86,72,78,74,"map"],[86,75,78,77],[86,76,78,78,"v"],[86,77,78,79],[86,82,78,84],[87,8,78,86,"name"],[87,12,78,90],[87,14,78,92,"v"],[87,15,78,93],[87,16,78,94,"originalName"],[87,28,78,106],[88,8,78,108,"tensor"],[88,14,78,114],[88,16,78,116,"v"],[88,17,78,117],[88,18,78,118,"variable"],[89,6,78,127],[89,7,78,128],[89,8,78,129],[89,9,78,130],[89,10,78,131],[90,4,79,4],[91,4,80,4],[91,10,80,10,"setWeights"],[91,20,80,20,"setWeights"],[91,21,80,21,"weightValues"],[91,33,80,33],[91,35,80,35],[92,6,81,8,"weightValues"],[92,18,81,20],[92,21,81,23],[92,27,81,29],[92,31,81,33],[92,32,81,34,"extractIterations"],[92,49,81,51],[92,50,81,52,"weightValues"],[92,62,81,64],[92,63,81,65],[93,6,82,8],[93,12,82,14,"trainable"],[93,21,82,23],[93,24,82,26],[93,29,82,31],[94,6,83,8],[94,10,83,12],[94,11,83,13,"accumulatedGrads"],[94,27,83,29],[94,30,83,32,"weightValues"],[94,42,83,44],[94,43,83,45,"map"],[94,46,83,48],[94,47,83,49,"v"],[94,48,83,50],[94,53,83,55],[95,8,83,57,"originalName"],[95,20,83,69],[95,22,83,71,"v"],[95,23,83,72],[95,24,83,73,"name"],[95,28,83,77],[96,8,83,79,"variable"],[96,16,83,87],[96,18,83,89,"v"],[96,19,83,90],[96,20,83,91,"tensor"],[96,26,83,97],[96,27,83,98,"variable"],[96,35,83,106],[96,36,83,107,"trainable"],[96,45,83,116],[97,6,83,118],[97,7,83,119],[97,8,83,120],[97,9,83,121],[98,4,84,4],[99,4,85,4,"getConfig"],[99,13,85,13,"getConfig"],[99,14,85,13],[99,16,85,16],[100,6,86,8],[100,13,86,15],[101,8,87,12],[101,22,87,26],[101,24,87,28],[101,28,87,32],[101,29,87,33,"learningRate"],[101,41,87,45],[102,8,88,12],[102,33,88,37],[102,35,88,39],[102,39,88,43],[102,40,88,44,"initialAccumulatorValue"],[103,6,89,8],[103,7,89,9],[104,4,90,4],[105,4,91,4],[106,4,92,4],[106,11,92,11,"fromConfig"],[106,21,92,21,"fromConfig"],[106,22,92,22,"cls"],[106,25,92,25],[106,27,92,27,"config"],[106,33,92,33],[106,35,92,35],[107,6,93,8],[107,13,93,15],[107,17,93,19,"cls"],[107,20,93,22],[107,21,93,23,"config"],[107,27,93,29],[107,28,93,30],[107,42,93,44],[107,43,93,45],[107,45,93,47,"config"],[107,51,93,53],[107,52,93,54],[107,77,93,79],[107,78,93,80],[107,79,93,81],[108,4,94,4],[109,2,95,0],[110,0,95,1],[110,3]],"functionMap":{"names":["<global>","AdagradOptimizer","AdagradOptimizer.get__className","AdagradOptimizer#constructor","AdagradOptimizer#applyGradients","variableGradients.map$argument_0","variableNames.forEach$argument_0","tidy$argument_0","AdagradOptimizer#dispose","accumulatedGrads.map$argument_0","AdagradOptimizer#getWeights","AdagradOptimizer#setWeights","weightValues.map$argument_0","AdagradOptimizer#getConfig","AdagradOptimizer.fromConfig"],"mappings":"AAA;OC0B;ICE;KDK;IEC;KFK;IGC;kCCE,iBD;8BEE;mCCM;4CDC;iBCU;aDK;SFC;KHE;IOC;8CCE,eD;KPE;ISC;8EDE,mDC;KTC;IUC;iDCG,uED;KVC;IYC;KZK;IaE;KbE;CDC"},"hasCjsExports":false},"type":"js/module"}]}