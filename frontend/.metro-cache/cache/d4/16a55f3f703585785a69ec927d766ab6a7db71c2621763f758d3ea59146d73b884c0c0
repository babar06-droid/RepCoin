{"dependencies":[],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"MaxPool2DBackpropProgram\", {\n    enumerable: true,\n    get: function () {\n      return MaxPool2DBackpropProgram;\n    }\n  });\n  Object.defineProperty(exports, \"MaxPool3DBackpropProgram\", {\n    enumerable: true,\n    get: function () {\n      return MaxPool3DBackpropProgram;\n    }\n  });\n  /**\n   * @license\n   * Copyright 2017 Google LLC. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   */\n  class MaxPool2DBackpropProgram {\n    constructor(convInfo) {\n      this.variableNames = ['dy', 'maxPos'];\n      this.outputShape = convInfo.inShape;\n      const strideHeight = convInfo.strideHeight;\n      const strideWidth = convInfo.strideWidth;\n      const dilationHeight = convInfo.dilationHeight;\n      const effectiveFilterHeight = convInfo.effectiveFilterHeight;\n      const effectiveFilterWidth = convInfo.effectiveFilterWidth;\n      const padTop = effectiveFilterHeight - 1 - convInfo.padInfo.top;\n      const padLeft = effectiveFilterWidth - 1 - convInfo.padInfo.left;\n      const lastIndex = effectiveFilterHeight * effectiveFilterWidth - 1;\n      this.userCode = `\n      const ivec2 pads = ivec2(${padTop}, ${padLeft});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${effectiveFilterHeight};\n          wR += ${dilationHeight}) {\n          float dyR = float(dyRCorner + wR) / ${strideHeight}.0;\n\n          if (dyR < 0.0 || dyR >= ${convInfo.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ${effectiveFilterWidth}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${strideWidth}.0;\n\n            if (dyC < 0.0 || dyC >= ${convInfo.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ${lastIndex} - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ${effectiveFilterWidth} + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    `;\n    }\n  }\n  class MaxPool3DBackpropProgram {\n    constructor(convInfo) {\n      this.variableNames = ['dy', 'maxPos'];\n      this.outputShape = convInfo.inShape;\n      const strideDepth = convInfo.strideDepth;\n      const strideHeight = convInfo.strideHeight;\n      const strideWidth = convInfo.strideWidth;\n      const dilationDepth = convInfo.dilationDepth;\n      const dilationHeight = convInfo.dilationHeight;\n      const dilationWidth = convInfo.dilationWidth;\n      const effectiveFilterDepth = convInfo.effectiveFilterDepth;\n      const effectiveFilterHeight = convInfo.effectiveFilterHeight;\n      const effectiveFilterWidth = convInfo.effectiveFilterWidth;\n      const padFront = effectiveFilterDepth - 1 - convInfo.padInfo.front;\n      const padTop = effectiveFilterHeight - 1 - convInfo.padInfo.top;\n      const padLeft = effectiveFilterWidth - 1 - convInfo.padInfo.left;\n      const lastIndex = effectiveFilterDepth * effectiveFilterHeight * effectiveFilterWidth - 1;\n      this.userCode = `\n      const ivec3 pads = ivec3(${padFront}, ${padTop}, ${padLeft});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ${effectiveFilterDepth};\n           wD += ${dilationDepth}) {\n          float dyD = float(dyDCorner + wD) / ${strideDepth}.0;\n\n          if (dyD < 0.0 || dyD >= ${convInfo.outDepth}.0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ${effectiveFilterHeight};\n              wR += ${dilationHeight}) {\n            float dyR = float(dyRCorner + wR) / ${strideHeight}.0;\n\n            if (dyR < 0.0 || dyR >= ${convInfo.outHeight}.0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ${effectiveFilterWidth};\n                wC += ${dilationWidth}) {\n              float dyC = float(dyCCorner + wC) / ${strideWidth}.0;\n\n              if (dyC < 0.0 || dyC >= ${convInfo.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ${lastIndex} -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ${effectiveFilterHeight} * ${effectiveFilterWidth} +\n                  wR * ${effectiveFilterWidth} + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `;\n    }\n  }\n});","lineCount":180,"map":[[7,2,17,0,"Object"],[7,8,17,0],[7,9,17,0,"defineProperty"],[7,23,17,0],[7,24,17,0,"exports"],[7,31,17,0],[8,4,17,0,"enumerable"],[8,14,17,0],[9,4,17,0,"get"],[9,7,17,0],[9,18,17,0,"get"],[9,19,17,0],[10,6,17,0],[10,13,17,0,"MaxPool2DBackpropProgram"],[10,37,17,0],[11,4,17,0],[12,2,17,0],[13,2,78,0,"Object"],[13,8,78,0],[13,9,78,0,"defineProperty"],[13,23,78,0],[13,24,78,0,"exports"],[13,31,78,0],[14,4,78,0,"enumerable"],[14,14,78,0],[15,4,78,0,"get"],[15,7,78,0],[15,18,78,0,"get"],[15,19,78,0],[16,6,78,0],[16,13,78,0,"MaxPool3DBackpropProgram"],[16,37,78,0],[17,4,78,0],[18,2,78,0],[19,2,1,0],[20,0,2,0],[21,0,3,0],[22,0,4,0],[23,0,5,0],[24,0,6,0],[25,0,7,0],[26,0,8,0],[27,0,9,0],[28,0,10,0],[29,0,11,0],[30,0,12,0],[31,0,13,0],[32,0,14,0],[33,0,15,0],[34,0,16,0],[35,2,17,7],[35,8,17,13,"MaxPool2DBackpropProgram"],[35,32,17,37],[35,33,17,38],[36,4,18,4,"constructor"],[36,15,18,15,"constructor"],[36,16,18,16,"convInfo"],[36,24,18,24],[36,26,18,26],[37,6,19,8],[37,10,19,12],[37,11,19,13,"variableNames"],[37,24,19,26],[37,27,19,29],[37,28,19,30],[37,32,19,34],[37,34,19,36],[37,42,19,44],[37,43,19,45],[38,6,20,8],[38,10,20,12],[38,11,20,13,"outputShape"],[38,22,20,24],[38,25,20,27,"convInfo"],[38,33,20,35],[38,34,20,36,"inShape"],[38,41,20,43],[39,6,21,8],[39,12,21,14,"strideHeight"],[39,24,21,26],[39,27,21,29,"convInfo"],[39,35,21,37],[39,36,21,38,"strideHeight"],[39,48,21,50],[40,6,22,8],[40,12,22,14,"strideWidth"],[40,23,22,25],[40,26,22,28,"convInfo"],[40,34,22,36],[40,35,22,37,"strideWidth"],[40,46,22,48],[41,6,23,8],[41,12,23,14,"dilationHeight"],[41,26,23,28],[41,29,23,31,"convInfo"],[41,37,23,39],[41,38,23,40,"dilationHeight"],[41,52,23,54],[42,6,24,8],[42,12,24,14,"effectiveFilterHeight"],[42,33,24,35],[42,36,24,38,"convInfo"],[42,44,24,46],[42,45,24,47,"effectiveFilterHeight"],[42,66,24,68],[43,6,25,8],[43,12,25,14,"effectiveFilterWidth"],[43,32,25,34],[43,35,25,37,"convInfo"],[43,43,25,45],[43,44,25,46,"effectiveFilterWidth"],[43,64,25,66],[44,6,26,8],[44,12,26,14,"padTop"],[44,18,26,20],[44,21,26,23,"effectiveFilterHeight"],[44,42,26,44],[44,45,26,47],[44,46,26,48],[44,49,26,51,"convInfo"],[44,57,26,59],[44,58,26,60,"padInfo"],[44,65,26,67],[44,66,26,68,"top"],[44,69,26,71],[45,6,27,8],[45,12,27,14,"padLeft"],[45,19,27,21],[45,22,27,24,"effectiveFilterWidth"],[45,42,27,44],[45,45,27,47],[45,46,27,48],[45,49,27,51,"convInfo"],[45,57,27,59],[45,58,27,60,"padInfo"],[45,65,27,67],[45,66,27,68,"left"],[45,70,27,72],[46,6,28,8],[46,12,28,14,"lastIndex"],[46,21,28,23],[46,24,28,26,"effectiveFilterHeight"],[46,45,28,47],[46,48,28,50,"effectiveFilterWidth"],[46,68,28,70],[46,71,28,73],[46,72,28,74],[47,6,29,8],[47,10,29,12],[47,11,29,13,"userCode"],[47,19,29,21],[47,22,29,24],[48,0,30,0],[48,33,30,33,"padTop"],[48,39,30,39],[48,44,30,44,"padLeft"],[48,51,30,51],[49,0,31,0],[50,0,32,0],[51,0,33,0],[52,0,34,0],[53,0,35,0],[54,0,36,0],[55,0,37,0],[56,0,38,0],[57,0,39,0],[58,0,40,0],[59,0,41,0],[60,0,42,0],[61,0,43,0],[62,0,44,0],[62,32,44,32,"effectiveFilterHeight"],[62,53,44,53],[63,0,45,0],[63,18,45,18,"dilationHeight"],[63,32,45,32],[64,0,46,0],[64,48,46,48,"strideHeight"],[64,60,46,60],[65,0,47,0],[66,0,48,0],[66,36,48,36,"convInfo"],[66,44,48,44],[66,45,48,45,"outHeight"],[66,54,48,54],[67,0,49,0],[68,0,50,0],[69,0,51,0],[70,0,52,0],[71,0,53,0],[71,34,53,34,"effectiveFilterWidth"],[71,54,53,54],[72,0,54,0],[72,50,54,50,"strideWidth"],[72,61,54,61],[73,0,55,0],[74,0,56,0],[74,38,56,38,"convInfo"],[74,46,56,46],[74,47,56,47,"outWidth"],[74,55,56,55],[75,0,57,0],[76,0,58,0],[77,0,59,0],[78,0,60,0],[79,0,61,0],[80,0,62,0],[81,0,63,0],[81,32,63,32,"lastIndex"],[81,41,63,41],[82,0,64,0],[83,0,65,0],[84,0,66,0],[85,0,67,0],[85,37,67,37,"effectiveFilterWidth"],[85,57,67,57],[86,0,68,0],[87,0,69,0],[88,0,70,0],[89,0,71,0],[90,0,72,0],[91,0,73,0],[92,0,74,0],[93,0,75,0],[93,5,75,5],[94,4,76,4],[95,2,77,0],[96,2,78,7],[96,8,78,13,"MaxPool3DBackpropProgram"],[96,32,78,37],[96,33,78,38],[97,4,79,4,"constructor"],[97,15,79,15,"constructor"],[97,16,79,16,"convInfo"],[97,24,79,24],[97,26,79,26],[98,6,80,8],[98,10,80,12],[98,11,80,13,"variableNames"],[98,24,80,26],[98,27,80,29],[98,28,80,30],[98,32,80,34],[98,34,80,36],[98,42,80,44],[98,43,80,45],[99,6,81,8],[99,10,81,12],[99,11,81,13,"outputShape"],[99,22,81,24],[99,25,81,27,"convInfo"],[99,33,81,35],[99,34,81,36,"inShape"],[99,41,81,43],[100,6,82,8],[100,12,82,14,"strideDepth"],[100,23,82,25],[100,26,82,28,"convInfo"],[100,34,82,36],[100,35,82,37,"strideDepth"],[100,46,82,48],[101,6,83,8],[101,12,83,14,"strideHeight"],[101,24,83,26],[101,27,83,29,"convInfo"],[101,35,83,37],[101,36,83,38,"strideHeight"],[101,48,83,50],[102,6,84,8],[102,12,84,14,"strideWidth"],[102,23,84,25],[102,26,84,28,"convInfo"],[102,34,84,36],[102,35,84,37,"strideWidth"],[102,46,84,48],[103,6,85,8],[103,12,85,14,"dilationDepth"],[103,25,85,27],[103,28,85,30,"convInfo"],[103,36,85,38],[103,37,85,39,"dilationDepth"],[103,50,85,52],[104,6,86,8],[104,12,86,14,"dilationHeight"],[104,26,86,28],[104,29,86,31,"convInfo"],[104,37,86,39],[104,38,86,40,"dilationHeight"],[104,52,86,54],[105,6,87,8],[105,12,87,14,"dilationWidth"],[105,25,87,27],[105,28,87,30,"convInfo"],[105,36,87,38],[105,37,87,39,"dilationWidth"],[105,50,87,52],[106,6,88,8],[106,12,88,14,"effectiveFilterDepth"],[106,32,88,34],[106,35,88,37,"convInfo"],[106,43,88,45],[106,44,88,46,"effectiveFilterDepth"],[106,64,88,66],[107,6,89,8],[107,12,89,14,"effectiveFilterHeight"],[107,33,89,35],[107,36,89,38,"convInfo"],[107,44,89,46],[107,45,89,47,"effectiveFilterHeight"],[107,66,89,68],[108,6,90,8],[108,12,90,14,"effectiveFilterWidth"],[108,32,90,34],[108,35,90,37,"convInfo"],[108,43,90,45],[108,44,90,46,"effectiveFilterWidth"],[108,64,90,66],[109,6,91,8],[109,12,91,14,"padFront"],[109,20,91,22],[109,23,91,25,"effectiveFilterDepth"],[109,43,91,45],[109,46,91,48],[109,47,91,49],[109,50,91,52,"convInfo"],[109,58,91,60],[109,59,91,61,"padInfo"],[109,66,91,68],[109,67,91,69,"front"],[109,72,91,74],[110,6,92,8],[110,12,92,14,"padTop"],[110,18,92,20],[110,21,92,23,"effectiveFilterHeight"],[110,42,92,44],[110,45,92,47],[110,46,92,48],[110,49,92,51,"convInfo"],[110,57,92,59],[110,58,92,60,"padInfo"],[110,65,92,67],[110,66,92,68,"top"],[110,69,92,71],[111,6,93,8],[111,12,93,14,"padLeft"],[111,19,93,21],[111,22,93,24,"effectiveFilterWidth"],[111,42,93,44],[111,45,93,47],[111,46,93,48],[111,49,93,51,"convInfo"],[111,57,93,59],[111,58,93,60,"padInfo"],[111,65,93,67],[111,66,93,68,"left"],[111,70,93,72],[112,6,94,8],[112,12,94,14,"lastIndex"],[112,21,94,23],[112,24,94,26,"effectiveFilterDepth"],[112,44,94,46],[112,47,94,49,"effectiveFilterHeight"],[112,68,94,70],[112,71,94,73,"effectiveFilterWidth"],[112,91,94,93],[112,94,94,96],[112,95,94,97],[113,6,95,8],[113,10,95,12],[113,11,95,13,"userCode"],[113,19,95,21],[113,22,95,24],[114,0,96,0],[114,33,96,33,"padFront"],[114,41,96,41],[114,46,96,46,"padTop"],[114,52,96,52],[114,57,96,57,"padLeft"],[114,64,96,64],[115,0,97,0],[116,0,98,0],[117,0,99,0],[118,0,100,0],[119,0,101,0],[120,0,102,0],[121,0,103,0],[122,0,104,0],[123,0,105,0],[124,0,106,0],[125,0,107,0],[126,0,108,0],[127,0,109,0],[128,0,110,0],[129,0,111,0],[130,0,112,0],[131,0,113,0],[131,32,113,32,"effectiveFilterDepth"],[131,52,113,52],[132,0,114,0],[132,19,114,19,"dilationDepth"],[132,32,114,32],[133,0,115,0],[133,48,115,48,"strideDepth"],[133,59,115,59],[134,0,116,0],[135,0,117,0],[135,36,117,36,"convInfo"],[135,44,117,44],[135,45,117,45,"outDepth"],[135,53,117,53],[136,0,118,0],[137,0,119,0],[138,0,120,0],[139,0,121,0],[140,0,122,0],[140,34,122,34,"effectiveFilterHeight"],[140,55,122,55],[141,0,123,0],[141,22,123,22,"dilationHeight"],[141,36,123,36],[142,0,124,0],[142,50,124,50,"strideHeight"],[142,62,124,62],[143,0,125,0],[144,0,126,0],[144,38,126,38,"convInfo"],[144,46,126,46],[144,47,126,47,"outHeight"],[144,56,126,56],[145,0,127,0],[146,0,128,0],[147,0,129,0],[148,0,130,0],[149,0,131,0],[150,0,132,0],[150,36,132,36,"effectiveFilterWidth"],[150,56,132,56],[151,0,133,0],[151,24,133,24,"dilationWidth"],[151,37,133,37],[152,0,134,0],[152,52,134,52,"strideWidth"],[152,63,134,63],[153,0,135,0],[154,0,136,0],[154,40,136,40,"convInfo"],[154,48,136,48],[154,49,136,49,"outWidth"],[154,57,136,57],[155,0,137,0],[156,0,138,0],[157,0,139,0],[158,0,140,0],[159,0,141,0],[160,0,142,0],[161,0,143,0],[161,34,143,34,"lastIndex"],[161,43,143,43],[162,0,144,0],[163,0,145,0],[164,0,146,0],[165,0,147,0],[166,0,148,0],[167,0,149,0],[167,25,149,25,"effectiveFilterHeight"],[167,46,149,46],[167,52,149,52,"effectiveFilterWidth"],[167,72,149,72],[168,0,150,0],[168,25,150,25,"effectiveFilterWidth"],[168,45,150,45],[169,0,151,0],[170,0,152,0],[171,0,153,0],[172,0,154,0],[173,0,155,0],[174,0,156,0],[175,0,157,0],[176,0,158,0],[177,0,159,0],[177,5,159,5],[178,4,160,4],[179,2,161,0],[180,0,161,1],[180,3]],"functionMap":{"names":["<global>","MaxPool2DBackpropProgram","MaxPool2DBackpropProgram#constructor","MaxPool3DBackpropProgram","MaxPool3DBackpropProgram#constructor"],"mappings":"AAA;OCgB;ICC;KD0D;CDC;OGC;ICC;KDiF;CHC"},"hasCjsExports":false},"type":"js/module"}]}