{"dependencies":[{"name":"./packing_util","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":17,"column":0,"index":703},"end":{"line":17,"column":45,"index":748}}],"key":"XZxV38atso3t5pLpH4+paVH17Hc=","exportNames":["*"],"imports":1}},{"name":"./shader_compiler","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":18,"column":0,"index":749},"end":{"line":18,"column":54,"index":803}}],"key":"yVSKlvZSxQn3Ck2puzGVWEYPzq8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"MirrorPadPackedProgram\", {\n    enumerable: true,\n    get: function () {\n      return MirrorPadPackedProgram;\n    }\n  });\n  var _packing_util = require(_dependencyMap[0], \"./packing_util\");\n  var _shader_compiler = require(_dependencyMap[1], \"./shader_compiler\");\n  /**\n   * @license\n   * Copyright 2020 Google LLC. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   */\n\n  /**\n   * Example shader code for\n   * `mirrorPad(tf.tensor1d([1, 2, 3], 'int32'), [[2, 2]], 'reflect')`\n   * ```\n   *    const int start = int(2);\n   *    const int end = int(5);\n   *\n   *    void main() {\n   *       int outputLoc = getOutputCoords();\n   *       vec4 result = vec4(0.);\n   *\n   *       int rc = outputLoc;\n   *\n   *       int source = rc;\n   *       if (source < start) {\n   *         source = start * 2 - source - 0;\n   *       } else if (source >= end) {\n   *         source = (end - 1) * 2 - source + 0;\n   *       }\n   *       source -= start;\n   *\n   *       result[0] = getChannel(getX(source), source);\n   *       rc += 1;\n   *       if(rc < 6) {\n   *          int source = rc;\n   *          if (source < start) {\n   *            source = start * 2 - source - 0;\n   *          } else if (source >= end) {\n   *            source = (end - 1) * 2 - source + 0;\n   *          }\n   *          source -= start;\n   *\n   *         result[1] = getChannel(getX(source), source);\n   *       }\n   *\n   *       setOutput(result);\n   *     }\n   * ```\n   */\n  class MirrorPadPackedProgram {\n    constructor(xShape, paddings, mode) {\n      this.variableNames = ['x'];\n      this.packedInputs = true;\n      this.packedOutput = true;\n      this.outputShape = paddings.map((p, i) => p[0] /* beforePad */ + xShape[i] + p[1] /* afterPad */);\n      const rank = xShape.length;\n      const dtype = (0, _shader_compiler.getCoordsDataType)(rank);\n      const start = paddings.map(p => p[0]).join(',');\n      const end = paddings.map((p, i) => p[0] + xShape[i]).join(',');\n      const coords = (0, _packing_util.getChannels)('rc', rank);\n      const source = (0, _packing_util.getChannels)('source', rank);\n      const cLimit = `${coords[rank - 1]} < ${this.outputShape[rank - 1]}`;\n      const innerDims = rank === 1 ? 'source' : `vec2(${source.slice(-2).join()})`;\n      const offset = mode === 'reflect' ? 0 : 1;\n      let mainLoop = '';\n      if (rank === 1) {\n        const padSetup = `\n        ${dtype} source = rc;\n        if (source < start) {\n          source = start * 2 - source - ${offset};\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ${offset};\n        }\n        source -= start;\n      `;\n        mainLoop = `\n        ${dtype} rc = outputLoc;\n        ${padSetup}\n        result[0] = getChannel(getX(${source.join()}), ${innerDims});\n        ${coords[rank - 1]} += 1;\n        if(${cLimit}) {\n          ${padSetup}\n          result[1] = getChannel(getX(${source.join()}), ${innerDims});\n        }\n      `;\n      } else {\n        const padSetup = `\n        ${dtype} source = rc;\n        ${dtype} lt = ${dtype}(lessThan(source, start));\n        ${dtype} gte = ${dtype}(greaterThanEqual(source, end));\n        ${dtype} orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ${offset}) +\n                gte * ((end - 1) * 2 - source + ${offset});\n        source -= start;\n      `;\n        mainLoop = `\n        ${dtype} rc = outputLoc;\n        ${padSetup}\n        result[0] = getChannel(getX(${source.join()}), ${innerDims});\n        ${coords[rank - 1]} += 1;\n        if(${cLimit}) {\n          ${padSetup}\n          result[1] = getChannel(getX(${source.join()}), ${innerDims});\n        }\n        rc = outputLoc;\n        ${coords[rank - 2]} += 1;\n        if(${coords[rank - 2]} < ${this.outputShape[rank - 2]}) {\n          ${padSetup}\n          result[2] = getChannel(getX(${source.join()}), ${innerDims});\n          ${coords[rank - 1]} += 1;\n          if(${cLimit}) {\n            ${padSetup}\n            result[3] = getChannel(getX(${source.join()}), ${innerDims});\n          }\n        }\n      `;\n      }\n      this.userCode = `\n      const ${dtype} start = ${dtype}(${start});\n      const ${dtype} end = ${dtype}(${end});\n\n      void main() {\n        ${dtype} outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ${mainLoop}\n        setOutput(result);\n      }\n    `;\n    }\n  }\n});","lineCount":153,"map":[[7,2,58,0,"Object"],[7,8,58,0],[7,9,58,0,"defineProperty"],[7,23,58,0],[7,24,58,0,"exports"],[7,31,58,0],[8,4,58,0,"enumerable"],[8,14,58,0],[9,4,58,0,"get"],[9,7,58,0],[9,18,58,0,"get"],[9,19,58,0],[10,6,58,0],[10,13,58,0,"MirrorPadPackedProgram"],[10,35,58,0],[11,4,58,0],[12,2,58,0],[13,2,17,0],[13,6,17,0,"_packing_util"],[13,19,17,0],[13,22,17,0,"require"],[13,29,17,0],[13,30,17,0,"_dependencyMap"],[13,44,17,0],[14,2,18,0],[14,6,18,0,"_shader_compiler"],[14,22,18,0],[14,25,18,0,"require"],[14,32,18,0],[14,33,18,0,"_dependencyMap"],[14,47,18,0],[15,2,1,0],[16,0,2,0],[17,0,3,0],[18,0,4,0],[19,0,5,0],[20,0,6,0],[21,0,7,0],[22,0,8,0],[23,0,9,0],[24,0,10,0],[25,0,11,0],[26,0,12,0],[27,0,13,0],[28,0,14,0],[29,0,15,0],[30,0,16,0],[32,2,19,0],[33,0,20,0],[34,0,21,0],[35,0,22,0],[36,0,23,0],[37,0,24,0],[38,0,25,0],[39,0,26,0],[40,0,27,0],[41,0,28,0],[42,0,29,0],[43,0,30,0],[44,0,31,0],[45,0,32,0],[46,0,33,0],[47,0,34,0],[48,0,35,0],[49,0,36,0],[50,0,37,0],[51,0,38,0],[52,0,39,0],[53,0,40,0],[54,0,41,0],[55,0,42,0],[56,0,43,0],[57,0,44,0],[58,0,45,0],[59,0,46,0],[60,0,47,0],[61,0,48,0],[62,0,49,0],[63,0,50,0],[64,0,51,0],[65,0,52,0],[66,0,53,0],[67,0,54,0],[68,0,55,0],[69,0,56,0],[70,0,57,0],[71,2,58,7],[71,8,58,13,"MirrorPadPackedProgram"],[71,30,58,35],[71,31,58,36],[72,4,59,4,"constructor"],[72,15,59,15,"constructor"],[72,16,59,16,"xShape"],[72,22,59,22],[72,24,59,24,"paddings"],[72,32,59,32],[72,34,59,34,"mode"],[72,38,59,38],[72,40,59,40],[73,6,60,8],[73,10,60,12],[73,11,60,13,"variableNames"],[73,24,60,26],[73,27,60,29],[73,28,60,30],[73,31,60,33],[73,32,60,34],[74,6,61,8],[74,10,61,12],[74,11,61,13,"packedInputs"],[74,23,61,25],[74,26,61,28],[74,30,61,32],[75,6,62,8],[75,10,62,12],[75,11,62,13,"packedOutput"],[75,23,62,25],[75,26,62,28],[75,30,62,32],[76,6,63,8],[76,10,63,12],[76,11,63,13,"outputShape"],[76,22,63,24],[76,25,63,27,"paddings"],[76,33,63,35],[76,34,63,36,"map"],[76,37,63,39],[76,38,63,40],[76,39,63,41,"p"],[76,40,63,42],[76,42,63,44,"i"],[76,43,63,45],[76,48,63,50,"p"],[76,49,63,51],[76,50,63,52],[76,51,63,53],[76,52,63,54],[76,53,63,55],[76,71,63,73,"xShape"],[76,77,63,79],[76,78,63,80,"i"],[76,79,63,81],[76,80,63,82],[76,83,63,85,"p"],[76,84,63,86],[76,85,63,87],[76,86,63,88],[76,87,63,89],[76,88,63,90],[76,102,63,104],[76,103,63,105],[77,6,64,8],[77,12,64,14,"rank"],[77,16,64,18],[77,19,64,21,"xShape"],[77,25,64,27],[77,26,64,28,"length"],[77,32,64,34],[78,6,65,8],[78,12,65,14,"dtype"],[78,17,65,19],[78,20,65,22],[78,24,65,22,"getCoordsDataType"],[78,40,65,39],[78,41,65,39,"getCoordsDataType"],[78,58,65,39],[78,60,65,40,"rank"],[78,64,65,44],[78,65,65,45],[79,6,66,8],[79,12,66,14,"start"],[79,17,66,19],[79,20,66,22,"paddings"],[79,28,66,30],[79,29,66,31,"map"],[79,32,66,34],[79,33,66,35,"p"],[79,34,66,36],[79,38,66,40,"p"],[79,39,66,41],[79,40,66,42],[79,41,66,43],[79,42,66,44],[79,43,66,45],[79,44,66,46,"join"],[79,48,66,50],[79,49,66,51],[79,52,66,54],[79,53,66,55],[80,6,67,8],[80,12,67,14,"end"],[80,15,67,17],[80,18,67,20,"paddings"],[80,26,67,28],[80,27,67,29,"map"],[80,30,67,32],[80,31,67,33],[80,32,67,34,"p"],[80,33,67,35],[80,35,67,37,"i"],[80,36,67,38],[80,41,67,43,"p"],[80,42,67,44],[80,43,67,45],[80,44,67,46],[80,45,67,47],[80,48,67,50,"xShape"],[80,54,67,56],[80,55,67,57,"i"],[80,56,67,58],[80,57,67,59],[80,58,67,60],[80,59,67,61,"join"],[80,63,67,65],[80,64,67,66],[80,67,67,69],[80,68,67,70],[81,6,68,8],[81,12,68,14,"coords"],[81,18,68,20],[81,21,68,23],[81,25,68,23,"getChannels"],[81,38,68,34],[81,39,68,34,"getChannels"],[81,50,68,34],[81,52,68,35],[81,56,68,39],[81,58,68,41,"rank"],[81,62,68,45],[81,63,68,46],[82,6,69,8],[82,12,69,14,"source"],[82,18,69,20],[82,21,69,23],[82,25,69,23,"getChannels"],[82,38,69,34],[82,39,69,34,"getChannels"],[82,50,69,34],[82,52,69,35],[82,60,69,43],[82,62,69,45,"rank"],[82,66,69,49],[82,67,69,50],[83,6,70,8],[83,12,70,14,"cLimit"],[83,18,70,20],[83,21,70,23],[83,24,70,26,"coords"],[83,30,70,32],[83,31,70,33,"rank"],[83,35,70,37],[83,38,70,40],[83,39,70,41],[83,40,70,42],[83,46,70,48],[83,50,70,52],[83,51,70,53,"outputShape"],[83,62,70,64],[83,63,70,65,"rank"],[83,67,70,69],[83,70,70,72],[83,71,70,73],[83,72,70,74],[83,74,70,76],[84,6,71,8],[84,12,71,14,"innerDims"],[84,21,71,23],[84,24,71,26,"rank"],[84,28,71,30],[84,33,71,35],[84,34,71,36],[84,37,71,39],[84,45,71,47],[84,48,71,50],[84,56,71,58,"source"],[84,62,71,64],[84,63,71,65,"slice"],[84,68,71,70],[84,69,71,71],[84,70,71,72],[84,71,71,73],[84,72,71,74],[84,73,71,75,"join"],[84,77,71,79],[84,78,71,80],[84,79,71,81],[84,82,71,84],[85,6,72,8],[85,12,72,14,"offset"],[85,18,72,20],[85,21,72,23,"mode"],[85,25,72,27],[85,30,72,32],[85,39,72,41],[85,42,72,44],[85,43,72,45],[85,46,72,48],[85,47,72,49],[86,6,73,8],[86,10,73,12,"mainLoop"],[86,18,73,20],[86,21,73,23],[86,23,73,25],[87,6,74,8],[87,10,74,12,"rank"],[87,14,74,16],[87,19,74,21],[87,20,74,22],[87,22,74,24],[88,8,75,12],[88,14,75,18,"padSetup"],[88,22,75,26],[88,25,75,29],[89,0,76,0],[89,10,76,10,"dtype"],[89,15,76,15],[90,0,77,0],[91,0,78,0],[91,42,78,42,"offset"],[91,48,78,48],[92,0,79,0],[93,0,80,0],[93,46,80,46,"offset"],[93,52,80,52],[94,0,81,0],[95,0,82,0],[96,0,83,0],[96,7,83,7],[97,8,84,12,"mainLoop"],[97,16,84,20],[97,19,84,23],[98,0,85,0],[98,10,85,10,"dtype"],[98,15,85,15],[99,0,86,0],[99,10,86,10,"padSetup"],[99,18,86,18],[100,0,87,0],[100,38,87,38,"source"],[100,44,87,44],[100,45,87,45,"join"],[100,49,87,49],[100,50,87,50],[100,51,87,51],[100,57,87,57,"innerDims"],[100,66,87,66],[101,0,88,0],[101,10,88,10,"coords"],[101,16,88,16],[101,17,88,17,"rank"],[101,21,88,21],[101,24,88,24],[101,25,88,25],[101,26,88,26],[102,0,89,0],[102,13,89,13,"cLimit"],[102,19,89,19],[103,0,90,0],[103,12,90,12,"padSetup"],[103,20,90,20],[104,0,91,0],[104,40,91,40,"source"],[104,46,91,46],[104,47,91,47,"join"],[104,51,91,51],[104,52,91,52],[104,53,91,53],[104,59,91,59,"innerDims"],[104,68,91,68],[105,0,92,0],[106,0,93,0],[106,7,93,7],[107,6,94,8],[107,7,94,9],[107,13,95,13],[108,8,96,12],[108,14,96,18,"padSetup"],[108,22,96,26],[108,25,96,29],[109,0,97,0],[109,10,97,10,"dtype"],[109,15,97,15],[110,0,98,0],[110,10,98,10,"dtype"],[110,15,98,15],[110,24,98,24,"dtype"],[110,29,98,29],[111,0,99,0],[111,10,99,10,"dtype"],[111,15,99,15],[111,25,99,25,"dtype"],[111,30,99,30],[112,0,100,0],[112,10,100,10,"dtype"],[112,15,100,15],[113,0,101,0],[114,0,102,0],[114,45,102,45,"offset"],[114,51,102,51],[115,0,103,0],[115,50,103,50,"offset"],[115,56,103,56],[116,0,104,0],[117,0,105,0],[117,7,105,7],[118,8,106,12,"mainLoop"],[118,16,106,20],[118,19,106,23],[119,0,107,0],[119,10,107,10,"dtype"],[119,15,107,15],[120,0,108,0],[120,10,108,10,"padSetup"],[120,18,108,18],[121,0,109,0],[121,38,109,38,"source"],[121,44,109,44],[121,45,109,45,"join"],[121,49,109,49],[121,50,109,50],[121,51,109,51],[121,57,109,57,"innerDims"],[121,66,109,66],[122,0,110,0],[122,10,110,10,"coords"],[122,16,110,16],[122,17,110,17,"rank"],[122,21,110,21],[122,24,110,24],[122,25,110,25],[122,26,110,26],[123,0,111,0],[123,13,111,13,"cLimit"],[123,19,111,19],[124,0,112,0],[124,12,112,12,"padSetup"],[124,20,112,20],[125,0,113,0],[125,40,113,40,"source"],[125,46,113,46],[125,47,113,47,"join"],[125,51,113,51],[125,52,113,52],[125,53,113,53],[125,59,113,59,"innerDims"],[125,68,113,68],[126,0,114,0],[127,0,115,0],[128,0,116,0],[128,10,116,10,"coords"],[128,16,116,16],[128,17,116,17,"rank"],[128,21,116,21],[128,24,116,24],[128,25,116,25],[128,26,116,26],[129,0,117,0],[129,13,117,13,"coords"],[129,19,117,19],[129,20,117,20,"rank"],[129,24,117,24],[129,27,117,27],[129,28,117,28],[129,29,117,29],[129,35,117,35],[129,39,117,39],[129,40,117,40,"outputShape"],[129,51,117,51],[129,52,117,52,"rank"],[129,56,117,56],[129,59,117,59],[129,60,117,60],[129,61,117,61],[130,0,118,0],[130,12,118,12,"padSetup"],[130,20,118,20],[131,0,119,0],[131,40,119,40,"source"],[131,46,119,46],[131,47,119,47,"join"],[131,51,119,51],[131,52,119,52],[131,53,119,53],[131,59,119,59,"innerDims"],[131,68,119,68],[132,0,120,0],[132,12,120,12,"coords"],[132,18,120,18],[132,19,120,19,"rank"],[132,23,120,23],[132,26,120,26],[132,27,120,27],[132,28,120,28],[133,0,121,0],[133,15,121,15,"cLimit"],[133,21,121,21],[134,0,122,0],[134,14,122,14,"padSetup"],[134,22,122,22],[135,0,123,0],[135,42,123,42,"source"],[135,48,123,48],[135,49,123,49,"join"],[135,53,123,53],[135,54,123,54],[135,55,123,55],[135,61,123,61,"innerDims"],[135,70,123,70],[136,0,124,0],[137,0,125,0],[138,0,126,0],[138,7,126,7],[139,6,127,8],[140,6,128,8],[140,10,128,12],[140,11,128,13,"userCode"],[140,19,128,21],[140,22,128,24],[141,0,129,0],[141,14,129,14,"dtype"],[141,19,129,19],[141,31,129,31,"dtype"],[141,36,129,36],[141,40,129,40,"start"],[141,45,129,45],[142,0,130,0],[142,14,130,14,"dtype"],[142,19,130,19],[142,29,130,29,"dtype"],[142,34,130,34],[142,38,130,38,"end"],[142,41,130,41],[143,0,131,0],[144,0,132,0],[145,0,133,0],[145,10,133,10,"dtype"],[145,15,133,15],[146,0,134,0],[147,0,135,0],[147,10,135,10,"mainLoop"],[147,18,135,18],[148,0,136,0],[149,0,137,0],[150,0,138,0],[150,5,138,5],[151,4,139,4],[152,2,140,0],[153,0,140,1],[153,3]],"functionMap":{"names":["<global>","MirrorPadPackedProgram","MirrorPadPackedProgram#constructor","paddings.map$argument_0"],"mappings":"AAA;OCyD;ICC;wCCI,iDD;mCCG,SD;iCCC,0BD;KDwE;CDC"},"hasCjsExports":false},"type":"js/module"}]}