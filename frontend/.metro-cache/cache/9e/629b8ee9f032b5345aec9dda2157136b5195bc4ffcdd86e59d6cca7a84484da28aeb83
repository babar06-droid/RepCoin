{"dependencies":[{"name":"@tensorflow/tfjs-core","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":17,"column":0,"index":703},"end":{"line":17,"column":74,"index":777}}],"key":"qIleUpSDMUXFynEGc51k60/pDSs=","exportNames":["*"],"imports":1}},{"name":"../gather_gpu","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":18,"column":0,"index":778},"end":{"line":18,"column":46,"index":824}}],"key":"wAJDGXH3njNhJBlB+vNFQJBHEeg=","exportNames":["*"],"imports":1}},{"name":"../kernel_utils/shared","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":19,"column":0,"index":825},"end":{"line":19,"column":57,"index":882}}],"key":"JzS9qfQGP0NvwhobUV8d6bPV3h4=","exportNames":["*"],"imports":1}},{"name":"./Reshape","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":20,"column":0,"index":883},"end":{"line":20,"column":36,"index":919}}],"key":"EUWK+oKi/AwokPOQ1jng5DYfQSc=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.gatherV2 = gatherV2;\n  Object.defineProperty(exports, \"gatherV2Config\", {\n    enumerable: true,\n    get: function () {\n      return gatherV2Config;\n    }\n  });\n  var _tensorflowTfjsCore = require(_dependencyMap[0], \"@tensorflow/tfjs-core\");\n  var _gather_gpu = require(_dependencyMap[1], \"../gather_gpu\");\n  var _kernel_utilsShared = require(_dependencyMap[2], \"../kernel_utils/shared\");\n  var _Reshape = require(_dependencyMap[3], \"./Reshape\");\n  /**\n   * @license\n   * Copyright 2020 Google LLC. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   */\n\n  function gatherV2(args) {\n    const {\n      inputs,\n      backend,\n      attrs\n    } = args;\n    const {\n      x,\n      indices\n    } = inputs;\n    const {\n      axis,\n      batchDims\n    } = attrs;\n    const parsedAxis = _tensorflowTfjsCore.util.parseAxisParam(axis, x.shape)[0];\n    if ((0, _tensorflowTfjsCore.env)().get('DEBUG')) {\n      // In debug mode, throw error when any index is out of bound.\n      // Otherwise, just fill out of bounds with zeroes.\n      const indicesVals = backend.readSync(indices.dataId);\n      const axisDim = x.shape[parsedAxis];\n      for (let i = 0; i < indicesVals.length; ++i) {\n        const index = indicesVals[i];\n        _tensorflowTfjsCore.util.assert(index <= axisDim - 1 && index >= 0, () => `GatherV2: the index value ${index} is not in [0, ${axisDim - 1}]`);\n      }\n    }\n    const shapeInfo = _tensorflowTfjsCore.backend_util.segment_util.collectGatherOpShapeInfo(x, indices, parsedAxis, batchDims);\n    const indicesSize = _tensorflowTfjsCore.util.sizeFromShape(indices.shape);\n    const toDispose = [];\n    const flattenX = (0, _Reshape.reshape)({\n      inputs: {\n        x\n      },\n      backend,\n      attrs: {\n        shape: [shapeInfo.batchSize, shapeInfo.outerSize, shapeInfo.dimSize, shapeInfo.sliceSize]\n      }\n    });\n    const flattenIndex = (0, _Reshape.reshape)({\n      inputs: {\n        x: indices\n      },\n      backend,\n      attrs: {\n        shape: [shapeInfo.batchSize, indicesSize / shapeInfo.batchSize]\n      }\n    });\n    toDispose.push(flattenX);\n    toDispose.push(flattenIndex);\n    const flattenOutputShape = [shapeInfo.batchSize, shapeInfo.outerSize, indicesSize / shapeInfo.batchSize, shapeInfo.sliceSize];\n    if (backend.shouldExecuteOnCPU([x, indices]) || x.dtype === 'string') {\n      const indicesBuf = backend.bufferSync(flattenIndex);\n      const xBuf = backend.bufferSync(flattenX);\n      const outBuf = (0, _kernel_utilsShared.gatherV2ImplCPU)(xBuf, indicesBuf, flattenOutputShape);\n      toDispose.forEach(t => backend.disposeIntermediateTensorInfo(t));\n      return backend.makeTensorInfo(shapeInfo.outputShape, outBuf.dtype, outBuf.values);\n    }\n    const program = new _gather_gpu.GatherProgram(flattenX.shape, flattenOutputShape);\n    const res = backend.runWebGLProgram(program, [flattenX, flattenIndex], flattenX.dtype);\n    toDispose.push(res);\n    const reshaped = (0, _Reshape.reshape)({\n      inputs: {\n        x: res\n      },\n      backend,\n      attrs: {\n        shape: shapeInfo.outputShape\n      }\n    });\n    toDispose.forEach(t => backend.disposeIntermediateTensorInfo(t));\n    return reshaped;\n  }\n  const gatherV2Config = {\n    kernelName: _tensorflowTfjsCore.GatherV2,\n    backendName: 'webgl',\n    kernelFunc: gatherV2\n  };\n});","lineCount":111,"map":[[7,2,21,0,"exports"],[7,9,21,0],[7,10,21,0,"gatherV2"],[7,18,21,0],[7,21,21,0,"gatherV2"],[7,29,21,0],[8,2,74,0,"Object"],[8,8,74,0],[8,9,74,0,"defineProperty"],[8,23,74,0],[8,24,74,0,"exports"],[8,31,74,0],[9,4,74,0,"enumerable"],[9,14,74,0],[10,4,74,0,"get"],[10,7,74,0],[10,18,74,0,"get"],[10,19,74,0],[11,6,74,0],[11,13,74,0,"gatherV2Config"],[11,27,74,0],[12,4,74,0],[13,2,74,0],[14,2,17,0],[14,6,17,0,"_tensorflowTfjsCore"],[14,25,17,0],[14,28,17,0,"require"],[14,35,17,0],[14,36,17,0,"_dependencyMap"],[14,50,17,0],[15,2,18,0],[15,6,18,0,"_gather_gpu"],[15,17,18,0],[15,20,18,0,"require"],[15,27,18,0],[15,28,18,0,"_dependencyMap"],[15,42,18,0],[16,2,19,0],[16,6,19,0,"_kernel_utilsShared"],[16,25,19,0],[16,28,19,0,"require"],[16,35,19,0],[16,36,19,0,"_dependencyMap"],[16,50,19,0],[17,2,20,0],[17,6,20,0,"_Reshape"],[17,14,20,0],[17,17,20,0,"require"],[17,24,20,0],[17,25,20,0,"_dependencyMap"],[17,39,20,0],[18,2,1,0],[19,0,2,0],[20,0,3,0],[21,0,4,0],[22,0,5,0],[23,0,6,0],[24,0,7,0],[25,0,8,0],[26,0,9,0],[27,0,10,0],[28,0,11,0],[29,0,12,0],[30,0,13,0],[31,0,14,0],[32,0,15,0],[33,0,16,0],[35,2,21,7],[35,11,21,16,"gatherV2"],[35,19,21,24,"gatherV2"],[35,20,21,25,"args"],[35,24,21,29],[35,26,21,31],[36,4,22,4],[36,10,22,10],[37,6,22,12,"inputs"],[37,12,22,18],[38,6,22,20,"backend"],[38,13,22,27],[39,6,22,29,"attrs"],[40,4,22,35],[40,5,22,36],[40,8,22,39,"args"],[40,12,22,43],[41,4,23,4],[41,10,23,10],[42,6,23,12,"x"],[42,7,23,13],[43,6,23,15,"indices"],[44,4,23,23],[44,5,23,24],[44,8,23,27,"inputs"],[44,14,23,33],[45,4,24,4],[45,10,24,10],[46,6,24,12,"axis"],[46,10,24,16],[47,6,24,18,"batchDims"],[48,4,24,28],[48,5,24,29],[48,8,24,32,"attrs"],[48,13,24,37],[49,4,25,4],[49,10,25,10,"parsedAxis"],[49,20,25,20],[49,23,25,23,"util"],[49,42,25,27],[49,43,25,27,"util"],[49,47,25,27],[49,48,25,28,"parseAxisParam"],[49,62,25,42],[49,63,25,43,"axis"],[49,67,25,47],[49,69,25,49,"x"],[49,70,25,50],[49,71,25,51,"shape"],[49,76,25,56],[49,77,25,57],[49,78,25,58],[49,79,25,59],[49,80,25,60],[50,4,26,4],[50,8,26,8],[50,12,26,8,"env"],[50,31,26,11],[50,32,26,11,"env"],[50,35,26,11],[50,37,26,12],[50,38,26,13],[50,39,26,14,"get"],[50,42,26,17],[50,43,26,18],[50,50,26,25],[50,51,26,26],[50,53,26,28],[51,6,27,8],[52,6,28,8],[53,6,29,8],[53,12,29,14,"indicesVals"],[53,23,29,25],[53,26,29,28,"backend"],[53,33,29,35],[53,34,29,36,"readSync"],[53,42,29,44],[53,43,29,45,"indices"],[53,50,29,52],[53,51,29,53,"dataId"],[53,57,29,59],[53,58,29,60],[54,6,30,8],[54,12,30,14,"axisDim"],[54,19,30,21],[54,22,30,24,"x"],[54,23,30,25],[54,24,30,26,"shape"],[54,29,30,31],[54,30,30,32,"parsedAxis"],[54,40,30,42],[54,41,30,43],[55,6,31,8],[55,11,31,13],[55,15,31,17,"i"],[55,16,31,18],[55,19,31,21],[55,20,31,22],[55,22,31,24,"i"],[55,23,31,25],[55,26,31,28,"indicesVals"],[55,37,31,39],[55,38,31,40,"length"],[55,44,31,46],[55,46,31,48],[55,48,31,50,"i"],[55,49,31,51],[55,51,31,53],[56,8,32,12],[56,14,32,18,"index"],[56,19,32,23],[56,22,32,26,"indicesVals"],[56,33,32,37],[56,34,32,38,"i"],[56,35,32,39],[56,36,32,40],[57,8,33,12,"util"],[57,27,33,16],[57,28,33,16,"util"],[57,32,33,16],[57,33,33,17,"assert"],[57,39,33,23],[57,40,33,24,"index"],[57,45,33,29],[57,49,33,33,"axisDim"],[57,56,33,40],[57,59,33,43],[57,60,33,44],[57,64,33,48,"index"],[57,69,33,53],[57,73,33,57],[57,74,33,58],[57,76,33,60],[57,82,33,66],[57,111,33,95,"index"],[57,116,33,100],[57,134,33,118,"axisDim"],[57,141,33,125],[57,144,33,128],[57,145,33,129],[57,148,33,132],[57,149,33,133],[58,6,34,8],[59,4,35,4],[60,4,36,4],[60,10,36,10,"shapeInfo"],[60,19,36,19],[60,22,36,22,"backend_util"],[60,41,36,34],[60,42,36,34,"backend_util"],[60,54,36,34],[60,55,36,35,"segment_util"],[60,67,36,47],[60,68,36,48,"collectGatherOpShapeInfo"],[60,92,36,72],[60,93,36,73,"x"],[60,94,36,74],[60,96,36,76,"indices"],[60,103,36,83],[60,105,36,85,"parsedAxis"],[60,115,36,95],[60,117,36,97,"batchDims"],[60,126,36,106],[60,127,36,107],[61,4,37,4],[61,10,37,10,"indicesSize"],[61,21,37,21],[61,24,37,24,"util"],[61,43,37,28],[61,44,37,28,"util"],[61,48,37,28],[61,49,37,29,"sizeFromShape"],[61,62,37,42],[61,63,37,43,"indices"],[61,70,37,50],[61,71,37,51,"shape"],[61,76,37,56],[61,77,37,57],[62,4,38,4],[62,10,38,10,"toDispose"],[62,19,38,19],[62,22,38,22],[62,24,38,24],[63,4,39,4],[63,10,39,10,"flattenX"],[63,18,39,18],[63,21,39,21],[63,25,39,21,"reshape"],[63,33,39,28],[63,34,39,28,"reshape"],[63,41,39,28],[63,43,39,29],[64,6,40,8,"inputs"],[64,12,40,14],[64,14,40,16],[65,8,40,18,"x"],[66,6,40,20],[66,7,40,21],[67,6,41,8,"backend"],[67,13,41,15],[68,6,42,8,"attrs"],[68,11,42,13],[68,13,42,15],[69,8,43,12,"shape"],[69,13,43,17],[69,15,43,19],[69,16,44,16,"shapeInfo"],[69,25,44,25],[69,26,44,26,"batchSize"],[69,35,44,35],[69,37,44,37,"shapeInfo"],[69,46,44,46],[69,47,44,47,"outerSize"],[69,56,44,56],[69,58,44,58,"shapeInfo"],[69,67,44,67],[69,68,44,68,"dimSize"],[69,75,44,75],[69,77,45,16,"shapeInfo"],[69,86,45,25],[69,87,45,26,"sliceSize"],[69,96,45,35],[70,6,47,8],[71,4,48,4],[71,5,48,5],[71,6,48,6],[72,4,49,4],[72,10,49,10,"flattenIndex"],[72,22,49,22],[72,25,49,25],[72,29,49,25,"reshape"],[72,37,49,32],[72,38,49,32,"reshape"],[72,45,49,32],[72,47,49,33],[73,6,50,8,"inputs"],[73,12,50,14],[73,14,50,16],[74,8,50,18,"x"],[74,9,50,19],[74,11,50,21,"indices"],[75,6,50,29],[75,7,50,30],[76,6,51,8,"backend"],[76,13,51,15],[77,6,52,8,"attrs"],[77,11,52,13],[77,13,52,15],[78,8,52,17,"shape"],[78,13,52,22],[78,15,52,24],[78,16,52,25,"shapeInfo"],[78,25,52,34],[78,26,52,35,"batchSize"],[78,35,52,44],[78,37,52,46,"indicesSize"],[78,48,52,57],[78,51,52,60,"shapeInfo"],[78,60,52,69],[78,61,52,70,"batchSize"],[78,70,52,79],[79,6,52,81],[80,4,53,4],[80,5,53,5],[80,6,53,6],[81,4,54,4,"toDispose"],[81,13,54,13],[81,14,54,14,"push"],[81,18,54,18],[81,19,54,19,"flattenX"],[81,27,54,27],[81,28,54,28],[82,4,55,4,"toDispose"],[82,13,55,13],[82,14,55,14,"push"],[82,18,55,18],[82,19,55,19,"flattenIndex"],[82,31,55,31],[82,32,55,32],[83,4,56,4],[83,10,56,10,"flattenOutputShape"],[83,28,56,28],[83,31,56,31],[83,32,57,8,"shapeInfo"],[83,41,57,17],[83,42,57,18,"batchSize"],[83,51,57,27],[83,53,57,29,"shapeInfo"],[83,62,57,38],[83,63,57,39,"outerSize"],[83,72,57,48],[83,74,57,50,"indicesSize"],[83,85,57,61],[83,88,57,64,"shapeInfo"],[83,97,57,73],[83,98,57,74,"batchSize"],[83,107,57,83],[83,109,58,8,"shapeInfo"],[83,118,58,17],[83,119,58,18,"sliceSize"],[83,128,58,27],[83,129,59,5],[84,4,60,4],[84,8,60,8,"backend"],[84,15,60,15],[84,16,60,16,"shouldExecuteOnCPU"],[84,34,60,34],[84,35,60,35],[84,36,60,36,"x"],[84,37,60,37],[84,39,60,39,"indices"],[84,46,60,46],[84,47,60,47],[84,48,60,48],[84,52,60,52,"x"],[84,53,60,53],[84,54,60,54,"dtype"],[84,59,60,59],[84,64,60,64],[84,72,60,72],[84,74,60,74],[85,6,61,8],[85,12,61,14,"indicesBuf"],[85,22,61,24],[85,25,61,27,"backend"],[85,32,61,34],[85,33,61,35,"bufferSync"],[85,43,61,45],[85,44,61,46,"flattenIndex"],[85,56,61,58],[85,57,61,59],[86,6,62,8],[86,12,62,14,"xBuf"],[86,16,62,18],[86,19,62,21,"backend"],[86,26,62,28],[86,27,62,29,"bufferSync"],[86,37,62,39],[86,38,62,40,"flattenX"],[86,46,62,48],[86,47,62,49],[87,6,63,8],[87,12,63,14,"outBuf"],[87,18,63,20],[87,21,63,23],[87,25,63,23,"gatherV2ImplCPU"],[87,44,63,38],[87,45,63,38,"gatherV2ImplCPU"],[87,60,63,38],[87,62,63,39,"xBuf"],[87,66,63,43],[87,68,63,45,"indicesBuf"],[87,78,63,55],[87,80,63,57,"flattenOutputShape"],[87,98,63,75],[87,99,63,76],[88,6,64,8,"toDispose"],[88,15,64,17],[88,16,64,18,"forEach"],[88,23,64,25],[88,24,64,26,"t"],[88,25,64,27],[88,29,64,31,"backend"],[88,36,64,38],[88,37,64,39,"disposeIntermediateTensorInfo"],[88,66,64,68],[88,67,64,69,"t"],[88,68,64,70],[88,69,64,71],[88,70,64,72],[89,6,65,8],[89,13,65,15,"backend"],[89,20,65,22],[89,21,65,23,"makeTensorInfo"],[89,35,65,37],[89,36,65,38,"shapeInfo"],[89,45,65,47],[89,46,65,48,"outputShape"],[89,57,65,59],[89,59,65,61,"outBuf"],[89,65,65,67],[89,66,65,68,"dtype"],[89,71,65,73],[89,73,65,75,"outBuf"],[89,79,65,81],[89,80,65,82,"values"],[89,86,65,88],[89,87,65,89],[90,4,66,4],[91,4,67,4],[91,10,67,10,"program"],[91,17,67,17],[91,20,67,20],[91,24,67,24,"GatherProgram"],[91,35,67,37],[91,36,67,37,"GatherProgram"],[91,49,67,37],[91,50,67,38,"flattenX"],[91,58,67,46],[91,59,67,47,"shape"],[91,64,67,52],[91,66,67,54,"flattenOutputShape"],[91,84,67,72],[91,85,67,73],[92,4,68,4],[92,10,68,10,"res"],[92,13,68,13],[92,16,68,16,"backend"],[92,23,68,23],[92,24,68,24,"runWebGLProgram"],[92,39,68,39],[92,40,68,40,"program"],[92,47,68,47],[92,49,68,49],[92,50,68,50,"flattenX"],[92,58,68,58],[92,60,68,60,"flattenIndex"],[92,72,68,72],[92,73,68,73],[92,75,68,75,"flattenX"],[92,83,68,83],[92,84,68,84,"dtype"],[92,89,68,89],[92,90,68,90],[93,4,69,4,"toDispose"],[93,13,69,13],[93,14,69,14,"push"],[93,18,69,18],[93,19,69,19,"res"],[93,22,69,22],[93,23,69,23],[94,4,70,4],[94,10,70,10,"reshaped"],[94,18,70,18],[94,21,70,21],[94,25,70,21,"reshape"],[94,33,70,28],[94,34,70,28,"reshape"],[94,41,70,28],[94,43,70,29],[95,6,70,31,"inputs"],[95,12,70,37],[95,14,70,39],[96,8,70,41,"x"],[96,9,70,42],[96,11,70,44,"res"],[97,6,70,48],[97,7,70,49],[98,6,70,51,"backend"],[98,13,70,58],[99,6,70,60,"attrs"],[99,11,70,65],[99,13,70,67],[100,8,70,69,"shape"],[100,13,70,74],[100,15,70,76,"shapeInfo"],[100,24,70,85],[100,25,70,86,"outputShape"],[101,6,70,98],[102,4,70,100],[102,5,70,101],[102,6,70,102],[103,4,71,4,"toDispose"],[103,13,71,13],[103,14,71,14,"forEach"],[103,21,71,21],[103,22,71,22,"t"],[103,23,71,23],[103,27,71,27,"backend"],[103,34,71,34],[103,35,71,35,"disposeIntermediateTensorInfo"],[103,64,71,64],[103,65,71,65,"t"],[103,66,71,66],[103,67,71,67],[103,68,71,68],[104,4,72,4],[104,11,72,11,"reshaped"],[104,19,72,19],[105,2,73,0],[106,2,74,7],[106,8,74,13,"gatherV2Config"],[106,22,74,27],[106,25,74,30],[107,4,75,4,"kernelName"],[107,14,75,14],[107,16,75,16,"GatherV2"],[107,35,75,24],[107,36,75,24,"GatherV2"],[107,44,75,24],[108,4,76,4,"backendName"],[108,15,76,15],[108,17,76,17],[108,24,76,24],[109,4,77,4,"kernelFunc"],[109,14,77,14],[109,16,77,16,"gatherV2"],[110,2,78,0],[110,3,78,1],[111,0,78,2],[111,3]],"functionMap":{"names":["<global>","gatherV2","util.assert$argument_1","toDispose.forEach$argument_0"],"mappings":"AAA;OCoB;4DCY,wED;0BE+B,6CF;sBEO,6CF;CDE"},"hasCjsExports":false},"type":"js/module"}]}