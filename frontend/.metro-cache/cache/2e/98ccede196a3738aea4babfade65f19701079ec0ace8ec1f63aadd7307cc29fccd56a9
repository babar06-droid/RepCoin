{"dependencies":[],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"TransformProgram\", {\n    enumerable: true,\n    get: function () {\n      return TransformProgram;\n    }\n  });\n  /**\n   * @license\n   * Copyright 2021 Google LLC. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   */\n  class TransformProgram {\n    constructor(imageHeight, imageWidth, interpolation, fillMode, fillValue, outShape) {\n      this.variableNames = ['Image', 'Transforms'];\n      this.outputShape = outShape;\n      const interpolationModeId = interpolation === 'nearest' ? 1 : 2;\n      let fillModeId;\n      switch (fillMode) {\n        case 'constant':\n          fillModeId = 1;\n          break;\n        case 'reflect':\n          fillModeId = 2;\n          break;\n        case 'wrap':\n          fillModeId = 3;\n          break;\n        case 'nearest':\n          fillModeId = 4;\n          break;\n        default:\n          fillModeId = 1;\n          break;\n      }\n      this.userCode = `\n            float mapCoord(float outCoord, float len) {\n              float inCoord = outCoord;\n              if(${fillModeId} == 2) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    if (inCoord < sz2) {\n                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +\n                      inCoord;\n                    }\n                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    inCoord -= sz2 * float(int(float(inCoord / sz2)));\n                    if (inCoord >= len) {\n                      inCoord = sz2 - inCoord - 1.0;\n                    }\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (${fillModeId} == 3) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord -= len * float(int(float(inCoord / sz)));\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (${fillModeId} == 4) {\n                return clamp(outCoord, 0.0, len - 1.0);\n              } else {\n                return outCoord;\n              }\n            }\n\n            float readWithFillValue(int batch, int coordY, int coordX,\n              int channel) {\n              float outputValue;\n              if (0 <= coordY && coordY < ${imageHeight} && 0 <= coordX && coordX < ${imageWidth}) {\n                  outputValue = getImage(batch, coordY, coordX, channel);\n              } else {\n                outputValue = float(${fillValue});\n              }\n              return outputValue;\n            }\n\n            void main() {\n              ivec4 coords = getOutputCoords();\n              float outputValue;\n              int batch = coords[0];\n              int x = coords[2];\n              int y = coords[1];\n              int channel = coords[3];\n              float xf = float(x);\n              float yf = float(y);\n              float a1 = getTransforms(batch, 0);\n              float a2 = getTransforms(batch, 1);\n              float a3 = getTransforms(batch, 2);\n              float b1 = getTransforms(batch, 3);\n              float b2 = getTransforms(batch, 4);\n              float b3 = getTransforms(batch, 5);\n              float c1 = getTransforms(batch, 6);\n              float c2 = getTransforms(batch, 7);\n              float projection = c1 * xf + c2 * yf + 1.0;\n              if (projection == 0.0) {\n                outputValue = float(${fillValue});\n              } else {\n                float inX = (a1 * xf + a2 * yf + a3) / projection;\n                float inY = (b1 * xf + b2 * yf + b3) / projection;\n                float mapX = mapCoord(inX, float(${imageWidth}));\n                float mapY = mapCoord(inY, float(${imageHeight}));\n\n                if (${interpolationModeId} == 1) {\n                  int coordY = int(round(mapY));\n                  int coordX = int(round(mapX));\n                  outputValue = readWithFillValue(batch, coordY, coordX,\n                    channel);\n                } else {\n                  float yFloor = floor(mapY);\n                  float xFloor = floor(mapX);\n                  float yCeil = yFloor + 1.0;\n                  float xCeil = xFloor + 1.0;\n                  float valueYFloor = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);\n                  float valueYCeil = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);\n                  outputValue = (yCeil - mapY) * valueYFloor +\n                  (mapY - yFloor) * valueYCeil;\n                }\n              }\n              setOutput(outputValue);\n            }\n        `;\n    }\n  }\n});","lineCount":167,"map":[[7,2,17,0,"Object"],[7,8,17,0],[7,9,17,0,"defineProperty"],[7,23,17,0],[7,24,17,0,"exports"],[7,31,17,0],[8,4,17,0,"enumerable"],[8,14,17,0],[9,4,17,0,"get"],[9,7,17,0],[9,18,17,0,"get"],[9,19,17,0],[10,6,17,0],[10,13,17,0,"TransformProgram"],[10,29,17,0],[11,4,17,0],[12,2,17,0],[13,2,1,0],[14,0,2,0],[15,0,3,0],[16,0,4,0],[17,0,5,0],[18,0,6,0],[19,0,7,0],[20,0,8,0],[21,0,9,0],[22,0,10,0],[23,0,11,0],[24,0,12,0],[25,0,13,0],[26,0,14,0],[27,0,15,0],[28,0,16,0],[29,2,17,7],[29,8,17,13,"TransformProgram"],[29,24,17,29],[29,25,17,30],[30,4,18,4,"constructor"],[30,15,18,15,"constructor"],[30,16,18,16,"imageHeight"],[30,27,18,27],[30,29,18,29,"imageWidth"],[30,39,18,39],[30,41,18,41,"interpolation"],[30,54,18,54],[30,56,18,56,"fillMode"],[30,64,18,64],[30,66,18,66,"fillValue"],[30,75,18,75],[30,77,18,77,"outShape"],[30,85,18,85],[30,87,18,87],[31,6,19,8],[31,10,19,12],[31,11,19,13,"variableNames"],[31,24,19,26],[31,27,19,29],[31,28,19,30],[31,35,19,37],[31,37,19,39],[31,49,19,51],[31,50,19,52],[32,6,20,8],[32,10,20,12],[32,11,20,13,"outputShape"],[32,22,20,24],[32,25,20,27,"outShape"],[32,33,20,35],[33,6,21,8],[33,12,21,14,"interpolationModeId"],[33,31,21,33],[33,34,21,36,"interpolation"],[33,47,21,49],[33,52,21,54],[33,61,21,63],[33,64,21,66],[33,65,21,67],[33,68,21,70],[33,69,21,71],[34,6,22,8],[34,10,22,12,"fillModeId"],[34,20,22,22],[35,6,23,8],[35,14,23,16,"fillMode"],[35,22,23,24],[36,8,24,12],[36,13,24,17],[36,23,24,27],[37,10,25,16,"fillModeId"],[37,20,25,26],[37,23,25,29],[37,24,25,30],[38,10,26,16],[39,8,27,12],[39,13,27,17],[39,22,27,26],[40,10,28,16,"fillModeId"],[40,20,28,26],[40,23,28,29],[40,24,28,30],[41,10,29,16],[42,8,30,12],[42,13,30,17],[42,19,30,23],[43,10,31,16,"fillModeId"],[43,20,31,26],[43,23,31,29],[43,24,31,30],[44,10,32,16],[45,8,33,12],[45,13,33,17],[45,22,33,26],[46,10,34,16,"fillModeId"],[46,20,34,26],[46,23,34,29],[46,24,34,30],[47,10,35,16],[48,8,36,12],[49,10,37,16,"fillModeId"],[49,20,37,26],[49,23,37,29],[49,24,37,30],[50,10,38,16],[51,6,39,8],[52,6,40,8],[52,10,40,12],[52,11,40,13,"userCode"],[52,19,40,21],[52,22,40,24],[53,0,41,0],[54,0,42,0],[55,0,43,0],[55,19,43,19,"fillModeId"],[55,29,43,29],[56,0,44,0],[57,0,45,0],[58,0,46,0],[59,0,47,0],[60,0,48,0],[61,0,49,0],[62,0,50,0],[63,0,51,0],[64,0,52,0],[65,0,53,0],[66,0,54,0],[67,0,55,0],[68,0,56,0],[69,0,57,0],[70,0,58,0],[71,0,59,0],[72,0,60,0],[73,0,61,0],[74,0,62,0],[75,0,63,0],[76,0,64,0],[77,0,65,0],[78,0,66,0],[79,0,67,0],[79,27,67,27,"fillModeId"],[79,37,67,37],[80,0,68,0],[81,0,69,0],[82,0,70,0],[83,0,71,0],[84,0,72,0],[85,0,73,0],[86,0,74,0],[87,0,75,0],[88,0,76,0],[89,0,77,0],[90,0,78,0],[91,0,79,0],[92,0,80,0],[93,0,81,0],[94,0,82,0],[95,0,83,0],[96,0,84,0],[96,27,84,27,"fillModeId"],[96,37,84,37],[97,0,85,0],[98,0,86,0],[99,0,87,0],[100,0,88,0],[101,0,89,0],[102,0,90,0],[103,0,91,0],[104,0,92,0],[105,0,93,0],[106,0,94,0],[106,44,94,44,"imageHeight"],[106,55,94,55],[106,86,94,86,"imageWidth"],[106,96,94,96],[107,0,95,0],[108,0,96,0],[109,0,97,0],[109,38,97,38,"fillValue"],[109,47,97,47],[110,0,98,0],[111,0,99,0],[112,0,100,0],[113,0,101,0],[114,0,102,0],[115,0,103,0],[116,0,104,0],[117,0,105,0],[118,0,106,0],[119,0,107,0],[120,0,108,0],[121,0,109,0],[122,0,110,0],[123,0,111,0],[124,0,112,0],[125,0,113,0],[126,0,114,0],[127,0,115,0],[128,0,116,0],[129,0,117,0],[130,0,118,0],[131,0,119,0],[132,0,120,0],[133,0,121,0],[133,38,121,38,"fillValue"],[133,47,121,47],[134,0,122,0],[135,0,123,0],[136,0,124,0],[137,0,125,0],[137,51,125,51,"imageWidth"],[137,61,125,61],[138,0,126,0],[138,51,126,51,"imageHeight"],[138,62,126,62],[139,0,127,0],[140,0,128,0],[140,22,128,22,"interpolationModeId"],[140,41,128,41],[141,0,129,0],[142,0,130,0],[143,0,131,0],[144,0,132,0],[145,0,133,0],[146,0,134,0],[147,0,135,0],[148,0,136,0],[149,0,137,0],[150,0,138,0],[151,0,139,0],[152,0,140,0],[153,0,141,0],[154,0,142,0],[155,0,143,0],[156,0,144,0],[157,0,145,0],[158,0,146,0],[159,0,147,0],[160,0,148,0],[161,0,149,0],[162,0,150,0],[163,0,151,0],[164,0,152,0],[164,9,152,9],[165,4,153,4],[166,2,154,0],[167,0,154,1],[167,3]],"functionMap":{"names":["<global>","TransformProgram","TransformProgram#constructor"],"mappings":"AAA;OCgB;ICC;KDuI;CDC"},"hasCjsExports":false},"type":"js/module"}]}