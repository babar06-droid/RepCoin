{"dependencies":[{"name":"./environment","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":17,"column":0,"index":703},"end":{"line":17,"column":36,"index":739}}],"key":"2Do9crUUPY12BvahLvyDXFl4ivo=","exportNames":["*"],"imports":1}},{"name":"./global_util","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":18,"column":0,"index":740},"end":{"line":18,"column":42,"index":782}}],"key":"lD4qzDkWx56u3yiM1kocaIpzJ6s=","exportNames":["*"],"imports":1}},{"name":"./log","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":19,"column":0,"index":783},"end":{"line":19,"column":29,"index":812}}],"key":"zf+SD6oa8OIE8y54WLpxZOp3BAY=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopNamespace(e) {\n    if (e && e.__esModule) return e;\n    var n = {};\n    if (e) Object.keys(e).forEach(function (k) {\n      var d = Object.getOwnPropertyDescriptor(e, k);\n      Object.defineProperty(n, k, d.get ? d : {\n        enumerable: true,\n        get: function () {\n          return e[k];\n        }\n      });\n    });\n    n.default = e;\n    return n;\n  }\n  exports.getKernel = getKernel;\n  exports.getGradient = getGradient;\n  exports.getKernelsForBackend = getKernelsForBackend;\n  exports.registerKernel = registerKernel;\n  exports.registerGradient = registerGradient;\n  exports.unregisterKernel = unregisterKernel;\n  exports.unregisterGradient = unregisterGradient;\n  exports.copyRegisteredKernels = copyRegisteredKernels;\n  var _environment = require(_dependencyMap[0], \"./environment\");\n  var _global_util = require(_dependencyMap[1], \"./global_util\");\n  var _log = require(_dependencyMap[2], \"./log\");\n  var log = _interopNamespace(_log);\n  /**\n   * @license\n   * Copyright 2019 Google LLC. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   */\n\n  const kernelRegistry = (0, _global_util.getGlobal)('kernelRegistry', () => new Map());\n  const gradRegistry = (0, _global_util.getGlobal)('gradRegistry', () => new Map());\n  /**\n   * Returns the kernel function (code) associated with the provided names.\n   *\n   * @param kernelName The official name of the kernel.\n   * @param backendName The official name of the backend.\n   */\n  function getKernel(kernelName, backendName) {\n    const key = makeKey(kernelName, backendName);\n    return kernelRegistry.get(key);\n  }\n  /**\n   * Returns the registered gradient info associated with the provided kernel.\n   * @param kernelName The official TF kernel name.\n   */\n  function getGradient(kernelName) {\n    return gradRegistry.get(kernelName);\n  }\n  function getKernelsForBackend(backendName) {\n    const it = kernelRegistry.entries();\n    const result = [];\n    while (true) {\n      const {\n        done,\n        value\n      } = it.next();\n      if (done) {\n        break;\n      }\n      const [key, config] = value;\n      const [backend] = key.split('_');\n      if (backend === backendName) {\n        result.push(config);\n      }\n    }\n    return result;\n  }\n  /**\n   * Registers the function (forward pass) for the kernel in a global registry.\n   *\n   * @param config A config object with the following properties:\n   * - `kernelName` The official name of the kernel.\n   * - `backendName` The official name of the backend.\n   * - `kernelFunc` The function to run during the forward pass of the kernel.\n   * - `setupFunc` Optional. Gets called once, after the backend initializes.\n   * - `disposeFunc` Optional. Gets called once, right before the backend is\n   * disposed.\n   */\n  function registerKernel(config) {\n    const {\n      kernelName,\n      backendName\n    } = config;\n    const key = makeKey(kernelName, backendName);\n    if (kernelRegistry.has(key)) {\n      log.warn(`The kernel '${kernelName}' for backend ` + `'${backendName}' is already registered`);\n    }\n    kernelRegistry.set(key, config);\n  }\n  /**\n   * Registers a gradient function for a given kernel in the global registry,\n   * to be used during the back-propagation of that kernel.\n   *\n   * @param config An object with the following properties:\n   * - `kernelName` The name of the kernel that the gradient function is for.\n   * - `gradFunc` The function to run during back-propagation.\n   */\n  function registerGradient(config) {\n    const {\n      kernelName\n    } = config;\n    if (gradRegistry.has(kernelName)) {\n      // TODO (yassogba) after 3.0 assess whether we need to keep this gated\n      // to debug mode.\n      if ((0, _environment.env)().getBool('DEBUG')) {\n        log.warn(`Overriding the gradient for '${kernelName}'`);\n      }\n    }\n    gradRegistry.set(kernelName, config);\n  }\n  /**\n   * Removes the kernel function from the registry.\n   *\n   * @param kernelName The official name of the kernel.\n   * @param backendName The official name of the backend.\n   *\n   */\n  function unregisterKernel(kernelName, backendName) {\n    const key = makeKey(kernelName, backendName);\n    if (!kernelRegistry.has(key)) {\n      throw new Error(`The kernel '${kernelName}' for backend ` + `'${backendName}' is not registered`);\n    }\n    kernelRegistry.delete(key);\n  }\n  /** Removes the registered gradient from the global registry. */\n  function unregisterGradient(kernelName) {\n    if (!gradRegistry.has(kernelName)) {\n      throw new Error(`The gradient '${kernelName}' for backend is not registered`);\n    }\n    gradRegistry.delete(kernelName);\n  }\n  /**\n   * Finds kernels that have already been registered to a backend and re-registers\n   * them for a new backend. Useful for registering custom backends.\n   * @param registeredBackendName Already registered backend.\n   * @param newBackendName New backend.\n   */\n  function copyRegisteredKernels(registeredBackendName, newBackendName) {\n    const kernels = getKernelsForBackend(registeredBackendName);\n    kernels.forEach(kernelConfig => {\n      const newKernelConfig = Object.assign({}, kernelConfig, {\n        backendName: newBackendName\n      });\n      registerKernel(newKernelConfig);\n    });\n  }\n  function makeKey(kernelName, backendName) {\n    return `${backendName}_${kernelName}`;\n  }\n});","lineCount":171,"map":[[22,2,28,0,"exports"],[22,9,28,0],[22,10,28,0,"getKernel"],[22,19,28,0],[22,22,28,0,"getKernel"],[22,31,28,0],[23,2,36,0,"exports"],[23,9,36,0],[23,10,36,0,"getGradient"],[23,21,36,0],[23,24,36,0,"getGradient"],[23,35,36,0],[24,2,39,0,"exports"],[24,9,39,0],[24,10,39,0,"getKernelsForBackend"],[24,30,39,0],[24,33,39,0,"getKernelsForBackend"],[24,53,39,0],[25,2,66,0,"exports"],[25,9,66,0],[25,10,66,0,"registerKernel"],[25,24,66,0],[25,27,66,0,"registerKernel"],[25,41,66,0],[26,2,83,0,"exports"],[26,9,83,0],[26,10,83,0,"registerGradient"],[26,26,83,0],[26,29,83,0,"registerGradient"],[26,45,83,0],[27,2,101,0,"exports"],[27,9,101,0],[27,10,101,0,"unregisterKernel"],[27,26,101,0],[27,29,101,0,"unregisterKernel"],[27,45,101,0],[28,2,110,0,"exports"],[28,9,110,0],[28,10,110,0,"unregisterGradient"],[28,28,110,0],[28,31,110,0,"unregisterGradient"],[28,49,110,0],[29,2,122,0,"exports"],[29,9,122,0],[29,10,122,0,"copyRegisteredKernels"],[29,31,122,0],[29,34,122,0,"copyRegisteredKernels"],[29,55,122,0],[30,2,17,0],[30,6,17,0,"_environment"],[30,18,17,0],[30,21,17,0,"require"],[30,28,17,0],[30,29,17,0,"_dependencyMap"],[30,43,17,0],[31,2,18,0],[31,6,18,0,"_global_util"],[31,18,18,0],[31,21,18,0,"require"],[31,28,18,0],[31,29,18,0,"_dependencyMap"],[31,43,18,0],[32,2,19,0],[32,6,19,0,"_log"],[32,10,19,0],[32,13,19,0,"require"],[32,20,19,0],[32,21,19,0,"_dependencyMap"],[32,35,19,0],[33,2,19,0],[33,6,19,0,"log"],[33,9,19,0],[33,12,19,0,"_interopNamespace"],[33,29,19,0],[33,30,19,0,"_log"],[33,34,19,0],[34,2,1,0],[35,0,2,0],[36,0,3,0],[37,0,4,0],[38,0,5,0],[39,0,6,0],[40,0,7,0],[41,0,8,0],[42,0,9,0],[43,0,10,0],[44,0,11,0],[45,0,12,0],[46,0,13,0],[47,0,14,0],[48,0,15,0],[49,0,16,0],[51,2,20,0],[51,8,20,6,"kernelRegistry"],[51,22,20,20],[51,25,20,23],[51,29,20,23,"getGlobal"],[51,41,20,32],[51,42,20,32,"getGlobal"],[51,51,20,32],[51,53,20,33],[51,69,20,49],[51,71,20,51],[51,77,20,57],[51,81,20,61,"Map"],[51,84,20,64],[51,85,20,65],[51,86,20,66],[51,87,20,67],[52,2,21,0],[52,8,21,6,"gradRegistry"],[52,20,21,18],[52,23,21,21],[52,27,21,21,"getGlobal"],[52,39,21,30],[52,40,21,30,"getGlobal"],[52,49,21,30],[52,51,21,31],[52,65,21,45],[52,67,21,47],[52,73,21,53],[52,77,21,57,"Map"],[52,80,21,60],[52,81,21,61],[52,82,21,62],[52,83,21,63],[53,2,22,0],[54,0,23,0],[55,0,24,0],[56,0,25,0],[57,0,26,0],[58,0,27,0],[59,2,28,7],[59,11,28,16,"getKernel"],[59,20,28,25,"getKernel"],[59,21,28,26,"kernelName"],[59,31,28,36],[59,33,28,38,"backendName"],[59,44,28,49],[59,46,28,51],[60,4,29,4],[60,10,29,10,"key"],[60,13,29,13],[60,16,29,16,"makeKey"],[60,23,29,23],[60,24,29,24,"kernelName"],[60,34,29,34],[60,36,29,36,"backendName"],[60,47,29,47],[60,48,29,48],[61,4,30,4],[61,11,30,11,"kernelRegistry"],[61,25,30,25],[61,26,30,26,"get"],[61,29,30,29],[61,30,30,30,"key"],[61,33,30,33],[61,34,30,34],[62,2,31,0],[63,2,32,0],[64,0,33,0],[65,0,34,0],[66,0,35,0],[67,2,36,7],[67,11,36,16,"getGradient"],[67,22,36,27,"getGradient"],[67,23,36,28,"kernelName"],[67,33,36,38],[67,35,36,40],[68,4,37,4],[68,11,37,11,"gradRegistry"],[68,23,37,23],[68,24,37,24,"get"],[68,27,37,27],[68,28,37,28,"kernelName"],[68,38,37,38],[68,39,37,39],[69,2,38,0],[70,2,39,7],[70,11,39,16,"getKernelsForBackend"],[70,31,39,36,"getKernelsForBackend"],[70,32,39,37,"backendName"],[70,43,39,48],[70,45,39,50],[71,4,40,4],[71,10,40,10,"it"],[71,12,40,12],[71,15,40,15,"kernelRegistry"],[71,29,40,29],[71,30,40,30,"entries"],[71,37,40,37],[71,38,40,38],[71,39,40,39],[72,4,41,4],[72,10,41,10,"result"],[72,16,41,16],[72,19,41,19],[72,21,41,21],[73,4,42,4],[73,11,42,11],[73,15,42,15],[73,17,42,17],[74,6,43,8],[74,12,43,14],[75,8,43,16,"done"],[75,12,43,20],[76,8,43,22,"value"],[77,6,43,28],[77,7,43,29],[77,10,43,32,"it"],[77,12,43,34],[77,13,43,35,"next"],[77,17,43,39],[77,18,43,40],[77,19,43,41],[78,6,44,8],[78,10,44,12,"done"],[78,14,44,16],[78,16,44,18],[79,8,45,12],[80,6,46,8],[81,6,47,8],[81,12,47,14],[81,13,47,15,"key"],[81,16,47,18],[81,18,47,20,"config"],[81,24,47,26],[81,25,47,27],[81,28,47,30,"value"],[81,33,47,35],[82,6,48,8],[82,12,48,14],[82,13,48,15,"backend"],[82,20,48,22],[82,21,48,24],[82,24,48,27,"key"],[82,27,48,30],[82,28,48,31,"split"],[82,33,48,36],[82,34,48,37],[82,37,48,40],[82,38,48,41],[83,6,49,8],[83,10,49,12,"backend"],[83,17,49,19],[83,22,49,24,"backendName"],[83,33,49,35],[83,35,49,37],[84,8,50,12,"result"],[84,14,50,18],[84,15,50,19,"push"],[84,19,50,23],[84,20,50,24,"config"],[84,26,50,30],[84,27,50,31],[85,6,51,8],[86,4,52,4],[87,4,53,4],[87,11,53,11,"result"],[87,17,53,17],[88,2,54,0],[89,2,55,0],[90,0,56,0],[91,0,57,0],[92,0,58,0],[93,0,59,0],[94,0,60,0],[95,0,61,0],[96,0,62,0],[97,0,63,0],[98,0,64,0],[99,0,65,0],[100,2,66,7],[100,11,66,16,"registerKernel"],[100,25,66,30,"registerKernel"],[100,26,66,31,"config"],[100,32,66,37],[100,34,66,39],[101,4,67,4],[101,10,67,10],[102,6,67,12,"kernelName"],[102,16,67,22],[103,6,67,24,"backendName"],[104,4,67,36],[104,5,67,37],[104,8,67,40,"config"],[104,14,67,46],[105,4,68,4],[105,10,68,10,"key"],[105,13,68,13],[105,16,68,16,"makeKey"],[105,23,68,23],[105,24,68,24,"kernelName"],[105,34,68,34],[105,36,68,36,"backendName"],[105,47,68,47],[105,48,68,48],[106,4,69,4],[106,8,69,8,"kernelRegistry"],[106,22,69,22],[106,23,69,23,"has"],[106,26,69,26],[106,27,69,27,"key"],[106,30,69,30],[106,31,69,31],[106,33,69,33],[107,6,70,8,"log"],[107,9,70,11],[107,10,70,12,"warn"],[107,14,70,16],[107,15,70,17],[107,30,70,32,"kernelName"],[107,40,70,42],[107,56,70,58],[107,59,71,12],[107,63,71,16,"backendName"],[107,74,71,27],[107,99,71,52],[107,100,71,53],[108,4,72,4],[109,4,73,4,"kernelRegistry"],[109,18,73,18],[109,19,73,19,"set"],[109,22,73,22],[109,23,73,23,"key"],[109,26,73,26],[109,28,73,28,"config"],[109,34,73,34],[109,35,73,35],[110,2,74,0],[111,2,75,0],[112,0,76,0],[113,0,77,0],[114,0,78,0],[115,0,79,0],[116,0,80,0],[117,0,81,0],[118,0,82,0],[119,2,83,7],[119,11,83,16,"registerGradient"],[119,27,83,32,"registerGradient"],[119,28,83,33,"config"],[119,34,83,39],[119,36,83,41],[120,4,84,4],[120,10,84,10],[121,6,84,12,"kernelName"],[122,4,84,23],[122,5,84,24],[122,8,84,27,"config"],[122,14,84,33],[123,4,85,4],[123,8,85,8,"gradRegistry"],[123,20,85,20],[123,21,85,21,"has"],[123,24,85,24],[123,25,85,25,"kernelName"],[123,35,85,35],[123,36,85,36],[123,38,85,38],[124,6,86,8],[125,6,87,8],[126,6,88,8],[126,10,88,12],[126,14,88,12,"env"],[126,26,88,15],[126,27,88,15,"env"],[126,30,88,15],[126,32,88,16],[126,33,88,17],[126,34,88,18,"getBool"],[126,41,88,25],[126,42,88,26],[126,49,88,33],[126,50,88,34],[126,52,88,36],[127,8,89,12,"log"],[127,11,89,15],[127,12,89,16,"warn"],[127,16,89,20],[127,17,89,21],[127,49,89,53,"kernelName"],[127,59,89,63],[127,62,89,66],[127,63,89,67],[128,6,90,8],[129,4,91,4],[130,4,92,4,"gradRegistry"],[130,16,92,16],[130,17,92,17,"set"],[130,20,92,20],[130,21,92,21,"kernelName"],[130,31,92,31],[130,33,92,33,"config"],[130,39,92,39],[130,40,92,40],[131,2,93,0],[132,2,94,0],[133,0,95,0],[134,0,96,0],[135,0,97,0],[136,0,98,0],[137,0,99,0],[138,0,100,0],[139,2,101,7],[139,11,101,16,"unregisterKernel"],[139,27,101,32,"unregisterKernel"],[139,28,101,33,"kernelName"],[139,38,101,43],[139,40,101,45,"backendName"],[139,51,101,56],[139,53,101,58],[140,4,102,4],[140,10,102,10,"key"],[140,13,102,13],[140,16,102,16,"makeKey"],[140,23,102,23],[140,24,102,24,"kernelName"],[140,34,102,34],[140,36,102,36,"backendName"],[140,47,102,47],[140,48,102,48],[141,4,103,4],[141,8,103,8],[141,9,103,9,"kernelRegistry"],[141,23,103,23],[141,24,103,24,"has"],[141,27,103,27],[141,28,103,28,"key"],[141,31,103,31],[141,32,103,32],[141,34,103,34],[142,6,104,8],[142,12,104,14],[142,16,104,18,"Error"],[142,21,104,23],[142,22,104,24],[142,37,104,39,"kernelName"],[142,47,104,49],[142,63,104,65],[142,66,105,12],[142,70,105,16,"backendName"],[142,81,105,27],[142,102,105,48],[142,103,105,49],[143,4,106,4],[144,4,107,4,"kernelRegistry"],[144,18,107,18],[144,19,107,19,"delete"],[144,25,107,25],[144,26,107,26,"key"],[144,29,107,29],[144,30,107,30],[145,2,108,0],[146,2,109,0],[147,2,110,7],[147,11,110,16,"unregisterGradient"],[147,29,110,34,"unregisterGradient"],[147,30,110,35,"kernelName"],[147,40,110,45],[147,42,110,47],[148,4,111,4],[148,8,111,8],[148,9,111,9,"gradRegistry"],[148,21,111,21],[148,22,111,22,"has"],[148,25,111,25],[148,26,111,26,"kernelName"],[148,36,111,36],[148,37,111,37],[148,39,111,39],[149,6,112,8],[149,12,112,14],[149,16,112,18,"Error"],[149,21,112,23],[149,22,112,24],[149,39,112,41,"kernelName"],[149,49,112,51],[149,82,112,84],[149,83,112,85],[150,4,113,4],[151,4,114,4,"gradRegistry"],[151,16,114,16],[151,17,114,17,"delete"],[151,23,114,23],[151,24,114,24,"kernelName"],[151,34,114,34],[151,35,114,35],[152,2,115,0],[153,2,116,0],[154,0,117,0],[155,0,118,0],[156,0,119,0],[157,0,120,0],[158,0,121,0],[159,2,122,7],[159,11,122,16,"copyRegisteredKernels"],[159,32,122,37,"copyRegisteredKernels"],[159,33,122,38,"registeredBackendName"],[159,54,122,59],[159,56,122,61,"newBackendName"],[159,70,122,75],[159,72,122,77],[160,4,123,4],[160,10,123,10,"kernels"],[160,17,123,17],[160,20,123,20,"getKernelsForBackend"],[160,40,123,40],[160,41,123,41,"registeredBackendName"],[160,62,123,62],[160,63,123,63],[161,4,124,4,"kernels"],[161,11,124,11],[161,12,124,12,"forEach"],[161,19,124,19],[161,20,124,20,"kernelConfig"],[161,32,124,32],[161,36,124,36],[162,6,125,8],[162,12,125,14,"newKernelConfig"],[162,27,125,29],[162,30,125,32,"Object"],[162,36,125,38],[162,37,125,39,"assign"],[162,43,125,45],[162,44,125,46],[162,45,125,47],[162,46,125,48],[162,48,125,50,"kernelConfig"],[162,60,125,62],[162,62,125,64],[163,8,125,66,"backendName"],[163,19,125,77],[163,21,125,79,"newBackendName"],[164,6,125,94],[164,7,125,95],[164,8,125,96],[165,6,126,8,"registerKernel"],[165,20,126,22],[165,21,126,23,"newKernelConfig"],[165,36,126,38],[165,37,126,39],[166,4,127,4],[166,5,127,5],[166,6,127,6],[167,2,128,0],[168,2,129,0],[168,11,129,9,"makeKey"],[168,18,129,16,"makeKey"],[168,19,129,17,"kernelName"],[168,29,129,27],[168,31,129,29,"backendName"],[168,42,129,40],[168,44,129,42],[169,4,130,4],[169,11,130,11],[169,14,130,14,"backendName"],[169,25,130,25],[169,29,130,29,"kernelName"],[169,39,130,39],[169,41,130,41],[170,2,131,0],[171,0,131,1],[171,3]],"functionMap":{"names":["<global>","getGlobal$argument_1","getKernel","getGradient","getKernelsForBackend","registerKernel","registerGradient","unregisterKernel","unregisterGradient","copyRegisteredKernels","kernels.forEach$argument_0","makeKey"],"mappings":"AAA;mDCmB,eD;+CCC,eD;OEO;CFG;OGK;CHE;OIC;CJe;OKY;CLQ;OMS;CNU;OOQ;CPO;OQE;CRK;OSO;oBCE;KDG;CTC;AWC;CXE"},"hasCjsExports":false},"type":"js/module"}]}