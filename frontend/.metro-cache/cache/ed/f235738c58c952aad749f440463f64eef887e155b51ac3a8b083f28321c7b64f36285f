{"dependencies":[{"name":"./glsl_version","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":17,"column":0,"index":703},"end":{"line":17,"column":52,"index":755}}],"key":"PzwIhi74LcKYbosuBjZm+h3PwII=","exportNames":["*"],"imports":1}},{"name":"./gpgpu_math","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":18,"column":0,"index":756},"end":{"line":18,"column":48,"index":804}}],"key":"r7nFADTf/sGcqNrAYkmj7Z35J80=","exportNames":["*"],"imports":1}},{"name":"./shader_compiler_util","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":19,"column":0,"index":805},"end":{"line":19,"column":54,"index":859}}],"key":"MRaYEFt5V5oNumhqJDPCX030gRk=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopNamespace(e) {\n    if (e && e.__esModule) return e;\n    var n = {};\n    if (e) Object.keys(e).forEach(function (k) {\n      var d = Object.getOwnPropertyDescriptor(e, k);\n      Object.defineProperty(n, k, d.get ? d : {\n        enumerable: true,\n        get: function () {\n          return e[k];\n        }\n      });\n    });\n    n.default = e;\n    return n;\n  }\n  Object.defineProperty(exports, \"EncodeMatrixPackedProgram\", {\n    enumerable: true,\n    get: function () {\n      return EncodeMatrixPackedProgram;\n    }\n  });\n  var _glsl_version = require(_dependencyMap[0], \"./glsl_version\");\n  var _gpgpu_math = require(_dependencyMap[1], \"./gpgpu_math\");\n  var _shader_compiler_util = require(_dependencyMap[2], \"./shader_compiler_util\");\n  var shader_util = _interopNamespace(_shader_compiler_util);\n  /**\n   * @license\n   * Copyright 2018 Google LLC. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   */\n\n  /*\n  This is how the shader encodes a tensor with shape = [2, 3, 5]\n  (indices are [batch, row, col]).\n  \n  000|001   002|003   004|xxx   020|021   022|023   024|xxx\n  -------   -------   -------   -------   -------   -------\n  010|011   012|013   014|xxx   xxx|xxx   xxx|xxx   xxx|xxx\n  \n  100|101   102|103   104|xxx   120|121   122|123   124|xxx\n  -------   -------   -------   -------   -------   -------\n  110|111   112|113   114|xxx   xxx|xxx   xxx|xxx   xxx|xxx\n  \n  Single texels contain only values from the same batch, and from adjacent rows\n  and columns.\n   */\n  class EncodeMatrixPackedProgram {\n    constructor(outputShape, inputIsUnsignedByte = false) {\n      this.variableNames = ['A'];\n      this.packedInputs = false;\n      this.packedOutput = true;\n      this.customUniforms = [{\n        name: 'texShape',\n        type: 'ivec2'\n      }];\n      const glsl = (0, _glsl_version.getGlslDifferences)();\n      this.outputShape = outputShape;\n      this.enableShapeUniforms = (0, _gpgpu_math.useShapeUniforms)(this.outputShape.length);\n      let mainLoop = '';\n      let output = 'result';\n      if (inputIsUnsignedByte) {\n        output = 'floor(result * 255. + 0.5)';\n      }\n      for (let row = 0; row <= 1; row++) {\n        for (let col = 0; col <= 1; col++) {\n          const channel = row * 2 + col;\n          mainLoop += `\n          localCoords = coords;\n          if(localCoords[2] + ${col} < ${this.enableShapeUniforms ? 'outShape[2]' : `${outputShape[2]}`}) {\n          localCoords[2] += ${col};\n          if (localCoords[1] + ${row} < ${this.enableShapeUniforms ? 'outShape[1]' : `${outputShape[1]}`}) {\n            localCoords[1] += ${row};\n\n            flatIndex = getFlatIndex(localCoords);\n            offset = imod(flatIndex, 4);\n\n            flatIndex = idiv(flatIndex, 4, 1.);\n\n            int r = flatIndex / texShape[1];\n            int c = imod(flatIndex, texShape[1]);\n            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n            values = ${glsl.texture2D}(A, uv);\n\n            if (offset == 0) {\n              result[${channel}] = values[0];\n            } else if (offset == 1) {\n              result[${channel}] = values[1];\n            } else if (offset == 2) {\n              result[${channel}] = values[2];\n            } else {\n              result[${channel}] = values[3];\n            }\n          }\n        }\n        `;\n        }\n      }\n      this.userCode = `\n        ${this.enableShapeUniforms ? shader_util.getFlatIndexFrom3DOutput() : shader_util.getFlatIndexFrom3D(outputShape)}\n\n        void main() {\n          ivec3 coords = getOutputCoords();\n\n          vec4 result = vec4(0.);\n          int flatIndex, r, c, offset;\n          ivec3 localCoords;\n          vec2 uv;\n          vec4 values;\n\n          ${mainLoop}\n\n          ${glsl.output} = ${output};\n        }\n    `;\n    }\n  }\n});","lineCount":134,"map":[[22,2,35,0,"Object"],[22,8,35,0],[22,9,35,0,"defineProperty"],[22,23,35,0],[22,24,35,0,"exports"],[22,31,35,0],[23,4,35,0,"enumerable"],[23,14,35,0],[24,4,35,0,"get"],[24,7,35,0],[24,18,35,0,"get"],[24,19,35,0],[25,6,35,0],[25,13,35,0,"EncodeMatrixPackedProgram"],[25,38,35,0],[26,4,35,0],[27,2,35,0],[28,2,17,0],[28,6,17,0,"_glsl_version"],[28,19,17,0],[28,22,17,0,"require"],[28,29,17,0],[28,30,17,0,"_dependencyMap"],[28,44,17,0],[29,2,18,0],[29,6,18,0,"_gpgpu_math"],[29,17,18,0],[29,20,18,0,"require"],[29,27,18,0],[29,28,18,0,"_dependencyMap"],[29,42,18,0],[30,2,19,0],[30,6,19,0,"_shader_compiler_util"],[30,27,19,0],[30,30,19,0,"require"],[30,37,19,0],[30,38,19,0,"_dependencyMap"],[30,52,19,0],[31,2,19,0],[31,6,19,0,"shader_util"],[31,17,19,0],[31,20,19,0,"_interopNamespace"],[31,37,19,0],[31,38,19,0,"_shader_compiler_util"],[31,59,19,0],[32,2,1,0],[33,0,2,0],[34,0,3,0],[35,0,4,0],[36,0,5,0],[37,0,6,0],[38,0,7,0],[39,0,8,0],[40,0,9,0],[41,0,10,0],[42,0,11,0],[43,0,12,0],[44,0,13,0],[45,0,14,0],[46,0,15,0],[47,0,16,0],[49,2,20,0],[50,0,21,0],[51,0,22,0],[52,0,23,0],[53,0,24,0],[54,0,25,0],[55,0,26,0],[56,0,27,0],[57,0,28,0],[58,0,29,0],[59,0,30,0],[60,0,31,0],[61,0,32,0],[62,0,33,0],[63,0,34,0],[64,2,35,7],[64,8,35,13,"EncodeMatrixPackedProgram"],[64,33,35,38],[64,34,35,39],[65,4,36,4,"constructor"],[65,15,36,15,"constructor"],[65,16,36,16,"outputShape"],[65,27,36,27],[65,29,36,29,"inputIsUnsignedByte"],[65,48,36,48],[65,51,36,51],[65,56,36,56],[65,58,36,58],[66,6,37,8],[66,10,37,12],[66,11,37,13,"variableNames"],[66,24,37,26],[66,27,37,29],[66,28,37,30],[66,31,37,33],[66,32,37,34],[67,6,38,8],[67,10,38,12],[67,11,38,13,"packedInputs"],[67,23,38,25],[67,26,38,28],[67,31,38,33],[68,6,39,8],[68,10,39,12],[68,11,39,13,"packedOutput"],[68,23,39,25],[68,26,39,28],[68,30,39,32],[69,6,40,8],[69,10,40,12],[69,11,40,13,"customUniforms"],[69,25,40,27],[69,28,40,30],[69,29,40,31],[70,8,40,33,"name"],[70,12,40,37],[70,14,40,39],[70,24,40,49],[71,8,40,51,"type"],[71,12,40,55],[71,14,40,57],[72,6,40,65],[72,7,40,66],[72,8,40,67],[73,6,41,8],[73,12,41,14,"glsl"],[73,16,41,18],[73,19,41,21],[73,23,41,21,"getGlslDifferences"],[73,36,41,39],[73,37,41,39,"getGlslDifferences"],[73,55,41,39],[73,57,41,40],[73,58,41,41],[74,6,42,8],[74,10,42,12],[74,11,42,13,"outputShape"],[74,22,42,24],[74,25,42,27,"outputShape"],[74,36,42,38],[75,6,43,8],[75,10,43,12],[75,11,43,13,"enableShapeUniforms"],[75,30,43,32],[75,33,43,35],[75,37,43,35,"useShapeUniforms"],[75,48,43,51],[75,49,43,51,"useShapeUniforms"],[75,65,43,51],[75,67,43,52],[75,71,43,56],[75,72,43,57,"outputShape"],[75,83,43,68],[75,84,43,69,"length"],[75,90,43,75],[75,91,43,76],[76,6,44,8],[76,10,44,12,"mainLoop"],[76,18,44,20],[76,21,44,23],[76,23,44,25],[77,6,45,8],[77,10,45,12,"output"],[77,16,45,18],[77,19,45,21],[77,27,45,29],[78,6,46,8],[78,10,46,12,"inputIsUnsignedByte"],[78,29,46,31],[78,31,46,33],[79,8,47,12,"output"],[79,14,47,18],[79,17,47,21],[79,45,47,49],[80,6,48,8],[81,6,49,8],[81,11,49,13],[81,15,49,17,"row"],[81,18,49,20],[81,21,49,23],[81,22,49,24],[81,24,49,26,"row"],[81,27,49,29],[81,31,49,33],[81,32,49,34],[81,34,49,36,"row"],[81,37,49,39],[81,39,49,41],[81,41,49,43],[82,8,50,12],[82,13,50,17],[82,17,50,21,"col"],[82,20,50,24],[82,23,50,27],[82,24,50,28],[82,26,50,30,"col"],[82,29,50,33],[82,33,50,37],[82,34,50,38],[82,36,50,40,"col"],[82,39,50,43],[82,41,50,45],[82,43,50,47],[83,10,51,16],[83,16,51,22,"channel"],[83,23,51,29],[83,26,51,32,"row"],[83,29,51,35],[83,32,51,38],[83,33,51,39],[83,36,51,42,"col"],[83,39,51,45],[84,10,52,16,"mainLoop"],[84,18,52,24],[84,22,52,28],[85,0,53,0],[86,0,54,0],[86,32,54,32,"col"],[86,35,54,35],[86,41,54,41],[86,45,54,45],[86,46,54,46,"enableShapeUniforms"],[86,65,54,65],[86,68,54,68],[86,81,54,81],[86,84,54,84],[86,87,54,87,"outputShape"],[86,98,54,98],[86,99,54,99],[86,100,54,100],[86,101,54,101],[86,103,54,103],[87,0,55,0],[87,30,55,30,"col"],[87,33,55,33],[88,0,56,0],[88,33,56,33,"row"],[88,36,56,36],[88,42,56,42],[88,46,56,46],[88,47,56,47,"enableShapeUniforms"],[88,66,56,66],[88,69,56,69],[88,82,56,82],[88,85,56,85],[88,88,56,88,"outputShape"],[88,99,56,99],[88,100,56,100],[88,101,56,101],[88,102,56,102],[88,104,56,104],[89,0,57,0],[89,32,57,32,"row"],[89,35,57,35],[90,0,58,0],[91,0,59,0],[92,0,60,0],[93,0,61,0],[94,0,62,0],[95,0,63,0],[96,0,64,0],[97,0,65,0],[98,0,66,0],[99,0,67,0],[99,23,67,23,"glsl"],[99,27,67,27],[99,28,67,28,"texture2D"],[99,37,67,37],[100,0,68,0],[101,0,69,0],[102,0,70,0],[102,23,70,23,"channel"],[102,30,70,30],[103,0,71,0],[104,0,72,0],[104,23,72,23,"channel"],[104,30,72,30],[105,0,73,0],[106,0,74,0],[106,23,74,23,"channel"],[106,30,74,30],[107,0,75,0],[108,0,76,0],[108,23,76,23,"channel"],[108,30,76,30],[109,0,77,0],[110,0,78,0],[111,0,79,0],[112,0,80,0],[112,9,80,9],[113,8,81,12],[114,6,82,8],[115,6,83,8],[115,10,83,12],[115,11,83,13,"userCode"],[115,19,83,21],[115,22,83,24],[116,0,84,0],[116,10,84,10],[116,14,84,14],[116,15,84,15,"enableShapeUniforms"],[116,34,84,34],[116,37,84,37,"shader_util"],[116,48,84,48],[116,49,84,49,"getFlatIndexFrom3DOutput"],[116,73,84,73],[116,74,84,74],[116,75,84,75],[116,78,85,12,"shader_util"],[116,89,85,23],[116,90,85,24,"getFlatIndexFrom3D"],[116,108,85,42],[116,109,85,43,"outputShape"],[116,120,85,54],[116,121,85,55],[117,0,86,0],[118,0,87,0],[119,0,88,0],[120,0,89,0],[121,0,90,0],[122,0,91,0],[123,0,92,0],[124,0,93,0],[125,0,94,0],[126,0,95,0],[127,0,96,0],[127,12,96,12,"mainLoop"],[127,20,96,20],[128,0,97,0],[129,0,98,0],[129,12,98,12,"glsl"],[129,16,98,16],[129,17,98,17,"output"],[129,23,98,23],[129,29,98,29,"output"],[129,35,98,35],[130,0,99,0],[131,0,100,0],[131,5,100,5],[132,4,101,4],[133,2,102,0],[134,0,102,1],[134,3]],"functionMap":{"names":["<global>","EncodeMatrixPackedProgram","EncodeMatrixPackedProgram#constructor"],"mappings":"AAA;OCkC;ICC;KDiE;CDC"},"hasCjsExports":false},"type":"js/module"}]}