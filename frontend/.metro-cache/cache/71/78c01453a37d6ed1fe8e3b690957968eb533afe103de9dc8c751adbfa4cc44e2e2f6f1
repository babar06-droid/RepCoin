{"dependencies":[{"name":"@tensorflow/tfjs-core","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":19,"column":0,"index":767},"end":{"line":19,"column":50,"index":817}}],"key":"qIleUpSDMUXFynEGc51k60/pDSs=","exportNames":["*"],"imports":1}},{"name":"./byte_chunk_iterator","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":20,"column":0,"index":818},"end":{"line":20,"column":58,"index":876}}],"key":"7YDCrKk2VS9DW1HsmqaAczMd7EU=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"FileChunkIterator\", {\n    enumerable: true,\n    get: function () {\n      return FileChunkIterator;\n    }\n  });\n  var _tensorflowTfjsCore = require(_dependencyMap[0], \"@tensorflow/tfjs-core\");\n  var _byte_chunk_iterator = require(_dependencyMap[1], \"./byte_chunk_iterator\");\n  /**\n   * @license\n   * Copyright 2018 Google LLC. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   *\n   * =============================================================================\n   */\n  // inspired by https://github.com/maxogden/filereader-stream\n\n  /**\n   * Provide a stream of chunks from a File, Blob, or Uint8Array.\n   * @param file The source File, Blob or Uint8Array.\n   * @param options Optional settings controlling file reading.\n   * @returns a lazy Iterator of Uint8Arrays containing sequential chunks of the\n   *   input File, Blob or Uint8Array.\n   */\n  class FileChunkIterator extends _byte_chunk_iterator.ByteChunkIterator {\n    constructor(file, options = {}) {\n      super();\n      this.file = file;\n      this.options = options;\n      _tensorflowTfjsCore.util.assert(file instanceof Uint8Array || ((0, _tensorflowTfjsCore.env)().get('IS_BROWSER') ? file instanceof File || file instanceof Blob : false), () => 'FileChunkIterator only supports File, Blob and Uint8Array ' + 'right now.');\n      this.offset = options.offset || 0;\n      // default 1MB chunk has tolerable perf on large files\n      this.chunkSize = options.chunkSize || 1024 * 1024;\n    }\n    summary() {\n      return `FileChunks ${this.file}`;\n    }\n    async next() {\n      if (this.offset >= (this.file instanceof Uint8Array ? this.file.byteLength : this.file.size)) {\n        return {\n          value: null,\n          done: true\n        };\n      }\n      const chunk = new Promise((resolve, reject) => {\n        const end = this.offset + this.chunkSize;\n        if (this.file instanceof Uint8Array) {\n          // Note if end > this.uint8Array.byteLength, we just get a small last\n          // chunk.\n          resolve(new Uint8Array(this.file.slice(this.offset, end)));\n        } else {\n          // This branch assumes that this.file type is File or Blob, which\n          // means it is in the browser environment.\n          // TODO(soergel): is this a performance issue?\n          const fileReader = new FileReader();\n          fileReader.onload = event => {\n            let data = fileReader.result;\n            // Not sure we can trust the return type of\n            // FileReader.readAsArrayBuffer See e.g.\n            // https://github.com/node-file-api/FileReader/issues/2\n            if (data instanceof ArrayBuffer) {\n              data = new Uint8Array(data);\n            }\n            if (!(data instanceof Uint8Array)) {\n              return reject(new TypeError('FileReader returned unknown type.'));\n            }\n            resolve(data);\n          };\n          fileReader.onabort = event => {\n            return reject(new Error('Aborted'));\n          };\n          fileReader.onerror = event => {\n            return reject(new Error(event.type));\n          };\n          // TODO(soergel): better handle onabort, onerror\n          // Note if end > this.file.size, we just get a small last chunk.\n          const slice = this.file.slice(this.offset, end);\n          // We can't use readAsText here (even if we know the file is text)\n          // because the slice boundary may fall within a multi-byte character.\n          fileReader.readAsArrayBuffer(slice);\n        }\n        this.offset = end;\n      });\n      return {\n        value: await chunk,\n        done: false\n      };\n    }\n  }\n});","lineCount":106,"map":[[7,2,28,0,"Object"],[7,8,28,0],[7,9,28,0,"defineProperty"],[7,23,28,0],[7,24,28,0,"exports"],[7,31,28,0],[8,4,28,0,"enumerable"],[8,14,28,0],[9,4,28,0,"get"],[9,7,28,0],[9,18,28,0,"get"],[9,19,28,0],[10,6,28,0],[10,13,28,0,"FileChunkIterator"],[10,30,28,0],[11,4,28,0],[12,2,28,0],[13,2,19,0],[13,6,19,0,"_tensorflowTfjsCore"],[13,25,19,0],[13,28,19,0,"require"],[13,35,19,0],[13,36,19,0,"_dependencyMap"],[13,50,19,0],[14,2,20,0],[14,6,20,0,"_byte_chunk_iterator"],[14,26,20,0],[14,29,20,0,"require"],[14,36,20,0],[14,37,20,0,"_dependencyMap"],[14,51,20,0],[15,2,1,0],[16,0,2,0],[17,0,3,0],[18,0,4,0],[19,0,5,0],[20,0,6,0],[21,0,7,0],[22,0,8,0],[23,0,9,0],[24,0,10,0],[25,0,11,0],[26,0,12,0],[27,0,13,0],[28,0,14,0],[29,0,15,0],[30,0,16,0],[31,0,17,0],[32,2,18,0],[34,2,21,0],[35,0,22,0],[36,0,23,0],[37,0,24,0],[38,0,25,0],[39,0,26,0],[40,0,27,0],[41,2,28,7],[41,8,28,13,"FileChunkIterator"],[41,25,28,30],[41,34,28,39,"ByteChunkIterator"],[41,54,28,56],[41,55,28,56,"ByteChunkIterator"],[41,72,28,56],[41,73,28,57],[42,4,29,4,"constructor"],[42,15,29,15,"constructor"],[42,16,29,16,"file"],[42,20,29,20],[42,22,29,22,"options"],[42,29,29,29],[42,32,29,32],[42,33,29,33],[42,34,29,34],[42,36,29,36],[43,6,30,8],[43,11,30,13],[43,12,30,14],[43,13,30,15],[44,6,31,8],[44,10,31,12],[44,11,31,13,"file"],[44,15,31,17],[44,18,31,20,"file"],[44,22,31,24],[45,6,32,8],[45,10,32,12],[45,11,32,13,"options"],[45,18,32,20],[45,21,32,23,"options"],[45,28,32,30],[46,6,33,8,"util"],[46,25,33,12],[46,26,33,12,"util"],[46,30,33,12],[46,31,33,13,"assert"],[46,37,33,19],[46,38,33,21,"file"],[46,42,33,25],[46,54,33,37,"Uint8Array"],[46,64,33,47],[46,69,34,13],[46,73,34,13,"env"],[46,92,34,16],[46,93,34,16,"env"],[46,96,34,16],[46,98,34,17],[46,99,34,18],[46,100,34,19,"get"],[46,103,34,22],[46,104,34,23],[46,116,34,35],[46,117,34,36],[46,120,35,17,"file"],[46,124,35,21],[46,136,35,33,"File"],[46,140,35,37],[46,144,35,41,"file"],[46,148,35,45],[46,160,35,57,"Blob"],[46,164,35,61],[46,167,36,16],[46,172,36,21],[46,173,36,22],[46,175,36,24],[46,181,36,30],[46,241,36,90],[46,244,37,12],[46,256,37,24],[46,257,37,25],[47,6,38,8],[47,10,38,12],[47,11,38,13,"offset"],[47,17,38,19],[47,20,38,22,"options"],[47,27,38,29],[47,28,38,30,"offset"],[47,34,38,36],[47,38,38,40],[47,39,38,41],[48,6,39,8],[49,6,40,8],[49,10,40,12],[49,11,40,13,"chunkSize"],[49,20,40,22],[49,23,40,25,"options"],[49,30,40,32],[49,31,40,33,"chunkSize"],[49,40,40,42],[49,44,40,46],[49,48,40,50],[49,51,40,53],[49,55,40,57],[50,4,41,4],[51,4,42,4,"summary"],[51,11,42,11,"summary"],[51,12,42,11],[51,14,42,14],[52,6,43,8],[52,13,43,15],[52,27,43,29],[52,31,43,33],[52,32,43,34,"file"],[52,36,43,38],[52,38,43,40],[53,4,44,4],[54,4,45,4],[54,10,45,10,"next"],[54,14,45,14,"next"],[54,15,45,14],[54,17,45,17],[55,6,46,8],[55,10,46,12],[55,14,46,16],[55,15,46,17,"offset"],[55,21,46,23],[55,26,46,29],[55,30,46,33],[55,31,46,34,"file"],[55,35,46,38],[55,47,46,50,"Uint8Array"],[55,57,46,60],[55,60,47,12],[55,64,47,16],[55,65,47,17,"file"],[55,69,47,21],[55,70,47,22,"byteLength"],[55,80,47,32],[55,83,48,12],[55,87,48,16],[55,88,48,17,"file"],[55,92,48,21],[55,93,48,22,"size"],[55,97,48,26],[55,98,48,27],[55,100,48,29],[56,8,49,12],[56,15,49,19],[57,10,49,21,"value"],[57,15,49,26],[57,17,49,28],[57,21,49,32],[58,10,49,34,"done"],[58,14,49,38],[58,16,49,40],[59,8,49,45],[59,9,49,46],[60,6,50,8],[61,6,51,8],[61,12,51,14,"chunk"],[61,17,51,19],[61,20,51,22],[61,24,51,26,"Promise"],[61,31,51,33],[61,32,51,34],[61,33,51,35,"resolve"],[61,40,51,42],[61,42,51,44,"reject"],[61,48,51,50],[61,53,51,55],[62,8,52,12],[62,14,52,18,"end"],[62,17,52,21],[62,20,52,24],[62,24,52,28],[62,25,52,29,"offset"],[62,31,52,35],[62,34,52,38],[62,38,52,42],[62,39,52,43,"chunkSize"],[62,48,52,52],[63,8,53,12],[63,12,53,16],[63,16,53,20],[63,17,53,21,"file"],[63,21,53,25],[63,33,53,37,"Uint8Array"],[63,43,53,47],[63,45,53,49],[64,10,54,16],[65,10,55,16],[66,10,56,16,"resolve"],[66,17,56,23],[66,18,56,24],[66,22,56,28,"Uint8Array"],[66,32,56,38],[66,33,56,39],[66,37,56,43],[66,38,56,44,"file"],[66,42,56,48],[66,43,56,49,"slice"],[66,48,56,54],[66,49,56,55],[66,53,56,59],[66,54,56,60,"offset"],[66,60,56,66],[66,62,56,68,"end"],[66,65,56,71],[66,66,56,72],[66,67,56,73],[66,68,56,74],[67,8,57,12],[67,9,57,13],[67,15,58,17],[68,10,59,16],[69,10,60,16],[70,10,61,16],[71,10,62,16],[71,16,62,22,"fileReader"],[71,26,62,32],[71,29,62,35],[71,33,62,39,"FileReader"],[71,43,62,49],[71,44,62,50],[71,45,62,51],[72,10,63,16,"fileReader"],[72,20,63,26],[72,21,63,27,"onload"],[72,27,63,33],[72,30,63,37,"event"],[72,35,63,42],[72,39,63,47],[73,12,64,20],[73,16,64,24,"data"],[73,20,64,28],[73,23,64,31,"fileReader"],[73,33,64,41],[73,34,64,42,"result"],[73,40,64,48],[74,12,65,20],[75,12,66,20],[76,12,67,20],[77,12,68,20],[77,16,68,24,"data"],[77,20,68,28],[77,32,68,40,"ArrayBuffer"],[77,43,68,51],[77,45,68,53],[78,14,69,24,"data"],[78,18,69,28],[78,21,69,31],[78,25,69,35,"Uint8Array"],[78,35,69,45],[78,36,69,46,"data"],[78,40,69,50],[78,41,69,51],[79,12,70,20],[80,12,71,20],[80,16,71,24],[80,18,71,26,"data"],[80,22,71,30],[80,34,71,42,"Uint8Array"],[80,44,71,52],[80,45,71,53],[80,47,71,55],[81,14,72,24],[81,21,72,31,"reject"],[81,27,72,37],[81,28,72,38],[81,32,72,42,"TypeError"],[81,41,72,51],[81,42,72,52],[81,77,72,87],[81,78,72,88],[81,79,72,89],[82,12,73,20],[83,12,74,20,"resolve"],[83,19,74,27],[83,20,74,28,"data"],[83,24,74,32],[83,25,74,33],[84,10,75,16],[84,11,75,17],[85,10,76,16,"fileReader"],[85,20,76,26],[85,21,76,27,"onabort"],[85,28,76,34],[85,31,76,38,"event"],[85,36,76,43],[85,40,76,48],[86,12,77,20],[86,19,77,27,"reject"],[86,25,77,33],[86,26,77,34],[86,30,77,38,"Error"],[86,35,77,43],[86,36,77,44],[86,45,77,53],[86,46,77,54],[86,47,77,55],[87,10,78,16],[87,11,78,17],[88,10,79,16,"fileReader"],[88,20,79,26],[88,21,79,27,"onerror"],[88,28,79,34],[88,31,79,38,"event"],[88,36,79,43],[88,40,79,48],[89,12,80,20],[89,19,80,27,"reject"],[89,25,80,33],[89,26,80,34],[89,30,80,38,"Error"],[89,35,80,43],[89,36,80,44,"event"],[89,41,80,49],[89,42,80,50,"type"],[89,46,80,54],[89,47,80,55],[89,48,80,56],[90,10,81,16],[90,11,81,17],[91,10,82,16],[92,10,83,16],[93,10,84,16],[93,16,84,22,"slice"],[93,21,84,27],[93,24,84,30],[93,28,84,34],[93,29,84,35,"file"],[93,33,84,39],[93,34,84,40,"slice"],[93,39,84,45],[93,40,84,46],[93,44,84,50],[93,45,84,51,"offset"],[93,51,84,57],[93,53,84,59,"end"],[93,56,84,62],[93,57,84,63],[94,10,85,16],[95,10,86,16],[96,10,87,16,"fileReader"],[96,20,87,26],[96,21,87,27,"readAsArrayBuffer"],[96,38,87,44],[96,39,87,45,"slice"],[96,44,87,50],[96,45,87,51],[97,8,88,12],[98,8,89,12],[98,12,89,16],[98,13,89,17,"offset"],[98,19,89,23],[98,22,89,26,"end"],[98,25,89,29],[99,6,90,8],[99,7,90,9],[99,8,90,10],[100,6,91,8],[100,13,91,15],[101,8,91,17,"value"],[101,13,91,22],[101,15,91,25],[101,21,91,31,"chunk"],[101,26,91,37],[102,8,91,39,"done"],[102,12,91,43],[102,14,91,45],[103,6,91,51],[103,7,91,52],[104,4,92,4],[105,2,93,0],[106,0,93,1],[106,3]],"functionMap":{"names":["<global>","FileChunkIterator","FileChunkIterator#constructor","util.assert$argument_1","FileChunkIterator#summary","FileChunkIterator#next","Promise$argument_0","fileReader.onload","fileReader.onabort","fileReader.onerror"],"mappings":"AAA;OC2B;ICC;wBCO;wBDC;KDI;IGC;KHE;IIC;kCCM;oCCY;iBDY;qCEC;iBFE;qCGC;iBHE;SDS;KJE;CDC"},"hasCjsExports":false},"type":"js/module"}]}