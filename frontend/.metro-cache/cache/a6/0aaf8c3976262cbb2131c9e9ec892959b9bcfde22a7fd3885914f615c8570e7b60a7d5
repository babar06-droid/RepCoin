{"dependencies":[{"name":"./shader_compiler","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":54,"index":54}}],"key":"yVSKlvZSxQn3Ck2puzGVWEYPzq8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"CumOpType\", {\n    enumerable: true,\n    get: function () {\n      return CumOpType;\n    }\n  });\n  Object.defineProperty(exports, \"CumProgram\", {\n    enumerable: true,\n    get: function () {\n      return CumProgram;\n    }\n  });\n  var _shader_compiler = require(_dependencyMap[0], \"./shader_compiler\");\n  var CumOpType;\n  (function (CumOpType) {\n    CumOpType[\"Prod\"] = \"*\";\n    CumOpType[\"Sum\"] = \"+\";\n  })(CumOpType || (CumOpType = {}));\n  class CumProgram {\n    constructor(op, outputShape, exclusive, reverse) {\n      this.op = op;\n      this.outputShape = outputShape;\n      this.variableNames = ['x'];\n      this.customUniforms = [{\n        name: 'index',\n        type: 'float'\n      }];\n      const rank = this.outputShape.length;\n      const initVal = this.op === CumOpType.Prod ? '1.0' : '0.0';\n      const val = exclusive ? initVal : `getX(${getCoords(rank, 'coords', this.op)})`;\n      const length = this.outputShape[this.outputShape.length - 1];\n      let condition = '';\n      let idxString = '';\n      // When exclusive is set, the cum op becomes roll op that copies the\n      // value from the previous index based on the direction specified by the\n      // reverse flag.\n      if (exclusive) {\n        condition = reverse ? `end != ${length - 1}` : 'end != 0';\n        idxString = reverse ? 'end + 1' : 'end - 1';\n      } else {\n        condition = reverse ? `end + pow2 < ${length}` : 'end >= pow2';\n        idxString = reverse ? 'end + pow2' : 'end - pow2';\n      }\n      this.userCode = `\n      void main() {\n        ${(0, _shader_compiler.getCoordsDataType)(rank)} coords = getOutputCoords();\n        int end = ${getFinalCoord(rank, 'coords', this.op)};\n        float val = ${val};\n        int pow2 = int(pow(2.0, index));\n        if (${condition}) {\n          int idx = ${idxString};\n          ${getFinalCoord(rank, 'coords', this.op)} = idx;\n          val ${this.op}= getX(${getCoords(rank, 'coords', this.op)});\n        }\n        setOutput(val);\n      }\n    `;\n    }\n  }\n  function getCoords(rank, name, op) {\n    if (rank === 1) {\n      return `${name}`;\n    } else if (rank === 2) {\n      return `${name}.x, ${name}.y`;\n    } else if (rank === 3) {\n      return `${name}.x, ${name}.y, ${name}.z`;\n    } else if (rank === 4) {\n      return `${name}.x, ${name}.y, ${name}.z, ${name}.w`;\n    } else {\n      throw new Error(`Cumulative ${op} for rank ${rank} is not yet supported`);\n    }\n  }\n  function getFinalCoord(rank, name, op) {\n    if (rank === 1) {\n      return `${name}`;\n    } else if (rank === 2) {\n      return `${name}.y`;\n    } else if (rank === 3) {\n      return `${name}.z`;\n    } else if (rank === 4) {\n      return `${name}.w`;\n    } else {\n      throw new Error(`Cumulative ${op} for rank ${rank} is not yet supported`);\n    }\n  }\n});","lineCount":92,"map":[[7,2,2,0,"Object"],[7,8,2,0],[7,9,2,0,"defineProperty"],[7,23,2,0],[7,24,2,0,"exports"],[7,31,2,0],[8,4,2,0,"enumerable"],[8,14,2,0],[9,4,2,0,"get"],[9,7,2,0],[9,18,2,0,"get"],[9,19,2,0],[10,6,2,0],[10,13,2,0,"CumOpType"],[10,22,2,0],[11,4,2,0],[12,2,2,0],[13,2,7,0,"Object"],[13,8,7,0],[13,9,7,0,"defineProperty"],[13,23,7,0],[13,24,7,0,"exports"],[13,31,7,0],[14,4,7,0,"enumerable"],[14,14,7,0],[15,4,7,0,"get"],[15,7,7,0],[15,18,7,0,"get"],[15,19,7,0],[16,6,7,0],[16,13,7,0,"CumProgram"],[16,23,7,0],[17,4,7,0],[18,2,7,0],[19,2,1,0],[19,6,1,0,"_shader_compiler"],[19,22,1,0],[19,25,1,0,"require"],[19,32,1,0],[19,33,1,0,"_dependencyMap"],[19,47,1,0],[20,2,2,7],[20,6,2,11,"CumOpType"],[20,15,2,20],[21,2,3,0],[21,3,3,1],[21,13,3,11,"CumOpType"],[21,22,3,20],[21,24,3,22],[22,4,4,4,"CumOpType"],[22,13,4,13],[22,14,4,14],[22,20,4,20],[22,21,4,21],[22,24,4,24],[22,27,4,27],[23,4,5,4,"CumOpType"],[23,13,5,13],[23,14,5,14],[23,19,5,19],[23,20,5,20],[23,23,5,23],[23,26,5,26],[24,2,6,0],[24,3,6,1],[24,5,6,3,"CumOpType"],[24,14,6,12],[24,19,6,17,"CumOpType"],[24,28,6,26],[24,31,6,29],[24,32,6,30],[24,33,6,31],[24,34,6,32],[24,35,6,33],[25,2,7,7],[25,8,7,13,"CumProgram"],[25,18,7,23],[25,19,7,24],[26,4,8,4,"constructor"],[26,15,8,15,"constructor"],[26,16,8,16,"op"],[26,18,8,18],[26,20,8,20,"outputShape"],[26,31,8,31],[26,33,8,33,"exclusive"],[26,42,8,42],[26,44,8,44,"reverse"],[26,51,8,51],[26,53,8,53],[27,6,9,8],[27,10,9,12],[27,11,9,13,"op"],[27,13,9,15],[27,16,9,18,"op"],[27,18,9,20],[28,6,10,8],[28,10,10,12],[28,11,10,13,"outputShape"],[28,22,10,24],[28,25,10,27,"outputShape"],[28,36,10,38],[29,6,11,8],[29,10,11,12],[29,11,11,13,"variableNames"],[29,24,11,26],[29,27,11,29],[29,28,11,30],[29,31,11,33],[29,32,11,34],[30,6,12,8],[30,10,12,12],[30,11,12,13,"customUniforms"],[30,25,12,27],[30,28,12,30],[30,29,12,31],[31,8,12,33,"name"],[31,12,12,37],[31,14,12,39],[31,21,12,46],[32,8,12,48,"type"],[32,12,12,52],[32,14,12,54],[33,6,12,62],[33,7,12,63],[33,8,12,64],[34,6,13,8],[34,12,13,14,"rank"],[34,16,13,18],[34,19,13,21],[34,23,13,25],[34,24,13,26,"outputShape"],[34,35,13,37],[34,36,13,38,"length"],[34,42,13,44],[35,6,14,8],[35,12,14,14,"initVal"],[35,19,14,21],[35,22,14,24],[35,26,14,28],[35,27,14,29,"op"],[35,29,14,31],[35,34,14,36,"CumOpType"],[35,43,14,45],[35,44,14,46,"Prod"],[35,48,14,50],[35,51,14,53],[35,56,14,58],[35,59,14,61],[35,64,14,66],[36,6,15,8],[36,12,15,14,"val"],[36,15,15,17],[36,18,15,20,"exclusive"],[36,27,15,29],[36,30,15,32,"initVal"],[36,37,15,39],[36,40,15,42],[36,48,15,50,"getCoords"],[36,57,15,59],[36,58,15,60,"rank"],[36,62,15,64],[36,64,15,66],[36,72,15,74],[36,74,15,76],[36,78,15,80],[36,79,15,81,"op"],[36,81,15,83],[36,82,15,84],[36,85,15,87],[37,6,16,8],[37,12,16,14,"length"],[37,18,16,20],[37,21,16,23],[37,25,16,27],[37,26,16,28,"outputShape"],[37,37,16,39],[37,38,16,40],[37,42,16,44],[37,43,16,45,"outputShape"],[37,54,16,56],[37,55,16,57,"length"],[37,61,16,63],[37,64,16,66],[37,65,16,67],[37,66,16,68],[38,6,17,8],[38,10,17,12,"condition"],[38,19,17,21],[38,22,17,24],[38,24,17,26],[39,6,18,8],[39,10,18,12,"idxString"],[39,19,18,21],[39,22,18,24],[39,24,18,26],[40,6,19,8],[41,6,20,8],[42,6,21,8],[43,6,22,8],[43,10,22,12,"exclusive"],[43,19,22,21],[43,21,22,23],[44,8,23,12,"condition"],[44,17,23,21],[44,20,23,24,"reverse"],[44,27,23,31],[44,30,23,34],[44,40,23,44,"length"],[44,46,23,50],[44,49,23,53],[44,50,23,54],[44,52,23,56],[44,55,23,59],[44,65,23,69],[45,8,24,12,"idxString"],[45,17,24,21],[45,20,24,24,"reverse"],[45,27,24,31],[45,30,24,34],[45,39,24,43],[45,42,24,46],[45,51,24,55],[46,6,25,8],[46,7,25,9],[46,13,26,13],[47,8,27,12,"condition"],[47,17,27,21],[47,20,27,24,"reverse"],[47,27,27,31],[47,30,27,34],[47,46,27,50,"length"],[47,52,27,56],[47,54,27,58],[47,57,27,61],[47,70,27,74],[48,8,28,12,"idxString"],[48,17,28,21],[48,20,28,25,"reverse"],[48,27,28,32],[48,30,28,35],[48,42,28,47],[48,45,28,50],[48,57,28,63],[49,6,29,8],[50,6,30,8],[50,10,30,12],[50,11,30,13,"userCode"],[50,19,30,21],[50,22,30,24],[51,0,31,0],[52,0,32,0],[52,10,32,10],[52,14,32,10,"getCoordsDataType"],[52,30,32,27],[52,31,32,27,"getCoordsDataType"],[52,48,32,27],[52,50,32,28,"rank"],[52,54,32,32],[52,55,32,33],[53,0,33,0],[53,20,33,20,"getFinalCoord"],[53,33,33,33],[53,34,33,34,"rank"],[53,38,33,38],[53,40,33,40],[53,48,33,48],[53,50,33,50],[53,54,33,54],[53,55,33,55,"op"],[53,57,33,57],[53,58,33,58],[54,0,34,0],[54,22,34,22,"val"],[54,25,34,25],[55,0,35,0],[56,0,36,0],[56,14,36,14,"condition"],[56,23,36,23],[57,0,37,0],[57,22,37,22,"idxString"],[57,31,37,31],[58,0,38,0],[58,12,38,12,"getFinalCoord"],[58,25,38,25],[58,26,38,26,"rank"],[58,30,38,30],[58,32,38,32],[58,40,38,40],[58,42,38,42],[58,46,38,46],[58,47,38,47,"op"],[58,49,38,49],[58,50,38,50],[59,0,39,0],[59,16,39,16],[59,20,39,20],[59,21,39,21,"op"],[59,23,39,23],[59,33,39,33,"getCoords"],[59,42,39,42],[59,43,39,43,"rank"],[59,47,39,47],[59,49,39,49],[59,57,39,57],[59,59,39,59],[59,63,39,63],[59,64,39,64,"op"],[59,66,39,66],[59,67,39,67],[60,0,40,0],[61,0,41,0],[62,0,42,0],[63,0,43,0],[63,5,43,5],[64,4,44,4],[65,2,45,0],[66,2,46,0],[66,11,46,9,"getCoords"],[66,20,46,18,"getCoords"],[66,21,46,19,"rank"],[66,25,46,23],[66,27,46,25,"name"],[66,31,46,29],[66,33,46,31,"op"],[66,35,46,33],[66,37,46,35],[67,4,47,4],[67,8,47,8,"rank"],[67,12,47,12],[67,17,47,17],[67,18,47,18],[67,20,47,20],[68,6,48,8],[68,13,48,15],[68,16,48,18,"name"],[68,20,48,22],[68,22,48,24],[69,4,49,4],[69,5,49,5],[69,11,50,9],[69,15,50,13,"rank"],[69,19,50,17],[69,24,50,22],[69,25,50,23],[69,27,50,25],[70,6,51,8],[70,13,51,15],[70,16,51,18,"name"],[70,20,51,22],[70,27,51,29,"name"],[70,31,51,33],[70,35,51,37],[71,4,52,4],[71,5,52,5],[71,11,53,9],[71,15,53,13,"rank"],[71,19,53,17],[71,24,53,22],[71,25,53,23],[71,27,53,25],[72,6,54,8],[72,13,54,15],[72,16,54,18,"name"],[72,20,54,22],[72,27,54,29,"name"],[72,31,54,33],[72,38,54,40,"name"],[72,42,54,44],[72,46,54,48],[73,4,55,4],[73,5,55,5],[73,11,56,9],[73,15,56,13,"rank"],[73,19,56,17],[73,24,56,22],[73,25,56,23],[73,27,56,25],[74,6,57,8],[74,13,57,15],[74,16,57,18,"name"],[74,20,57,22],[74,27,57,29,"name"],[74,31,57,33],[74,38,57,40,"name"],[74,42,57,44],[74,49,57,51,"name"],[74,53,57,55],[74,57,57,59],[75,4,58,4],[75,5,58,5],[75,11,59,9],[76,6,60,8],[76,12,60,14],[76,16,60,18,"Error"],[76,21,60,23],[76,22,60,24],[76,36,60,38,"op"],[76,38,60,40],[76,51,60,53,"rank"],[76,55,60,57],[76,78,60,80],[76,79,60,81],[77,4,61,4],[78,2,62,0],[79,2,63,0],[79,11,63,9,"getFinalCoord"],[79,24,63,22,"getFinalCoord"],[79,25,63,23,"rank"],[79,29,63,27],[79,31,63,29,"name"],[79,35,63,33],[79,37,63,35,"op"],[79,39,63,37],[79,41,63,39],[80,4,64,4],[80,8,64,8,"rank"],[80,12,64,12],[80,17,64,17],[80,18,64,18],[80,20,64,20],[81,6,65,8],[81,13,65,15],[81,16,65,18,"name"],[81,20,65,22],[81,22,65,24],[82,4,66,4],[82,5,66,5],[82,11,67,9],[82,15,67,13,"rank"],[82,19,67,17],[82,24,67,22],[82,25,67,23],[82,27,67,25],[83,6,68,8],[83,13,68,15],[83,16,68,18,"name"],[83,20,68,22],[83,24,68,26],[84,4,69,4],[84,5,69,5],[84,11,70,9],[84,15,70,13,"rank"],[84,19,70,17],[84,24,70,22],[84,25,70,23],[84,27,70,25],[85,6,71,8],[85,13,71,15],[85,16,71,18,"name"],[85,20,71,22],[85,24,71,26],[86,4,72,4],[86,5,72,5],[86,11,73,9],[86,15,73,13,"rank"],[86,19,73,17],[86,24,73,22],[86,25,73,23],[86,27,73,25],[87,6,74,8],[87,13,74,15],[87,16,74,18,"name"],[87,20,74,22],[87,24,74,26],[88,4,75,4],[88,5,75,5],[88,11,76,9],[89,6,77,8],[89,12,77,14],[89,16,77,18,"Error"],[89,21,77,23],[89,22,77,24],[89,36,77,38,"op"],[89,38,77,40],[89,51,77,53,"rank"],[89,55,77,57],[89,78,77,80],[89,79,77,81],[90,4,78,4],[91,2,79,0],[92,0,79,1],[92,3]],"functionMap":{"names":["<global>","<anonymous>","CumProgram","CumProgram#constructor","getCoords","getFinalCoord"],"mappings":"AAA;CCE;CDG;OEC;ICC;KDoC;CFC;AIC;CJgB;AKC;CLgB"},"hasCjsExports":false},"type":"js/module"}]}