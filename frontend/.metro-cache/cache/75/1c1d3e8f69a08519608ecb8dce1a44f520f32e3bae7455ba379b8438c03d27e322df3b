{"dependencies":[{"name":"./gpgpu_math","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":17,"column":0,"index":682},"end":{"line":17,"column":48,"index":730}}],"key":"r7nFADTf/sGcqNrAYkmj7Z35J80=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"Conv2DDerInputPackedProgram\", {\n    enumerable: true,\n    get: function () {\n      return Conv2DDerInputPackedProgram;\n    }\n  });\n  var _gpgpu_math = require(_dependencyMap[0], \"./gpgpu_math\");\n  /**\n   * @license\n   * Copyright 2023 Google LLC.\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   */\n\n  class Conv2DDerInputPackedProgram {\n    constructor(convInfo) {\n      this.variableNames = ['dy', 'W'];\n      this.packedInputs = true;\n      this.packedOutput = true;\n      this.customUniforms = [{\n        name: 'strides',\n        type: 'vec2'\n      }];\n      this.outputShape = convInfo.inShape;\n      this.enableShapeUniforms = (0, _gpgpu_math.useShapeUniforms)(this.outputShape.length);\n      const filterHeight = convInfo.filterHeight;\n      const filterWidth = convInfo.filterWidth;\n      const padTop = filterHeight - 1 - convInfo.padInfo.top;\n      const padLeft = filterWidth - 1 - convInfo.padInfo.left;\n      this.userCode = `\n      const ivec2 pads = ivec2(${padTop}, ${padLeft});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n\n        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        vec4 result = vec4(0.);\n        for (int wR = 0; wR < ${filterHeight}; wR++) {\n          float dyR = float(dyRCorner + wR) / strides[0];\n          if (dyR < 0.0 || dyR >= ${convInfo.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n          int wRPerm = ${filterHeight} - 1 - wR;\n\n          for (int wC = 0; wC < ${filterWidth}; wC++) {\n            int wCPerm = ${filterWidth} - 1 - wC;\n\n            float dyC = float(dyCCorner + wC) / strides[1];\n            bool idyCVal = (dyC >= 0.0) && (dyC < ${convInfo.outWidth}.0)\n              && (fract(dyC) == 0.0);\n            int idyC = int(dyC);\n\n            float dyC2 = float(dyCCorner + wC + 1) / strides[1];\n            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${convInfo.outWidth}.0)\n              && (fract(dyC2) == 0.0);\n            int idyC2 = int(dyC2);\n\n            if (idyCVal && idyCVal2) {\n              for (int d2 = 0; d2 < ${convInfo.outChannels}; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC, d2);\n                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?\n                  dySample : getDy(batch, idyR, idyC2, d2);\n\n                vec2 dyValue = mod(float(idyC), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.xy += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n\n                dyValue = mod(float(idyC2), 2.) == 0. ?\n                  dySample2.xy : dySample2.zw;\n                result.zw += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            } else if (idyCVal) {\n              for (int d2 = 0; d2 < ${convInfo.outChannels}; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC, d2);\n                vec2 dyValue = mod(float(idyC), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.xy += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            } else if (idyCVal2) {\n              for (int d2 = 0; d2 < ${convInfo.outChannels}; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC2, d2);\n                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.zw += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            }\n          }\n        }\n        setOutput(result);\n      }\n    `;\n    }\n  }\n});","lineCount":123,"map":[[7,2,18,0,"Object"],[7,8,18,0],[7,9,18,0,"defineProperty"],[7,23,18,0],[7,24,18,0,"exports"],[7,31,18,0],[8,4,18,0,"enumerable"],[8,14,18,0],[9,4,18,0,"get"],[9,7,18,0],[9,18,18,0,"get"],[9,19,18,0],[10,6,18,0],[10,13,18,0,"Conv2DDerInputPackedProgram"],[10,40,18,0],[11,4,18,0],[12,2,18,0],[13,2,17,0],[13,6,17,0,"_gpgpu_math"],[13,17,17,0],[13,20,17,0,"require"],[13,27,17,0],[13,28,17,0,"_dependencyMap"],[13,42,17,0],[14,2,1,0],[15,0,2,0],[16,0,3,0],[17,0,4,0],[18,0,5,0],[19,0,6,0],[20,0,7,0],[21,0,8,0],[22,0,9,0],[23,0,10,0],[24,0,11,0],[25,0,12,0],[26,0,13,0],[27,0,14,0],[28,0,15,0],[29,0,16,0],[31,2,18,7],[31,8,18,13,"Conv2DDerInputPackedProgram"],[31,35,18,40],[31,36,18,41],[32,4,19,4,"constructor"],[32,15,19,15,"constructor"],[32,16,19,16,"convInfo"],[32,24,19,24],[32,26,19,26],[33,6,20,8],[33,10,20,12],[33,11,20,13,"variableNames"],[33,24,20,26],[33,27,20,29],[33,28,20,30],[33,32,20,34],[33,34,20,36],[33,37,20,39],[33,38,20,40],[34,6,21,8],[34,10,21,12],[34,11,21,13,"packedInputs"],[34,23,21,25],[34,26,21,28],[34,30,21,32],[35,6,22,8],[35,10,22,12],[35,11,22,13,"packedOutput"],[35,23,22,25],[35,26,22,28],[35,30,22,32],[36,6,23,8],[36,10,23,12],[36,11,23,13,"customUniforms"],[36,25,23,27],[36,28,23,30],[36,29,24,12],[37,8,24,14,"name"],[37,12,24,18],[37,14,24,20],[37,23,24,29],[38,8,24,31,"type"],[38,12,24,35],[38,14,24,37],[39,6,24,44],[39,7,24,45],[39,8,25,9],[40,6,26,8],[40,10,26,12],[40,11,26,13,"outputShape"],[40,22,26,24],[40,25,26,27,"convInfo"],[40,33,26,35],[40,34,26,36,"inShape"],[40,41,26,43],[41,6,27,8],[41,10,27,12],[41,11,27,13,"enableShapeUniforms"],[41,30,27,32],[41,33,27,35],[41,37,27,35,"useShapeUniforms"],[41,48,27,51],[41,49,27,51,"useShapeUniforms"],[41,65,27,51],[41,67,27,52],[41,71,27,56],[41,72,27,57,"outputShape"],[41,83,27,68],[41,84,27,69,"length"],[41,90,27,75],[41,91,27,76],[42,6,28,8],[42,12,28,14,"filterHeight"],[42,24,28,26],[42,27,28,29,"convInfo"],[42,35,28,37],[42,36,28,38,"filterHeight"],[42,48,28,50],[43,6,29,8],[43,12,29,14,"filterWidth"],[43,23,29,25],[43,26,29,28,"convInfo"],[43,34,29,36],[43,35,29,37,"filterWidth"],[43,46,29,48],[44,6,30,8],[44,12,30,14,"padTop"],[44,18,30,20],[44,21,30,23,"filterHeight"],[44,33,30,35],[44,36,30,38],[44,37,30,39],[44,40,30,42,"convInfo"],[44,48,30,50],[44,49,30,51,"padInfo"],[44,56,30,58],[44,57,30,59,"top"],[44,60,30,62],[45,6,31,8],[45,12,31,14,"padLeft"],[45,19,31,21],[45,22,31,24,"filterWidth"],[45,33,31,35],[45,36,31,38],[45,37,31,39],[45,40,31,42,"convInfo"],[45,48,31,50],[45,49,31,51,"padInfo"],[45,56,31,58],[45,57,31,59,"left"],[45,61,31,63],[46,6,32,8],[46,10,32,12],[46,11,32,13,"userCode"],[46,19,32,21],[46,22,32,24],[47,0,33,0],[47,33,33,33,"padTop"],[47,39,33,39],[47,44,33,44,"padLeft"],[47,51,33,51],[48,0,34,0],[49,0,35,0],[50,0,36,0],[51,0,37,0],[52,0,38,0],[53,0,39,0],[54,0,40,0],[55,0,41,0],[56,0,42,0],[57,0,43,0],[58,0,44,0],[59,0,45,0],[59,32,45,32,"filterHeight"],[59,44,45,44],[60,0,46,0],[61,0,47,0],[61,36,47,36,"convInfo"],[61,44,47,44],[61,45,47,45,"outHeight"],[61,54,47,54],[62,0,48,0],[63,0,49,0],[64,0,50,0],[65,0,51,0],[65,25,51,25,"filterHeight"],[65,37,51,37],[66,0,52,0],[67,0,53,0],[67,34,53,34,"filterWidth"],[67,45,53,45],[68,0,54,0],[68,27,54,27,"filterWidth"],[68,38,54,38],[69,0,55,0],[70,0,56,0],[71,0,57,0],[71,52,57,52,"convInfo"],[71,60,57,60],[71,61,57,61,"outWidth"],[71,69,57,69],[72,0,58,0],[73,0,59,0],[74,0,60,0],[75,0,61,0],[76,0,62,0],[76,55,62,55,"convInfo"],[76,63,62,63],[76,64,62,64,"outWidth"],[76,72,62,72],[77,0,63,0],[78,0,64,0],[79,0,65,0],[80,0,66,0],[81,0,67,0],[81,38,67,38,"convInfo"],[81,46,67,46],[81,47,67,47,"outChannels"],[81,58,67,58],[82,0,68,0],[83,0,69,0],[84,0,70,0],[85,0,71,0],[86,0,72,0],[87,0,73,0],[88,0,74,0],[89,0,75,0],[90,0,76,0],[91,0,77,0],[92,0,78,0],[93,0,79,0],[94,0,80,0],[95,0,81,0],[96,0,82,0],[97,0,83,0],[98,0,84,0],[98,38,84,38,"convInfo"],[98,46,84,46],[98,47,84,47,"outChannels"],[98,58,84,58],[99,0,85,0],[100,0,86,0],[101,0,87,0],[102,0,88,0],[103,0,89,0],[104,0,90,0],[105,0,91,0],[106,0,92,0],[107,0,93,0],[107,38,93,38,"convInfo"],[107,46,93,46],[107,47,93,47,"outChannels"],[107,58,93,58],[108,0,94,0],[109,0,95,0],[110,0,96,0],[111,0,97,0],[112,0,98,0],[113,0,99,0],[114,0,100,0],[115,0,101,0],[116,0,102,0],[117,0,103,0],[118,0,104,0],[119,0,105,0],[120,0,106,0],[120,5,106,5],[121,4,107,4],[122,2,108,0],[123,0,108,1],[123,3]],"functionMap":{"names":["<global>","Conv2DDerInputPackedProgram","Conv2DDerInputPackedProgram#constructor"],"mappings":"AAA;OCiB;ICC;KDwF;CDC"},"hasCjsExports":false},"type":"js/module"}]}