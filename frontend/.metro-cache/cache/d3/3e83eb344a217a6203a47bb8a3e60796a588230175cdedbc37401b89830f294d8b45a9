{"dependencies":[{"name":"../../tensor_util_env","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":56,"index":56}}],"key":"xfSGNGkCJdZhfQ673y/6d+no2yU=","exportNames":["*"],"imports":1}},{"name":"../cast","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":57},"end":{"line":2,"column":31,"index":88}}],"key":"D+BUEx5BO0JXxAXMtu4IMlEZU0c=","exportNames":["*"],"imports":1}},{"name":"../div","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":89},"end":{"line":3,"column":29,"index":118}}],"key":"5rHCiV00cfBGwUZFTnTN9j0PzWw=","exportNames":["*"],"imports":1}},{"name":"../loss_ops_utils","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":119},"end":{"line":4,"column":46,"index":165}}],"key":"DAPyQ0ldu7pmRn3jRz+wBfmq/uQ=","exportNames":["*"],"imports":1}},{"name":"../mean","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":166},"end":{"line":5,"column":31,"index":197}}],"key":"+LNlHHtqAq8j5UlSZGjMNKRSIRg=","exportNames":["*"],"imports":1}},{"name":"../mul","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":6,"column":0,"index":198},"end":{"line":6,"column":29,"index":227}}],"key":"IV74B7MBUPoSZUTM5ocGXe9fIRE=","exportNames":["*"],"imports":1}},{"name":"../not_equal","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":7,"column":0,"index":228},"end":{"line":7,"column":40,"index":268}}],"key":"gGI8fo33cb36QJPFY9GQLYDRFpg=","exportNames":["*"],"imports":1}},{"name":"../ones","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":8,"column":0,"index":269},"end":{"line":8,"column":31,"index":300}}],"key":"oY5rcLACDDaeXk0CW2FPDbSbq/E=","exportNames":["*"],"imports":1}},{"name":"../operation","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":9,"column":0,"index":301},"end":{"line":9,"column":34,"index":335}}],"key":"fQilPqfSvhAHjyfKT0P4wel7jE4=","exportNames":["*"],"imports":1}},{"name":"../scalar","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":10,"column":0,"index":336},"end":{"line":10,"column":35,"index":371}}],"key":"u3TTm6Tdu30WLt+AMD6qMWu+U20=","exportNames":["*"],"imports":1}},{"name":"../sum","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":11,"column":0,"index":372},"end":{"line":11,"column":29,"index":401}}],"key":"iMzhCilxhON+Kq66I0CtH0j3scg=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"computeWeightedLoss\", {\n    enumerable: true,\n    get: function () {\n      return computeWeightedLoss;\n    }\n  });\n  var _tensor_util_env = require(_dependencyMap[0], \"../../tensor_util_env\");\n  var _cast = require(_dependencyMap[1], \"../cast\");\n  var _div = require(_dependencyMap[2], \"../div\");\n  var _loss_ops_utils = require(_dependencyMap[3], \"../loss_ops_utils\");\n  var _mean = require(_dependencyMap[4], \"../mean\");\n  var _mul = require(_dependencyMap[5], \"../mul\");\n  var _not_equal = require(_dependencyMap[6], \"../not_equal\");\n  var _ones = require(_dependencyMap[7], \"../ones\");\n  var _operation = require(_dependencyMap[8], \"../operation\");\n  var _scalar = require(_dependencyMap[9], \"../scalar\");\n  var _sum = require(_dependencyMap[10], \"../sum\");\n  /**\n   * Computes the weighted loss between two tensors.\n   *\n   * @param losses Tensor of shape `[batch_size, d1, ..., dN]`.\n   * @param weights Tensor whose rank is either 0, or the same rank as\n   *    `losses`, and must be broadcastable to `losses` (i.e., all\n   *    dimensions must be either `1`, or the same as the corresponding\n   *    `losses` dimension).\n   *\n   * @doc {heading: 'Training', subheading: 'Losses', namespace: 'losses'}\n   */\n  function computeWeightedLoss_(losses, weights, reduction = _loss_ops_utils.Reduction.SUM_BY_NONZERO_WEIGHTS) {\n    const $losses = (0, _tensor_util_env.convertToTensor)(losses, 'losses', 'computeWeightedLoss');\n    let $weights = null;\n    if (weights != null) {\n      $weights = (0, _tensor_util_env.convertToTensor)(weights, 'weights', 'computeWeightedLoss');\n    }\n    const weightedLoss = $weights == null ? $losses : (0, _mul.mul)($losses, $weights);\n    if (reduction === _loss_ops_utils.Reduction.NONE) {\n      return weightedLoss;\n    }\n    if (reduction === _loss_ops_utils.Reduction.SUM) {\n      return (0, _sum.sum)(weightedLoss);\n    }\n    if (reduction === _loss_ops_utils.Reduction.MEAN) {\n      if ($weights == null) {\n        return (0, _mean.mean)(weightedLoss);\n      } else {\n        const broadcastFactor = $losses.size / $weights.size;\n        const result = (0, _div.div)((0, _sum.sum)(weightedLoss), (0, _sum.sum)($weights));\n        return broadcastFactor > 1 ? (0, _div.div)(result, (0, _scalar.scalar)(broadcastFactor)) : result;\n      }\n    }\n    if (reduction === _loss_ops_utils.Reduction.SUM_BY_NONZERO_WEIGHTS) {\n      if ($weights == null) {\n        return (0, _div.div)((0, _sum.sum)(weightedLoss), (0, _scalar.scalar)($losses.size));\n      } else {\n        const broadcastedWeights = (0, _mul.mul)($weights, (0, _ones.ones)($losses.shape));\n        const numNonZeros = (0, _cast.cast)((0, _sum.sum)((0, _not_equal.notEqual)(broadcastedWeights, (0, _scalar.scalar)(0))), 'float32');\n        return (0, _div.div)((0, _sum.sum)(weightedLoss), numNonZeros);\n      }\n    }\n    throw Error(`Unknown reduction: ${reduction}`);\n  }\n  const computeWeightedLoss = /* @__PURE__ */(0, _operation.op)({\n    computeWeightedLoss_\n  });\n});","lineCount":71,"map":[[7,2,59,0,"Object"],[7,8,59,0],[7,9,59,0,"defineProperty"],[7,23,59,0],[7,24,59,0,"exports"],[7,31,59,0],[8,4,59,0,"enumerable"],[8,14,59,0],[9,4,59,0,"get"],[9,7,59,0],[9,18,59,0,"get"],[9,19,59,0],[10,6,59,0],[10,13,59,0,"computeWeightedLoss"],[10,32,59,0],[11,4,59,0],[12,2,59,0],[13,2,1,0],[13,6,1,0,"_tensor_util_env"],[13,22,1,0],[13,25,1,0,"require"],[13,32,1,0],[13,33,1,0,"_dependencyMap"],[13,47,1,0],[14,2,2,0],[14,6,2,0,"_cast"],[14,11,2,0],[14,14,2,0,"require"],[14,21,2,0],[14,22,2,0,"_dependencyMap"],[14,36,2,0],[15,2,3,0],[15,6,3,0,"_div"],[15,10,3,0],[15,13,3,0,"require"],[15,20,3,0],[15,21,3,0,"_dependencyMap"],[15,35,3,0],[16,2,4,0],[16,6,4,0,"_loss_ops_utils"],[16,21,4,0],[16,24,4,0,"require"],[16,31,4,0],[16,32,4,0,"_dependencyMap"],[16,46,4,0],[17,2,5,0],[17,6,5,0,"_mean"],[17,11,5,0],[17,14,5,0,"require"],[17,21,5,0],[17,22,5,0,"_dependencyMap"],[17,36,5,0],[18,2,6,0],[18,6,6,0,"_mul"],[18,10,6,0],[18,13,6,0,"require"],[18,20,6,0],[18,21,6,0,"_dependencyMap"],[18,35,6,0],[19,2,7,0],[19,6,7,0,"_not_equal"],[19,16,7,0],[19,19,7,0,"require"],[19,26,7,0],[19,27,7,0,"_dependencyMap"],[19,41,7,0],[20,2,8,0],[20,6,8,0,"_ones"],[20,11,8,0],[20,14,8,0,"require"],[20,21,8,0],[20,22,8,0,"_dependencyMap"],[20,36,8,0],[21,2,9,0],[21,6,9,0,"_operation"],[21,16,9,0],[21,19,9,0,"require"],[21,26,9,0],[21,27,9,0,"_dependencyMap"],[21,41,9,0],[22,2,10,0],[22,6,10,0,"_scalar"],[22,13,10,0],[22,16,10,0,"require"],[22,23,10,0],[22,24,10,0,"_dependencyMap"],[22,38,10,0],[23,2,11,0],[23,6,11,0,"_sum"],[23,10,11,0],[23,13,11,0,"require"],[23,20,11,0],[23,21,11,0,"_dependencyMap"],[23,35,11,0],[24,2,12,0],[25,0,13,0],[26,0,14,0],[27,0,15,0],[28,0,16,0],[29,0,17,0],[30,0,18,0],[31,0,19,0],[32,0,20,0],[33,0,21,0],[34,0,22,0],[35,2,23,0],[35,11,23,9,"computeWeightedLoss_"],[35,31,23,29,"computeWeightedLoss_"],[35,32,23,30,"losses"],[35,38,23,36],[35,40,23,38,"weights"],[35,47,23,45],[35,49,23,47,"reduction"],[35,58,23,56],[35,61,23,59,"Reduction"],[35,76,23,68],[35,77,23,68,"Reduction"],[35,86,23,68],[35,87,23,69,"SUM_BY_NONZERO_WEIGHTS"],[35,109,23,91],[35,111,23,93],[36,4,24,4],[36,10,24,10,"$losses"],[36,17,24,17],[36,20,24,20],[36,24,24,20,"convertToTensor"],[36,40,24,35],[36,41,24,35,"convertToTensor"],[36,56,24,35],[36,58,24,36,"losses"],[36,64,24,42],[36,66,24,44],[36,74,24,52],[36,76,24,54],[36,97,24,75],[36,98,24,76],[37,4,25,4],[37,8,25,8,"$weights"],[37,16,25,16],[37,19,25,19],[37,23,25,23],[38,4,26,4],[38,8,26,8,"weights"],[38,15,26,15],[38,19,26,19],[38,23,26,23],[38,25,26,25],[39,6,27,8,"$weights"],[39,14,27,16],[39,17,27,19],[39,21,27,19,"convertToTensor"],[39,37,27,34],[39,38,27,34,"convertToTensor"],[39,53,27,34],[39,55,27,35,"weights"],[39,62,27,42],[39,64,27,44],[39,73,27,53],[39,75,27,55],[39,96,27,76],[39,97,27,77],[40,4,28,4],[41,4,29,4],[41,10,29,10,"weightedLoss"],[41,22,29,22],[41,25,29,26,"$weights"],[41,33,29,34],[41,37,29,38],[41,41,29,42],[41,44,29,46,"$losses"],[41,51,29,53],[41,54,29,56],[41,58,29,56,"mul"],[41,62,29,59],[41,63,29,59,"mul"],[41,66,29,59],[41,68,29,60,"$losses"],[41,75,29,67],[41,77,29,69,"$weights"],[41,85,29,77],[41,86,29,78],[42,4,30,4],[42,8,30,8,"reduction"],[42,17,30,17],[42,22,30,22,"Reduction"],[42,37,30,31],[42,38,30,31,"Reduction"],[42,47,30,31],[42,48,30,32,"NONE"],[42,52,30,36],[42,54,30,38],[43,6,31,8],[43,13,31,15,"weightedLoss"],[43,25,31,27],[44,4,32,4],[45,4,33,4],[45,8,33,8,"reduction"],[45,17,33,17],[45,22,33,22,"Reduction"],[45,37,33,31],[45,38,33,31,"Reduction"],[45,47,33,31],[45,48,33,32,"SUM"],[45,51,33,35],[45,53,33,37],[46,6,34,8],[46,13,34,15],[46,17,34,15,"sum"],[46,21,34,18],[46,22,34,18,"sum"],[46,25,34,18],[46,27,34,19,"weightedLoss"],[46,39,34,31],[46,40,34,32],[47,4,35,4],[48,4,36,4],[48,8,36,8,"reduction"],[48,17,36,17],[48,22,36,22,"Reduction"],[48,37,36,31],[48,38,36,31,"Reduction"],[48,47,36,31],[48,48,36,32,"MEAN"],[48,52,36,36],[48,54,36,38],[49,6,37,8],[49,10,37,12,"$weights"],[49,18,37,20],[49,22,37,24],[49,26,37,28],[49,28,37,30],[50,8,38,12],[50,15,38,19],[50,19,38,19,"mean"],[50,24,38,23],[50,25,38,23,"mean"],[50,29,38,23],[50,31,38,24,"weightedLoss"],[50,43,38,36],[50,44,38,37],[51,6,39,8],[51,7,39,9],[51,13,40,13],[52,8,41,12],[52,14,41,18,"broadcastFactor"],[52,29,41,33],[52,32,41,36,"$losses"],[52,39,41,43],[52,40,41,44,"size"],[52,44,41,48],[52,47,41,51,"$weights"],[52,55,41,59],[52,56,41,60,"size"],[52,60,41,64],[53,8,42,12],[53,14,42,18,"result"],[53,20,42,24],[53,23,42,27],[53,27,42,27,"div"],[53,31,42,30],[53,32,42,30,"div"],[53,35,42,30],[53,37,42,31],[53,41,42,31,"sum"],[53,45,42,34],[53,46,42,34,"sum"],[53,49,42,34],[53,51,42,35,"weightedLoss"],[53,63,42,47],[53,64,42,48],[53,66,42,50],[53,70,42,50,"sum"],[53,74,42,53],[53,75,42,53,"sum"],[53,78,42,53],[53,80,42,54,"$weights"],[53,88,42,62],[53,89,42,63],[53,90,42,64],[54,8,43,12],[54,15,43,19,"broadcastFactor"],[54,30,43,34],[54,33,43,37],[54,34,43,38],[54,37,43,41],[54,41,43,41,"div"],[54,45,43,44],[54,46,43,44,"div"],[54,49,43,44],[54,51,43,45,"result"],[54,57,43,51],[54,59,43,53],[54,63,43,53,"scalar"],[54,70,43,59],[54,71,43,59,"scalar"],[54,77,43,59],[54,79,43,60,"broadcastFactor"],[54,94,43,75],[54,95,43,76],[54,96,43,77],[54,99,44,16,"result"],[54,105,44,22],[55,6,45,8],[56,4,46,4],[57,4,47,4],[57,8,47,8,"reduction"],[57,17,47,17],[57,22,47,22,"Reduction"],[57,37,47,31],[57,38,47,31,"Reduction"],[57,47,47,31],[57,48,47,32,"SUM_BY_NONZERO_WEIGHTS"],[57,70,47,54],[57,72,47,56],[58,6,48,8],[58,10,48,12,"$weights"],[58,18,48,20],[58,22,48,24],[58,26,48,28],[58,28,48,30],[59,8,49,12],[59,15,49,19],[59,19,49,19,"div"],[59,23,49,22],[59,24,49,22,"div"],[59,27,49,22],[59,29,49,23],[59,33,49,23,"sum"],[59,37,49,26],[59,38,49,26,"sum"],[59,41,49,26],[59,43,49,27,"weightedLoss"],[59,55,49,39],[59,56,49,40],[59,58,49,42],[59,62,49,42,"scalar"],[59,69,49,48],[59,70,49,48,"scalar"],[59,76,49,48],[59,78,49,49,"$losses"],[59,85,49,56],[59,86,49,57,"size"],[59,90,49,61],[59,91,49,62],[59,92,49,63],[60,6,50,8],[60,7,50,9],[60,13,51,13],[61,8,52,12],[61,14,52,18,"broadcastedWeights"],[61,32,52,36],[61,35,52,39],[61,39,52,39,"mul"],[61,43,52,42],[61,44,52,42,"mul"],[61,47,52,42],[61,49,52,43,"$weights"],[61,57,52,51],[61,59,52,53],[61,63,52,53,"ones"],[61,68,52,57],[61,69,52,57,"ones"],[61,73,52,57],[61,75,52,58,"$losses"],[61,82,52,65],[61,83,52,66,"shape"],[61,88,52,71],[61,89,52,72],[61,90,52,73],[62,8,53,12],[62,14,53,18,"numNonZeros"],[62,25,53,29],[62,28,53,32],[62,32,53,32,"cast"],[62,37,53,36],[62,38,53,36,"cast"],[62,42,53,36],[62,44,53,37],[62,48,53,37,"sum"],[62,52,53,40],[62,53,53,40,"sum"],[62,56,53,40],[62,58,53,41],[62,62,53,41,"notEqual"],[62,72,53,49],[62,73,53,49,"notEqual"],[62,81,53,49],[62,83,53,50,"broadcastedWeights"],[62,101,53,68],[62,103,53,70],[62,107,53,70,"scalar"],[62,114,53,76],[62,115,53,76,"scalar"],[62,121,53,76],[62,123,53,77],[62,124,53,78],[62,125,53,79],[62,126,53,80],[62,127,53,81],[62,129,53,83],[62,138,53,92],[62,139,53,93],[63,8,54,12],[63,15,54,19],[63,19,54,19,"div"],[63,23,54,22],[63,24,54,22,"div"],[63,27,54,22],[63,29,54,23],[63,33,54,23,"sum"],[63,37,54,26],[63,38,54,26,"sum"],[63,41,54,26],[63,43,54,27,"weightedLoss"],[63,55,54,39],[63,56,54,40],[63,58,54,42,"numNonZeros"],[63,69,54,53],[63,70,54,54],[64,6,55,8],[65,4,56,4],[66,4,57,4],[66,10,57,10,"Error"],[66,15,57,15],[66,16,57,16],[66,38,57,38,"reduction"],[66,47,57,47],[66,49,57,49],[66,50,57,50],[67,2,58,0],[68,2,59,7],[68,8,59,13,"computeWeightedLoss"],[68,27,59,32],[68,30,59,35],[68,45,59,51],[68,49,59,51,"op"],[68,59,59,53],[68,60,59,53,"op"],[68,62,59,53],[68,64,59,54],[69,4,59,56,"computeWeightedLoss_"],[70,2,59,77],[70,3,59,78],[70,4,59,79],[71,0,59,80],[71,3]],"functionMap":{"names":["<global>","computeWeightedLoss_"],"mappings":"AAA;ACsB;CDmC"},"hasCjsExports":false},"type":"js/module"}]}