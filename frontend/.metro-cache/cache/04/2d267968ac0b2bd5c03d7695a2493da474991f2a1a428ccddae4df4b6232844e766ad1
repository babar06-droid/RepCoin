{"dependencies":[{"name":"../util","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":17,"column":0,"index":703},"end":{"line":17,"column":41,"index":744}}],"key":"DTmef1GE5grNQfsvpIzpBlINy9c=","exportNames":["*"],"imports":1}},{"name":"./reduce_util","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":18,"column":0,"index":745},"end":{"line":18,"column":54,"index":799}}],"key":"jhbY94Y8A1spAx7YDwg9JKS9gXU=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.segOpComputeOptimalWindowSize = segOpComputeOptimalWindowSize;\n  exports.computeOutShape = computeOutShape;\n  exports.collectGatherOpShapeInfo = collectGatherOpShapeInfo;\n  var _util = require(_dependencyMap[0], \"../util\");\n  var _reduce_util = require(_dependencyMap[1], \"./reduce_util\");\n  /**\n   * @license\n   * Copyright 2018 Google LLC. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   */\n\n  function segOpComputeOptimalWindowSize(inSize, numSegments) {\n    let done = false;\n    let res;\n    if (inSize <= _reduce_util.PARALLELIZE_THRESHOLD) {\n      res = inSize;\n      done = true;\n    } else {\n      res = (0, _util.nearestDivisor)(inSize, Math.floor(Math.sqrt(inSize)));\n    }\n    while (!done) {\n      if (res > numSegments || res === inSize) {\n        done = true;\n      } else {\n        res = (0, _util.nearestDivisor)(inSize, res + 1);\n      }\n    }\n    return res;\n  }\n  function computeOutShape(aShape, axis, numSegments) {\n    const outShape = [];\n    const rank = aShape.length;\n    for (let dim = 0; dim < rank; dim++) {\n      if (dim !== axis) {\n        outShape.push(aShape[dim]);\n      } else {\n        outShape.push(numSegments);\n      }\n    }\n    return outShape;\n  }\n  function collectGatherOpShapeInfo(x, indices, axis, batchDims) {\n    const indicesRank = indices.shape.length;\n    const xRank = x.shape.length;\n    if (batchDims !== 0) {\n      if (batchDims < -indicesRank || batchDims > indicesRank) {\n        throw new Error(`Expect batchDims in the range of [-${indicesRank}, ${indicesRank}], but got ${batchDims}`);\n      }\n    }\n    if (batchDims < 0) {\n      batchDims += indicesRank;\n    }\n    if (batchDims > xRank) {\n      throw new Error(`batchDims (${batchDims}) must be less than rank(x) (\n    ${xRank}).`);\n    }\n    if (axis < batchDims) {\n      throw new Error(`batchDims (${batchDims}) must be less than or equal to axis (${axis}).`);\n    }\n    for (let i = 0; i < batchDims; ++i) {\n      if (x.shape[i] !== indices.shape[i]) {\n        throw new Error(`x.shape[${i}]: ${x.shape[i]} should be equal to indices.shape[${i}]: ${indices.shape[i]}.`);\n      }\n    }\n    const dimSize = x.shape[axis];\n    const outputShape = [];\n    let batchSize = 1;\n    let outerSize = 1;\n    let sliceSize = 1;\n    for (let i = 0; i < batchDims; ++i) {\n      outputShape.push(x.shape[i]);\n      batchSize *= x.shape[i];\n    }\n    for (let i = batchDims; i < axis; i++) {\n      outputShape.push(x.shape[i]);\n      outerSize *= x.shape[i];\n    }\n    for (let i = batchDims; i < indicesRank; i++) {\n      outputShape.push(indices.shape[i]);\n    }\n    for (let i = axis + 1; i < xRank; i++) {\n      outputShape.push(x.shape[i]);\n      sliceSize *= x.shape[i];\n    }\n    return {\n      batchSize,\n      sliceSize,\n      outerSize,\n      dimSize,\n      outputShape\n    };\n  }\n});","lineCount":110,"map":[[7,2,19,0,"exports"],[7,9,19,0],[7,10,19,0,"segOpComputeOptimalWindowSize"],[7,39,19,0],[7,42,19,0,"segOpComputeOptimalWindowSize"],[7,71,19,0],[8,2,39,0,"exports"],[8,9,39,0],[8,10,39,0,"computeOutShape"],[8,25,39,0],[8,28,39,0,"computeOutShape"],[8,43,39,0],[9,2,52,0,"exports"],[9,9,52,0],[9,10,52,0,"collectGatherOpShapeInfo"],[9,34,52,0],[9,37,52,0,"collectGatherOpShapeInfo"],[9,61,52,0],[10,2,17,0],[10,6,17,0,"_util"],[10,11,17,0],[10,14,17,0,"require"],[10,21,17,0],[10,22,17,0,"_dependencyMap"],[10,36,17,0],[11,2,18,0],[11,6,18,0,"_reduce_util"],[11,18,18,0],[11,21,18,0,"require"],[11,28,18,0],[11,29,18,0,"_dependencyMap"],[11,43,18,0],[12,2,1,0],[13,0,2,0],[14,0,3,0],[15,0,4,0],[16,0,5,0],[17,0,6,0],[18,0,7,0],[19,0,8,0],[20,0,9,0],[21,0,10,0],[22,0,11,0],[23,0,12,0],[24,0,13,0],[25,0,14,0],[26,0,15,0],[27,0,16,0],[29,2,19,7],[29,11,19,16,"segOpComputeOptimalWindowSize"],[29,40,19,45,"segOpComputeOptimalWindowSize"],[29,41,19,46,"inSize"],[29,47,19,52],[29,49,19,54,"numSegments"],[29,60,19,65],[29,62,19,67],[30,4,20,4],[30,8,20,8,"done"],[30,12,20,12],[30,15,20,15],[30,20,20,20],[31,4,21,4],[31,8,21,8,"res"],[31,11,21,11],[32,4,22,4],[32,8,22,8,"inSize"],[32,14,22,14],[32,18,22,18,"PARALLELIZE_THRESHOLD"],[32,30,22,39],[32,31,22,39,"PARALLELIZE_THRESHOLD"],[32,52,22,39],[32,54,22,41],[33,6,23,8,"res"],[33,9,23,11],[33,12,23,14,"inSize"],[33,18,23,20],[34,6,24,8,"done"],[34,10,24,12],[34,13,24,15],[34,17,24,19],[35,4,25,4],[35,5,25,5],[35,11,26,9],[36,6,27,8,"res"],[36,9,27,11],[36,12,27,14],[36,16,27,14,"nearestDivisor"],[36,21,27,28],[36,22,27,28,"nearestDivisor"],[36,36,27,28],[36,38,27,29,"inSize"],[36,44,27,35],[36,46,27,37,"Math"],[36,50,27,41],[36,51,27,42,"floor"],[36,56,27,47],[36,57,27,48,"Math"],[36,61,27,52],[36,62,27,53,"sqrt"],[36,66,27,57],[36,67,27,58,"inSize"],[36,73,27,64],[36,74,27,65],[36,75,27,66],[36,76,27,67],[37,4,28,4],[38,4,29,4],[38,11,29,11],[38,12,29,12,"done"],[38,16,29,16],[38,18,29,18],[39,6,30,8],[39,10,30,12,"res"],[39,13,30,15],[39,16,30,18,"numSegments"],[39,27,30,29],[39,31,30,33,"res"],[39,34,30,36],[39,39,30,41,"inSize"],[39,45,30,47],[39,47,30,49],[40,8,31,12,"done"],[40,12,31,16],[40,15,31,19],[40,19,31,23],[41,6,32,8],[41,7,32,9],[41,13,33,13],[42,8,34,12,"res"],[42,11,34,15],[42,14,34,18],[42,18,34,18,"nearestDivisor"],[42,23,34,32],[42,24,34,32,"nearestDivisor"],[42,38,34,32],[42,40,34,33,"inSize"],[42,46,34,39],[42,48,34,41,"res"],[42,51,34,44],[42,54,34,47],[42,55,34,48],[42,56,34,49],[43,6,35,8],[44,4,36,4],[45,4,37,4],[45,11,37,11,"res"],[45,14,37,14],[46,2,38,0],[47,2,39,7],[47,11,39,16,"computeOutShape"],[47,26,39,31,"computeOutShape"],[47,27,39,32,"aShape"],[47,33,39,38],[47,35,39,40,"axis"],[47,39,39,44],[47,41,39,46,"numSegments"],[47,52,39,57],[47,54,39,59],[48,4,40,4],[48,10,40,10,"outShape"],[48,18,40,18],[48,21,40,21],[48,23,40,23],[49,4,41,4],[49,10,41,10,"rank"],[49,14,41,14],[49,17,41,17,"aShape"],[49,23,41,23],[49,24,41,24,"length"],[49,30,41,30],[50,4,42,4],[50,9,42,9],[50,13,42,13,"dim"],[50,16,42,16],[50,19,42,19],[50,20,42,20],[50,22,42,22,"dim"],[50,25,42,25],[50,28,42,28,"rank"],[50,32,42,32],[50,34,42,34,"dim"],[50,37,42,37],[50,39,42,39],[50,41,42,41],[51,6,43,8],[51,10,43,12,"dim"],[51,13,43,15],[51,18,43,20,"axis"],[51,22,43,24],[51,24,43,26],[52,8,44,12,"outShape"],[52,16,44,20],[52,17,44,21,"push"],[52,21,44,25],[52,22,44,26,"aShape"],[52,28,44,32],[52,29,44,33,"dim"],[52,32,44,36],[52,33,44,37],[52,34,44,38],[53,6,45,8],[53,7,45,9],[53,13,46,13],[54,8,47,12,"outShape"],[54,16,47,20],[54,17,47,21,"push"],[54,21,47,25],[54,22,47,26,"numSegments"],[54,33,47,37],[54,34,47,38],[55,6,48,8],[56,4,49,4],[57,4,50,4],[57,11,50,11,"outShape"],[57,19,50,19],[58,2,51,0],[59,2,52,7],[59,11,52,16,"collectGatherOpShapeInfo"],[59,35,52,40,"collectGatherOpShapeInfo"],[59,36,52,41,"x"],[59,37,52,42],[59,39,52,44,"indices"],[59,46,52,51],[59,48,52,53,"axis"],[59,52,52,57],[59,54,52,59,"batchDims"],[59,63,52,68],[59,65,52,70],[60,4,53,4],[60,10,53,10,"indicesRank"],[60,21,53,21],[60,24,53,24,"indices"],[60,31,53,31],[60,32,53,32,"shape"],[60,37,53,37],[60,38,53,38,"length"],[60,44,53,44],[61,4,54,4],[61,10,54,10,"xRank"],[61,15,54,15],[61,18,54,18,"x"],[61,19,54,19],[61,20,54,20,"shape"],[61,25,54,25],[61,26,54,26,"length"],[61,32,54,32],[62,4,55,4],[62,8,55,8,"batchDims"],[62,17,55,17],[62,22,55,22],[62,23,55,23],[62,25,55,25],[63,6,56,8],[63,10,56,12,"batchDims"],[63,19,56,21],[63,22,56,24],[63,23,56,25,"indicesRank"],[63,34,56,36],[63,38,56,40,"batchDims"],[63,47,56,49],[63,50,56,52,"indicesRank"],[63,61,56,63],[63,63,56,65],[64,8,57,12],[64,14,57,18],[64,18,57,22,"Error"],[64,23,57,27],[64,24,57,28],[64,62,57,66,"indicesRank"],[64,73,57,77],[64,78,57,82,"indicesRank"],[64,89,57,93],[64,103,57,107,"batchDims"],[64,112,57,116],[64,114,57,118],[64,115,57,119],[65,6,58,8],[66,4,59,4],[67,4,60,4],[67,8,60,8,"batchDims"],[67,17,60,17],[67,20,60,20],[67,21,60,21],[67,23,60,23],[68,6,61,8,"batchDims"],[68,15,61,17],[68,19,61,21,"indicesRank"],[68,30,61,32],[69,4,62,4],[70,4,63,4],[70,8,63,8,"batchDims"],[70,17,63,17],[70,20,63,20,"xRank"],[70,25,63,25],[70,27,63,27],[71,6,64,8],[71,12,64,14],[71,16,64,18,"Error"],[71,21,64,23],[71,22,64,24],[71,36,64,38,"batchDims"],[71,45,64,47],[72,0,65,0],[72,6,65,6,"xRank"],[72,11,65,11],[72,15,65,15],[72,16,65,16],[73,4,66,4],[74,4,67,4],[74,8,67,8,"axis"],[74,12,67,12],[74,15,67,15,"batchDims"],[74,24,67,24],[74,26,67,26],[75,6,68,8],[75,12,68,14],[75,16,68,18,"Error"],[75,21,68,23],[75,22,68,24],[75,36,68,38,"batchDims"],[75,45,68,47],[75,86,68,88,"axis"],[75,90,68,92],[75,94,68,96],[75,95,68,97],[76,4,69,4],[77,4,70,4],[77,9,70,9],[77,13,70,13,"i"],[77,14,70,14],[77,17,70,17],[77,18,70,18],[77,20,70,20,"i"],[77,21,70,21],[77,24,70,24,"batchDims"],[77,33,70,33],[77,35,70,35],[77,37,70,37,"i"],[77,38,70,38],[77,40,70,40],[78,6,71,8],[78,10,71,12,"x"],[78,11,71,13],[78,12,71,14,"shape"],[78,17,71,19],[78,18,71,20,"i"],[78,19,71,21],[78,20,71,22],[78,25,71,27,"indices"],[78,32,71,34],[78,33,71,35,"shape"],[78,38,71,40],[78,39,71,41,"i"],[78,40,71,42],[78,41,71,43],[78,43,71,45],[79,8,72,12],[79,14,72,18],[79,18,72,22,"Error"],[79,23,72,27],[79,24,72,28],[79,35,72,39,"i"],[79,36,72,40],[79,42,72,46,"x"],[79,43,72,47],[79,44,72,48,"shape"],[79,49,72,53],[79,50,72,54,"i"],[79,51,72,55],[79,52,72,56],[79,89,72,93,"i"],[79,90,72,94],[79,96,72,100,"indices"],[79,103,72,107],[79,104,72,108,"shape"],[79,109,72,113],[79,110,72,114,"i"],[79,111,72,115],[79,112,72,116],[79,115,72,119],[79,116,72,120],[80,6,73,8],[81,4,74,4],[82,4,75,4],[82,10,75,10,"dimSize"],[82,17,75,17],[82,20,75,20,"x"],[82,21,75,21],[82,22,75,22,"shape"],[82,27,75,27],[82,28,75,28,"axis"],[82,32,75,32],[82,33,75,33],[83,4,76,4],[83,10,76,10,"outputShape"],[83,21,76,21],[83,24,76,24],[83,26,76,26],[84,4,77,4],[84,8,77,8,"batchSize"],[84,17,77,17],[84,20,77,20],[84,21,77,21],[85,4,78,4],[85,8,78,8,"outerSize"],[85,17,78,17],[85,20,78,20],[85,21,78,21],[86,4,79,4],[86,8,79,8,"sliceSize"],[86,17,79,17],[86,20,79,20],[86,21,79,21],[87,4,80,4],[87,9,80,9],[87,13,80,13,"i"],[87,14,80,14],[87,17,80,17],[87,18,80,18],[87,20,80,20,"i"],[87,21,80,21],[87,24,80,24,"batchDims"],[87,33,80,33],[87,35,80,35],[87,37,80,37,"i"],[87,38,80,38],[87,40,80,40],[88,6,81,8,"outputShape"],[88,17,81,19],[88,18,81,20,"push"],[88,22,81,24],[88,23,81,25,"x"],[88,24,81,26],[88,25,81,27,"shape"],[88,30,81,32],[88,31,81,33,"i"],[88,32,81,34],[88,33,81,35],[88,34,81,36],[89,6,82,8,"batchSize"],[89,15,82,17],[89,19,82,21,"x"],[89,20,82,22],[89,21,82,23,"shape"],[89,26,82,28],[89,27,82,29,"i"],[89,28,82,30],[89,29,82,31],[90,4,83,4],[91,4,84,4],[91,9,84,9],[91,13,84,13,"i"],[91,14,84,14],[91,17,84,17,"batchDims"],[91,26,84,26],[91,28,84,28,"i"],[91,29,84,29],[91,32,84,32,"axis"],[91,36,84,36],[91,38,84,38,"i"],[91,39,84,39],[91,41,84,41],[91,43,84,43],[92,6,85,8,"outputShape"],[92,17,85,19],[92,18,85,20,"push"],[92,22,85,24],[92,23,85,25,"x"],[92,24,85,26],[92,25,85,27,"shape"],[92,30,85,32],[92,31,85,33,"i"],[92,32,85,34],[92,33,85,35],[92,34,85,36],[93,6,86,8,"outerSize"],[93,15,86,17],[93,19,86,21,"x"],[93,20,86,22],[93,21,86,23,"shape"],[93,26,86,28],[93,27,86,29,"i"],[93,28,86,30],[93,29,86,31],[94,4,87,4],[95,4,88,4],[95,9,88,9],[95,13,88,13,"i"],[95,14,88,14],[95,17,88,17,"batchDims"],[95,26,88,26],[95,28,88,28,"i"],[95,29,88,29],[95,32,88,32,"indicesRank"],[95,43,88,43],[95,45,88,45,"i"],[95,46,88,46],[95,48,88,48],[95,50,88,50],[96,6,89,8,"outputShape"],[96,17,89,19],[96,18,89,20,"push"],[96,22,89,24],[96,23,89,25,"indices"],[96,30,89,32],[96,31,89,33,"shape"],[96,36,89,38],[96,37,89,39,"i"],[96,38,89,40],[96,39,89,41],[96,40,89,42],[97,4,90,4],[98,4,91,4],[98,9,91,9],[98,13,91,13,"i"],[98,14,91,14],[98,17,91,17,"axis"],[98,21,91,21],[98,24,91,24],[98,25,91,25],[98,27,91,27,"i"],[98,28,91,28],[98,31,91,31,"xRank"],[98,36,91,36],[98,38,91,38,"i"],[98,39,91,39],[98,41,91,41],[98,43,91,43],[99,6,92,8,"outputShape"],[99,17,92,19],[99,18,92,20,"push"],[99,22,92,24],[99,23,92,25,"x"],[99,24,92,26],[99,25,92,27,"shape"],[99,30,92,32],[99,31,92,33,"i"],[99,32,92,34],[99,33,92,35],[99,34,92,36],[100,6,93,8,"sliceSize"],[100,15,93,17],[100,19,93,21,"x"],[100,20,93,22],[100,21,93,23,"shape"],[100,26,93,28],[100,27,93,29,"i"],[100,28,93,30],[100,29,93,31],[101,4,94,4],[102,4,95,4],[102,11,95,11],[103,6,95,13,"batchSize"],[103,15,95,22],[104,6,95,24,"sliceSize"],[104,15,95,33],[105,6,95,35,"outerSize"],[105,15,95,44],[106,6,95,46,"dimSize"],[106,13,95,53],[107,6,95,55,"outputShape"],[108,4,95,67],[108,5,95,68],[109,2,96,0],[110,0,96,1],[110,3]],"functionMap":{"names":["<global>","segOpComputeOptimalWindowSize","computeOutShape","collectGatherOpShapeInfo"],"mappings":"AAA;OCkB;CDmB;OEC;CFY;OGC;CH4C"},"hasCjsExports":false},"type":"js/module"}]}