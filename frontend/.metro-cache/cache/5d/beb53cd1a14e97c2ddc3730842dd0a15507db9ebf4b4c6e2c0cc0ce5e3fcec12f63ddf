{"dependencies":[{"name":"@tensorflow/tfjs-core","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":17,"column":0,"index":703},"end":{"line":17,"column":85,"index":788}}],"key":"qIleUpSDMUXFynEGc51k60/pDSs=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"dilation2DBackpropFilterConfig\", {\n    enumerable: true,\n    get: function () {\n      return dilation2DBackpropFilterConfig;\n    }\n  });\n  var _tensorflowTfjsCore = require(_dependencyMap[0], \"@tensorflow/tfjs-core\");\n  /**\n   * @license\n   * Copyright 2020 Google LLC. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   */\n\n  const dilation2DBackpropFilterConfig = {\n    kernelName: _tensorflowTfjsCore.Dilation2DBackpropFilter,\n    backendName: 'cpu',\n    kernelFunc: ({\n      inputs,\n      backend,\n      attrs\n    }) => {\n      const {\n        x,\n        filter,\n        dy\n      } = inputs;\n      const {\n        strides,\n        pad,\n        dilations\n      } = attrs;\n      const cpuBackend = backend;\n      const $x = _tensorflowTfjsCore.util.toNestedArray(x.shape, cpuBackend.data.get(x.dataId).values);\n      const $filter = _tensorflowTfjsCore.util.toNestedArray(filter.shape, cpuBackend.data.get(filter.dataId).values);\n      const {\n        batchSize,\n        inHeight,\n        inWidth,\n        inChannels,\n        outHeight,\n        outWidth,\n        padInfo,\n        strideHeight,\n        strideWidth,\n        filterHeight,\n        filterWidth,\n        dilationHeight,\n        dilationWidth,\n        outShape\n      } = _tensorflowTfjsCore.backend_util.computeDilation2DInfo(x.shape, filter.shape, strides, pad, 'NHWC' /* dataFormat */, dilations);\n      _tensorflowTfjsCore.util.assert(dy.rank === outShape.length, () => `Error in ${_tensorflowTfjsCore.Dilation2DBackpropFilter}, dy ` + `must have the same rank as output ${outShape.length}, but got ` + `${dy.rank}`);\n      const $dy = _tensorflowTfjsCore.util.toNestedArray(outShape, cpuBackend.data.get(dy.dataId).values);\n      // The computed filter gradients has the same dimensions as the filter:\n      // [filterHeight, filterWidth, depth]\n      const gradients = _tensorflowTfjsCore.util.makeZerosNestedTypedArray(filter.shape, filter.dtype);\n      // In the case of multiple argmax branches, we only back-propagate along the\n      // last branch, i.e., the one with largest value of `h * filter_cols + w`,\n      // similarly to the max-pooling backward routines.\n      // This implementation follows the TF c++ implementation:\n      // https://github.com/tensorflow/tensorflow/blob/d9a3a849edc198e90172bc58eb293de457f9d986/tensorflow/core/kernels/dilation_ops.cc\n      for (let b = 0; b < batchSize; ++b) {\n        for (let hOut = 0; hOut < outHeight; ++hOut) {\n          const hBeg = hOut * strideHeight - padInfo.top;\n          for (let wOut = 0; wOut < outWidth; ++wOut) {\n            const wBeg = wOut * strideWidth - padInfo.left;\n            for (let d = 0; d < inChannels; ++d) {\n              let curVal = Number.MIN_SAFE_INTEGER;\n              let hMax = 0;\n              let wMax = 0;\n              for (let h = 0; h < filterHeight; ++h) {\n                const hIn = hBeg + h * dilationHeight;\n                if (hIn >= 0 && hIn < inHeight) {\n                  for (let w = 0; w < filterWidth; ++w) {\n                    const wIn = wBeg + w * dilationWidth;\n                    if (wIn >= 0 && wIn < inWidth) {\n                      const val = $x[b][hIn][wIn][d] + $filter[h][w][d];\n                      if (val > curVal) {\n                        curVal = val;\n                        hMax = h;\n                        wMax = w;\n                      }\n                    }\n                  }\n                }\n              }\n              gradients[hMax][wMax][d] += $dy[b][hOut][wOut][d];\n            }\n          }\n        }\n      }\n      const dataId = cpuBackend.write(_tensorflowTfjsCore.util.toTypedArray(gradients, x.dtype), filter.shape, filter.dtype);\n      return {\n        dataId,\n        shape: filter.shape,\n        dtype: filter.dtype\n      };\n    }\n  };\n});","lineCount":116,"map":[[7,2,18,0,"Object"],[7,8,18,0],[7,9,18,0,"defineProperty"],[7,23,18,0],[7,24,18,0,"exports"],[7,31,18,0],[8,4,18,0,"enumerable"],[8,14,18,0],[9,4,18,0,"get"],[9,7,18,0],[9,18,18,0,"get"],[9,19,18,0],[10,6,18,0],[10,13,18,0,"dilation2DBackpropFilterConfig"],[10,43,18,0],[11,4,18,0],[12,2,18,0],[13,2,17,0],[13,6,17,0,"_tensorflowTfjsCore"],[13,25,17,0],[13,28,17,0,"require"],[13,35,17,0],[13,36,17,0,"_dependencyMap"],[13,50,17,0],[14,2,1,0],[15,0,2,0],[16,0,3,0],[17,0,4,0],[18,0,5,0],[19,0,6,0],[20,0,7,0],[21,0,8,0],[22,0,9,0],[23,0,10,0],[24,0,11,0],[25,0,12,0],[26,0,13,0],[27,0,14,0],[28,0,15,0],[29,0,16,0],[31,2,18,7],[31,8,18,13,"dilation2DBackpropFilterConfig"],[31,38,18,43],[31,41,18,46],[32,4,19,4,"kernelName"],[32,14,19,14],[32,16,19,16,"Dilation2DBackpropFilter"],[32,35,19,40],[32,36,19,40,"Dilation2DBackpropFilter"],[32,60,19,40],[33,4,20,4,"backendName"],[33,15,20,15],[33,17,20,17],[33,22,20,22],[34,4,21,4,"kernelFunc"],[34,14,21,14],[34,16,21,16,"kernelFunc"],[34,17,21,17],[35,6,21,19,"inputs"],[35,12,21,25],[36,6,21,27,"backend"],[36,13,21,34],[37,6,21,36,"attrs"],[38,4,21,42],[38,5,21,43],[38,10,21,48],[39,6,22,8],[39,12,22,14],[40,8,22,16,"x"],[40,9,22,17],[41,8,22,19,"filter"],[41,14,22,25],[42,8,22,27,"dy"],[43,6,22,30],[43,7,22,31],[43,10,22,34,"inputs"],[43,16,22,40],[44,6,23,8],[44,12,23,14],[45,8,23,16,"strides"],[45,15,23,23],[46,8,23,25,"pad"],[46,11,23,28],[47,8,23,30,"dilations"],[48,6,23,40],[48,7,23,41],[48,10,23,44,"attrs"],[48,15,23,49],[49,6,24,8],[49,12,24,14,"cpuBackend"],[49,22,24,24],[49,25,24,27,"backend"],[49,32,24,34],[50,6,25,8],[50,12,25,14,"$x"],[50,14,25,16],[50,17,25,19,"util"],[50,36,25,23],[50,37,25,23,"util"],[50,41,25,23],[50,42,25,24,"toNestedArray"],[50,55,25,37],[50,56,25,38,"x"],[50,57,25,39],[50,58,25,40,"shape"],[50,63,25,45],[50,65,25,47,"cpuBackend"],[50,75,25,57],[50,76,25,58,"data"],[50,80,25,62],[50,81,25,63,"get"],[50,84,25,66],[50,85,25,67,"x"],[50,86,25,68],[50,87,25,69,"dataId"],[50,93,25,75],[50,94,25,76],[50,95,25,77,"values"],[50,101,25,83],[50,102,25,84],[51,6,26,8],[51,12,26,14,"$filter"],[51,19,26,21],[51,22,26,24,"util"],[51,41,26,28],[51,42,26,28,"util"],[51,46,26,28],[51,47,26,29,"toNestedArray"],[51,60,26,42],[51,61,26,43,"filter"],[51,67,26,49],[51,68,26,50,"shape"],[51,73,26,55],[51,75,26,57,"cpuBackend"],[51,85,26,67],[51,86,26,68,"data"],[51,90,26,72],[51,91,26,73,"get"],[51,94,26,76],[51,95,26,77,"filter"],[51,101,26,83],[51,102,26,84,"dataId"],[51,108,26,90],[51,109,26,91],[51,110,26,92,"values"],[51,116,26,98],[51,117,26,99],[52,6,27,8],[52,12,27,14],[53,8,27,16,"batchSize"],[53,17,27,25],[54,8,27,27,"inHeight"],[54,16,27,35],[55,8,27,37,"inWidth"],[55,15,27,44],[56,8,27,46,"inChannels"],[56,18,27,56],[57,8,27,58,"outHeight"],[57,17,27,67],[58,8,27,69,"outWidth"],[58,16,27,77],[59,8,27,79,"padInfo"],[59,15,27,86],[60,8,27,88,"strideHeight"],[60,20,27,100],[61,8,27,102,"strideWidth"],[61,19,27,113],[62,8,27,115,"filterHeight"],[62,20,27,127],[63,8,27,129,"filterWidth"],[63,19,27,140],[64,8,27,142,"dilationHeight"],[64,22,27,156],[65,8,27,158,"dilationWidth"],[65,21,27,171],[66,8,27,173,"outShape"],[67,6,27,182],[67,7,27,183],[67,10,27,186,"backend_util"],[67,29,27,198],[67,30,27,198,"backend_util"],[67,42,27,198],[67,43,27,199,"computeDilation2DInfo"],[67,64,27,220],[67,65,27,221,"x"],[67,66,27,222],[67,67,27,223,"shape"],[67,72,27,228],[67,74,27,230,"filter"],[67,80,27,236],[67,81,27,237,"shape"],[67,86,27,242],[67,88,27,244,"strides"],[67,95,27,251],[67,97,27,253,"pad"],[67,100,27,256],[67,102,27,258],[67,108,27,264],[67,109,27,265],[67,127,27,283,"dilations"],[67,136,27,292],[67,137,27,293],[68,6,28,8,"util"],[68,25,28,12],[68,26,28,12,"util"],[68,30,28,12],[68,31,28,13,"assert"],[68,37,28,19],[68,38,28,20,"dy"],[68,40,28,22],[68,41,28,23,"rank"],[68,45,28,27],[68,50,28,32,"outShape"],[68,58,28,40],[68,59,28,41,"length"],[68,65,28,47],[68,67,28,49],[68,73,28,55],[68,85,28,67,"Dilation2DBackpropFilter"],[68,104,28,91],[68,105,28,91,"Dilation2DBackpropFilter"],[68,129,28,91],[68,136,28,98],[68,139,29,12],[68,176,29,49,"outShape"],[68,184,29,57],[68,185,29,58,"length"],[68,191,29,64],[68,203,29,76],[68,206,30,12],[68,209,30,15,"dy"],[68,211,30,17],[68,212,30,18,"rank"],[68,216,30,22],[68,218,30,24],[68,219,30,25],[69,6,31,8],[69,12,31,14,"$dy"],[69,15,31,17],[69,18,31,20,"util"],[69,37,31,24],[69,38,31,24,"util"],[69,42,31,24],[69,43,31,25,"toNestedArray"],[69,56,31,38],[69,57,31,39,"outShape"],[69,65,31,47],[69,67,31,49,"cpuBackend"],[69,77,31,59],[69,78,31,60,"data"],[69,82,31,64],[69,83,31,65,"get"],[69,86,31,68],[69,87,31,69,"dy"],[69,89,31,71],[69,90,31,72,"dataId"],[69,96,31,78],[69,97,31,79],[69,98,31,80,"values"],[69,104,31,86],[69,105,31,87],[70,6,32,8],[71,6,33,8],[72,6,34,8],[72,12,34,14,"gradients"],[72,21,34,23],[72,24,34,26,"util"],[72,43,34,30],[72,44,34,30,"util"],[72,48,34,30],[72,49,34,31,"makeZerosNestedTypedArray"],[72,74,34,56],[72,75,34,57,"filter"],[72,81,34,63],[72,82,34,64,"shape"],[72,87,34,69],[72,89,34,71,"filter"],[72,95,34,77],[72,96,34,78,"dtype"],[72,101,34,83],[72,102,34,84],[73,6,35,8],[74,6,36,8],[75,6,37,8],[76,6,38,8],[77,6,39,8],[78,6,40,8],[78,11,40,13],[78,15,40,17,"b"],[78,16,40,18],[78,19,40,21],[78,20,40,22],[78,22,40,24,"b"],[78,23,40,25],[78,26,40,28,"batchSize"],[78,35,40,37],[78,37,40,39],[78,39,40,41,"b"],[78,40,40,42],[78,42,40,44],[79,8,41,12],[79,13,41,17],[79,17,41,21,"hOut"],[79,21,41,25],[79,24,41,28],[79,25,41,29],[79,27,41,31,"hOut"],[79,31,41,35],[79,34,41,38,"outHeight"],[79,43,41,47],[79,45,41,49],[79,47,41,51,"hOut"],[79,51,41,55],[79,53,41,57],[80,10,42,16],[80,16,42,22,"hBeg"],[80,20,42,26],[80,23,42,29,"hOut"],[80,27,42,33],[80,30,42,36,"strideHeight"],[80,42,42,48],[80,45,42,51,"padInfo"],[80,52,42,58],[80,53,42,59,"top"],[80,56,42,62],[81,10,43,16],[81,15,43,21],[81,19,43,25,"wOut"],[81,23,43,29],[81,26,43,32],[81,27,43,33],[81,29,43,35,"wOut"],[81,33,43,39],[81,36,43,42,"outWidth"],[81,44,43,50],[81,46,43,52],[81,48,43,54,"wOut"],[81,52,43,58],[81,54,43,60],[82,12,44,20],[82,18,44,26,"wBeg"],[82,22,44,30],[82,25,44,33,"wOut"],[82,29,44,37],[82,32,44,40,"strideWidth"],[82,43,44,51],[82,46,44,54,"padInfo"],[82,53,44,61],[82,54,44,62,"left"],[82,58,44,66],[83,12,45,20],[83,17,45,25],[83,21,45,29,"d"],[83,22,45,30],[83,25,45,33],[83,26,45,34],[83,28,45,36,"d"],[83,29,45,37],[83,32,45,40,"inChannels"],[83,42,45,50],[83,44,45,52],[83,46,45,54,"d"],[83,47,45,55],[83,49,45,57],[84,14,46,24],[84,18,46,28,"curVal"],[84,24,46,34],[84,27,46,37,"Number"],[84,33,46,43],[84,34,46,44,"MIN_SAFE_INTEGER"],[84,50,46,60],[85,14,47,24],[85,18,47,28,"hMax"],[85,22,47,32],[85,25,47,35],[85,26,47,36],[86,14,48,24],[86,18,48,28,"wMax"],[86,22,48,32],[86,25,48,35],[86,26,48,36],[87,14,49,24],[87,19,49,29],[87,23,49,33,"h"],[87,24,49,34],[87,27,49,37],[87,28,49,38],[87,30,49,40,"h"],[87,31,49,41],[87,34,49,44,"filterHeight"],[87,46,49,56],[87,48,49,58],[87,50,49,60,"h"],[87,51,49,61],[87,53,49,63],[88,16,50,28],[88,22,50,34,"hIn"],[88,25,50,37],[88,28,50,40,"hBeg"],[88,32,50,44],[88,35,50,47,"h"],[88,36,50,48],[88,39,50,51,"dilationHeight"],[88,53,50,65],[89,16,51,28],[89,20,51,32,"hIn"],[89,23,51,35],[89,27,51,39],[89,28,51,40],[89,32,51,44,"hIn"],[89,35,51,47],[89,38,51,50,"inHeight"],[89,46,51,58],[89,48,51,60],[90,18,52,32],[90,23,52,37],[90,27,52,41,"w"],[90,28,52,42],[90,31,52,45],[90,32,52,46],[90,34,52,48,"w"],[90,35,52,49],[90,38,52,52,"filterWidth"],[90,49,52,63],[90,51,52,65],[90,53,52,67,"w"],[90,54,52,68],[90,56,52,70],[91,20,53,36],[91,26,53,42,"wIn"],[91,29,53,45],[91,32,53,48,"wBeg"],[91,36,53,52],[91,39,53,55,"w"],[91,40,53,56],[91,43,53,59,"dilationWidth"],[91,56,53,72],[92,20,54,36],[92,24,54,40,"wIn"],[92,27,54,43],[92,31,54,47],[92,32,54,48],[92,36,54,52,"wIn"],[92,39,54,55],[92,42,54,58,"inWidth"],[92,49,54,65],[92,51,54,67],[93,22,55,40],[93,28,55,46,"val"],[93,31,55,49],[93,34,55,52,"$x"],[93,36,55,54],[93,37,55,55,"b"],[93,38,55,56],[93,39,55,57],[93,40,55,58,"hIn"],[93,43,55,61],[93,44,55,62],[93,45,55,63,"wIn"],[93,48,55,66],[93,49,55,67],[93,50,55,68,"d"],[93,51,55,69],[93,52,55,70],[93,55,55,73,"$filter"],[93,62,55,80],[93,63,55,81,"h"],[93,64,55,82],[93,65,55,83],[93,66,55,84,"w"],[93,67,55,85],[93,68,55,86],[93,69,55,87,"d"],[93,70,55,88],[93,71,55,89],[94,22,56,40],[94,26,56,44,"val"],[94,29,56,47],[94,32,56,50,"curVal"],[94,38,56,56],[94,40,56,58],[95,24,57,44,"curVal"],[95,30,57,50],[95,33,57,53,"val"],[95,36,57,56],[96,24,58,44,"hMax"],[96,28,58,48],[96,31,58,51,"h"],[96,32,58,52],[97,24,59,44,"wMax"],[97,28,59,48],[97,31,59,51,"w"],[97,32,59,52],[98,22,60,40],[99,20,61,36],[100,18,62,32],[101,16,63,28],[102,14,64,24],[103,14,65,24,"gradients"],[103,23,65,33],[103,24,65,34,"hMax"],[103,28,65,38],[103,29,65,39],[103,30,65,40,"wMax"],[103,34,65,44],[103,35,65,45],[103,36,65,46,"d"],[103,37,65,47],[103,38,65,48],[103,42,65,52,"$dy"],[103,45,65,55],[103,46,65,56,"b"],[103,47,65,57],[103,48,65,58],[103,49,65,59,"hOut"],[103,53,65,63],[103,54,65,64],[103,55,65,65,"wOut"],[103,59,65,69],[103,60,65,70],[103,61,65,71,"d"],[103,62,65,72],[103,63,65,73],[104,12,66,20],[105,10,67,16],[106,8,68,12],[107,6,69,8],[108,6,70,8],[108,12,70,14,"dataId"],[108,18,70,20],[108,21,70,23,"cpuBackend"],[108,31,70,33],[108,32,70,34,"write"],[108,37,70,39],[108,38,70,40,"util"],[108,57,70,44],[108,58,70,44,"util"],[108,62,70,44],[108,63,70,45,"toTypedArray"],[108,75,70,57],[108,76,70,58,"gradients"],[108,85,70,67],[108,87,70,69,"x"],[108,88,70,70],[108,89,70,71,"dtype"],[108,94,70,76],[108,95,70,77],[108,97,70,79,"filter"],[108,103,70,85],[108,104,70,86,"shape"],[108,109,70,91],[108,111,70,93,"filter"],[108,117,70,99],[108,118,70,100,"dtype"],[108,123,70,105],[108,124,70,106],[109,6,71,8],[109,13,71,15],[110,8,71,17,"dataId"],[110,14,71,23],[111,8,71,25,"shape"],[111,13,71,30],[111,15,71,32,"filter"],[111,21,71,38],[111,22,71,39,"shape"],[111,27,71,44],[112,8,71,46,"dtype"],[112,13,71,51],[112,15,71,53,"filter"],[112,21,71,59],[112,22,71,60,"dtype"],[113,6,71,66],[113,7,71,67],[114,4,72,4],[115,2,73,0],[115,3,73,1],[116,0,73,2],[116,3]],"functionMap":{"names":["<global>","dilation2DBackpropFilterConfig.kernelFunc","util.assert$argument_1"],"mappings":"AAA;gBCoB;iDCO;wBDE;KD0C"},"hasCjsExports":false},"type":"js/module"}]}