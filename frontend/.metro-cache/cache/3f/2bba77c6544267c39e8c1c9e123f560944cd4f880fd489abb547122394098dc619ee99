{"dependencies":[{"name":"../../tensor_util_env","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":17,"column":0,"index":682},"end":{"line":17,"column":56,"index":738}}],"key":"xfSGNGkCJdZhfQ673y/6d+no2yU=","exportNames":["*"],"imports":1}},{"name":"../../util","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":18,"column":0,"index":739},"end":{"line":18,"column":35,"index":774}}],"key":"OiLVMoS12Mp3xgHkQeTdnQIBX6Q=","exportNames":["*"],"imports":1}},{"name":"../cast","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":19,"column":0,"index":775},"end":{"line":19,"column":31,"index":806}}],"key":"D+BUEx5BO0JXxAXMtu4IMlEZU0c=","exportNames":["*"],"imports":1}},{"name":"../einsum","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":20,"column":0,"index":807},"end":{"line":20,"column":35,"index":842}}],"key":"k8VDpqn9ynpANlZ0YeNt+Udff54=","exportNames":["*"],"imports":1}},{"name":"../expand_dims","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":21,"column":0,"index":843},"end":{"line":21,"column":44,"index":887}}],"key":"xmL6t+8Sy16XLPagJrdEgpHZ8eE=","exportNames":["*"],"imports":1}},{"name":"../operation","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":22,"column":0,"index":888},"end":{"line":22,"column":34,"index":922}}],"key":"fQilPqfSvhAHjyfKT0P4wel7jE4=","exportNames":["*"],"imports":1}},{"name":"../tensor1d","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":23,"column":0,"index":923},"end":{"line":23,"column":39,"index":962}}],"key":"kuefm5tuaz1jkFeHQbmB8ff4Z9E=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopNamespace(e) {\n    if (e && e.__esModule) return e;\n    var n = {};\n    if (e) Object.keys(e).forEach(function (k) {\n      var d = Object.getOwnPropertyDescriptor(e, k);\n      Object.defineProperty(n, k, d.get ? d : {\n        enumerable: true,\n        get: function () {\n          return e[k];\n        }\n      });\n    });\n    n.default = e;\n    return n;\n  }\n  Object.defineProperty(exports, \"rgbToGrayscale\", {\n    enumerable: true,\n    get: function () {\n      return rgbToGrayscale;\n    }\n  });\n  var _tensor_util_env = require(_dependencyMap[0], \"../../tensor_util_env\");\n  var _util = require(_dependencyMap[1], \"../../util\");\n  var util = _interopNamespace(_util);\n  var _cast = require(_dependencyMap[2], \"../cast\");\n  var _einsum = require(_dependencyMap[3], \"../einsum\");\n  var _expand_dims = require(_dependencyMap[4], \"../expand_dims\");\n  var _operation = require(_dependencyMap[5], \"../operation\");\n  var _tensor1d = require(_dependencyMap[6], \"../tensor1d\");\n  /**\n   * @license\n   * Copyright 2023 Google LLC.\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   */\n\n  /**\n   * Converts images from RGB format to grayscale.\n   *\n   * @param image A RGB tensor to convert. The `image`'s last dimension must\n   *     be size 3 with at least a two-dimensional shape.\n   *\n   * @doc {heading: 'Operations', subheading: 'Images', namespace: 'image'}\n   */\n  function rgbToGrayscale_(image) {\n    const $image = (0, _tensor_util_env.convertToTensor)(image, 'image', 'RGBToGrayscale');\n    const lastDimsIdx = $image.rank - 1;\n    const lastDims = $image.shape[lastDimsIdx];\n    util.assert($image.rank >= 2, () => 'Error in RGBToGrayscale: images must be at least rank 2, ' + `but got rank ${$image.rank}.`);\n    util.assert(lastDims === 3, () => 'Error in RGBToGrayscale: last dimension of an RGB image ' + `should be size 3, but got size ${lastDims}.`);\n    // Remember original dtype so we can convert back if needed\n    const origDtype = $image.dtype;\n    const fltImage = (0, _cast.cast)($image, 'float32');\n    const rgbWeights = (0, _tensor1d.tensor1d)([0.2989, 0.5870, 0.1140]);\n    let grayFloat;\n    switch ($image.rank) {\n      case 2:\n        grayFloat = (0, _einsum.einsum)('ij,j->i', fltImage, rgbWeights);\n        break;\n      case 3:\n        grayFloat = (0, _einsum.einsum)('ijk,k->ij', fltImage, rgbWeights);\n        break;\n      case 4:\n        grayFloat = (0, _einsum.einsum)('ijkl,l->ijk', fltImage, rgbWeights);\n        break;\n      case 5:\n        grayFloat = (0, _einsum.einsum)('ijklm,m->ijkl', fltImage, rgbWeights);\n        break;\n      case 6:\n        grayFloat = (0, _einsum.einsum)('ijklmn,n->ijklm', fltImage, rgbWeights);\n        break;\n      default:\n        throw new Error('Not a valid tensor rank.');\n    }\n    grayFloat = (0, _expand_dims.expandDims)(grayFloat, -1);\n    return (0, _cast.cast)(grayFloat, origDtype);\n  }\n  const rgbToGrayscale = /* @__PURE__ */(0, _operation.op)({\n    rgbToGrayscale_\n  });\n});","lineCount":97,"map":[[22,2,67,0,"Object"],[22,8,67,0],[22,9,67,0,"defineProperty"],[22,23,67,0],[22,24,67,0,"exports"],[22,31,67,0],[23,4,67,0,"enumerable"],[23,14,67,0],[24,4,67,0,"get"],[24,7,67,0],[24,18,67,0,"get"],[24,19,67,0],[25,6,67,0],[25,13,67,0,"rgbToGrayscale"],[25,27,67,0],[26,4,67,0],[27,2,67,0],[28,2,17,0],[28,6,17,0,"_tensor_util_env"],[28,22,17,0],[28,25,17,0,"require"],[28,32,17,0],[28,33,17,0,"_dependencyMap"],[28,47,17,0],[29,2,18,0],[29,6,18,0,"_util"],[29,11,18,0],[29,14,18,0,"require"],[29,21,18,0],[29,22,18,0,"_dependencyMap"],[29,36,18,0],[30,2,18,0],[30,6,18,0,"util"],[30,10,18,0],[30,13,18,0,"_interopNamespace"],[30,30,18,0],[30,31,18,0,"_util"],[30,36,18,0],[31,2,19,0],[31,6,19,0,"_cast"],[31,11,19,0],[31,14,19,0,"require"],[31,21,19,0],[31,22,19,0,"_dependencyMap"],[31,36,19,0],[32,2,20,0],[32,6,20,0,"_einsum"],[32,13,20,0],[32,16,20,0,"require"],[32,23,20,0],[32,24,20,0,"_dependencyMap"],[32,38,20,0],[33,2,21,0],[33,6,21,0,"_expand_dims"],[33,18,21,0],[33,21,21,0,"require"],[33,28,21,0],[33,29,21,0,"_dependencyMap"],[33,43,21,0],[34,2,22,0],[34,6,22,0,"_operation"],[34,16,22,0],[34,19,22,0,"require"],[34,26,22,0],[34,27,22,0,"_dependencyMap"],[34,41,22,0],[35,2,23,0],[35,6,23,0,"_tensor1d"],[35,15,23,0],[35,18,23,0,"require"],[35,25,23,0],[35,26,23,0,"_dependencyMap"],[35,40,23,0],[36,2,1,0],[37,0,2,0],[38,0,3,0],[39,0,4,0],[40,0,5,0],[41,0,6,0],[42,0,7,0],[43,0,8,0],[44,0,9,0],[45,0,10,0],[46,0,11,0],[47,0,12,0],[48,0,13,0],[49,0,14,0],[50,0,15,0],[51,0,16,0],[53,2,24,0],[54,0,25,0],[55,0,26,0],[56,0,27,0],[57,0,28,0],[58,0,29,0],[59,0,30,0],[60,0,31,0],[61,2,32,0],[61,11,32,9,"rgbToGrayscale_"],[61,26,32,24,"rgbToGrayscale_"],[61,27,32,25,"image"],[61,32,32,30],[61,34,32,32],[62,4,33,4],[62,10,33,10,"$image"],[62,16,33,16],[62,19,33,19],[62,23,33,19,"convertToTensor"],[62,39,33,34],[62,40,33,34,"convertToTensor"],[62,55,33,34],[62,57,33,35,"image"],[62,62,33,40],[62,64,33,42],[62,71,33,49],[62,73,33,51],[62,89,33,67],[62,90,33,68],[63,4,34,4],[63,10,34,10,"lastDimsIdx"],[63,21,34,21],[63,24,34,24,"$image"],[63,30,34,30],[63,31,34,31,"rank"],[63,35,34,35],[63,38,34,38],[63,39,34,39],[64,4,35,4],[64,10,35,10,"lastDims"],[64,18,35,18],[64,21,35,21,"$image"],[64,27,35,27],[64,28,35,28,"shape"],[64,33,35,33],[64,34,35,34,"lastDimsIdx"],[64,45,35,45],[64,46,35,46],[65,4,36,4,"util"],[65,8,36,8],[65,9,36,9,"assert"],[65,15,36,15],[65,16,36,16,"$image"],[65,22,36,22],[65,23,36,23,"rank"],[65,27,36,27],[65,31,36,31],[65,32,36,32],[65,34,36,34],[65,40,36,40],[65,99,36,99],[65,102,37,8],[65,118,37,24,"$image"],[65,124,37,30],[65,125,37,31,"rank"],[65,129,37,35],[65,132,37,38],[65,133,37,39],[66,4,38,4,"util"],[66,8,38,8],[66,9,38,9,"assert"],[66,15,38,15],[66,16,38,16,"lastDims"],[66,24,38,24],[66,29,38,29],[66,30,38,30],[66,32,38,32],[66,38,38,38],[66,96,38,96],[66,99,39,8],[66,133,39,42,"lastDims"],[66,141,39,50],[66,144,39,53],[66,145,39,54],[67,4,40,4],[68,4,41,4],[68,10,41,10,"origDtype"],[68,19,41,19],[68,22,41,22,"$image"],[68,28,41,28],[68,29,41,29,"dtype"],[68,34,41,34],[69,4,42,4],[69,10,42,10,"fltImage"],[69,18,42,18],[69,21,42,21],[69,25,42,21,"cast"],[69,30,42,25],[69,31,42,25,"cast"],[69,35,42,25],[69,37,42,26,"$image"],[69,43,42,32],[69,45,42,34],[69,54,42,43],[69,55,42,44],[70,4,43,4],[70,10,43,10,"rgbWeights"],[70,20,43,20],[70,23,43,23],[70,27,43,23,"tensor1d"],[70,36,43,31],[70,37,43,31,"tensor1d"],[70,45,43,31],[70,47,43,32],[70,48,43,33],[70,54,43,39],[70,56,43,41],[70,62,43,47],[70,64,43,49],[70,70,43,55],[70,71,43,56],[70,72,43,57],[71,4,44,4],[71,8,44,8,"grayFloat"],[71,17,44,17],[72,4,45,4],[72,12,45,12,"$image"],[72,18,45,18],[72,19,45,19,"rank"],[72,23,45,23],[73,6,46,8],[73,11,46,13],[73,12,46,14],[74,8,47,12,"grayFloat"],[74,17,47,21],[74,20,47,24],[74,24,47,24,"einsum"],[74,31,47,30],[74,32,47,30,"einsum"],[74,38,47,30],[74,40,47,31],[74,49,47,40],[74,51,47,42,"fltImage"],[74,59,47,50],[74,61,47,52,"rgbWeights"],[74,71,47,62],[74,72,47,63],[75,8,48,12],[76,6,49,8],[76,11,49,13],[76,12,49,14],[77,8,50,12,"grayFloat"],[77,17,50,21],[77,20,50,24],[77,24,50,24,"einsum"],[77,31,50,30],[77,32,50,30,"einsum"],[77,38,50,30],[77,40,50,31],[77,51,50,42],[77,53,50,44,"fltImage"],[77,61,50,52],[77,63,50,54,"rgbWeights"],[77,73,50,64],[77,74,50,65],[78,8,51,12],[79,6,52,8],[79,11,52,13],[79,12,52,14],[80,8,53,12,"grayFloat"],[80,17,53,21],[80,20,53,24],[80,24,53,24,"einsum"],[80,31,53,30],[80,32,53,30,"einsum"],[80,38,53,30],[80,40,53,31],[80,53,53,44],[80,55,53,46,"fltImage"],[80,63,53,54],[80,65,53,56,"rgbWeights"],[80,75,53,66],[80,76,53,67],[81,8,54,12],[82,6,55,8],[82,11,55,13],[82,12,55,14],[83,8,56,12,"grayFloat"],[83,17,56,21],[83,20,56,24],[83,24,56,24,"einsum"],[83,31,56,30],[83,32,56,30,"einsum"],[83,38,56,30],[83,40,56,31],[83,55,56,46],[83,57,56,48,"fltImage"],[83,65,56,56],[83,67,56,58,"rgbWeights"],[83,77,56,68],[83,78,56,69],[84,8,57,12],[85,6,58,8],[85,11,58,13],[85,12,58,14],[86,8,59,12,"grayFloat"],[86,17,59,21],[86,20,59,24],[86,24,59,24,"einsum"],[86,31,59,30],[86,32,59,30,"einsum"],[86,38,59,30],[86,40,59,31],[86,57,59,48],[86,59,59,50,"fltImage"],[86,67,59,58],[86,69,59,60,"rgbWeights"],[86,79,59,70],[86,80,59,71],[87,8,60,12],[88,6,61,8],[89,8,62,12],[89,14,62,18],[89,18,62,22,"Error"],[89,23,62,27],[89,24,62,28],[89,50,62,54],[89,51,62,55],[90,4,63,4],[91,4,64,4,"grayFloat"],[91,13,64,13],[91,16,64,16],[91,20,64,16,"expandDims"],[91,32,64,26],[91,33,64,26,"expandDims"],[91,43,64,26],[91,45,64,27,"grayFloat"],[91,54,64,36],[91,56,64,38],[91,57,64,39],[91,58,64,40],[91,59,64,41],[92,4,65,4],[92,11,65,11],[92,15,65,11,"cast"],[92,20,65,15],[92,21,65,15,"cast"],[92,25,65,15],[92,27,65,16,"grayFloat"],[92,36,65,25],[92,38,65,27,"origDtype"],[92,47,65,36],[92,48,65,37],[93,2,66,0],[94,2,67,7],[94,8,67,13,"rgbToGrayscale"],[94,22,67,27],[94,25,67,30],[94,40,67,46],[94,44,67,46,"op"],[94,54,67,48],[94,55,67,48,"op"],[94,57,67,48],[94,59,67,49],[95,4,67,51,"rgbToGrayscale_"],[96,2,67,67],[96,3,67,68],[96,4,67,69],[97,0,67,70],[97,3]],"functionMap":{"names":["<global>","rgbToGrayscale_","util.assert$argument_1"],"mappings":"AAA;AC+B;kCCI;sCDC;gCCC;qDDC;CD2B"},"hasCjsExports":false},"type":"js/module"}]}