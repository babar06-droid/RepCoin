{"dependencies":[{"name":"@tensorflow/tfjs-core","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":17,"column":0,"index":703},"end":{"line":17,"column":61,"index":764}}],"key":"qIleUpSDMUXFynEGc51k60/pDSs=","exportNames":["*"],"imports":1}},{"name":"../cpu_util","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":18,"column":0,"index":765},"end":{"line":18,"column":47,"index":812}}],"key":"5L5S4GXlh/uJh1MrXQbkPSVOWm4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.batchNorm = batchNorm;\n  Object.defineProperty(exports, \"batchNormConfig\", {\n    enumerable: true,\n    get: function () {\n      return batchNormConfig;\n    }\n  });\n  var _tensorflowTfjsCore = require(_dependencyMap[0], \"@tensorflow/tfjs-core\");\n  var _cpu_util = require(_dependencyMap[1], \"../cpu_util\");\n  /**\n   * @license\n   * Copyright 2020 Google LLC. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   */\n\n  function batchNorm(args) {\n    const {\n      inputs,\n      backend,\n      attrs\n    } = args;\n    const {\n      x,\n      scale,\n      offset,\n      mean,\n      variance\n    } = inputs;\n    _tensorflowTfjsCore.util.assert(mean.shape.length === variance.shape.length, () => 'Batch normalization gradient requires mean and variance to have ' + 'equal ranks.');\n    _tensorflowTfjsCore.util.assert(offset == null || mean.shape.length === offset.shape.length, () => 'Batch normalization gradient requires mean and offset to have ' + 'equal ranks.');\n    _tensorflowTfjsCore.util.assert(scale == null || mean.shape.length === scale.shape.length, () => 'Batch normalization gradient requires mean and scale to have ' + 'equal ranks.');\n    (0, _cpu_util.assertNotComplex)([x, mean, variance, scale, offset], 'batchNorm');\n    let {\n      varianceEpsilon\n    } = attrs;\n    if (varianceEpsilon == null) {\n      varianceEpsilon = 0.001;\n    }\n    const xVals = backend.data.get(x.dataId).values;\n    const mVals = backend.data.get(mean.dataId).values;\n    const varVals = backend.data.get(variance.dataId).values;\n    const sVals = scale ? backend.data.get(scale.dataId).values : new Float32Array([1]);\n    const offVals = offset ? backend.data.get(offset.dataId).values : new Float32Array([0]);\n    const outVals = new Float32Array(xVals.length);\n    const offValsLength = offVals.length;\n    const sValsLength = sVals.length;\n    const varValsLength = varVals.length;\n    const mValsLength = mVals.length;\n    let offi = 0;\n    let mi = 0;\n    let si = 0;\n    let vi = 0;\n    for (let i = 0; i < xVals.length; ++i) {\n      outVals[i] = offVals[offi++] + (xVals[i] - mVals[mi++]) * sVals[si++] / Math.sqrt(varVals[vi++] + varianceEpsilon);\n      if (offi >= offValsLength) {\n        offi = 0;\n      }\n      if (mi >= mValsLength) {\n        mi = 0;\n      }\n      if (si >= sValsLength) {\n        si = 0;\n      }\n      if (vi >= varValsLength) {\n        vi = 0;\n      }\n    }\n    return backend.makeTensorInfo(x.shape, x.dtype, outVals);\n  }\n  const batchNormConfig = {\n    kernelName: _tensorflowTfjsCore.FusedBatchNorm,\n    backendName: 'cpu',\n    kernelFunc: batchNorm\n  };\n});","lineCount":92,"map":[[7,2,19,0,"exports"],[7,9,19,0],[7,10,19,0,"batchNorm"],[7,19,19,0],[7,22,19,0,"batchNorm"],[7,31,19,0],[8,2,69,0,"Object"],[8,8,69,0],[8,9,69,0,"defineProperty"],[8,23,69,0],[8,24,69,0,"exports"],[8,31,69,0],[9,4,69,0,"enumerable"],[9,14,69,0],[10,4,69,0,"get"],[10,7,69,0],[10,18,69,0,"get"],[10,19,69,0],[11,6,69,0],[11,13,69,0,"batchNormConfig"],[11,28,69,0],[12,4,69,0],[13,2,69,0],[14,2,17,0],[14,6,17,0,"_tensorflowTfjsCore"],[14,25,17,0],[14,28,17,0,"require"],[14,35,17,0],[14,36,17,0,"_dependencyMap"],[14,50,17,0],[15,2,18,0],[15,6,18,0,"_cpu_util"],[15,15,18,0],[15,18,18,0,"require"],[15,25,18,0],[15,26,18,0,"_dependencyMap"],[15,40,18,0],[16,2,1,0],[17,0,2,0],[18,0,3,0],[19,0,4,0],[20,0,5,0],[21,0,6,0],[22,0,7,0],[23,0,8,0],[24,0,9,0],[25,0,10,0],[26,0,11,0],[27,0,12,0],[28,0,13,0],[29,0,14,0],[30,0,15,0],[31,0,16,0],[33,2,19,7],[33,11,19,16,"batchNorm"],[33,20,19,25,"batchNorm"],[33,21,19,26,"args"],[33,25,19,30],[33,27,19,32],[34,4,20,4],[34,10,20,10],[35,6,20,12,"inputs"],[35,12,20,18],[36,6,20,20,"backend"],[36,13,20,27],[37,6,20,29,"attrs"],[38,4,20,35],[38,5,20,36],[38,8,20,39,"args"],[38,12,20,43],[39,4,21,4],[39,10,21,10],[40,6,21,12,"x"],[40,7,21,13],[41,6,21,15,"scale"],[41,11,21,20],[42,6,21,22,"offset"],[42,12,21,28],[43,6,21,30,"mean"],[43,10,21,34],[44,6,21,36,"variance"],[45,4,21,45],[45,5,21,46],[45,8,21,49,"inputs"],[45,14,21,55],[46,4,22,4,"util"],[46,23,22,8],[46,24,22,8,"util"],[46,28,22,8],[46,29,22,9,"assert"],[46,35,22,15],[46,36,22,16,"mean"],[46,40,22,20],[46,41,22,21,"shape"],[46,46,22,26],[46,47,22,27,"length"],[46,53,22,33],[46,58,22,38,"variance"],[46,66,22,46],[46,67,22,47,"shape"],[46,72,22,52],[46,73,22,53,"length"],[46,79,22,59],[46,81,22,61],[46,87,22,67],[46,153,22,133],[46,156,23,8],[46,170,23,22],[46,171,23,23],[47,4,24,4,"util"],[47,23,24,8],[47,24,24,8,"util"],[47,28,24,8],[47,29,24,9,"assert"],[47,35,24,15],[47,36,24,16,"offset"],[47,42,24,22],[47,46,24,26],[47,50,24,30],[47,54,24,34,"mean"],[47,58,24,38],[47,59,24,39,"shape"],[47,64,24,44],[47,65,24,45,"length"],[47,71,24,51],[47,76,24,56,"offset"],[47,82,24,62],[47,83,24,63,"shape"],[47,88,24,68],[47,89,24,69,"length"],[47,95,24,75],[47,97,24,77],[47,103,24,83],[47,167,24,147],[47,170,25,8],[47,184,25,22],[47,185,25,23],[48,4,26,4,"util"],[48,23,26,8],[48,24,26,8,"util"],[48,28,26,8],[48,29,26,9,"assert"],[48,35,26,15],[48,36,26,16,"scale"],[48,41,26,21],[48,45,26,25],[48,49,26,29],[48,53,26,33,"mean"],[48,57,26,37],[48,58,26,38,"shape"],[48,63,26,43],[48,64,26,44,"length"],[48,70,26,50],[48,75,26,55,"scale"],[48,80,26,60],[48,81,26,61,"shape"],[48,86,26,66],[48,87,26,67,"length"],[48,93,26,73],[48,95,26,75],[48,101,26,81],[48,164,26,144],[48,167,27,8],[48,181,27,22],[48,182,27,23],[49,4,28,4],[49,8,28,4,"assertNotComplex"],[49,17,28,20],[49,18,28,20,"assertNotComplex"],[49,34,28,20],[49,36,28,21],[49,37,28,22,"x"],[49,38,28,23],[49,40,28,25,"mean"],[49,44,28,29],[49,46,28,31,"variance"],[49,54,28,39],[49,56,28,41,"scale"],[49,61,28,46],[49,63,28,48,"offset"],[49,69,28,54],[49,70,28,55],[49,72,28,57],[49,83,28,68],[49,84,28,69],[50,4,29,4],[50,8,29,8],[51,6,29,10,"varianceEpsilon"],[52,4,29,26],[52,5,29,27],[52,8,29,30,"attrs"],[52,13,29,35],[53,4,30,4],[53,8,30,8,"varianceEpsilon"],[53,23,30,23],[53,27,30,27],[53,31,30,31],[53,33,30,33],[54,6,31,8,"varianceEpsilon"],[54,21,31,23],[54,24,31,26],[54,29,31,31],[55,4,32,4],[56,4,33,4],[56,10,33,10,"xVals"],[56,15,33,15],[56,18,33,18,"backend"],[56,25,33,25],[56,26,33,26,"data"],[56,30,33,30],[56,31,33,31,"get"],[56,34,33,34],[56,35,33,35,"x"],[56,36,33,36],[56,37,33,37,"dataId"],[56,43,33,43],[56,44,33,44],[56,45,33,45,"values"],[56,51,33,51],[57,4,34,4],[57,10,34,10,"mVals"],[57,15,34,15],[57,18,34,18,"backend"],[57,25,34,25],[57,26,34,26,"data"],[57,30,34,30],[57,31,34,31,"get"],[57,34,34,34],[57,35,34,35,"mean"],[57,39,34,39],[57,40,34,40,"dataId"],[57,46,34,46],[57,47,34,47],[57,48,34,48,"values"],[57,54,34,54],[58,4,35,4],[58,10,35,10,"varVals"],[58,17,35,17],[58,20,35,20,"backend"],[58,27,35,27],[58,28,35,28,"data"],[58,32,35,32],[58,33,35,33,"get"],[58,36,35,36],[58,37,35,37,"variance"],[58,45,35,45],[58,46,35,46,"dataId"],[58,52,35,52],[58,53,35,53],[58,54,35,54,"values"],[58,60,35,60],[59,4,36,4],[59,10,36,10,"sVals"],[59,15,36,15],[59,18,36,18,"scale"],[59,23,36,23],[59,26,36,26,"backend"],[59,33,36,33],[59,34,36,34,"data"],[59,38,36,38],[59,39,36,39,"get"],[59,42,36,42],[59,43,36,43,"scale"],[59,48,36,48],[59,49,36,49,"dataId"],[59,55,36,55],[59,56,36,56],[59,57,36,57,"values"],[59,63,36,63],[59,66,37,8],[59,70,37,12,"Float32Array"],[59,82,37,24],[59,83,37,25],[59,84,37,26],[59,85,37,27],[59,86,37,28],[59,87,37,29],[60,4,38,4],[60,10,38,10,"offVals"],[60,17,38,17],[60,20,38,20,"offset"],[60,26,38,26],[60,29,39,8,"backend"],[60,36,39,15],[60,37,39,16,"data"],[60,41,39,20],[60,42,39,21,"get"],[60,45,39,24],[60,46,39,25,"offset"],[60,52,39,31],[60,53,39,32,"dataId"],[60,59,39,38],[60,60,39,39],[60,61,39,40,"values"],[60,67,39,46],[60,70,40,8],[60,74,40,12,"Float32Array"],[60,86,40,24],[60,87,40,25],[60,88,40,26],[60,89,40,27],[60,90,40,28],[60,91,40,29],[61,4,41,4],[61,10,41,10,"outVals"],[61,17,41,17],[61,20,41,20],[61,24,41,24,"Float32Array"],[61,36,41,36],[61,37,41,37,"xVals"],[61,42,41,42],[61,43,41,43,"length"],[61,49,41,49],[61,50,41,50],[62,4,42,4],[62,10,42,10,"offValsLength"],[62,23,42,23],[62,26,42,26,"offVals"],[62,33,42,33],[62,34,42,34,"length"],[62,40,42,40],[63,4,43,4],[63,10,43,10,"sValsLength"],[63,21,43,21],[63,24,43,24,"sVals"],[63,29,43,29],[63,30,43,30,"length"],[63,36,43,36],[64,4,44,4],[64,10,44,10,"varValsLength"],[64,23,44,23],[64,26,44,26,"varVals"],[64,33,44,33],[64,34,44,34,"length"],[64,40,44,40],[65,4,45,4],[65,10,45,10,"mValsLength"],[65,21,45,21],[65,24,45,24,"mVals"],[65,29,45,29],[65,30,45,30,"length"],[65,36,45,36],[66,4,46,4],[66,8,46,8,"offi"],[66,12,46,12],[66,15,46,15],[66,16,46,16],[67,4,47,4],[67,8,47,8,"mi"],[67,10,47,10],[67,13,47,13],[67,14,47,14],[68,4,48,4],[68,8,48,8,"si"],[68,10,48,10],[68,13,48,13],[68,14,48,14],[69,4,49,4],[69,8,49,8,"vi"],[69,10,49,10],[69,13,49,13],[69,14,49,14],[70,4,50,4],[70,9,50,9],[70,13,50,13,"i"],[70,14,50,14],[70,17,50,17],[70,18,50,18],[70,20,50,20,"i"],[70,21,50,21],[70,24,50,24,"xVals"],[70,29,50,29],[70,30,50,30,"length"],[70,36,50,36],[70,38,50,38],[70,40,50,40,"i"],[70,41,50,41],[70,43,50,43],[71,6,51,8,"outVals"],[71,13,51,15],[71,14,51,16,"i"],[71,15,51,17],[71,16,51,18],[71,19,51,21,"offVals"],[71,26,51,28],[71,27,51,29,"offi"],[71,31,51,33],[71,33,51,35],[71,34,51,36],[71,37,52,12],[71,38,52,13,"xVals"],[71,43,52,18],[71,44,52,19,"i"],[71,45,52,20],[71,46,52,21],[71,49,52,24,"mVals"],[71,54,52,29],[71,55,52,30,"mi"],[71,57,52,32],[71,59,52,34],[71,60,52,35],[71,64,52,39,"sVals"],[71,69,52,44],[71,70,52,45,"si"],[71,72,52,47],[71,74,52,49],[71,75,52,50],[71,78,53,16,"Math"],[71,82,53,20],[71,83,53,21,"sqrt"],[71,87,53,25],[71,88,53,26,"varVals"],[71,95,53,33],[71,96,53,34,"vi"],[71,98,53,36],[71,100,53,38],[71,101,53,39],[71,104,53,42,"varianceEpsilon"],[71,119,53,57],[71,120,53,58],[72,6,54,8],[72,10,54,12,"offi"],[72,14,54,16],[72,18,54,20,"offValsLength"],[72,31,54,33],[72,33,54,35],[73,8,55,12,"offi"],[73,12,55,16],[73,15,55,19],[73,16,55,20],[74,6,56,8],[75,6,57,8],[75,10,57,12,"mi"],[75,12,57,14],[75,16,57,18,"mValsLength"],[75,27,57,29],[75,29,57,31],[76,8,58,12,"mi"],[76,10,58,14],[76,13,58,17],[76,14,58,18],[77,6,59,8],[78,6,60,8],[78,10,60,12,"si"],[78,12,60,14],[78,16,60,18,"sValsLength"],[78,27,60,29],[78,29,60,31],[79,8,61,12,"si"],[79,10,61,14],[79,13,61,17],[79,14,61,18],[80,6,62,8],[81,6,63,8],[81,10,63,12,"vi"],[81,12,63,14],[81,16,63,18,"varValsLength"],[81,29,63,31],[81,31,63,33],[82,8,64,12,"vi"],[82,10,64,14],[82,13,64,17],[82,14,64,18],[83,6,65,8],[84,4,66,4],[85,4,67,4],[85,11,67,11,"backend"],[85,18,67,18],[85,19,67,19,"makeTensorInfo"],[85,33,67,33],[85,34,67,34,"x"],[85,35,67,35],[85,36,67,36,"shape"],[85,41,67,41],[85,43,67,43,"x"],[85,44,67,44],[85,45,67,45,"dtype"],[85,50,67,50],[85,52,67,52,"outVals"],[85,59,67,59],[85,60,67,60],[86,2,68,0],[87,2,69,7],[87,8,69,13,"batchNormConfig"],[87,23,69,28],[87,26,69,31],[88,4,70,4,"kernelName"],[88,14,70,14],[88,16,70,16,"FusedBatchNorm"],[88,35,70,30],[88,36,70,30,"FusedBatchNorm"],[88,50,70,30],[89,4,71,4,"backendName"],[89,15,71,15],[89,17,71,17],[89,22,71,22],[90,4,72,4,"kernelFunc"],[90,14,72,14],[90,16,72,16,"batchNorm"],[91,2,73,0],[91,3,73,1],[92,0,73,2],[92,3]],"functionMap":{"names":["<global>","batchNorm","util.assert$argument_1"],"mappings":"AAA;OCkB;6DCG;sBDC;6ECC;sBDC;2ECC;sBDC;CDyC"},"hasCjsExports":false},"type":"js/module"}]}