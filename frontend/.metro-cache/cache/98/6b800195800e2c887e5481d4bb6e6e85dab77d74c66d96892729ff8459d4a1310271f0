{"dependencies":[{"name":"@tensorflow/tfjs-core","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":17,"column":0,"index":703},"end":{"line":17,"column":71,"index":774}}],"key":"qIleUpSDMUXFynEGc51k60/pDSs=","exportNames":["*"],"imports":1}},{"name":"../kernel_utils/reduce","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":18,"column":0,"index":775},"end":{"line":18,"column":48,"index":823}}],"key":"jfnNBpzwIopyFjddGB5/poFfoDQ=","exportNames":["*"],"imports":1}},{"name":"./Reshape","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":19,"column":0,"index":824},"end":{"line":19,"column":36,"index":860}}],"key":"EUWK+oKi/AwokPOQ1jng5DYfQSc=","exportNames":["*"],"imports":1}},{"name":"./Transpose_impl","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":20,"column":0,"index":861},"end":{"line":20,"column":49,"index":910}}],"key":"14/1wfkCjW4iZnvkwkO0WFpRQ7E=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.sumImpl = sumImpl;\n  var _tensorflowTfjsCore = require(_dependencyMap[0], \"@tensorflow/tfjs-core\");\n  var _kernel_utilsReduce = require(_dependencyMap[1], \"../kernel_utils/reduce\");\n  var _Reshape = require(_dependencyMap[2], \"./Reshape\");\n  var _Transpose_impl = require(_dependencyMap[3], \"./Transpose_impl\");\n  /**\n   * @license\n   * Copyright 2020 Google LLC. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   */\n\n  function sumImpl(x, axis, keepDims, backend) {\n    const reductionIndices = axis;\n    const xRank = x.shape.length;\n    const origAxes = _tensorflowTfjsCore.util.parseAxisParam(reductionIndices, x.shape);\n    let axes = origAxes;\n    const permutedAxes = _tensorflowTfjsCore.backend_util.getAxesPermutation(axes, xRank);\n    const sumInputIsTransposed = permutedAxes != null;\n    let sumInput = x;\n    if (sumInputIsTransposed) {\n      sumInput = (0, _Transpose_impl.transposeImpl)(x, permutedAxes, backend);\n      axes = _tensorflowTfjsCore.backend_util.getInnerMostAxes(axes.length, xRank);\n    }\n    _tensorflowTfjsCore.backend_util.assertAxesAreInnerMostDims('sum', axes, xRank);\n    const [sumOutShape, reduceShape] = _tensorflowTfjsCore.backend_util.computeOutAndReduceShapes(sumInput.shape, axes);\n    let outShape = sumOutShape;\n    if (keepDims) {\n      // rather than reshape at the end, set the target shape here.\n      outShape = _tensorflowTfjsCore.backend_util.expandShapeToKeepDim(sumOutShape, origAxes);\n    }\n    const inSize = _tensorflowTfjsCore.util.sizeFromShape(reduceShape);\n    const xSize = _tensorflowTfjsCore.util.sizeFromShape(x.shape);\n    const batchSize = xSize / inSize;\n    const reshapedInput = (0, _Reshape.reshape)({\n      inputs: {\n        x: sumInput\n      },\n      attrs: {\n        shape: [batchSize, inSize]\n      },\n      backend\n    });\n    const outType = (0, _tensorflowTfjsCore.sumOutType)(x.dtype);\n    const reduced = (0, _kernel_utilsReduce.reduce)(reshapedInput, outType, 'sum', backend);\n    const out = (0, _Reshape.reshape)({\n      inputs: {\n        x: reduced\n      },\n      attrs: {\n        shape: outShape\n      },\n      backend\n    });\n    backend.disposeIntermediateTensorInfo(reshapedInput);\n    backend.disposeIntermediateTensorInfo(reduced);\n    if (sumInputIsTransposed) {\n      backend.disposeIntermediateTensorInfo(sumInput);\n    }\n    return out;\n  }\n});","lineCount":78,"map":[[7,2,21,0,"exports"],[7,9,21,0],[7,10,21,0,"sumImpl"],[7,17,21,0],[7,20,21,0,"sumImpl"],[7,27,21,0],[8,2,17,0],[8,6,17,0,"_tensorflowTfjsCore"],[8,25,17,0],[8,28,17,0,"require"],[8,35,17,0],[8,36,17,0,"_dependencyMap"],[8,50,17,0],[9,2,18,0],[9,6,18,0,"_kernel_utilsReduce"],[9,25,18,0],[9,28,18,0,"require"],[9,35,18,0],[9,36,18,0,"_dependencyMap"],[9,50,18,0],[10,2,19,0],[10,6,19,0,"_Reshape"],[10,14,19,0],[10,17,19,0,"require"],[10,24,19,0],[10,25,19,0,"_dependencyMap"],[10,39,19,0],[11,2,20,0],[11,6,20,0,"_Transpose_impl"],[11,21,20,0],[11,24,20,0,"require"],[11,31,20,0],[11,32,20,0,"_dependencyMap"],[11,46,20,0],[12,2,1,0],[13,0,2,0],[14,0,3,0],[15,0,4,0],[16,0,5,0],[17,0,6,0],[18,0,7,0],[19,0,8,0],[20,0,9,0],[21,0,10,0],[22,0,11,0],[23,0,12,0],[24,0,13,0],[25,0,14,0],[26,0,15,0],[27,0,16,0],[29,2,21,7],[29,11,21,16,"sumImpl"],[29,18,21,23,"sumImpl"],[29,19,21,24,"x"],[29,20,21,25],[29,22,21,27,"axis"],[29,26,21,31],[29,28,21,33,"keepDims"],[29,36,21,41],[29,38,21,43,"backend"],[29,45,21,50],[29,47,21,52],[30,4,22,4],[30,10,22,10,"reductionIndices"],[30,26,22,26],[30,29,22,29,"axis"],[30,33,22,33],[31,4,23,4],[31,10,23,10,"xRank"],[31,15,23,15],[31,18,23,18,"x"],[31,19,23,19],[31,20,23,20,"shape"],[31,25,23,25],[31,26,23,26,"length"],[31,32,23,32],[32,4,24,4],[32,10,24,10,"origAxes"],[32,18,24,18],[32,21,24,21,"util"],[32,40,24,25],[32,41,24,25,"util"],[32,45,24,25],[32,46,24,26,"parseAxisParam"],[32,60,24,40],[32,61,24,41,"reductionIndices"],[32,77,24,57],[32,79,24,59,"x"],[32,80,24,60],[32,81,24,61,"shape"],[32,86,24,66],[32,87,24,67],[33,4,25,4],[33,8,25,8,"axes"],[33,12,25,12],[33,15,25,15,"origAxes"],[33,23,25,23],[34,4,26,4],[34,10,26,10,"permutedAxes"],[34,22,26,22],[34,25,26,25,"backend_util"],[34,44,26,37],[34,45,26,37,"backend_util"],[34,57,26,37],[34,58,26,38,"getAxesPermutation"],[34,76,26,56],[34,77,26,57,"axes"],[34,81,26,61],[34,83,26,63,"xRank"],[34,88,26,68],[34,89,26,69],[35,4,27,4],[35,10,27,10,"sumInputIsTransposed"],[35,30,27,30],[35,33,27,33,"permutedAxes"],[35,45,27,45],[35,49,27,49],[35,53,27,53],[36,4,28,4],[36,8,28,8,"sumInput"],[36,16,28,16],[36,19,28,19,"x"],[36,20,28,20],[37,4,29,4],[37,8,29,8,"sumInputIsTransposed"],[37,28,29,28],[37,30,29,30],[38,6,30,8,"sumInput"],[38,14,30,16],[38,17,30,19],[38,21,30,19,"transposeImpl"],[38,36,30,32],[38,37,30,32,"transposeImpl"],[38,50,30,32],[38,52,30,33,"x"],[38,53,30,34],[38,55,30,36,"permutedAxes"],[38,67,30,48],[38,69,30,50,"backend"],[38,76,30,57],[38,77,30,58],[39,6,31,8,"axes"],[39,10,31,12],[39,13,31,15,"backend_util"],[39,32,31,27],[39,33,31,27,"backend_util"],[39,45,31,27],[39,46,31,28,"getInnerMostAxes"],[39,62,31,44],[39,63,31,45,"axes"],[39,67,31,49],[39,68,31,50,"length"],[39,74,31,56],[39,76,31,58,"xRank"],[39,81,31,63],[39,82,31,64],[40,4,32,4],[41,4,33,4,"backend_util"],[41,23,33,16],[41,24,33,16,"backend_util"],[41,36,33,16],[41,37,33,17,"assertAxesAreInnerMostDims"],[41,63,33,43],[41,64,33,44],[41,69,33,49],[41,71,33,51,"axes"],[41,75,33,55],[41,77,33,57,"xRank"],[41,82,33,62],[41,83,33,63],[42,4,34,4],[42,10,34,10],[42,11,34,11,"sumOutShape"],[42,22,34,22],[42,24,34,24,"reduceShape"],[42,35,34,35],[42,36,34,36],[42,39,34,39,"backend_util"],[42,58,34,51],[42,59,34,51,"backend_util"],[42,71,34,51],[42,72,34,52,"computeOutAndReduceShapes"],[42,97,34,77],[42,98,34,78,"sumInput"],[42,106,34,86],[42,107,34,87,"shape"],[42,112,34,92],[42,114,34,94,"axes"],[42,118,34,98],[42,119,34,99],[43,4,35,4],[43,8,35,8,"outShape"],[43,16,35,16],[43,19,35,19,"sumOutShape"],[43,30,35,30],[44,4,36,4],[44,8,36,8,"keepDims"],[44,16,36,16],[44,18,36,18],[45,6,37,8],[46,6,38,8,"outShape"],[46,14,38,16],[46,17,38,19,"backend_util"],[46,36,38,31],[46,37,38,31,"backend_util"],[46,49,38,31],[46,50,38,32,"expandShapeToKeepDim"],[46,70,38,52],[46,71,38,53,"sumOutShape"],[46,82,38,64],[46,84,38,66,"origAxes"],[46,92,38,74],[46,93,38,75],[47,4,39,4],[48,4,40,4],[48,10,40,10,"inSize"],[48,16,40,16],[48,19,40,19,"util"],[48,38,40,23],[48,39,40,23,"util"],[48,43,40,23],[48,44,40,24,"sizeFromShape"],[48,57,40,37],[48,58,40,38,"reduceShape"],[48,69,40,49],[48,70,40,50],[49,4,41,4],[49,10,41,10,"xSize"],[49,15,41,15],[49,18,41,18,"util"],[49,37,41,22],[49,38,41,22,"util"],[49,42,41,22],[49,43,41,23,"sizeFromShape"],[49,56,41,36],[49,57,41,37,"x"],[49,58,41,38],[49,59,41,39,"shape"],[49,64,41,44],[49,65,41,45],[50,4,42,4],[50,10,42,10,"batchSize"],[50,19,42,19],[50,22,42,22,"xSize"],[50,27,42,27],[50,30,42,30,"inSize"],[50,36,42,36],[51,4,43,4],[51,10,43,10,"reshapedInput"],[51,23,43,23],[51,26,43,26],[51,30,43,26,"reshape"],[51,38,43,33],[51,39,43,33,"reshape"],[51,46,43,33],[51,48,43,34],[52,6,43,36,"inputs"],[52,12,43,42],[52,14,43,44],[53,8,43,46,"x"],[53,9,43,47],[53,11,43,49,"sumInput"],[54,6,43,58],[54,7,43,59],[55,6,43,61,"attrs"],[55,11,43,66],[55,13,43,68],[56,8,43,70,"shape"],[56,13,43,75],[56,15,43,77],[56,16,43,78,"batchSize"],[56,25,43,87],[56,27,43,89,"inSize"],[56,33,43,95],[57,6,43,97],[57,7,43,98],[58,6,43,100,"backend"],[59,4,43,108],[59,5,43,109],[59,6,43,110],[60,4,44,4],[60,10,44,10,"outType"],[60,17,44,17],[60,20,44,20],[60,24,44,20,"sumOutType"],[60,43,44,30],[60,44,44,30,"sumOutType"],[60,54,44,30],[60,56,44,31,"x"],[60,57,44,32],[60,58,44,33,"dtype"],[60,63,44,38],[60,64,44,39],[61,4,45,4],[61,10,45,10,"reduced"],[61,17,45,17],[61,20,45,20],[61,24,45,20,"reduce"],[61,43,45,26],[61,44,45,26,"reduce"],[61,50,45,26],[61,52,45,27,"reshapedInput"],[61,65,45,40],[61,67,45,42,"outType"],[61,74,45,49],[61,76,45,51],[61,81,45,56],[61,83,45,58,"backend"],[61,90,45,65],[61,91,45,66],[62,4,46,4],[62,10,46,10,"out"],[62,13,46,13],[62,16,46,16],[62,20,46,16,"reshape"],[62,28,46,23],[62,29,46,23,"reshape"],[62,36,46,23],[62,38,46,24],[63,6,46,26,"inputs"],[63,12,46,32],[63,14,46,34],[64,8,46,36,"x"],[64,9,46,37],[64,11,46,39,"reduced"],[65,6,46,47],[65,7,46,48],[66,6,46,50,"attrs"],[66,11,46,55],[66,13,46,57],[67,8,46,59,"shape"],[67,13,46,64],[67,15,46,66,"outShape"],[68,6,46,75],[68,7,46,76],[69,6,46,78,"backend"],[70,4,46,86],[70,5,46,87],[70,6,46,88],[71,4,47,4,"backend"],[71,11,47,11],[71,12,47,12,"disposeIntermediateTensorInfo"],[71,41,47,41],[71,42,47,42,"reshapedInput"],[71,55,47,55],[71,56,47,56],[72,4,48,4,"backend"],[72,11,48,11],[72,12,48,12,"disposeIntermediateTensorInfo"],[72,41,48,41],[72,42,48,42,"reduced"],[72,49,48,49],[72,50,48,50],[73,4,49,4],[73,8,49,8,"sumInputIsTransposed"],[73,28,49,28],[73,30,49,30],[74,6,50,8,"backend"],[74,13,50,15],[74,14,50,16,"disposeIntermediateTensorInfo"],[74,43,50,45],[74,44,50,46,"sumInput"],[74,52,50,54],[74,53,50,55],[75,4,51,4],[76,4,52,4],[76,11,52,11,"out"],[76,14,52,14],[77,2,53,0],[78,0,53,1],[78,3]],"functionMap":{"names":["<global>","sumImpl"],"mappings":"AAA;OCoB;CDgC"},"hasCjsExports":false},"type":"js/module"}]}