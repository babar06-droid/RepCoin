{"dependencies":[{"name":"@tensorflow/tfjs-core","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":17,"column":0,"index":703},"end":{"line":17,"column":69,"index":772}}],"key":"qIleUpSDMUXFynEGc51k60/pDSs=","exportNames":["*"],"imports":1}},{"name":"../kernel_utils/shared","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":18,"column":0,"index":773},"end":{"line":18,"column":54,"index":827}}],"key":"JzS9qfQGP0NvwhobUV8d6bPV3h4=","exportNames":["*"],"imports":1}},{"name":"../slice_gpu","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":19,"column":0,"index":828},"end":{"line":19,"column":44,"index":872}}],"key":"zVhw3XcW9YwVcc6tIQAFlwu4Hac=","exportNames":["*"],"imports":1}},{"name":"../slice_packed_gpu","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":20,"column":0,"index":873},"end":{"line":20,"column":57,"index":930}}],"key":"It/IdRX04cU66cTXlihkkPUdVvk=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.slice = slice;\n  Object.defineProperty(exports, \"sliceConfig\", {\n    enumerable: true,\n    get: function () {\n      return sliceConfig;\n    }\n  });\n  var _tensorflowTfjsCore = require(_dependencyMap[0], \"@tensorflow/tfjs-core\");\n  var _kernel_utilsShared = require(_dependencyMap[1], \"../kernel_utils/shared\");\n  var _slice_gpu = require(_dependencyMap[2], \"../slice_gpu\");\n  var _slice_packed_gpu = require(_dependencyMap[3], \"../slice_packed_gpu\");\n  /**\n   * @license\n   * Copyright 2020 Google LLC. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   */\n\n  function shallowSlice(x, begin, size, backend) {\n    const xTexData = backend.texData.get(x.dataId);\n    const t = backend.makeTensorInfo(size, x.dtype);\n    const newTexData = backend.texData.get(t.dataId);\n    // Copy texture data from the original tensor.\n    Object.assign(newTexData, xTexData);\n    newTexData.refCount = 1;\n    newTexData.shape = size;\n    newTexData.dtype = x.dtype;\n    let flatOffset = _tensorflowTfjsCore.slice_util.computeFlatOffset(begin, _tensorflowTfjsCore.util.computeStrides(x.shape));\n    if (xTexData.slice) {\n      // We are slicing an already sliced tensor, so we have to accumulate\n      // the offset.\n      flatOffset += xTexData.slice.flatOffset;\n    }\n    newTexData.slice = {\n      flatOffset,\n      // Point to the original dataId, which is used to do ref counting.\n      origDataId: xTexData.slice && xTexData.slice.origDataId || x.dataId\n    };\n    // Increase the ref count for that data bucket.\n    const refCount = backend.dataRefCount.get(newTexData.slice.origDataId) || 1;\n    backend.dataRefCount.set(newTexData.slice.origDataId, refCount + 1);\n    return t;\n  }\n  function slice(args) {\n    const {\n      inputs,\n      backend,\n      attrs\n    } = args;\n    const {\n      x\n    } = inputs;\n    const {\n      begin,\n      size\n    } = attrs;\n    const [$begin, $size] = _tensorflowTfjsCore.slice_util.parseSliceParams(x, begin, size);\n    _tensorflowTfjsCore.slice_util.assertParamsValid(x, $begin, $size);\n    if (_tensorflowTfjsCore.util.sizeFromShape($size) === 0) {\n      return backend.makeTensorInfo($size, x.dtype, []);\n    }\n    // Run on cpu if dtype is string. For string, the backend represents it\n    // as Uint8Array[], where each Uint8Array is a character. Given that the\n    // computation is only on the outer array, uploading the whole data onto\n    // gpu is wasteful. Also, currently webgl doesn't have a design to\n    // upload and retrieve Uint8Array[] between cpu and gpu. Therefore, we\n    // just run the kernel on cpu if dtype is string.\n    if (backend.shouldExecuteOnCPU([x]) || x.dtype === 'string') {\n      const xTexData = backend.texData.get(x.dataId);\n      const outValues = (0, _kernel_utilsShared.sliceImplCPU)(xTexData.values, $begin, $size, x.shape, x.dtype);\n      return backend.makeTensorInfo($size, x.dtype, outValues);\n    }\n    const {\n      isPacked\n    } = backend.texData.get(x.dataId);\n    const isContinous = _tensorflowTfjsCore.slice_util.isSliceContinous(x.shape, $begin, $size);\n    if (isPacked || !isContinous) {\n      const program = (0, _tensorflowTfjsCore.env)().getBool('WEBGL_PACK_ARRAY_OPERATIONS') ? new _slice_packed_gpu.SlicePackedProgram($size) : new _slice_gpu.SliceProgram($size);\n      const customValues = [$begin];\n      return backend.runWebGLProgram(program, [x], x.dtype, customValues);\n    }\n    backend.uploadToGPU(x.dataId);\n    return shallowSlice(x, $begin, $size, backend);\n  }\n  const sliceConfig = {\n    kernelName: _tensorflowTfjsCore.Slice,\n    backendName: 'webgl',\n    kernelFunc: slice\n  };\n});","lineCount":106,"map":[[7,2,46,0,"exports"],[7,9,46,0],[7,10,46,0,"slice"],[7,15,46,0],[7,18,46,0,"slice"],[7,23,46,0],[8,2,78,0,"Object"],[8,8,78,0],[8,9,78,0,"defineProperty"],[8,23,78,0],[8,24,78,0,"exports"],[8,31,78,0],[9,4,78,0,"enumerable"],[9,14,78,0],[10,4,78,0,"get"],[10,7,78,0],[10,18,78,0,"get"],[10,19,78,0],[11,6,78,0],[11,13,78,0,"sliceConfig"],[11,24,78,0],[12,4,78,0],[13,2,78,0],[14,2,17,0],[14,6,17,0,"_tensorflowTfjsCore"],[14,25,17,0],[14,28,17,0,"require"],[14,35,17,0],[14,36,17,0,"_dependencyMap"],[14,50,17,0],[15,2,18,0],[15,6,18,0,"_kernel_utilsShared"],[15,25,18,0],[15,28,18,0,"require"],[15,35,18,0],[15,36,18,0,"_dependencyMap"],[15,50,18,0],[16,2,19,0],[16,6,19,0,"_slice_gpu"],[16,16,19,0],[16,19,19,0,"require"],[16,26,19,0],[16,27,19,0,"_dependencyMap"],[16,41,19,0],[17,2,20,0],[17,6,20,0,"_slice_packed_gpu"],[17,23,20,0],[17,26,20,0,"require"],[17,33,20,0],[17,34,20,0,"_dependencyMap"],[17,48,20,0],[18,2,1,0],[19,0,2,0],[20,0,3,0],[21,0,4,0],[22,0,5,0],[23,0,6,0],[24,0,7,0],[25,0,8,0],[26,0,9,0],[27,0,10,0],[28,0,11,0],[29,0,12,0],[30,0,13,0],[31,0,14,0],[32,0,15,0],[33,0,16,0],[35,2,21,0],[35,11,21,9,"shallowSlice"],[35,23,21,21,"shallowSlice"],[35,24,21,22,"x"],[35,25,21,23],[35,27,21,25,"begin"],[35,32,21,30],[35,34,21,32,"size"],[35,38,21,36],[35,40,21,38,"backend"],[35,47,21,45],[35,49,21,47],[36,4,22,4],[36,10,22,10,"xTexData"],[36,18,22,18],[36,21,22,21,"backend"],[36,28,22,28],[36,29,22,29,"texData"],[36,36,22,36],[36,37,22,37,"get"],[36,40,22,40],[36,41,22,41,"x"],[36,42,22,42],[36,43,22,43,"dataId"],[36,49,22,49],[36,50,22,50],[37,4,23,4],[37,10,23,10,"t"],[37,11,23,11],[37,14,23,14,"backend"],[37,21,23,21],[37,22,23,22,"makeTensorInfo"],[37,36,23,36],[37,37,23,37,"size"],[37,41,23,41],[37,43,23,43,"x"],[37,44,23,44],[37,45,23,45,"dtype"],[37,50,23,50],[37,51,23,51],[38,4,24,4],[38,10,24,10,"newTexData"],[38,20,24,20],[38,23,24,23,"backend"],[38,30,24,30],[38,31,24,31,"texData"],[38,38,24,38],[38,39,24,39,"get"],[38,42,24,42],[38,43,24,43,"t"],[38,44,24,44],[38,45,24,45,"dataId"],[38,51,24,51],[38,52,24,52],[39,4,25,4],[40,4,26,4,"Object"],[40,10,26,10],[40,11,26,11,"assign"],[40,17,26,17],[40,18,26,18,"newTexData"],[40,28,26,28],[40,30,26,30,"xTexData"],[40,38,26,38],[40,39,26,39],[41,4,27,4,"newTexData"],[41,14,27,14],[41,15,27,15,"refCount"],[41,23,27,23],[41,26,27,26],[41,27,27,27],[42,4,28,4,"newTexData"],[42,14,28,14],[42,15,28,15,"shape"],[42,20,28,20],[42,23,28,23,"size"],[42,27,28,27],[43,4,29,4,"newTexData"],[43,14,29,14],[43,15,29,15,"dtype"],[43,20,29,20],[43,23,29,23,"x"],[43,24,29,24],[43,25,29,25,"dtype"],[43,30,29,30],[44,4,30,4],[44,8,30,8,"flatOffset"],[44,18,30,18],[44,21,30,21,"slice_util"],[44,40,30,31],[44,41,30,31,"slice_util"],[44,51,30,31],[44,52,30,32,"computeFlatOffset"],[44,69,30,49],[44,70,30,50,"begin"],[44,75,30,55],[44,77,30,57,"util"],[44,96,30,61],[44,97,30,61,"util"],[44,101,30,61],[44,102,30,62,"computeStrides"],[44,116,30,76],[44,117,30,77,"x"],[44,118,30,78],[44,119,30,79,"shape"],[44,124,30,84],[44,125,30,85],[44,126,30,86],[45,4,31,4],[45,8,31,8,"xTexData"],[45,16,31,16],[45,17,31,17,"slice"],[45,22,31,22],[45,24,31,24],[46,6,32,8],[47,6,33,8],[48,6,34,8,"flatOffset"],[48,16,34,18],[48,20,34,22,"xTexData"],[48,28,34,30],[48,29,34,31,"slice"],[48,34,34,36],[48,35,34,37,"flatOffset"],[48,45,34,47],[49,4,35,4],[50,4,36,4,"newTexData"],[50,14,36,14],[50,15,36,15,"slice"],[50,20,36,20],[50,23,36,23],[51,6,37,8,"flatOffset"],[51,16,37,18],[52,6,38,8],[53,6,39,8,"origDataId"],[53,16,39,18],[53,18,39,20,"xTexData"],[53,26,39,28],[53,27,39,29,"slice"],[53,32,39,34],[53,36,39,38,"xTexData"],[53,44,39,46],[53,45,39,47,"slice"],[53,50,39,52],[53,51,39,53,"origDataId"],[53,61,39,63],[53,65,39,67,"x"],[53,66,39,68],[53,67,39,69,"dataId"],[54,4,40,4],[54,5,40,5],[55,4,41,4],[56,4,42,4],[56,10,42,10,"refCount"],[56,18,42,18],[56,21,42,21,"backend"],[56,28,42,28],[56,29,42,29,"dataRefCount"],[56,41,42,41],[56,42,42,42,"get"],[56,45,42,45],[56,46,42,46,"newTexData"],[56,56,42,56],[56,57,42,57,"slice"],[56,62,42,62],[56,63,42,63,"origDataId"],[56,73,42,73],[56,74,42,74],[56,78,42,78],[56,79,42,79],[57,4,43,4,"backend"],[57,11,43,11],[57,12,43,12,"dataRefCount"],[57,24,43,24],[57,25,43,25,"set"],[57,28,43,28],[57,29,43,29,"newTexData"],[57,39,43,39],[57,40,43,40,"slice"],[57,45,43,45],[57,46,43,46,"origDataId"],[57,56,43,56],[57,58,43,58,"refCount"],[57,66,43,66],[57,69,43,69],[57,70,43,70],[57,71,43,71],[58,4,44,4],[58,11,44,11,"t"],[58,12,44,12],[59,2,45,0],[60,2,46,7],[60,11,46,16,"slice"],[60,16,46,21,"slice"],[60,17,46,22,"args"],[60,21,46,26],[60,23,46,28],[61,4,47,4],[61,10,47,10],[62,6,47,12,"inputs"],[62,12,47,18],[63,6,47,20,"backend"],[63,13,47,27],[64,6,47,29,"attrs"],[65,4,47,35],[65,5,47,36],[65,8,47,39,"args"],[65,12,47,43],[66,4,48,4],[66,10,48,10],[67,6,48,12,"x"],[68,4,48,14],[68,5,48,15],[68,8,48,18,"inputs"],[68,14,48,24],[69,4,49,4],[69,10,49,10],[70,6,49,12,"begin"],[70,11,49,17],[71,6,49,19,"size"],[72,4,49,24],[72,5,49,25],[72,8,49,28,"attrs"],[72,13,49,33],[73,4,50,4],[73,10,50,10],[73,11,50,11,"$begin"],[73,17,50,17],[73,19,50,19,"$size"],[73,24,50,24],[73,25,50,25],[73,28,50,28,"slice_util"],[73,47,50,38],[73,48,50,38,"slice_util"],[73,58,50,38],[73,59,50,39,"parseSliceParams"],[73,75,50,55],[73,76,50,56,"x"],[73,77,50,57],[73,79,50,59,"begin"],[73,84,50,64],[73,86,50,66,"size"],[73,90,50,70],[73,91,50,71],[74,4,51,4,"slice_util"],[74,23,51,14],[74,24,51,14,"slice_util"],[74,34,51,14],[74,35,51,15,"assertParamsValid"],[74,52,51,32],[74,53,51,33,"x"],[74,54,51,34],[74,56,51,36,"$begin"],[74,62,51,42],[74,64,51,44,"$size"],[74,69,51,49],[74,70,51,50],[75,4,52,4],[75,8,52,8,"util"],[75,27,52,12],[75,28,52,12,"util"],[75,32,52,12],[75,33,52,13,"sizeFromShape"],[75,46,52,26],[75,47,52,27,"$size"],[75,52,52,32],[75,53,52,33],[75,58,52,38],[75,59,52,39],[75,61,52,41],[76,6,53,8],[76,13,53,15,"backend"],[76,20,53,22],[76,21,53,23,"makeTensorInfo"],[76,35,53,37],[76,36,53,38,"$size"],[76,41,53,43],[76,43,53,45,"x"],[76,44,53,46],[76,45,53,47,"dtype"],[76,50,53,52],[76,52,53,54],[76,54,53,56],[76,55,53,57],[77,4,54,4],[78,4,55,4],[79,4,56,4],[80,4,57,4],[81,4,58,4],[82,4,59,4],[83,4,60,4],[84,4,61,4],[84,8,61,8,"backend"],[84,15,61,15],[84,16,61,16,"shouldExecuteOnCPU"],[84,34,61,34],[84,35,61,35],[84,36,61,36,"x"],[84,37,61,37],[84,38,61,38],[84,39,61,39],[84,43,61,43,"x"],[84,44,61,44],[84,45,61,45,"dtype"],[84,50,61,50],[84,55,61,55],[84,63,61,63],[84,65,61,65],[85,6,62,8],[85,12,62,14,"xTexData"],[85,20,62,22],[85,23,62,25,"backend"],[85,30,62,32],[85,31,62,33,"texData"],[85,38,62,40],[85,39,62,41,"get"],[85,42,62,44],[85,43,62,45,"x"],[85,44,62,46],[85,45,62,47,"dataId"],[85,51,62,53],[85,52,62,54],[86,6,63,8],[86,12,63,14,"outValues"],[86,21,63,23],[86,24,63,26],[86,28,63,26,"sliceImplCPU"],[86,47,63,38],[86,48,63,38,"sliceImplCPU"],[86,60,63,38],[86,62,63,39,"xTexData"],[86,70,63,47],[86,71,63,48,"values"],[86,77,63,54],[86,79,63,56,"$begin"],[86,85,63,62],[86,87,63,64,"$size"],[86,92,63,69],[86,94,63,71,"x"],[86,95,63,72],[86,96,63,73,"shape"],[86,101,63,78],[86,103,63,80,"x"],[86,104,63,81],[86,105,63,82,"dtype"],[86,110,63,87],[86,111,63,88],[87,6,64,8],[87,13,64,15,"backend"],[87,20,64,22],[87,21,64,23,"makeTensorInfo"],[87,35,64,37],[87,36,64,38,"$size"],[87,41,64,43],[87,43,64,45,"x"],[87,44,64,46],[87,45,64,47,"dtype"],[87,50,64,52],[87,52,64,54,"outValues"],[87,61,64,63],[87,62,64,64],[88,4,65,4],[89,4,66,4],[89,10,66,10],[90,6,66,12,"isPacked"],[91,4,66,21],[91,5,66,22],[91,8,66,25,"backend"],[91,15,66,32],[91,16,66,33,"texData"],[91,23,66,40],[91,24,66,41,"get"],[91,27,66,44],[91,28,66,45,"x"],[91,29,66,46],[91,30,66,47,"dataId"],[91,36,66,53],[91,37,66,54],[92,4,67,4],[92,10,67,10,"isContinous"],[92,21,67,21],[92,24,67,24,"slice_util"],[92,43,67,34],[92,44,67,34,"slice_util"],[92,54,67,34],[92,55,67,35,"isSliceContinous"],[92,71,67,51],[92,72,67,52,"x"],[92,73,67,53],[92,74,67,54,"shape"],[92,79,67,59],[92,81,67,61,"$begin"],[92,87,67,67],[92,89,67,69,"$size"],[92,94,67,74],[92,95,67,75],[93,4,68,4],[93,8,68,8,"isPacked"],[93,16,68,16],[93,20,68,20],[93,21,68,21,"isContinous"],[93,32,68,32],[93,34,68,34],[94,6,69,8],[94,12,69,14,"program"],[94,19,69,21],[94,22,69,24],[94,26,69,24,"env"],[94,45,69,27],[94,46,69,27,"env"],[94,49,69,27],[94,51,69,28],[94,52,69,29],[94,53,69,30,"getBool"],[94,60,69,37],[94,61,69,38],[94,90,69,67],[94,91,69,68],[94,94,70,12],[94,98,70,16,"SlicePackedProgram"],[94,115,70,34],[94,116,70,34,"SlicePackedProgram"],[94,134,70,34],[94,135,70,35,"$size"],[94,140,70,40],[94,141,70,41],[94,144,71,12],[94,148,71,16,"SliceProgram"],[94,158,71,28],[94,159,71,28,"SliceProgram"],[94,171,71,28],[94,172,71,29,"$size"],[94,177,71,34],[94,178,71,35],[95,6,72,8],[95,12,72,14,"customValues"],[95,24,72,26],[95,27,72,29],[95,28,72,30,"$begin"],[95,34,72,36],[95,35,72,37],[96,6,73,8],[96,13,73,15,"backend"],[96,20,73,22],[96,21,73,23,"runWebGLProgram"],[96,36,73,38],[96,37,73,39,"program"],[96,44,73,46],[96,46,73,48],[96,47,73,49,"x"],[96,48,73,50],[96,49,73,51],[96,51,73,53,"x"],[96,52,73,54],[96,53,73,55,"dtype"],[96,58,73,60],[96,60,73,62,"customValues"],[96,72,73,74],[96,73,73,75],[97,4,74,4],[98,4,75,4,"backend"],[98,11,75,11],[98,12,75,12,"uploadToGPU"],[98,23,75,23],[98,24,75,24,"x"],[98,25,75,25],[98,26,75,26,"dataId"],[98,32,75,32],[98,33,75,33],[99,4,76,4],[99,11,76,11,"shallowSlice"],[99,23,76,23],[99,24,76,24,"x"],[99,25,76,25],[99,27,76,27,"$begin"],[99,33,76,33],[99,35,76,35,"$size"],[99,40,76,40],[99,42,76,42,"backend"],[99,49,76,49],[99,50,76,50],[100,2,77,0],[101,2,78,7],[101,8,78,13,"sliceConfig"],[101,19,78,24],[101,22,78,27],[102,4,79,4,"kernelName"],[102,14,79,14],[102,16,79,16,"Slice"],[102,35,79,21],[102,36,79,21,"Slice"],[102,41,79,21],[103,4,80,4,"backendName"],[103,15,80,15],[103,17,80,17],[103,24,80,24],[104,4,81,4,"kernelFunc"],[104,14,81,14],[104,16,81,16,"slice"],[105,2,82,0],[105,3,82,1],[106,0,82,2],[106,3]],"functionMap":{"names":["<global>","shallowSlice","slice"],"mappings":"AAA;ACoB;CDwB;OEC;CF+B"},"hasCjsExports":false},"type":"js/module"}]}