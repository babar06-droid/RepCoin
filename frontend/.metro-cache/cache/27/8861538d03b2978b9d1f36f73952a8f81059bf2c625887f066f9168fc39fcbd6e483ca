{"dependencies":[],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"AvgPool2DBackpropProgram\", {\n    enumerable: true,\n    get: function () {\n      return AvgPool2DBackpropProgram;\n    }\n  });\n  Object.defineProperty(exports, \"AvgPool3DBackpropProgram\", {\n    enumerable: true,\n    get: function () {\n      return AvgPool3DBackpropProgram;\n    }\n  });\n  /**\n   * @license\n   * Copyright 2017 Google LLC. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   */\n  class AvgPool2DBackpropProgram {\n    constructor(convInfo) {\n      this.variableNames = ['dy'];\n      this.outputShape = convInfo.inShape;\n      const filterHeight = convInfo.filterHeight;\n      const filterWidth = convInfo.filterWidth;\n      const strideHeight = convInfo.strideHeight;\n      const strideWidth = convInfo.strideWidth;\n      const dilationHeight = convInfo.dilationHeight;\n      const dilationWidth = convInfo.dilationWidth;\n      const effectiveFilterHeight = convInfo.effectiveFilterHeight;\n      const effectiveFilterWidth = convInfo.effectiveFilterWidth;\n      const padTop = effectiveFilterHeight - 1 - convInfo.padInfo.top;\n      const padLeft = effectiveFilterWidth - 1 - convInfo.padInfo.left;\n      const avgMultiplier = 1 / (filterHeight * filterWidth);\n      this.userCode = `\n      const ivec2 pads = ivec2(${padTop}, ${padLeft});\n      const float avgMultiplier = float(${avgMultiplier});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${effectiveFilterHeight};\n            wR += ${dilationHeight}) {\n          float dyR = float(dyRCorner + wR) / ${strideHeight}.0;\n\n          if (dyR < 0.0 || dyR >= ${convInfo.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ${effectiveFilterWidth};\n            wC+= ${dilationWidth}) {\n            float dyC = float(dyCCorner + wC) / ${strideWidth}.0;\n\n            if (dyC < 0.0 || dyC >= ${convInfo.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    `;\n    }\n  }\n  class AvgPool3DBackpropProgram {\n    constructor(convInfo) {\n      this.variableNames = ['dy'];\n      this.outputShape = convInfo.inShape;\n      const filterDepth = convInfo.filterDepth;\n      const filterHeight = convInfo.filterHeight;\n      const filterWidth = convInfo.filterWidth;\n      const strideDepth = convInfo.strideDepth;\n      const strideHeight = convInfo.strideHeight;\n      const strideWidth = convInfo.strideWidth;\n      const dilationDepth = convInfo.dilationDepth;\n      const dilationHeight = convInfo.dilationHeight;\n      const dilationWidth = convInfo.dilationWidth;\n      const effectiveFilterDepth = convInfo.effectiveFilterDepth;\n      const effectiveFilterHeight = convInfo.effectiveFilterHeight;\n      const effectiveFilterWidth = convInfo.effectiveFilterWidth;\n      const padFront = effectiveFilterDepth - 1 - convInfo.padInfo.front;\n      const padTop = effectiveFilterHeight - 1 - convInfo.padInfo.top;\n      const padLeft = effectiveFilterWidth - 1 - convInfo.padInfo.left;\n      const avgMultiplier = 1 / (filterDepth * filterHeight * filterWidth);\n      this.userCode = `\n      const ivec3 pads = ivec3(${padFront}, ${padTop}, ${padLeft});\n      const float avgMultiplier = float(${avgMultiplier});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ${effectiveFilterDepth};\n            wD += ${dilationDepth}) {\n          float dyD = float(dyDCorner + wD) / ${strideDepth}.0;\n\n          if (dyD < 0.0 || dyD >= ${convInfo.outDepth}.0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ${effectiveFilterHeight};\n              wR += ${dilationHeight}) {\n            float dyR = float(dyRCorner + wR) / ${strideHeight}.0;\n\n            if (dyR < 0.0 || dyR >= ${convInfo.outHeight}.0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ${effectiveFilterWidth};\n                wC += ${dilationWidth}) {\n              float dyC = float(dyCCorner + wC) / ${strideWidth}.0;\n\n              if (dyC < 0.0 || dyC >= ${convInfo.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `;\n    }\n  }\n});","lineCount":174,"map":[[7,2,17,0,"Object"],[7,8,17,0],[7,9,17,0,"defineProperty"],[7,23,17,0],[7,24,17,0,"exports"],[7,31,17,0],[8,4,17,0,"enumerable"],[8,14,17,0],[9,4,17,0,"get"],[9,7,17,0],[9,18,17,0,"get"],[9,19,17,0],[10,6,17,0],[10,13,17,0,"AvgPool2DBackpropProgram"],[10,37,17,0],[11,4,17,0],[12,2,17,0],[13,2,77,0,"Object"],[13,8,77,0],[13,9,77,0,"defineProperty"],[13,23,77,0],[13,24,77,0,"exports"],[13,31,77,0],[14,4,77,0,"enumerable"],[14,14,77,0],[15,4,77,0,"get"],[15,7,77,0],[15,18,77,0,"get"],[15,19,77,0],[16,6,77,0],[16,13,77,0,"AvgPool3DBackpropProgram"],[16,37,77,0],[17,4,77,0],[18,2,77,0],[19,2,1,0],[20,0,2,0],[21,0,3,0],[22,0,4,0],[23,0,5,0],[24,0,6,0],[25,0,7,0],[26,0,8,0],[27,0,9,0],[28,0,10,0],[29,0,11,0],[30,0,12,0],[31,0,13,0],[32,0,14,0],[33,0,15,0],[34,0,16,0],[35,2,17,7],[35,8,17,13,"AvgPool2DBackpropProgram"],[35,32,17,37],[35,33,17,38],[36,4,18,4,"constructor"],[36,15,18,15,"constructor"],[36,16,18,16,"convInfo"],[36,24,18,24],[36,26,18,26],[37,6,19,8],[37,10,19,12],[37,11,19,13,"variableNames"],[37,24,19,26],[37,27,19,29],[37,28,19,30],[37,32,19,34],[37,33,19,35],[38,6,20,8],[38,10,20,12],[38,11,20,13,"outputShape"],[38,22,20,24],[38,25,20,27,"convInfo"],[38,33,20,35],[38,34,20,36,"inShape"],[38,41,20,43],[39,6,21,8],[39,12,21,14,"filterHeight"],[39,24,21,26],[39,27,21,29,"convInfo"],[39,35,21,37],[39,36,21,38,"filterHeight"],[39,48,21,50],[40,6,22,8],[40,12,22,14,"filterWidth"],[40,23,22,25],[40,26,22,28,"convInfo"],[40,34,22,36],[40,35,22,37,"filterWidth"],[40,46,22,48],[41,6,23,8],[41,12,23,14,"strideHeight"],[41,24,23,26],[41,27,23,29,"convInfo"],[41,35,23,37],[41,36,23,38,"strideHeight"],[41,48,23,50],[42,6,24,8],[42,12,24,14,"strideWidth"],[42,23,24,25],[42,26,24,28,"convInfo"],[42,34,24,36],[42,35,24,37,"strideWidth"],[42,46,24,48],[43,6,25,8],[43,12,25,14,"dilationHeight"],[43,26,25,28],[43,29,25,31,"convInfo"],[43,37,25,39],[43,38,25,40,"dilationHeight"],[43,52,25,54],[44,6,26,8],[44,12,26,14,"dilationWidth"],[44,25,26,27],[44,28,26,30,"convInfo"],[44,36,26,38],[44,37,26,39,"dilationWidth"],[44,50,26,52],[45,6,27,8],[45,12,27,14,"effectiveFilterHeight"],[45,33,27,35],[45,36,27,38,"convInfo"],[45,44,27,46],[45,45,27,47,"effectiveFilterHeight"],[45,66,27,68],[46,6,28,8],[46,12,28,14,"effectiveFilterWidth"],[46,32,28,34],[46,35,28,37,"convInfo"],[46,43,28,45],[46,44,28,46,"effectiveFilterWidth"],[46,64,28,66],[47,6,29,8],[47,12,29,14,"padTop"],[47,18,29,20],[47,21,29,23,"effectiveFilterHeight"],[47,42,29,44],[47,45,29,47],[47,46,29,48],[47,49,29,51,"convInfo"],[47,57,29,59],[47,58,29,60,"padInfo"],[47,65,29,67],[47,66,29,68,"top"],[47,69,29,71],[48,6,30,8],[48,12,30,14,"padLeft"],[48,19,30,21],[48,22,30,24,"effectiveFilterWidth"],[48,42,30,44],[48,45,30,47],[48,46,30,48],[48,49,30,51,"convInfo"],[48,57,30,59],[48,58,30,60,"padInfo"],[48,65,30,67],[48,66,30,68,"left"],[48,70,30,72],[49,6,31,8],[49,12,31,14,"avgMultiplier"],[49,25,31,27],[49,28,31,30],[49,29,31,31],[49,33,31,35,"filterHeight"],[49,45,31,47],[49,48,31,50,"filterWidth"],[49,59,31,61],[49,60,31,62],[50,6,32,8],[50,10,32,12],[50,11,32,13,"userCode"],[50,19,32,21],[50,22,32,24],[51,0,33,0],[51,33,33,33,"padTop"],[51,39,33,39],[51,44,33,44,"padLeft"],[51,51,33,51],[52,0,34,0],[52,42,34,42,"avgMultiplier"],[52,55,34,55],[53,0,35,0],[54,0,36,0],[55,0,37,0],[56,0,38,0],[57,0,39,0],[58,0,40,0],[59,0,41,0],[60,0,42,0],[61,0,43,0],[62,0,44,0],[63,0,45,0],[64,0,46,0],[65,0,47,0],[66,0,48,0],[66,32,48,32,"effectiveFilterHeight"],[66,53,48,53],[67,0,49,0],[67,20,49,20,"dilationHeight"],[67,34,49,34],[68,0,50,0],[68,48,50,48,"strideHeight"],[68,60,50,60],[69,0,51,0],[70,0,52,0],[70,36,52,36,"convInfo"],[70,44,52,44],[70,45,52,45,"outHeight"],[70,54,52,54],[71,0,53,0],[72,0,54,0],[73,0,55,0],[74,0,56,0],[75,0,57,0],[75,34,57,34,"effectiveFilterWidth"],[75,54,57,54],[76,0,58,0],[76,19,58,19,"dilationWidth"],[76,32,58,32],[77,0,59,0],[77,50,59,50,"strideWidth"],[77,61,59,61],[78,0,60,0],[79,0,61,0],[79,38,61,38,"convInfo"],[79,46,61,46],[79,47,61,47,"outWidth"],[79,55,61,55],[80,0,62,0],[81,0,63,0],[82,0,64,0],[83,0,65,0],[84,0,66,0],[85,0,67,0],[86,0,68,0],[87,0,69,0],[88,0,70,0],[89,0,71,0],[90,0,72,0],[91,0,73,0],[92,0,74,0],[92,5,74,5],[93,4,75,4],[94,2,76,0],[95,2,77,7],[95,8,77,13,"AvgPool3DBackpropProgram"],[95,32,77,37],[95,33,77,38],[96,4,78,4,"constructor"],[96,15,78,15,"constructor"],[96,16,78,16,"convInfo"],[96,24,78,24],[96,26,78,26],[97,6,79,8],[97,10,79,12],[97,11,79,13,"variableNames"],[97,24,79,26],[97,27,79,29],[97,28,79,30],[97,32,79,34],[97,33,79,35],[98,6,80,8],[98,10,80,12],[98,11,80,13,"outputShape"],[98,22,80,24],[98,25,80,27,"convInfo"],[98,33,80,35],[98,34,80,36,"inShape"],[98,41,80,43],[99,6,81,8],[99,12,81,14,"filterDepth"],[99,23,81,25],[99,26,81,28,"convInfo"],[99,34,81,36],[99,35,81,37,"filterDepth"],[99,46,81,48],[100,6,82,8],[100,12,82,14,"filterHeight"],[100,24,82,26],[100,27,82,29,"convInfo"],[100,35,82,37],[100,36,82,38,"filterHeight"],[100,48,82,50],[101,6,83,8],[101,12,83,14,"filterWidth"],[101,23,83,25],[101,26,83,28,"convInfo"],[101,34,83,36],[101,35,83,37,"filterWidth"],[101,46,83,48],[102,6,84,8],[102,12,84,14,"strideDepth"],[102,23,84,25],[102,26,84,28,"convInfo"],[102,34,84,36],[102,35,84,37,"strideDepth"],[102,46,84,48],[103,6,85,8],[103,12,85,14,"strideHeight"],[103,24,85,26],[103,27,85,29,"convInfo"],[103,35,85,37],[103,36,85,38,"strideHeight"],[103,48,85,50],[104,6,86,8],[104,12,86,14,"strideWidth"],[104,23,86,25],[104,26,86,28,"convInfo"],[104,34,86,36],[104,35,86,37,"strideWidth"],[104,46,86,48],[105,6,87,8],[105,12,87,14,"dilationDepth"],[105,25,87,27],[105,28,87,30,"convInfo"],[105,36,87,38],[105,37,87,39,"dilationDepth"],[105,50,87,52],[106,6,88,8],[106,12,88,14,"dilationHeight"],[106,26,88,28],[106,29,88,31,"convInfo"],[106,37,88,39],[106,38,88,40,"dilationHeight"],[106,52,88,54],[107,6,89,8],[107,12,89,14,"dilationWidth"],[107,25,89,27],[107,28,89,30,"convInfo"],[107,36,89,38],[107,37,89,39,"dilationWidth"],[107,50,89,52],[108,6,90,8],[108,12,90,14,"effectiveFilterDepth"],[108,32,90,34],[108,35,90,37,"convInfo"],[108,43,90,45],[108,44,90,46,"effectiveFilterDepth"],[108,64,90,66],[109,6,91,8],[109,12,91,14,"effectiveFilterHeight"],[109,33,91,35],[109,36,91,38,"convInfo"],[109,44,91,46],[109,45,91,47,"effectiveFilterHeight"],[109,66,91,68],[110,6,92,8],[110,12,92,14,"effectiveFilterWidth"],[110,32,92,34],[110,35,92,37,"convInfo"],[110,43,92,45],[110,44,92,46,"effectiveFilterWidth"],[110,64,92,66],[111,6,93,8],[111,12,93,14,"padFront"],[111,20,93,22],[111,23,93,25,"effectiveFilterDepth"],[111,43,93,45],[111,46,93,48],[111,47,93,49],[111,50,93,52,"convInfo"],[111,58,93,60],[111,59,93,61,"padInfo"],[111,66,93,68],[111,67,93,69,"front"],[111,72,93,74],[112,6,94,8],[112,12,94,14,"padTop"],[112,18,94,20],[112,21,94,23,"effectiveFilterHeight"],[112,42,94,44],[112,45,94,47],[112,46,94,48],[112,49,94,51,"convInfo"],[112,57,94,59],[112,58,94,60,"padInfo"],[112,65,94,67],[112,66,94,68,"top"],[112,69,94,71],[113,6,95,8],[113,12,95,14,"padLeft"],[113,19,95,21],[113,22,95,24,"effectiveFilterWidth"],[113,42,95,44],[113,45,95,47],[113,46,95,48],[113,49,95,51,"convInfo"],[113,57,95,59],[113,58,95,60,"padInfo"],[113,65,95,67],[113,66,95,68,"left"],[113,70,95,72],[114,6,96,8],[114,12,96,14,"avgMultiplier"],[114,25,96,27],[114,28,96,30],[114,29,96,31],[114,33,96,35,"filterDepth"],[114,44,96,46],[114,47,96,49,"filterHeight"],[114,59,96,61],[114,62,96,64,"filterWidth"],[114,73,96,75],[114,74,96,76],[115,6,97,8],[115,10,97,12],[115,11,97,13,"userCode"],[115,19,97,21],[115,22,97,24],[116,0,98,0],[116,33,98,33,"padFront"],[116,41,98,41],[116,46,98,46,"padTop"],[116,52,98,52],[116,57,98,57,"padLeft"],[116,64,98,64],[117,0,99,0],[117,42,99,42,"avgMultiplier"],[117,55,99,55],[118,0,100,0],[119,0,101,0],[120,0,102,0],[121,0,103,0],[122,0,104,0],[123,0,105,0],[124,0,106,0],[125,0,107,0],[126,0,108,0],[127,0,109,0],[128,0,110,0],[129,0,111,0],[130,0,112,0],[131,0,113,0],[132,0,114,0],[133,0,115,0],[134,0,116,0],[134,32,116,32,"effectiveFilterDepth"],[134,52,116,52],[135,0,117,0],[135,20,117,20,"dilationDepth"],[135,33,117,33],[136,0,118,0],[136,48,118,48,"strideDepth"],[136,59,118,59],[137,0,119,0],[138,0,120,0],[138,36,120,36,"convInfo"],[138,44,120,44],[138,45,120,45,"outDepth"],[138,53,120,53],[139,0,121,0],[140,0,122,0],[141,0,123,0],[142,0,124,0],[143,0,125,0],[143,34,125,34,"effectiveFilterHeight"],[143,55,125,55],[144,0,126,0],[144,22,126,22,"dilationHeight"],[144,36,126,36],[145,0,127,0],[145,50,127,50,"strideHeight"],[145,62,127,62],[146,0,128,0],[147,0,129,0],[147,38,129,38,"convInfo"],[147,46,129,46],[147,47,129,47,"outHeight"],[147,56,129,56],[148,0,130,0],[149,0,131,0],[150,0,132,0],[151,0,133,0],[152,0,134,0],[153,0,135,0],[153,36,135,36,"effectiveFilterWidth"],[153,56,135,56],[154,0,136,0],[154,24,136,24,"dilationWidth"],[154,37,136,37],[155,0,137,0],[155,52,137,52,"strideWidth"],[155,63,137,63],[156,0,138,0],[157,0,139,0],[157,40,139,40,"convInfo"],[157,48,139,48],[157,49,139,49,"outWidth"],[157,57,139,57],[158,0,140,0],[159,0,141,0],[160,0,142,0],[161,0,143,0],[162,0,144,0],[163,0,145,0],[164,0,146,0],[165,0,147,0],[166,0,148,0],[167,0,149,0],[168,0,150,0],[169,0,151,0],[170,0,152,0],[171,0,153,0],[171,5,153,5],[172,4,154,4],[173,2,155,0],[174,0,155,1],[174,3]],"functionMap":{"names":["<global>","AvgPool2DBackpropProgram","AvgPool2DBackpropProgram#constructor","AvgPool3DBackpropProgram","AvgPool3DBackpropProgram#constructor"],"mappings":"AAA;OCgB;ICC;KDyD;CDC;OGC;ICC;KD4E;CHC"},"hasCjsExports":false},"type":"js/module"}]}