{"dependencies":[{"name":"../tensor_util_env","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":17,"column":0,"index":703},"end":{"line":17,"column":53,"index":756}}],"key":"UCKDOr/oOGi3nbD26ZhyAVW61qk=","exportNames":["*"],"imports":1}},{"name":"../util","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":18,"column":0,"index":757},"end":{"line":18,"column":76,"index":833}}],"key":"DTmef1GE5grNQfsvpIzpBlINy9c=","exportNames":["*"],"imports":1}},{"name":"./tensor","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":19,"column":0,"index":834},"end":{"line":19,"column":34,"index":868}}],"key":"kYvdUyp8oamvOrioCW7d9J99xk0=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"inTopKAsync\", {\n    enumerable: true,\n    get: function () {\n      return inTopKAsync;\n    }\n  });\n  var _tensor_util_env = require(_dependencyMap[0], \"../tensor_util_env\");\n  var _util = require(_dependencyMap[1], \"../util\");\n  var _tensor = require(_dependencyMap[2], \"./tensor\");\n  /**\n   * @license\n   * Copyright 2019 Google LLC. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   */\n\n  /**\n   * Returns whether the targets are in the top K predictions.\n   *\n   * ```js\n   * const predictions = tf.tensor2d([[20, 10, 40, 30], [30, 50, -20, 10]]);\n   * const targets = tf.tensor1d([2, 0]);\n   * const precision = await tf.inTopKAsync(predictions, targets);\n   * precision.print();\n   * ```\n   * @param predictions 2-D or higher `tf.Tensor` with last dimension being\n   *     at least `k`.\n   * @param targets 1-D or higher `tf.Tensor`.\n   * @param k Optional Number of top elements to look at for computing precision,\n   *     default to 1.\n   *\n   * @doc {heading: 'Operations', subheading: 'Evaluation'}\n   */\n  async function inTopKAsync_(predictions, targets, k = 1) {\n    const $predictions = (0, _tensor_util_env.convertToTensor)(predictions, 'predictions', 'inTopK');\n    const $targets = (0, _tensor_util_env.convertToTensor)(targets, 'targets', 'inTopK');\n    (0, _util.assert)($predictions.rank > 1, () => 'inTopK() expects the predictions to be of rank 2 or higher, ' + `but got ${$predictions.rank}`);\n    (0, _util.assert)($predictions.rank - 1 === $targets.rank, () => `predictions rank should be 1 larger than ` + `targets rank, but got predictions rank ` + `${$predictions.rank} and targets rank ${$targets.rank}`);\n    (0, _util.assertShapesMatch)($predictions.shape.slice(0, $predictions.shape.length - 1), $targets.shape, `predictions's shape should be align with the targets' shape, ` + 'except the last dimension.');\n    const lastDim = $predictions.shape[$predictions.shape.length - 1];\n    (0, _util.assert)(k > 0 && k <= lastDim, () => `'k' passed to inTopK() must be > 0 && <= the predictions last ` + `dimension (${lastDim}), but got ${k}`);\n    const predictionsVals = await $predictions.data();\n    const targetsVals = await $targets.data();\n    // Reshape predictionsVals into a 2d tensor [batch, lastDim]\n    // and look up topK along lastDim.\n    const [batch, size] = [predictionsVals.length / lastDim, lastDim];\n    const precision = (0, _util.getTypedArrayFromDType)('bool', batch);\n    for (let b = 0; b < batch; b++) {\n      const offset = b * size;\n      const vals = predictionsVals.subarray(offset, offset + size);\n      const valAndInd = [];\n      for (let i = 0; i < vals.length; i++) {\n        valAndInd.push({\n          value: vals[i],\n          index: i\n        });\n      }\n      valAndInd.sort((a, b) => b.value - a.value);\n      precision[b] = 0;\n      for (let i = 0; i < k; i++) {\n        if (valAndInd[i].index === targetsVals[b]) {\n          precision[b] = 1;\n          break;\n        }\n      }\n    }\n    if (predictions !== $predictions) {\n      $predictions.dispose();\n    }\n    if (targets !== $targets) {\n      $targets.dispose();\n    }\n    // Output precision has the same shape as targets.\n    return (0, _tensor.tensor)(precision, $targets.shape, 'bool');\n  }\n  const inTopKAsync = inTopKAsync_;\n});","lineCount":93,"map":[[7,2,81,0,"Object"],[7,8,81,0],[7,9,81,0,"defineProperty"],[7,23,81,0],[7,24,81,0,"exports"],[7,31,81,0],[8,4,81,0,"enumerable"],[8,14,81,0],[9,4,81,0,"get"],[9,7,81,0],[9,18,81,0,"get"],[9,19,81,0],[10,6,81,0],[10,13,81,0,"inTopKAsync"],[10,24,81,0],[11,4,81,0],[12,2,81,0],[13,2,17,0],[13,6,17,0,"_tensor_util_env"],[13,22,17,0],[13,25,17,0,"require"],[13,32,17,0],[13,33,17,0,"_dependencyMap"],[13,47,17,0],[14,2,18,0],[14,6,18,0,"_util"],[14,11,18,0],[14,14,18,0,"require"],[14,21,18,0],[14,22,18,0,"_dependencyMap"],[14,36,18,0],[15,2,19,0],[15,6,19,0,"_tensor"],[15,13,19,0],[15,16,19,0,"require"],[15,23,19,0],[15,24,19,0,"_dependencyMap"],[15,38,19,0],[16,2,1,0],[17,0,2,0],[18,0,3,0],[19,0,4,0],[20,0,5,0],[21,0,6,0],[22,0,7,0],[23,0,8,0],[24,0,9,0],[25,0,10,0],[26,0,11,0],[27,0,12,0],[28,0,13,0],[29,0,14,0],[30,0,15,0],[31,0,16,0],[33,2,20,0],[34,0,21,0],[35,0,22,0],[36,0,23,0],[37,0,24,0],[38,0,25,0],[39,0,26,0],[40,0,27,0],[41,0,28,0],[42,0,29,0],[43,0,30,0],[44,0,31,0],[45,0,32,0],[46,0,33,0],[47,0,34,0],[48,0,35,0],[49,0,36,0],[50,2,37,0],[50,17,37,15,"inTopKAsync_"],[50,29,37,27,"inTopKAsync_"],[50,30,37,28,"predictions"],[50,41,37,39],[50,43,37,41,"targets"],[50,50,37,48],[50,52,37,50,"k"],[50,53,37,51],[50,56,37,54],[50,57,37,55],[50,59,37,57],[51,4,38,4],[51,10,38,10,"$predictions"],[51,22,38,22],[51,25,38,25],[51,29,38,25,"convertToTensor"],[51,45,38,40],[51,46,38,40,"convertToTensor"],[51,61,38,40],[51,63,38,41,"predictions"],[51,74,38,52],[51,76,38,54],[51,89,38,67],[51,91,38,69],[51,99,38,77],[51,100,38,78],[52,4,39,4],[52,10,39,10,"$targets"],[52,18,39,18],[52,21,39,21],[52,25,39,21,"convertToTensor"],[52,41,39,36],[52,42,39,36,"convertToTensor"],[52,57,39,36],[52,59,39,37,"targets"],[52,66,39,44],[52,68,39,46],[52,77,39,55],[52,79,39,57],[52,87,39,65],[52,88,39,66],[53,4,40,4],[53,8,40,4,"assert"],[53,13,40,10],[53,14,40,10,"assert"],[53,20,40,10],[53,22,40,11,"$predictions"],[53,34,40,23],[53,35,40,24,"rank"],[53,39,40,28],[53,42,40,31],[53,43,40,32],[53,45,40,34],[53,51,40,40],[53,113,40,102],[53,116,41,8],[53,127,41,19,"$predictions"],[53,139,41,31],[53,140,41,32,"rank"],[53,144,41,36],[53,146,41,38],[53,147,41,39],[54,4,42,4],[54,8,42,4,"assert"],[54,13,42,10],[54,14,42,10,"assert"],[54,20,42,10],[54,22,42,11,"$predictions"],[54,34,42,23],[54,35,42,24,"rank"],[54,39,42,28],[54,42,42,31],[54,43,42,32],[54,48,42,37,"$targets"],[54,56,42,45],[54,57,42,46,"rank"],[54,61,42,50],[54,63,42,52],[54,69,42,58],[54,112,42,101],[54,115,43,8],[54,156,43,49],[54,159,44,8],[54,162,44,11,"$predictions"],[54,174,44,23],[54,175,44,24,"rank"],[54,179,44,28],[54,200,44,49,"$targets"],[54,208,44,57],[54,209,44,58,"rank"],[54,213,44,62],[54,215,44,64],[54,216,44,65],[55,4,45,4],[55,8,45,4,"assertShapesMatch"],[55,13,45,21],[55,14,45,21,"assertShapesMatch"],[55,31,45,21],[55,33,45,22,"$predictions"],[55,45,45,34],[55,46,45,35,"shape"],[55,51,45,40],[55,52,45,41,"slice"],[55,57,45,46],[55,58,45,47],[55,59,45,48],[55,61,45,50,"$predictions"],[55,73,45,62],[55,74,45,63,"shape"],[55,79,45,68],[55,80,45,69,"length"],[55,86,45,75],[55,89,45,78],[55,90,45,79],[55,91,45,80],[55,93,45,82,"$targets"],[55,101,45,90],[55,102,45,91,"shape"],[55,107,45,96],[55,109,45,98],[55,172,45,161],[55,175,46,8],[55,203,46,36],[55,204,46,37],[56,4,47,4],[56,10,47,10,"lastDim"],[56,17,47,17],[56,20,47,20,"$predictions"],[56,32,47,32],[56,33,47,33,"shape"],[56,38,47,38],[56,39,47,39,"$predictions"],[56,51,47,51],[56,52,47,52,"shape"],[56,57,47,57],[56,58,47,58,"length"],[56,64,47,64],[56,67,47,67],[56,68,47,68],[56,69,47,69],[57,4,48,4],[57,8,48,4,"assert"],[57,13,48,10],[57,14,48,10,"assert"],[57,20,48,10],[57,22,48,11,"k"],[57,23,48,12],[57,26,48,15],[57,27,48,16],[57,31,48,20,"k"],[57,32,48,21],[57,36,48,25,"lastDim"],[57,43,48,32],[57,45,48,34],[57,51,48,40],[57,115,48,104],[57,118,49,8],[57,132,49,22,"lastDim"],[57,139,49,29],[57,153,49,43,"k"],[57,154,49,44],[57,156,49,46],[57,157,49,47],[58,4,50,4],[58,10,50,10,"predictionsVals"],[58,25,50,25],[58,28,50,28],[58,34,50,34,"$predictions"],[58,46,50,46],[58,47,50,47,"data"],[58,51,50,51],[58,52,50,52],[58,53,50,53],[59,4,51,4],[59,10,51,10,"targetsVals"],[59,21,51,21],[59,24,51,24],[59,30,51,30,"$targets"],[59,38,51,38],[59,39,51,39,"data"],[59,43,51,43],[59,44,51,44],[59,45,51,45],[60,4,52,4],[61,4,53,4],[62,4,54,4],[62,10,54,10],[62,11,54,11,"batch"],[62,16,54,16],[62,18,54,18,"size"],[62,22,54,22],[62,23,54,23],[62,26,54,26],[62,27,54,27,"predictionsVals"],[62,42,54,42],[62,43,54,43,"length"],[62,49,54,49],[62,52,54,52,"lastDim"],[62,59,54,59],[62,61,54,61,"lastDim"],[62,68,54,68],[62,69,54,69],[63,4,55,4],[63,10,55,10,"precision"],[63,19,55,19],[63,22,55,22],[63,26,55,22,"getTypedArrayFromDType"],[63,31,55,44],[63,32,55,44,"getTypedArrayFromDType"],[63,54,55,44],[63,56,55,45],[63,62,55,51],[63,64,55,53,"batch"],[63,69,55,58],[63,70,55,59],[64,4,56,4],[64,9,56,9],[64,13,56,13,"b"],[64,14,56,14],[64,17,56,17],[64,18,56,18],[64,20,56,20,"b"],[64,21,56,21],[64,24,56,24,"batch"],[64,29,56,29],[64,31,56,31,"b"],[64,32,56,32],[64,34,56,34],[64,36,56,36],[65,6,57,8],[65,12,57,14,"offset"],[65,18,57,20],[65,21,57,23,"b"],[65,22,57,24],[65,25,57,27,"size"],[65,29,57,31],[66,6,58,8],[66,12,58,14,"vals"],[66,16,58,18],[66,19,58,21,"predictionsVals"],[66,34,58,36],[66,35,58,37,"subarray"],[66,43,58,45],[66,44,58,46,"offset"],[66,50,58,52],[66,52,58,54,"offset"],[66,58,58,60],[66,61,58,63,"size"],[66,65,58,67],[66,66,58,68],[67,6,59,8],[67,12,59,14,"valAndInd"],[67,21,59,23],[67,24,59,26],[67,26,59,28],[68,6,60,8],[68,11,60,13],[68,15,60,17,"i"],[68,16,60,18],[68,19,60,21],[68,20,60,22],[68,22,60,24,"i"],[68,23,60,25],[68,26,60,28,"vals"],[68,30,60,32],[68,31,60,33,"length"],[68,37,60,39],[68,39,60,41,"i"],[68,40,60,42],[68,42,60,44],[68,44,60,46],[69,8,61,12,"valAndInd"],[69,17,61,21],[69,18,61,22,"push"],[69,22,61,26],[69,23,61,27],[70,10,61,29,"value"],[70,15,61,34],[70,17,61,36,"vals"],[70,21,61,40],[70,22,61,41,"i"],[70,23,61,42],[70,24,61,43],[71,10,61,45,"index"],[71,15,61,50],[71,17,61,52,"i"],[72,8,61,54],[72,9,61,55],[72,10,61,56],[73,6,62,8],[74,6,63,8,"valAndInd"],[74,15,63,17],[74,16,63,18,"sort"],[74,20,63,22],[74,21,63,23],[74,22,63,24,"a"],[74,23,63,25],[74,25,63,27,"b"],[74,26,63,28],[74,31,63,33,"b"],[74,32,63,34],[74,33,63,35,"value"],[74,38,63,40],[74,41,63,43,"a"],[74,42,63,44],[74,43,63,45,"value"],[74,48,63,50],[74,49,63,51],[75,6,64,8,"precision"],[75,15,64,17],[75,16,64,18,"b"],[75,17,64,19],[75,18,64,20],[75,21,64,23],[75,22,64,24],[76,6,65,8],[76,11,65,13],[76,15,65,17,"i"],[76,16,65,18],[76,19,65,21],[76,20,65,22],[76,22,65,24,"i"],[76,23,65,25],[76,26,65,28,"k"],[76,27,65,29],[76,29,65,31,"i"],[76,30,65,32],[76,32,65,34],[76,34,65,36],[77,8,66,12],[77,12,66,16,"valAndInd"],[77,21,66,25],[77,22,66,26,"i"],[77,23,66,27],[77,24,66,28],[77,25,66,29,"index"],[77,30,66,34],[77,35,66,39,"targetsVals"],[77,46,66,50],[77,47,66,51,"b"],[77,48,66,52],[77,49,66,53],[77,51,66,55],[78,10,67,16,"precision"],[78,19,67,25],[78,20,67,26,"b"],[78,21,67,27],[78,22,67,28],[78,25,67,31],[78,26,67,32],[79,10,68,16],[80,8,69,12],[81,6,70,8],[82,4,71,4],[83,4,72,4],[83,8,72,8,"predictions"],[83,19,72,19],[83,24,72,24,"$predictions"],[83,36,72,36],[83,38,72,38],[84,6,73,8,"$predictions"],[84,18,73,20],[84,19,73,21,"dispose"],[84,26,73,28],[84,27,73,29],[84,28,73,30],[85,4,74,4],[86,4,75,4],[86,8,75,8,"targets"],[86,15,75,15],[86,20,75,20,"$targets"],[86,28,75,28],[86,30,75,30],[87,6,76,8,"$targets"],[87,14,76,16],[87,15,76,17,"dispose"],[87,22,76,24],[87,23,76,25],[87,24,76,26],[88,4,77,4],[89,4,78,4],[90,4,79,4],[90,11,79,11],[90,15,79,11,"tensor"],[90,22,79,17],[90,23,79,17,"tensor"],[90,29,79,17],[90,31,79,18,"precision"],[90,40,79,27],[90,42,79,29,"$targets"],[90,50,79,37],[90,51,79,38,"shape"],[90,56,79,43],[90,58,79,45],[90,64,79,51],[90,65,79,52],[91,2,80,0],[92,2,81,7],[92,8,81,13,"inTopKAsync"],[92,19,81,24],[92,22,81,27,"inTopKAsync_"],[92,34,81,39],[93,0,81,40],[93,3]],"functionMap":{"names":["<global>","inTopKAsync_","assert$argument_1","valAndInd.sort$argument_0"],"mappings":"AAA;ACoC;kCCG;sCDC;oDCC;gEDE;kCCI;8CDC;uBEc,2BF;CDiB"},"hasCjsExports":false},"type":"js/module"}]}