{"dependencies":[{"name":"@tensorflow/tfjs-core","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":17,"column":0,"index":703},"end":{"line":17,"column":59,"index":762}}],"key":"qIleUpSDMUXFynEGc51k60/pDSs=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.uniqueImpl = uniqueImpl;\n  var _tensorflowTfjsCore = require(_dependencyMap[0], \"@tensorflow/tfjs-core\");\n  /**\n   * @license\n   * Copyright 2020 Google LLC. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   */\n\n  function uniqueImpl(values, axis, shape, dtype) {\n    // Normalize and validate axis.\n    const $axis = _tensorflowTfjsCore.util.parseAxisParam(axis, shape)[0];\n    // Calculate the new shape that is suitable for extracting data along the\n    // given axis.\n    //\n    // The rank is 3.\n    // The size of the 1st dimension is the size of all the axes < the given axis.\n    // The size of the 2nd dimension is the same as the size of the given axis.\n    // The size of the 3rd dimension is the size of all the axes > the given axis.\n    //\n    // For example, for a 4D tensor with shape=[2, 3, 5, 4] and axis=2, the\n    // newShape would be: [2*3, 5, 4].\n    //\n    // Note that this is not the final output shape. This will be the shape for an\n    // intermediate TensorBuffer (see inputBuffer below) to allow us to extract\n    // values along the given axis. To demonstrate how it works, consider the\n    // following example:\n    //\n    // Input: a 3D tensor, with shape [1, 2, 3]\n    // [\n    //   [\n    //      [1,2,3],\n    //      [4,5,6]\n    //   ]\n    // ]\n    // Axis: 2 (the last axis).\n    // Along axis 2, we expect to extract 3 tensors: [1,4], [2,5], [3,6].\n    //\n    // For this example, newShape would be: [2, 3, 1], where 2 is calculated from\n    // 1*2. The re-shaped data would look like:\n    //\n    // [\n    //   [\n    //     [1], [2], [3]\n    //   ],\n    //   [\n    //     [4], [5], [6]\n    //   ]\n    // ]\n    //\n    // Then, we can construct a 3-level nested loop by the following dimension\n    // order to extract the values along the axis (dimension1):\n    // i: dimension1       // 0,1,2 (newShape[1])\n    //   m: dimension0     // 0,1   (newShape[0])\n    //     n: dimension2   // 0     (newShape[2])\n    //\n    //                       m, i, n\n    //                      ---------\n    // Iteration 0: data at [0, 0, 0] => \"1\"\n    // Iteration 1: data at [1, 0, 0] => \"4\"\n    // We got [1,4].\n    // Iteration 2: data at [0, 1, 0] => \"2\"\n    // Iteration 3: data at [1, 1, 0] => \"5\"\n    // We got [2,5].\n    // Iteration 4: data at [0, 2, 0] => \"3\"\n    // Iteration 5: data at [1, 2, 0] => \"6\"\n    // We got [3,6].\n    const newShape = [1, shape[0], 1];\n    for (let i = 0; i < $axis; i++) {\n      newShape[0] *= shape[i];\n    }\n    newShape[1] = shape[$axis];\n    for (let i = $axis + 1; i < shape.length; i++) {\n      newShape[2] *= shape[i];\n    }\n    // A map from unique elements (their string representations) to their values\n    // in \"indices\" (below).\n    const uniqueElements = new Map();\n    // The indices of each unique element in the original tensor along the given\n    // axis. It is 1D and has the same size as the given axis.\n    const indices = new Int32Array(shape[$axis]);\n    // Create a buffer so we can easily extract value at a given location.\n    const inputBuffer = new _tensorflowTfjsCore.TensorBuffer(newShape, dtype, values);\n    // The indices along the given axis that have unique elements. This is a\n    // de-duped version of \"indices\" above.\n    const uniqueIndices = [];\n    const is1DTensor = newShape[0] === 1 && newShape[2] === 1;\n    for (let i = 0; i < shape[$axis]; i++) {\n      // Extract values along the axis.\n      let element;\n      if (is1DTensor) {\n        // Fast path for 1D tensor input.\n        element = values[i].toString();\n      } else {\n        const axisValues = [];\n        for (let m = 0; m < newShape[0]; m++) {\n          for (let n = 0; n < newShape[2]; n++) {\n            axisValues.push(inputBuffer.get(m, i, n));\n          }\n        }\n        element = axisValues.join(',');\n      }\n      // Dedup and update various indices.\n      const existingIndex = uniqueElements.get(element);\n      if (existingIndex != null) {\n        indices[i] = existingIndex;\n      } else {\n        const uniqueIndex = uniqueElements.size;\n        uniqueElements.set(element, uniqueIndex);\n        indices[i] = uniqueIndex;\n        uniqueIndices.push(i);\n      }\n    }\n    // Now we know where each of the unique elements are located along the axis\n    // (uniqueIndices). Extract them from input buffer and store them in the\n    // output buffer.\n    const outputTmpShape = newShape.slice();\n    outputTmpShape[1] = uniqueElements.size;\n    const outputBuffer = new _tensorflowTfjsCore.TensorBuffer(outputTmpShape, dtype);\n    uniqueIndices.forEach((uniqueElementIndex, i) => {\n      for (let m = 0; m < newShape[0]; m++) {\n        for (let n = 0; n < newShape[2]; n++) {\n          outputBuffer.set(inputBuffer.get(m, uniqueElementIndex, n), m, i, n);\n        }\n      }\n    });\n    // The output shape can be calculated from the input shape with the size of\n    // the given axis replaced by the number of unique elements along that axis.\n    const outputShape = shape.slice();\n    outputShape[$axis] = outputTmpShape[1];\n    return {\n      outputValues: outputBuffer.values,\n      outputShape,\n      indices\n    };\n  }\n});","lineCount":153,"map":[[7,2,18,0,"exports"],[7,9,18,0],[7,10,18,0,"uniqueImpl"],[7,20,18,0],[7,23,18,0,"uniqueImpl"],[7,33,18,0],[8,2,17,0],[8,6,17,0,"_tensorflowTfjsCore"],[8,25,17,0],[8,28,17,0,"require"],[8,35,17,0],[8,36,17,0,"_dependencyMap"],[8,50,17,0],[9,2,1,0],[10,0,2,0],[11,0,3,0],[12,0,4,0],[13,0,5,0],[14,0,6,0],[15,0,7,0],[16,0,8,0],[17,0,9,0],[18,0,10,0],[19,0,11,0],[20,0,12,0],[21,0,13,0],[22,0,14,0],[23,0,15,0],[24,0,16,0],[26,2,18,7],[26,11,18,16,"uniqueImpl"],[26,21,18,26,"uniqueImpl"],[26,22,18,27,"values"],[26,28,18,33],[26,30,18,35,"axis"],[26,34,18,39],[26,36,18,41,"shape"],[26,41,18,46],[26,43,18,48,"dtype"],[26,48,18,53],[26,50,18,55],[27,4,19,4],[28,4,20,4],[28,10,20,10,"$axis"],[28,15,20,15],[28,18,20,18,"util"],[28,37,20,22],[28,38,20,22,"util"],[28,42,20,22],[28,43,20,23,"parseAxisParam"],[28,57,20,37],[28,58,20,38,"axis"],[28,62,20,42],[28,64,20,44,"shape"],[28,69,20,49],[28,70,20,50],[28,71,20,51],[28,72,20,52],[28,73,20,53],[29,4,21,4],[30,4,22,4],[31,4,23,4],[32,4,24,4],[33,4,25,4],[34,4,26,4],[35,4,27,4],[36,4,28,4],[37,4,29,4],[38,4,30,4],[39,4,31,4],[40,4,32,4],[41,4,33,4],[42,4,34,4],[43,4,35,4],[44,4,36,4],[45,4,37,4],[46,4,38,4],[47,4,39,4],[48,4,40,4],[49,4,41,4],[50,4,42,4],[51,4,43,4],[52,4,44,4],[53,4,45,4],[54,4,46,4],[55,4,47,4],[56,4,48,4],[57,4,49,4],[58,4,50,4],[59,4,51,4],[60,4,52,4],[61,4,53,4],[62,4,54,4],[63,4,55,4],[64,4,56,4],[65,4,57,4],[66,4,58,4],[67,4,59,4],[68,4,60,4],[69,4,61,4],[70,4,62,4],[71,4,63,4],[72,4,64,4],[73,4,65,4],[74,4,66,4],[75,4,67,4],[76,4,68,4],[77,4,69,4],[78,4,70,4],[79,4,71,4],[80,4,72,4],[81,4,73,4],[82,4,74,4],[83,4,75,4],[84,4,76,4],[84,10,76,10,"newShape"],[84,18,76,18],[84,21,76,21],[84,22,76,22],[84,23,76,23],[84,25,76,25,"shape"],[84,30,76,30],[84,31,76,31],[84,32,76,32],[84,33,76,33],[84,35,76,35],[84,36,76,36],[84,37,76,37],[85,4,77,4],[85,9,77,9],[85,13,77,13,"i"],[85,14,77,14],[85,17,77,17],[85,18,77,18],[85,20,77,20,"i"],[85,21,77,21],[85,24,77,24,"$axis"],[85,29,77,29],[85,31,77,31,"i"],[85,32,77,32],[85,34,77,34],[85,36,77,36],[86,6,78,8,"newShape"],[86,14,78,16],[86,15,78,17],[86,16,78,18],[86,17,78,19],[86,21,78,23,"shape"],[86,26,78,28],[86,27,78,29,"i"],[86,28,78,30],[86,29,78,31],[87,4,79,4],[88,4,80,4,"newShape"],[88,12,80,12],[88,13,80,13],[88,14,80,14],[88,15,80,15],[88,18,80,18,"shape"],[88,23,80,23],[88,24,80,24,"$axis"],[88,29,80,29],[88,30,80,30],[89,4,81,4],[89,9,81,9],[89,13,81,13,"i"],[89,14,81,14],[89,17,81,17,"$axis"],[89,22,81,22],[89,25,81,25],[89,26,81,26],[89,28,81,28,"i"],[89,29,81,29],[89,32,81,32,"shape"],[89,37,81,37],[89,38,81,38,"length"],[89,44,81,44],[89,46,81,46,"i"],[89,47,81,47],[89,49,81,49],[89,51,81,51],[90,6,82,8,"newShape"],[90,14,82,16],[90,15,82,17],[90,16,82,18],[90,17,82,19],[90,21,82,23,"shape"],[90,26,82,28],[90,27,82,29,"i"],[90,28,82,30],[90,29,82,31],[91,4,83,4],[92,4,84,4],[93,4,85,4],[94,4,86,4],[94,10,86,10,"uniqueElements"],[94,24,86,24],[94,27,86,27],[94,31,86,31,"Map"],[94,34,86,34],[94,35,86,35],[94,36,86,36],[95,4,87,4],[96,4,88,4],[97,4,89,4],[97,10,89,10,"indices"],[97,17,89,17],[97,20,89,20],[97,24,89,24,"Int32Array"],[97,34,89,34],[97,35,89,35,"shape"],[97,40,89,40],[97,41,89,41,"$axis"],[97,46,89,46],[97,47,89,47],[97,48,89,48],[98,4,90,4],[99,4,91,4],[99,10,91,10,"inputBuffer"],[99,21,91,21],[99,24,91,24],[99,28,91,28,"TensorBuffer"],[99,47,91,40],[99,48,91,40,"TensorBuffer"],[99,60,91,40],[99,61,91,41,"newShape"],[99,69,91,49],[99,71,91,51,"dtype"],[99,76,91,56],[99,78,91,58,"values"],[99,84,91,64],[99,85,91,65],[100,4,92,4],[101,4,93,4],[102,4,94,4],[102,10,94,10,"uniqueIndices"],[102,23,94,23],[102,26,94,26],[102,28,94,28],[103,4,95,4],[103,10,95,10,"is1DTensor"],[103,20,95,20],[103,23,95,23,"newShape"],[103,31,95,31],[103,32,95,32],[103,33,95,33],[103,34,95,34],[103,39,95,39],[103,40,95,40],[103,44,95,44,"newShape"],[103,52,95,52],[103,53,95,53],[103,54,95,54],[103,55,95,55],[103,60,95,60],[103,61,95,61],[104,4,96,4],[104,9,96,9],[104,13,96,13,"i"],[104,14,96,14],[104,17,96,17],[104,18,96,18],[104,20,96,20,"i"],[104,21,96,21],[104,24,96,24,"shape"],[104,29,96,29],[104,30,96,30,"$axis"],[104,35,96,35],[104,36,96,36],[104,38,96,38,"i"],[104,39,96,39],[104,41,96,41],[104,43,96,43],[105,6,97,8],[106,6,98,8],[106,10,98,12,"element"],[106,17,98,19],[107,6,99,8],[107,10,99,12,"is1DTensor"],[107,20,99,22],[107,22,99,24],[108,8,100,12],[109,8,101,12,"element"],[109,15,101,19],[109,18,101,22,"values"],[109,24,101,28],[109,25,101,29,"i"],[109,26,101,30],[109,27,101,31],[109,28,101,32,"toString"],[109,36,101,40],[109,37,101,41],[109,38,101,42],[110,6,102,8],[110,7,102,9],[110,13,103,13],[111,8,104,12],[111,14,104,18,"axisValues"],[111,24,104,28],[111,27,104,31],[111,29,104,33],[112,8,105,12],[112,13,105,17],[112,17,105,21,"m"],[112,18,105,22],[112,21,105,25],[112,22,105,26],[112,24,105,28,"m"],[112,25,105,29],[112,28,105,32,"newShape"],[112,36,105,40],[112,37,105,41],[112,38,105,42],[112,39,105,43],[112,41,105,45,"m"],[112,42,105,46],[112,44,105,48],[112,46,105,50],[113,10,106,16],[113,15,106,21],[113,19,106,25,"n"],[113,20,106,26],[113,23,106,29],[113,24,106,30],[113,26,106,32,"n"],[113,27,106,33],[113,30,106,36,"newShape"],[113,38,106,44],[113,39,106,45],[113,40,106,46],[113,41,106,47],[113,43,106,49,"n"],[113,44,106,50],[113,46,106,52],[113,48,106,54],[114,12,107,20,"axisValues"],[114,22,107,30],[114,23,107,31,"push"],[114,27,107,35],[114,28,107,36,"inputBuffer"],[114,39,107,47],[114,40,107,48,"get"],[114,43,107,51],[114,44,107,52,"m"],[114,45,107,53],[114,47,107,55,"i"],[114,48,107,56],[114,50,107,58,"n"],[114,51,107,59],[114,52,107,60],[114,53,107,61],[115,10,108,16],[116,8,109,12],[117,8,110,12,"element"],[117,15,110,19],[117,18,110,22,"axisValues"],[117,28,110,32],[117,29,110,33,"join"],[117,33,110,37],[117,34,110,38],[117,37,110,41],[117,38,110,42],[118,6,111,8],[119,6,112,8],[120,6,113,8],[120,12,113,14,"existingIndex"],[120,25,113,27],[120,28,113,30,"uniqueElements"],[120,42,113,44],[120,43,113,45,"get"],[120,46,113,48],[120,47,113,49,"element"],[120,54,113,56],[120,55,113,57],[121,6,114,8],[121,10,114,12,"existingIndex"],[121,23,114,25],[121,27,114,29],[121,31,114,33],[121,33,114,35],[122,8,115,12,"indices"],[122,15,115,19],[122,16,115,20,"i"],[122,17,115,21],[122,18,115,22],[122,21,115,25,"existingIndex"],[122,34,115,38],[123,6,116,8],[123,7,116,9],[123,13,117,13],[124,8,118,12],[124,14,118,18,"uniqueIndex"],[124,25,118,29],[124,28,118,32,"uniqueElements"],[124,42,118,46],[124,43,118,47,"size"],[124,47,118,51],[125,8,119,12,"uniqueElements"],[125,22,119,26],[125,23,119,27,"set"],[125,26,119,30],[125,27,119,31,"element"],[125,34,119,38],[125,36,119,40,"uniqueIndex"],[125,47,119,51],[125,48,119,52],[126,8,120,12,"indices"],[126,15,120,19],[126,16,120,20,"i"],[126,17,120,21],[126,18,120,22],[126,21,120,25,"uniqueIndex"],[126,32,120,36],[127,8,121,12,"uniqueIndices"],[127,21,121,25],[127,22,121,26,"push"],[127,26,121,30],[127,27,121,31,"i"],[127,28,121,32],[127,29,121,33],[128,6,122,8],[129,4,123,4],[130,4,124,4],[131,4,125,4],[132,4,126,4],[133,4,127,4],[133,10,127,10,"outputTmpShape"],[133,24,127,24],[133,27,127,27,"newShape"],[133,35,127,35],[133,36,127,36,"slice"],[133,41,127,41],[133,42,127,42],[133,43,127,43],[134,4,128,4,"outputTmpShape"],[134,18,128,18],[134,19,128,19],[134,20,128,20],[134,21,128,21],[134,24,128,24,"uniqueElements"],[134,38,128,38],[134,39,128,39,"size"],[134,43,128,43],[135,4,129,4],[135,10,129,10,"outputBuffer"],[135,22,129,22],[135,25,129,25],[135,29,129,29,"TensorBuffer"],[135,48,129,41],[135,49,129,41,"TensorBuffer"],[135,61,129,41],[135,62,129,42,"outputTmpShape"],[135,76,129,56],[135,78,129,58,"dtype"],[135,83,129,63],[135,84,129,64],[136,4,130,4,"uniqueIndices"],[136,17,130,17],[136,18,130,18,"forEach"],[136,25,130,25],[136,26,130,26],[136,27,130,27,"uniqueElementIndex"],[136,45,130,45],[136,47,130,47,"i"],[136,48,130,48],[136,53,130,53],[137,6,131,8],[137,11,131,13],[137,15,131,17,"m"],[137,16,131,18],[137,19,131,21],[137,20,131,22],[137,22,131,24,"m"],[137,23,131,25],[137,26,131,28,"newShape"],[137,34,131,36],[137,35,131,37],[137,36,131,38],[137,37,131,39],[137,39,131,41,"m"],[137,40,131,42],[137,42,131,44],[137,44,131,46],[138,8,132,12],[138,13,132,17],[138,17,132,21,"n"],[138,18,132,22],[138,21,132,25],[138,22,132,26],[138,24,132,28,"n"],[138,25,132,29],[138,28,132,32,"newShape"],[138,36,132,40],[138,37,132,41],[138,38,132,42],[138,39,132,43],[138,41,132,45,"n"],[138,42,132,46],[138,44,132,48],[138,46,132,50],[139,10,133,16,"outputBuffer"],[139,22,133,28],[139,23,133,29,"set"],[139,26,133,32],[139,27,133,33,"inputBuffer"],[139,38,133,44],[139,39,133,45,"get"],[139,42,133,48],[139,43,133,49,"m"],[139,44,133,50],[139,46,133,52,"uniqueElementIndex"],[139,64,133,70],[139,66,133,72,"n"],[139,67,133,73],[139,68,133,74],[139,70,133,76,"m"],[139,71,133,77],[139,73,133,79,"i"],[139,74,133,80],[139,76,133,82,"n"],[139,77,133,83],[139,78,133,84],[140,8,134,12],[141,6,135,8],[142,4,136,4],[142,5,136,5],[142,6,136,6],[143,4,137,4],[144,4,138,4],[145,4,139,4],[145,10,139,10,"outputShape"],[145,21,139,21],[145,24,139,24,"shape"],[145,29,139,29],[145,30,139,30,"slice"],[145,35,139,35],[145,36,139,36],[145,37,139,37],[146,4,140,4,"outputShape"],[146,15,140,15],[146,16,140,16,"$axis"],[146,21,140,21],[146,22,140,22],[146,25,140,25,"outputTmpShape"],[146,39,140,39],[146,40,140,40],[146,41,140,41],[146,42,140,42],[147,4,141,4],[147,11,141,11],[148,6,142,8,"outputValues"],[148,18,142,20],[148,20,142,22,"outputBuffer"],[148,32,142,34],[148,33,142,35,"values"],[148,39,142,41],[149,6,143,8,"outputShape"],[149,17,143,19],[150,6,144,8,"indices"],[151,4,145,4],[151,5,145,5],[152,2,146,0],[153,0,146,1],[153,3]],"functionMap":{"names":["<global>","uniqueImpl","uniqueIndices.forEach$argument_0"],"mappings":"AAA;OCiB;0BCgH;KDM;CDU"},"hasCjsExports":false},"type":"js/module"}]}