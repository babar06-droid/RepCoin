{"dependencies":[{"name":"@tensorflow/tfjs-core","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":17,"column":0,"index":703},"end":{"line":17,"column":53,"index":756}}],"key":"qIleUpSDMUXFynEGc51k60/pDSs=","exportNames":["*"],"imports":1}},{"name":"./packing_util","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":18,"column":0,"index":757},"end":{"line":18,"column":45,"index":802}}],"key":"XZxV38atso3t5pLpH4+paVH17Hc=","exportNames":["*"],"imports":1}},{"name":"./shader_compiler","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":19,"column":0,"index":803},"end":{"line":19,"column":54,"index":857}}],"key":"yVSKlvZSxQn3Ck2puzGVWEYPzq8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"ConcatPackedProgram\", {\n    enumerable: true,\n    get: function () {\n      return ConcatPackedProgram;\n    }\n  });\n  var _tensorflowTfjsCore = require(_dependencyMap[0], \"@tensorflow/tfjs-core\");\n  var _packing_util = require(_dependencyMap[1], \"./packing_util\");\n  var _shader_compiler = require(_dependencyMap[2], \"./shader_compiler\");\n  /**\n   * @license\n   * Copyright 2019 Google LLC. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   */\n\n  class ConcatPackedProgram {\n    constructor(shapes, axis) {\n      this.packedInputs = true;\n      this.packedOutput = true;\n      this.outputShape = [];\n      this.outputShape = _tensorflowTfjsCore.backend_util.computeOutShape(shapes, axis);\n      const shape = this.outputShape;\n      const rank = shape.length;\n      const dtype = (0, _shader_compiler.getCoordsDataType)(rank);\n      const coords = (0, _packing_util.getChannels)('coords', rank);\n      const channels = ['x', 'y', 'z', 'w', 'u', 'v'].slice(0, rank);\n      this.variableNames = shapes.map((_, i) => `T${i}`);\n      const offsets = new Array(shapes.length - 1);\n      offsets[0] = shapes[0][axis];\n      for (let i = 1; i < offsets.length; i++) {\n        offsets[i] = offsets[i - 1] + shapes[i][axis];\n      }\n      const channel = channels[axis];\n      const lastChannels = channels.slice(-2);\n      const allChannels = channels.join();\n      let getValueSnippet = `if (${channel} < ${offsets[0]}) {\n        return getChannel(\n            getT0(${allChannels}), vec2(${lastChannels.join()}));\n        }`;\n      for (let i = 1; i < offsets.length; i++) {\n        const shift = offsets[i - 1];\n        // Note: the >= comparison below may seem unnecessary given the check\n        // above but is needed to workaround branch execution issues on some\n        // devices. It makes all the conditions exclusive without relying on\n        // execution order.\n        getValueSnippet += `\n        if (${channel} < ${offsets[i]}  && ${channel} >= ${offsets[i - 1]}) {\n          return getChannel(\n            getT${i}(${shiftedChannels(channels, channel, shift)}),\n            vec2(${shiftedChannels(lastChannels, channel, shift)}));\n        }`;\n      }\n      const lastIndex = offsets.length;\n      const shift = offsets[offsets.length - 1];\n      getValueSnippet += `\n        return getChannel(\n          getT${lastIndex}(${shiftedChannels(channels, channel, shift)}),\n          vec2(${shiftedChannels(lastChannels, channel, shift)}));`;\n      this.userCode = `\n      float getValue(${channels.map(x => 'int ' + x)}) {\n        ${getValueSnippet}\n      }\n\n      void main() {\n        ${dtype} coords = getOutputCoords();\n        vec4 result = vec4(getValue(${coords}), 0., 0., 0.);\n\n        ${coords[rank - 1]} = ${coords[rank - 1]} + 1;\n        if (${coords[rank - 1]} < ${shape[rank - 1]}) {\n          result.g = getValue(${coords});\n        }\n\n        ${coords[rank - 2]} = ${coords[rank - 2]} + 1;\n        if (${coords[rank - 2]} < ${shape[rank - 2]}) {\n          result.a = getValue(${coords});\n        }\n\n        ${coords[rank - 1]} = ${coords[rank - 1]} - 1;\n        if (${coords[rank - 2]} < ${shape[rank - 2]} &&\n            ${coords[rank - 1]} < ${shape[rank - 1]}) {\n          result.b = getValue(${coords});\n        }\n        setOutput(result);\n      }\n    `;\n    }\n  }\n  /**\n   * Return an expression for coordinates into a vector where a given channel\n   * will be offset by [shift].\n   *\n   * @param channels the channels to consider\n   * @param channel the channel we want shifted\n   * @param shift  the amount to subtract from the channel.\n   *\n   * @returns a string of the form 'x, y-[shift], z' where any one channel can\n   * have the shift applied.\n   */\n  function shiftedChannels(channels, channel, shift) {\n    const channelIdx = channels.indexOf(channel);\n    const res = channels.map((c, idx) => {\n      if (idx === channelIdx) {\n        return `${c} - ${shift}`;\n      } else {\n        return c;\n      }\n    });\n    return res.join();\n  }\n});","lineCount":127,"map":[[7,2,20,0,"Object"],[7,8,20,0],[7,9,20,0,"defineProperty"],[7,23,20,0],[7,24,20,0,"exports"],[7,31,20,0],[8,4,20,0,"enumerable"],[8,14,20,0],[9,4,20,0,"get"],[9,7,20,0],[9,18,20,0,"get"],[9,19,20,0],[10,6,20,0],[10,13,20,0,"ConcatPackedProgram"],[10,32,20,0],[11,4,20,0],[12,2,20,0],[13,2,17,0],[13,6,17,0,"_tensorflowTfjsCore"],[13,25,17,0],[13,28,17,0,"require"],[13,35,17,0],[13,36,17,0,"_dependencyMap"],[13,50,17,0],[14,2,18,0],[14,6,18,0,"_packing_util"],[14,19,18,0],[14,22,18,0,"require"],[14,29,18,0],[14,30,18,0,"_dependencyMap"],[14,44,18,0],[15,2,19,0],[15,6,19,0,"_shader_compiler"],[15,22,19,0],[15,25,19,0,"require"],[15,32,19,0],[15,33,19,0,"_dependencyMap"],[15,47,19,0],[16,2,1,0],[17,0,2,0],[18,0,3,0],[19,0,4,0],[20,0,5,0],[21,0,6,0],[22,0,7,0],[23,0,8,0],[24,0,9,0],[25,0,10,0],[26,0,11,0],[27,0,12,0],[28,0,13,0],[29,0,14,0],[30,0,15,0],[31,0,16,0],[33,2,20,7],[33,8,20,13,"ConcatPackedProgram"],[33,27,20,32],[33,28,20,33],[34,4,21,4,"constructor"],[34,15,21,15,"constructor"],[34,16,21,16,"shapes"],[34,22,21,22],[34,24,21,24,"axis"],[34,28,21,28],[34,30,21,30],[35,6,22,8],[35,10,22,12],[35,11,22,13,"packedInputs"],[35,23,22,25],[35,26,22,28],[35,30,22,32],[36,6,23,8],[36,10,23,12],[36,11,23,13,"packedOutput"],[36,23,23,25],[36,26,23,28],[36,30,23,32],[37,6,24,8],[37,10,24,12],[37,11,24,13,"outputShape"],[37,22,24,24],[37,25,24,27],[37,27,24,29],[38,6,25,8],[38,10,25,12],[38,11,25,13,"outputShape"],[38,22,25,24],[38,25,25,27,"backend_util"],[38,44,25,39],[38,45,25,39,"backend_util"],[38,57,25,39],[38,58,25,40,"computeOutShape"],[38,73,25,55],[38,74,25,56,"shapes"],[38,80,25,62],[38,82,25,64,"axis"],[38,86,25,68],[38,87,25,69],[39,6,26,8],[39,12,26,14,"shape"],[39,17,26,19],[39,20,26,22],[39,24,26,26],[39,25,26,27,"outputShape"],[39,36,26,38],[40,6,27,8],[40,12,27,14,"rank"],[40,16,27,18],[40,19,27,21,"shape"],[40,24,27,26],[40,25,27,27,"length"],[40,31,27,33],[41,6,28,8],[41,12,28,14,"dtype"],[41,17,28,19],[41,20,28,22],[41,24,28,22,"getCoordsDataType"],[41,40,28,39],[41,41,28,39,"getCoordsDataType"],[41,58,28,39],[41,60,28,40,"rank"],[41,64,28,44],[41,65,28,45],[42,6,29,8],[42,12,29,14,"coords"],[42,18,29,20],[42,21,29,23],[42,25,29,23,"getChannels"],[42,38,29,34],[42,39,29,34,"getChannels"],[42,50,29,34],[42,52,29,35],[42,60,29,43],[42,62,29,45,"rank"],[42,66,29,49],[42,67,29,50],[43,6,30,8],[43,12,30,14,"channels"],[43,20,30,22],[43,23,30,25],[43,24,30,26],[43,27,30,29],[43,29,30,31],[43,32,30,34],[43,34,30,36],[43,37,30,39],[43,39,30,41],[43,42,30,44],[43,44,30,46],[43,47,30,49],[43,49,30,51],[43,52,30,54],[43,53,30,55],[43,54,30,56,"slice"],[43,59,30,61],[43,60,30,62],[43,61,30,63],[43,63,30,65,"rank"],[43,67,30,69],[43,68,30,70],[44,6,31,8],[44,10,31,12],[44,11,31,13,"variableNames"],[44,24,31,26],[44,27,31,29,"shapes"],[44,33,31,35],[44,34,31,36,"map"],[44,37,31,39],[44,38,31,40],[44,39,31,41,"_"],[44,40,31,42],[44,42,31,44,"i"],[44,43,31,45],[44,48,31,50],[44,52,31,54,"i"],[44,53,31,55],[44,55,31,57],[44,56,31,58],[45,6,32,8],[45,12,32,14,"offsets"],[45,19,32,21],[45,22,32,24],[45,26,32,28,"Array"],[45,31,32,33],[45,32,32,34,"shapes"],[45,38,32,40],[45,39,32,41,"length"],[45,45,32,47],[45,48,32,50],[45,49,32,51],[45,50,32,52],[46,6,33,8,"offsets"],[46,13,33,15],[46,14,33,16],[46,15,33,17],[46,16,33,18],[46,19,33,21,"shapes"],[46,25,33,27],[46,26,33,28],[46,27,33,29],[46,28,33,30],[46,29,33,31,"axis"],[46,33,33,35],[46,34,33,36],[47,6,34,8],[47,11,34,13],[47,15,34,17,"i"],[47,16,34,18],[47,19,34,21],[47,20,34,22],[47,22,34,24,"i"],[47,23,34,25],[47,26,34,28,"offsets"],[47,33,34,35],[47,34,34,36,"length"],[47,40,34,42],[47,42,34,44,"i"],[47,43,34,45],[47,45,34,47],[47,47,34,49],[48,8,35,12,"offsets"],[48,15,35,19],[48,16,35,20,"i"],[48,17,35,21],[48,18,35,22],[48,21,35,25,"offsets"],[48,28,35,32],[48,29,35,33,"i"],[48,30,35,34],[48,33,35,37],[48,34,35,38],[48,35,35,39],[48,38,35,42,"shapes"],[48,44,35,48],[48,45,35,49,"i"],[48,46,35,50],[48,47,35,51],[48,48,35,52,"axis"],[48,52,35,56],[48,53,35,57],[49,6,36,8],[50,6,37,8],[50,12,37,14,"channel"],[50,19,37,21],[50,22,37,24,"channels"],[50,30,37,32],[50,31,37,33,"axis"],[50,35,37,37],[50,36,37,38],[51,6,38,8],[51,12,38,14,"lastChannels"],[51,24,38,26],[51,27,38,29,"channels"],[51,35,38,37],[51,36,38,38,"slice"],[51,41,38,43],[51,42,38,44],[51,43,38,45],[51,44,38,46],[51,45,38,47],[52,6,39,8],[52,12,39,14,"allChannels"],[52,23,39,25],[52,26,39,28,"channels"],[52,34,39,36],[52,35,39,37,"join"],[52,39,39,41],[52,40,39,42],[52,41,39,43],[53,6,40,8],[53,10,40,12,"getValueSnippet"],[53,25,40,27],[53,28,40,30],[53,35,40,37,"channel"],[53,42,40,44],[53,48,40,50,"offsets"],[53,55,40,57],[53,56,40,58],[53,57,40,59],[53,58,40,60],[54,0,41,0],[55,0,42,0],[55,20,42,20,"allChannels"],[55,31,42,31],[55,42,42,42,"lastChannels"],[55,54,42,54],[55,55,42,55,"join"],[55,59,42,59],[55,60,42,60],[55,61,42,61],[56,0,43,0],[56,10,43,10],[57,6,44,8],[57,11,44,13],[57,15,44,17,"i"],[57,16,44,18],[57,19,44,21],[57,20,44,22],[57,22,44,24,"i"],[57,23,44,25],[57,26,44,28,"offsets"],[57,33,44,35],[57,34,44,36,"length"],[57,40,44,42],[57,42,44,44,"i"],[57,43,44,45],[57,45,44,47],[57,47,44,49],[58,8,45,12],[58,14,45,18,"shift"],[58,19,45,23],[58,22,45,26,"offsets"],[58,29,45,33],[58,30,45,34,"i"],[58,31,45,35],[58,34,45,38],[58,35,45,39],[58,36,45,40],[59,8,46,12],[60,8,47,12],[61,8,48,12],[62,8,49,12],[63,8,50,12,"getValueSnippet"],[63,23,50,27],[63,27,50,31],[64,0,51,0],[64,14,51,14,"channel"],[64,21,51,21],[64,27,51,27,"offsets"],[64,34,51,34],[64,35,51,35,"i"],[64,36,51,36],[64,37,51,37],[64,45,51,45,"channel"],[64,52,51,52],[64,59,51,59,"offsets"],[64,66,51,66],[64,67,51,67,"i"],[64,68,51,68],[64,71,51,71],[64,72,51,72],[64,73,51,73],[65,0,52,0],[66,0,53,0],[66,18,53,18,"i"],[66,19,53,19],[66,23,53,23,"shiftedChannels"],[66,38,53,38],[66,39,53,39,"channels"],[66,47,53,47],[66,49,53,49,"channel"],[66,56,53,56],[66,58,53,58,"shift"],[66,63,53,63],[66,64,53,64],[67,0,54,0],[67,19,54,19,"shiftedChannels"],[67,34,54,34],[67,35,54,35,"lastChannels"],[67,47,54,47],[67,49,54,49,"channel"],[67,56,54,56],[67,58,54,58,"shift"],[67,63,54,63],[67,64,54,64],[68,0,55,0],[68,10,55,10],[69,6,56,8],[70,6,57,8],[70,12,57,14,"lastIndex"],[70,21,57,23],[70,24,57,26,"offsets"],[70,31,57,33],[70,32,57,34,"length"],[70,38,57,40],[71,6,58,8],[71,12,58,14,"shift"],[71,17,58,19],[71,20,58,22,"offsets"],[71,27,58,29],[71,28,58,30,"offsets"],[71,35,58,37],[71,36,58,38,"length"],[71,42,58,44],[71,45,58,47],[71,46,58,48],[71,47,58,49],[72,6,59,8,"getValueSnippet"],[72,21,59,23],[72,25,59,27],[73,0,60,0],[74,0,61,0],[74,16,61,16,"lastIndex"],[74,25,61,25],[74,29,61,29,"shiftedChannels"],[74,44,61,44],[74,45,61,45,"channels"],[74,53,61,53],[74,55,61,55,"channel"],[74,62,61,62],[74,64,61,64,"shift"],[74,69,61,69],[74,70,61,70],[75,0,62,0],[75,17,62,17,"shiftedChannels"],[75,32,62,32],[75,33,62,33,"lastChannels"],[75,45,62,45],[75,47,62,47,"channel"],[75,54,62,54],[75,56,62,56,"shift"],[75,61,62,61],[75,62,62,62],[75,67,62,67],[76,6,63,8],[76,10,63,12],[76,11,63,13,"userCode"],[76,19,63,21],[76,22,63,24],[77,0,64,0],[77,23,64,23,"channels"],[77,31,64,31],[77,32,64,32,"map"],[77,35,64,35],[77,36,64,36,"x"],[77,37,64,37],[77,41,64,41],[77,47,64,47],[77,50,64,50,"x"],[77,51,64,51],[77,52,64,52],[78,0,65,0],[78,10,65,10,"getValueSnippet"],[78,25,65,25],[79,0,66,0],[80,0,67,0],[81,0,68,0],[82,0,69,0],[82,10,69,10,"dtype"],[82,15,69,15],[83,0,70,0],[83,38,70,38,"coords"],[83,44,70,44],[84,0,71,0],[85,0,72,0],[85,10,72,10,"coords"],[85,16,72,16],[85,17,72,17,"rank"],[85,21,72,21],[85,24,72,24],[85,25,72,25],[85,26,72,26],[85,32,72,32,"coords"],[85,38,72,38],[85,39,72,39,"rank"],[85,43,72,43],[85,46,72,46],[85,47,72,47],[85,48,72,48],[86,0,73,0],[86,14,73,14,"coords"],[86,20,73,20],[86,21,73,21,"rank"],[86,25,73,25],[86,28,73,28],[86,29,73,29],[86,30,73,30],[86,36,73,36,"shape"],[86,41,73,41],[86,42,73,42,"rank"],[86,46,73,46],[86,49,73,49],[86,50,73,50],[86,51,73,51],[87,0,74,0],[87,32,74,32,"coords"],[87,38,74,38],[88,0,75,0],[89,0,76,0],[90,0,77,0],[90,10,77,10,"coords"],[90,16,77,16],[90,17,77,17,"rank"],[90,21,77,21],[90,24,77,24],[90,25,77,25],[90,26,77,26],[90,32,77,32,"coords"],[90,38,77,38],[90,39,77,39,"rank"],[90,43,77,43],[90,46,77,46],[90,47,77,47],[90,48,77,48],[91,0,78,0],[91,14,78,14,"coords"],[91,20,78,20],[91,21,78,21,"rank"],[91,25,78,25],[91,28,78,28],[91,29,78,29],[91,30,78,30],[91,36,78,36,"shape"],[91,41,78,41],[91,42,78,42,"rank"],[91,46,78,46],[91,49,78,49],[91,50,78,50],[91,51,78,51],[92,0,79,0],[92,32,79,32,"coords"],[92,38,79,38],[93,0,80,0],[94,0,81,0],[95,0,82,0],[95,10,82,10,"coords"],[95,16,82,16],[95,17,82,17,"rank"],[95,21,82,21],[95,24,82,24],[95,25,82,25],[95,26,82,26],[95,32,82,32,"coords"],[95,38,82,38],[95,39,82,39,"rank"],[95,43,82,43],[95,46,82,46],[95,47,82,47],[95,48,82,48],[96,0,83,0],[96,14,83,14,"coords"],[96,20,83,20],[96,21,83,21,"rank"],[96,25,83,25],[96,28,83,28],[96,29,83,29],[96,30,83,30],[96,36,83,36,"shape"],[96,41,83,41],[96,42,83,42,"rank"],[96,46,83,46],[96,49,83,49],[96,50,83,50],[96,51,83,51],[97,0,84,0],[97,14,84,14,"coords"],[97,20,84,20],[97,21,84,21,"rank"],[97,25,84,25],[97,28,84,28],[97,29,84,29],[97,30,84,30],[97,36,84,36,"shape"],[97,41,84,41],[97,42,84,42,"rank"],[97,46,84,46],[97,49,84,49],[97,50,84,50],[97,51,84,51],[98,0,85,0],[98,32,85,32,"coords"],[98,38,85,38],[99,0,86,0],[100,0,87,0],[101,0,88,0],[102,0,89,0],[102,5,89,5],[103,4,90,4],[104,2,91,0],[105,2,92,0],[106,0,93,0],[107,0,94,0],[108,0,95,0],[109,0,96,0],[110,0,97,0],[111,0,98,0],[112,0,99,0],[113,0,100,0],[114,0,101,0],[115,0,102,0],[116,2,103,0],[116,11,103,9,"shiftedChannels"],[116,26,103,24,"shiftedChannels"],[116,27,103,25,"channels"],[116,35,103,33],[116,37,103,35,"channel"],[116,44,103,42],[116,46,103,44,"shift"],[116,51,103,49],[116,53,103,51],[117,4,104,4],[117,10,104,10,"channelIdx"],[117,20,104,20],[117,23,104,23,"channels"],[117,31,104,31],[117,32,104,32,"indexOf"],[117,39,104,39],[117,40,104,40,"channel"],[117,47,104,47],[117,48,104,48],[118,4,105,4],[118,10,105,10,"res"],[118,13,105,13],[118,16,105,16,"channels"],[118,24,105,24],[118,25,105,25,"map"],[118,28,105,28],[118,29,105,29],[118,30,105,30,"c"],[118,31,105,31],[118,33,105,33,"idx"],[118,36,105,36],[118,41,105,41],[119,6,106,8],[119,10,106,12,"idx"],[119,13,106,15],[119,18,106,20,"channelIdx"],[119,28,106,30],[119,30,106,32],[120,8,107,12],[120,15,107,19],[120,18,107,22,"c"],[120,19,107,23],[120,25,107,29,"shift"],[120,30,107,34],[120,32,107,36],[121,6,108,8],[121,7,108,9],[121,13,109,13],[122,8,110,12],[122,15,110,19,"c"],[122,16,110,20],[123,6,111,8],[124,4,112,4],[124,5,112,5],[124,6,112,6],[125,4,113,4],[125,11,113,11,"res"],[125,14,113,14],[125,15,113,15,"join"],[125,19,113,19],[125,20,113,20],[125,21,113,21],[126,2,114,0],[127,0,114,1],[127,3]],"functionMap":{"names":["<global>","ConcatPackedProgram","ConcatPackedProgram#constructor","shapes.map$argument_0","channels.map$argument_0","shiftedChannels"],"mappings":"AAA;OCmB;ICC;wCCU,iBD;oCEiC,eF;KD0B;CDC;AKY;6BDE;KCO;CLE"},"hasCjsExports":false},"type":"js/module"}]}