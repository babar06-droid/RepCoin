{"dependencies":[{"name":"../../backends/non_max_suppression_impl","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":17,"column":0,"index":703},"end":{"line":17,"column":82,"index":785}}],"key":"TMFCT59yYol80UUXw+t7G5ZgJ4Q=","exportNames":["*"],"imports":1}},{"name":"../../tensor_util_env","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":18,"column":0,"index":786},"end":{"line":18,"column":56,"index":842}}],"key":"xfSGNGkCJdZhfQ673y/6d+no2yU=","exportNames":["*"],"imports":1}},{"name":"../nonmax_util","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":19,"column":0,"index":843},"end":{"line":19,"column":55,"index":898}}],"key":"0KlOSQQJQ4cKLKTcUmdRliPcibs=","exportNames":["*"],"imports":1}},{"name":"../tensor1d","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":20,"column":0,"index":899},"end":{"line":20,"column":39,"index":938}}],"key":"kuefm5tuaz1jkFeHQbmB8ff4Z9E=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"nonMaxSuppressionWithScoreAsync\", {\n    enumerable: true,\n    get: function () {\n      return nonMaxSuppressionWithScoreAsync;\n    }\n  });\n  var _backendsNon_max_suppression_impl = require(_dependencyMap[0], \"../../backends/non_max_suppression_impl\");\n  var _tensor_util_env = require(_dependencyMap[1], \"../../tensor_util_env\");\n  var _nonmax_util = require(_dependencyMap[2], \"../nonmax_util\");\n  var _tensor1d = require(_dependencyMap[3], \"../tensor1d\");\n  /**\n   * @license\n   * Copyright 2020 Google LLC. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   */\n\n  /**\n   * Asynchronously performs non maximum suppression of bounding boxes based on\n   * iou (intersection over union).\n   *\n   * This op also supports a Soft-NMS mode (cf.\n   * Bodla et al, https://arxiv.org/abs/1704.04503) where boxes reduce the score\n   * of other overlapping boxes, therefore favoring different regions of the image\n   * with high scores. To enable this Soft-NMS mode, set the `softNmsSigma`\n   * parameter to be larger than 0.\n   *\n   * @param boxes a 2d tensor of shape `[numBoxes, 4]`. Each entry is\n   *     `[y1, x1, y2, x2]`, where `(y1, x1)` and `(y2, x2)` are the corners of\n   *     the bounding box.\n   * @param scores a 1d tensor providing the box scores of shape `[numBoxes]`.\n   * @param maxOutputSize The maximum number of boxes to be selected.\n   * @param iouThreshold A float representing the threshold for deciding whether\n   *     boxes overlap too much with respect to IOU. Must be between [0, 1].\n   *     Defaults to 0.5 (50% box overlap).\n   * @param scoreThreshold A threshold for deciding when to remove boxes based\n   *     on score. Defaults to -inf, which means any score is accepted.\n   * @param softNmsSigma A float representing the sigma parameter for Soft NMS.\n   *     When sigma is 0, it falls back to nonMaxSuppression.\n   * @return A map with the following properties:\n   *     - selectedIndices: A 1D tensor with the selected box indices.\n   *     - selectedScores: A 1D tensor with the corresponding scores for each\n   *       selected box.\n   *\n   * @doc {heading: 'Operations', subheading: 'Images', namespace: 'image'}\n   */\n  async function nonMaxSuppressionWithScoreAsync_(boxes, scores, maxOutputSize, iouThreshold = 0.5, scoreThreshold = Number.NEGATIVE_INFINITY, softNmsSigma = 0.0) {\n    const $boxes = (0, _tensor_util_env.convertToTensor)(boxes, 'boxes', 'nonMaxSuppressionAsync');\n    const $scores = (0, _tensor_util_env.convertToTensor)(scores, 'scores', 'nonMaxSuppressionAsync');\n    const params = (0, _nonmax_util.nonMaxSuppSanityCheck)($boxes, $scores, maxOutputSize, iouThreshold, scoreThreshold, softNmsSigma);\n    maxOutputSize = params.maxOutputSize;\n    iouThreshold = params.iouThreshold;\n    scoreThreshold = params.scoreThreshold;\n    softNmsSigma = params.softNmsSigma;\n    const boxesAndScores = await Promise.all([$boxes.data(), $scores.data()]);\n    const boxesVals = boxesAndScores[0];\n    const scoresVals = boxesAndScores[1];\n    // We call a cpu based impl directly with the typedarray data  here rather\n    // than a kernel because all kernels are synchronous (and thus cannot await\n    // .data()).\n    const {\n      selectedIndices,\n      selectedScores\n    } = (0, _backendsNon_max_suppression_impl.nonMaxSuppressionV5Impl)(boxesVals, scoresVals, maxOutputSize, iouThreshold, scoreThreshold, softNmsSigma);\n    if ($boxes !== boxes) {\n      $boxes.dispose();\n    }\n    if ($scores !== scores) {\n      $scores.dispose();\n    }\n    return {\n      selectedIndices: (0, _tensor1d.tensor1d)(selectedIndices, 'int32'),\n      selectedScores: (0, _tensor1d.tensor1d)(selectedScores)\n    };\n  }\n  const nonMaxSuppressionWithScoreAsync = nonMaxSuppressionWithScoreAsync_;\n});","lineCount":93,"map":[[7,2,76,0,"Object"],[7,8,76,0],[7,9,76,0,"defineProperty"],[7,23,76,0],[7,24,76,0,"exports"],[7,31,76,0],[8,4,76,0,"enumerable"],[8,14,76,0],[9,4,76,0,"get"],[9,7,76,0],[9,18,76,0,"get"],[9,19,76,0],[10,6,76,0],[10,13,76,0,"nonMaxSuppressionWithScoreAsync"],[10,44,76,0],[11,4,76,0],[12,2,76,0],[13,2,17,0],[13,6,17,0,"_backendsNon_max_suppression_impl"],[13,39,17,0],[13,42,17,0,"require"],[13,49,17,0],[13,50,17,0,"_dependencyMap"],[13,64,17,0],[14,2,18,0],[14,6,18,0,"_tensor_util_env"],[14,22,18,0],[14,25,18,0,"require"],[14,32,18,0],[14,33,18,0,"_dependencyMap"],[14,47,18,0],[15,2,19,0],[15,6,19,0,"_nonmax_util"],[15,18,19,0],[15,21,19,0,"require"],[15,28,19,0],[15,29,19,0,"_dependencyMap"],[15,43,19,0],[16,2,20,0],[16,6,20,0,"_tensor1d"],[16,15,20,0],[16,18,20,0,"require"],[16,25,20,0],[16,26,20,0,"_dependencyMap"],[16,40,20,0],[17,2,1,0],[18,0,2,0],[19,0,3,0],[20,0,4,0],[21,0,5,0],[22,0,6,0],[23,0,7,0],[24,0,8,0],[25,0,9,0],[26,0,10,0],[27,0,11,0],[28,0,12,0],[29,0,13,0],[30,0,14,0],[31,0,15,0],[32,0,16,0],[34,2,21,0],[35,0,22,0],[36,0,23,0],[37,0,24,0],[38,0,25,0],[39,0,26,0],[40,0,27,0],[41,0,28,0],[42,0,29,0],[43,0,30,0],[44,0,31,0],[45,0,32,0],[46,0,33,0],[47,0,34,0],[48,0,35,0],[49,0,36,0],[50,0,37,0],[51,0,38,0],[52,0,39,0],[53,0,40,0],[54,0,41,0],[55,0,42,0],[56,0,43,0],[57,0,44,0],[58,0,45,0],[59,0,46,0],[60,0,47,0],[61,0,48,0],[62,0,49,0],[63,2,50,0],[63,17,50,15,"nonMaxSuppressionWithScoreAsync_"],[63,49,50,47,"nonMaxSuppressionWithScoreAsync_"],[63,50,50,48,"boxes"],[63,55,50,53],[63,57,50,55,"scores"],[63,63,50,61],[63,65,50,63,"maxOutputSize"],[63,78,50,76],[63,80,50,78,"iouThreshold"],[63,92,50,90],[63,95,50,93],[63,98,50,96],[63,100,50,98,"scoreThreshold"],[63,114,50,112],[63,117,50,115,"Number"],[63,123,50,121],[63,124,50,122,"NEGATIVE_INFINITY"],[63,141,50,139],[63,143,50,141,"softNmsSigma"],[63,155,50,153],[63,158,50,156],[63,161,50,159],[63,163,50,161],[64,4,51,4],[64,10,51,10,"$boxes"],[64,16,51,16],[64,19,51,19],[64,23,51,19,"convertToTensor"],[64,39,51,34],[64,40,51,34,"convertToTensor"],[64,55,51,34],[64,57,51,35,"boxes"],[64,62,51,40],[64,64,51,42],[64,71,51,49],[64,73,51,51],[64,97,51,75],[64,98,51,76],[65,4,52,4],[65,10,52,10,"$scores"],[65,17,52,17],[65,20,52,20],[65,24,52,20,"convertToTensor"],[65,40,52,35],[65,41,52,35,"convertToTensor"],[65,56,52,35],[65,58,52,36,"scores"],[65,64,52,42],[65,66,52,44],[65,74,52,52],[65,76,52,54],[65,100,52,78],[65,101,52,79],[66,4,53,4],[66,10,53,10,"params"],[66,16,53,16],[66,19,53,19],[66,23,53,19,"nonMaxSuppSanityCheck"],[66,35,53,40],[66,36,53,40,"nonMaxSuppSanityCheck"],[66,57,53,40],[66,59,53,41,"$boxes"],[66,65,53,47],[66,67,53,49,"$scores"],[66,74,53,56],[66,76,53,58,"maxOutputSize"],[66,89,53,71],[66,91,53,73,"iouThreshold"],[66,103,53,85],[66,105,53,87,"scoreThreshold"],[66,119,53,101],[66,121,53,103,"softNmsSigma"],[66,133,53,115],[66,134,53,116],[67,4,54,4,"maxOutputSize"],[67,17,54,17],[67,20,54,20,"params"],[67,26,54,26],[67,27,54,27,"maxOutputSize"],[67,40,54,40],[68,4,55,4,"iouThreshold"],[68,16,55,16],[68,19,55,19,"params"],[68,25,55,25],[68,26,55,26,"iouThreshold"],[68,38,55,38],[69,4,56,4,"scoreThreshold"],[69,18,56,18],[69,21,56,21,"params"],[69,27,56,27],[69,28,56,28,"scoreThreshold"],[69,42,56,42],[70,4,57,4,"softNmsSigma"],[70,16,57,16],[70,19,57,19,"params"],[70,25,57,25],[70,26,57,26,"softNmsSigma"],[70,38,57,38],[71,4,58,4],[71,10,58,10,"boxesAndScores"],[71,24,58,24],[71,27,58,27],[71,33,58,33,"Promise"],[71,40,58,40],[71,41,58,41,"all"],[71,44,58,44],[71,45,58,45],[71,46,58,46,"$boxes"],[71,52,58,52],[71,53,58,53,"data"],[71,57,58,57],[71,58,58,58],[71,59,58,59],[71,61,58,61,"$scores"],[71,68,58,68],[71,69,58,69,"data"],[71,73,58,73],[71,74,58,74],[71,75,58,75],[71,76,58,76],[71,77,58,77],[72,4,59,4],[72,10,59,10,"boxesVals"],[72,19,59,19],[72,22,59,22,"boxesAndScores"],[72,36,59,36],[72,37,59,37],[72,38,59,38],[72,39,59,39],[73,4,60,4],[73,10,60,10,"scoresVals"],[73,20,60,20],[73,23,60,23,"boxesAndScores"],[73,37,60,37],[73,38,60,38],[73,39,60,39],[73,40,60,40],[74,4,61,4],[75,4,62,4],[76,4,63,4],[77,4,64,4],[77,10,64,10],[78,6,64,12,"selectedIndices"],[78,21,64,27],[79,6,64,29,"selectedScores"],[80,4,64,44],[80,5,64,45],[80,8,64,48],[80,12,64,48,"nonMaxSuppressionV5Impl"],[80,45,64,71],[80,46,64,71,"nonMaxSuppressionV5Impl"],[80,69,64,71],[80,71,64,72,"boxesVals"],[80,80,64,81],[80,82,64,83,"scoresVals"],[80,92,64,93],[80,94,64,95,"maxOutputSize"],[80,107,64,108],[80,109,64,110,"iouThreshold"],[80,121,64,122],[80,123,64,124,"scoreThreshold"],[80,137,64,138],[80,139,64,140,"softNmsSigma"],[80,151,64,152],[80,152,64,153],[81,4,65,4],[81,8,65,8,"$boxes"],[81,14,65,14],[81,19,65,19,"boxes"],[81,24,65,24],[81,26,65,26],[82,6,66,8,"$boxes"],[82,12,66,14],[82,13,66,15,"dispose"],[82,20,66,22],[82,21,66,23],[82,22,66,24],[83,4,67,4],[84,4,68,4],[84,8,68,8,"$scores"],[84,15,68,15],[84,20,68,20,"scores"],[84,26,68,26],[84,28,68,28],[85,6,69,8,"$scores"],[85,13,69,15],[85,14,69,16,"dispose"],[85,21,69,23],[85,22,69,24],[85,23,69,25],[86,4,70,4],[87,4,71,4],[87,11,71,11],[88,6,72,8,"selectedIndices"],[88,21,72,23],[88,23,72,25],[88,27,72,25,"tensor1d"],[88,36,72,33],[88,37,72,33,"tensor1d"],[88,45,72,33],[88,47,72,34,"selectedIndices"],[88,62,72,49],[88,64,72,51],[88,71,72,58],[88,72,72,59],[89,6,73,8,"selectedScores"],[89,20,73,22],[89,22,73,24],[89,26,73,24,"tensor1d"],[89,35,73,32],[89,36,73,32,"tensor1d"],[89,44,73,32],[89,46,73,33,"selectedScores"],[89,60,73,47],[90,4,74,4],[90,5,74,5],[91,2,75,0],[92,2,76,7],[92,8,76,13,"nonMaxSuppressionWithScoreAsync"],[92,39,76,44],[92,42,76,47,"nonMaxSuppressionWithScoreAsync_"],[92,74,76,79],[93,0,76,80],[93,3]],"functionMap":{"names":["<global>","nonMaxSuppressionWithScoreAsync_"],"mappings":"AAA;ACiD;CDyB"},"hasCjsExports":false},"type":"js/module"}]}