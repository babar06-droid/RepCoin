{"dependencies":[{"name":"@tensorflow/tfjs-core","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":17,"column":0,"index":703},"end":{"line":17,"column":53,"index":756}}],"key":"qIleUpSDMUXFynEGc51k60/pDSs=","exportNames":["*"],"imports":1}},{"name":"../mean_gpu","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":18,"column":0,"index":757},"end":{"line":18,"column":42,"index":799}}],"key":"aiJuQ+1v7zkFxhlK5ybwRybQZws=","exportNames":["*"],"imports":1}},{"name":"../reduce_gpu","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":19,"column":0,"index":800},"end":{"line":19,"column":46,"index":846}}],"key":"E5yKEfQokgtRd1fTZE3OLGHyMOk=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.reduce = reduce;\n  var _tensorflowTfjsCore = require(_dependencyMap[0], \"@tensorflow/tfjs-core\");\n  var _mean_gpu = require(_dependencyMap[1], \"../mean_gpu\");\n  var _reduce_gpu = require(_dependencyMap[2], \"../reduce_gpu\");\n  /**\n   * @license\n   * Copyright 2020 Google LLC. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   */\n\n  // Returns an array of configuration objects that describe each stage of the\n  // reduction.\n  function getReductionStages(inShape) {\n    const stages = [];\n    while (stages.length === 0 || stages[stages.length - 1].outSize !== 1) {\n      const outSize = stages.length ? stages[stages.length - 1].outSize : inShape[1];\n      const windowSize = _tensorflowTfjsCore.backend_util.computeOptimalWindowSize(outSize);\n      stages.push({\n        inSize: outSize,\n        windowSize,\n        outSize: Math.ceil(outSize / windowSize)\n      });\n    }\n    return stages;\n  }\n  function reduce(x, dtype, reductionType, backend) {\n    const reductionStages = getReductionStages(x.shape);\n    let result = x;\n    for (let i = 0; i < reductionStages.length; i++) {\n      const {\n        inSize,\n        windowSize,\n        outSize\n      } = reductionStages[i];\n      let program;\n      let previousResult;\n      if (reductionType === 'mean') {\n        program = i === 0 ? new _mean_gpu.MeanProgram({\n          windowSize,\n          inSize,\n          batchSize: x.shape[0],\n          outSize\n        }, inSize) : new _mean_gpu.MeanProgram({\n          windowSize,\n          inSize,\n          batchSize: x.shape[0],\n          outSize\n        });\n      } else {\n        program = new _reduce_gpu.ReduceProgram({\n          windowSize,\n          inSize,\n          batchSize: x.shape[0],\n          outSize\n        }, reductionType);\n      }\n      previousResult = result;\n      result = backend.runWebGLProgram(program, [result], dtype);\n      if (previousResult.dataId !== x.dataId) {\n        backend.disposeIntermediateTensorInfo(previousResult);\n      }\n    }\n    return result;\n  }\n});","lineCount":82,"map":[[7,2,35,0,"exports"],[7,9,35,0],[7,10,35,0,"reduce"],[7,16,35,0],[7,19,35,0,"reduce"],[7,25,35,0],[8,2,17,0],[8,6,17,0,"_tensorflowTfjsCore"],[8,25,17,0],[8,28,17,0,"require"],[8,35,17,0],[8,36,17,0,"_dependencyMap"],[8,50,17,0],[9,2,18,0],[9,6,18,0,"_mean_gpu"],[9,15,18,0],[9,18,18,0,"require"],[9,25,18,0],[9,26,18,0,"_dependencyMap"],[9,40,18,0],[10,2,19,0],[10,6,19,0,"_reduce_gpu"],[10,17,19,0],[10,20,19,0,"require"],[10,27,19,0],[10,28,19,0,"_dependencyMap"],[10,42,19,0],[11,2,1,0],[12,0,2,0],[13,0,3,0],[14,0,4,0],[15,0,5,0],[16,0,6,0],[17,0,7,0],[18,0,8,0],[19,0,9,0],[20,0,10,0],[21,0,11,0],[22,0,12,0],[23,0,13,0],[24,0,14,0],[25,0,15,0],[26,0,16,0],[28,2,20,0],[29,2,21,0],[30,2,22,0],[30,11,22,9,"getReductionStages"],[30,29,22,27,"getReductionStages"],[30,30,22,28,"inShape"],[30,37,22,35],[30,39,22,37],[31,4,23,4],[31,10,23,10,"stages"],[31,16,23,16],[31,19,23,19],[31,21,23,21],[32,4,24,4],[32,11,24,11,"stages"],[32,17,24,17],[32,18,24,18,"length"],[32,24,24,24],[32,29,24,29],[32,30,24,30],[32,34,24,34,"stages"],[32,40,24,40],[32,41,24,41,"stages"],[32,47,24,47],[32,48,24,48,"length"],[32,54,24,54],[32,57,24,57],[32,58,24,58],[32,59,24,59],[32,60,24,60,"outSize"],[32,67,24,67],[32,72,24,72],[32,73,24,73],[32,75,24,75],[33,6,25,8],[33,12,25,14,"outSize"],[33,19,25,21],[33,22,25,24,"stages"],[33,28,25,30],[33,29,25,31,"length"],[33,35,25,37],[33,38,25,40,"stages"],[33,44,25,46],[33,45,25,47,"stages"],[33,51,25,53],[33,52,25,54,"length"],[33,58,25,60],[33,61,25,63],[33,62,25,64],[33,63,25,65],[33,64,25,66,"outSize"],[33,71,25,73],[33,74,25,76,"inShape"],[33,81,25,83],[33,82,25,84],[33,83,25,85],[33,84,25,86],[34,6,26,8],[34,12,26,14,"windowSize"],[34,22,26,24],[34,25,26,27,"backend_util"],[34,44,26,39],[34,45,26,39,"backend_util"],[34,57,26,39],[34,58,26,40,"computeOptimalWindowSize"],[34,82,26,64],[34,83,26,65,"outSize"],[34,90,26,72],[34,91,26,73],[35,6,27,8,"stages"],[35,12,27,14],[35,13,27,15,"push"],[35,17,27,19],[35,18,27,20],[36,8,28,12,"inSize"],[36,14,28,18],[36,16,28,20,"outSize"],[36,23,28,27],[37,8,29,12,"windowSize"],[37,18,29,22],[38,8,30,12,"outSize"],[38,15,30,19],[38,17,30,21,"Math"],[38,21,30,25],[38,22,30,26,"ceil"],[38,26,30,30],[38,27,30,31,"outSize"],[38,34,30,38],[38,37,30,41,"windowSize"],[38,47,30,51],[39,6,31,8],[39,7,31,9],[39,8,31,10],[40,4,32,4],[41,4,33,4],[41,11,33,11,"stages"],[41,17,33,17],[42,2,34,0],[43,2,35,7],[43,11,35,16,"reduce"],[43,17,35,22,"reduce"],[43,18,35,23,"x"],[43,19,35,24],[43,21,35,26,"dtype"],[43,26,35,31],[43,28,35,33,"reductionType"],[43,41,35,46],[43,43,35,48,"backend"],[43,50,35,55],[43,52,35,57],[44,4,36,4],[44,10,36,10,"reductionStages"],[44,25,36,25],[44,28,36,28,"getReductionStages"],[44,46,36,46],[44,47,36,47,"x"],[44,48,36,48],[44,49,36,49,"shape"],[44,54,36,54],[44,55,36,55],[45,4,37,4],[45,8,37,8,"result"],[45,14,37,14],[45,17,37,17,"x"],[45,18,37,18],[46,4,38,4],[46,9,38,9],[46,13,38,13,"i"],[46,14,38,14],[46,17,38,17],[46,18,38,18],[46,20,38,20,"i"],[46,21,38,21],[46,24,38,24,"reductionStages"],[46,39,38,39],[46,40,38,40,"length"],[46,46,38,46],[46,48,38,48,"i"],[46,49,38,49],[46,51,38,51],[46,53,38,53],[47,6,39,8],[47,12,39,14],[48,8,39,16,"inSize"],[48,14,39,22],[49,8,39,24,"windowSize"],[49,18,39,34],[50,8,39,36,"outSize"],[51,6,39,44],[51,7,39,45],[51,10,39,48,"reductionStages"],[51,25,39,63],[51,26,39,64,"i"],[51,27,39,65],[51,28,39,66],[52,6,40,8],[52,10,40,12,"program"],[52,17,40,19],[53,6,41,8],[53,10,41,12,"previousResult"],[53,24,41,26],[54,6,42,8],[54,10,42,12,"reductionType"],[54,23,42,25],[54,28,42,30],[54,34,42,36],[54,36,42,38],[55,8,43,12,"program"],[55,15,43,19],[55,18,43,22,"i"],[55,19,43,23],[55,24,43,28],[55,25,43,29],[55,28,44,16],[55,32,44,20,"MeanProgram"],[55,41,44,31],[55,42,44,31,"MeanProgram"],[55,53,44,31],[55,54,44,32],[56,10,44,34,"windowSize"],[56,20,44,44],[57,10,44,46,"inSize"],[57,16,44,52],[58,10,44,54,"batchSize"],[58,19,44,63],[58,21,44,65,"x"],[58,22,44,66],[58,23,44,67,"shape"],[58,28,44,72],[58,29,44,73],[58,30,44,74],[58,31,44,75],[59,10,44,77,"outSize"],[60,8,44,85],[60,9,44,86],[60,11,44,88,"inSize"],[60,17,44,94],[60,18,44,95],[60,21,45,16],[60,25,45,20,"MeanProgram"],[60,34,45,31],[60,35,45,31,"MeanProgram"],[60,46,45,31],[60,47,45,32],[61,10,45,34,"windowSize"],[61,20,45,44],[62,10,45,46,"inSize"],[62,16,45,52],[63,10,45,54,"batchSize"],[63,19,45,63],[63,21,45,65,"x"],[63,22,45,66],[63,23,45,67,"shape"],[63,28,45,72],[63,29,45,73],[63,30,45,74],[63,31,45,75],[64,10,45,77,"outSize"],[65,8,45,85],[65,9,45,86],[65,10,45,87],[66,6,46,8],[66,7,46,9],[66,13,47,13],[67,8,48,12,"program"],[67,15,48,19],[67,18,48,22],[67,22,48,26,"ReduceProgram"],[67,33,48,39],[67,34,48,39,"ReduceProgram"],[67,47,48,39],[67,48,48,40],[68,10,48,42,"windowSize"],[68,20,48,52],[69,10,48,54,"inSize"],[69,16,48,60],[70,10,48,62,"batchSize"],[70,19,48,71],[70,21,48,73,"x"],[70,22,48,74],[70,23,48,75,"shape"],[70,28,48,80],[70,29,48,81],[70,30,48,82],[70,31,48,83],[71,10,48,85,"outSize"],[72,8,48,93],[72,9,48,94],[72,11,48,96,"reductionType"],[72,24,48,109],[72,25,48,110],[73,6,49,8],[74,6,50,8,"previousResult"],[74,20,50,22],[74,23,50,25,"result"],[74,29,50,31],[75,6,51,8,"result"],[75,12,51,14],[75,15,51,17,"backend"],[75,22,51,24],[75,23,51,25,"runWebGLProgram"],[75,38,51,40],[75,39,51,41,"program"],[75,46,51,48],[75,48,51,50],[75,49,51,51,"result"],[75,55,51,57],[75,56,51,58],[75,58,51,60,"dtype"],[75,63,51,65],[75,64,51,66],[76,6,52,8],[76,10,52,12,"previousResult"],[76,24,52,26],[76,25,52,27,"dataId"],[76,31,52,33],[76,36,52,38,"x"],[76,37,52,39],[76,38,52,40,"dataId"],[76,44,52,46],[76,46,52,48],[77,8,53,12,"backend"],[77,15,53,19],[77,16,53,20,"disposeIntermediateTensorInfo"],[77,45,53,49],[77,46,53,50,"previousResult"],[77,60,53,64],[77,61,53,65],[78,6,54,8],[79,4,55,4],[80,4,56,4],[80,11,56,11,"result"],[80,17,56,17],[81,2,57,0],[82,0,57,1],[82,3]],"functionMap":{"names":["<global>","getReductionStages","reduce"],"mappings":"AAA;ACqB;CDY;OEC;CFsB"},"hasCjsExports":false},"type":"js/module"}]}