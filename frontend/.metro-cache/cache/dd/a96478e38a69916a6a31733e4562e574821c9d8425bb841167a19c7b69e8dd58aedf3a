{"dependencies":[{"name":"./lazy_iterator","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":18,"column":0,"index":706},"end":{"line":18,"column":66,"index":772}}],"key":"q2hxzZKS96FYTd6539vU0OZjvFs=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"StringIterator\", {\n    enumerable: true,\n    get: function () {\n      return StringIterator;\n    }\n  });\n  var _lazy_iterator = require(_dependencyMap[0], \"./lazy_iterator\");\n  /**\n   * @license\n   * Copyright 2018 Google LLC. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   *\n   * =============================================================================\n   */\n\n  class StringIterator extends _lazy_iterator.LazyIterator {\n    /**\n     * Splits a string stream on a given separator.\n     *\n     * It is assumed that the incoming chunk boundaries have no semantic meaning,\n     * so conceptually the incoming stream is treated simply as the concatenation\n     * of its elements.\n     *\n     * The outgoing stream provides chunks corresponding to the results of the\n     * standard string split() operation (even if such a chunk spanned incoming\n     * chunks).  The separators are not included.\n     *\n     * A typical usage is to split a text file (represented as a stream with\n     * arbitrary chunk boundaries) into lines.\n     *\n     * @param upstream A readable stream of strings that can be treated as\n     *   concatenated.\n     * @param separator A character to split on.\n     */\n    split(separator) {\n      return new SplitIterator(this, separator);\n    }\n  }\n  // ============================================================================\n  // The following private classes serve to implement the chainable methods\n  // on StringIterator.  Unfortunately they can't be placed in separate files, due\n  // to resulting trouble with circular imports.\n  // ============================================================================\n  // We wanted multiple inheritance, e.g.\n  //   class SplitIterator extends QueueIterator<string>, StringIterator\n  // but the TypeScript mixin approach is a bit hacky, so we take this adapter\n  // approach instead.\n  class SplitIterator extends StringIterator {\n    constructor(upstream, separator) {\n      super();\n      this.upstream = upstream;\n      this.impl = new SplitIteratorImpl(upstream, separator);\n    }\n    summary() {\n      return this.impl.summary();\n    }\n    async next() {\n      return this.impl.next();\n    }\n  }\n  class SplitIteratorImpl extends _lazy_iterator.OneToManyIterator {\n    constructor(upstream, separator) {\n      super();\n      this.upstream = upstream;\n      this.separator = separator;\n      // A partial string at the end of an upstream chunk\n      this.carryover = '';\n    }\n    summary() {\n      return `${this.upstream.summary()} -> Split('${this.separator}')`;\n    }\n    async pump() {\n      const chunkResult = await this.upstream.next();\n      if (chunkResult.done) {\n        if (this.carryover === '') {\n          return false;\n        }\n        // Pretend that the pump succeeded in order to emit the small last batch.\n        // The next pump() call will actually fail.\n        this.outputQueue.push(this.carryover);\n        this.carryover = '';\n        return true;\n      }\n      const lines = chunkResult.value.split(this.separator);\n      // Note the behavior: \" ab \".split(' ') === ['', 'ab', '']\n      // Thus the carryover may be '' if the separator falls on a chunk\n      // boundary; this produces the correct result.\n      lines[0] = this.carryover + lines[0];\n      for (const line of lines.slice(0, -1)) {\n        this.outputQueue.push(line);\n      }\n      this.carryover = lines[lines.length - 1];\n      return true;\n    }\n  }\n});","lineCount":112,"map":[[7,2,19,0,"Object"],[7,8,19,0],[7,9,19,0,"defineProperty"],[7,23,19,0],[7,24,19,0,"exports"],[7,31,19,0],[8,4,19,0,"enumerable"],[8,14,19,0],[9,4,19,0,"get"],[9,7,19,0],[9,18,19,0,"get"],[9,19,19,0],[10,6,19,0],[10,13,19,0,"StringIterator"],[10,27,19,0],[11,4,19,0],[12,2,19,0],[13,2,18,0],[13,6,18,0,"_lazy_iterator"],[13,20,18,0],[13,23,18,0,"require"],[13,30,18,0],[13,31,18,0,"_dependencyMap"],[13,45,18,0],[14,2,1,0],[15,0,2,0],[16,0,3,0],[17,0,4,0],[18,0,5,0],[19,0,6,0],[20,0,7,0],[21,0,8,0],[22,0,9,0],[23,0,10,0],[24,0,11,0],[25,0,12,0],[26,0,13,0],[27,0,14,0],[28,0,15,0],[29,0,16,0],[30,0,17,0],[32,2,19,7],[32,8,19,13,"StringIterator"],[32,22,19,27],[32,31,19,36,"LazyIterator"],[32,45,19,48],[32,46,19,48,"LazyIterator"],[32,58,19,48],[32,59,19,49],[33,4,20,4],[34,0,21,0],[35,0,22,0],[36,0,23,0],[37,0,24,0],[38,0,25,0],[39,0,26,0],[40,0,27,0],[41,0,28,0],[42,0,29,0],[43,0,30,0],[44,0,31,0],[45,0,32,0],[46,0,33,0],[47,0,34,0],[48,0,35,0],[49,0,36,0],[50,0,37,0],[51,4,38,4,"split"],[51,9,38,9,"split"],[51,10,38,10,"separator"],[51,19,38,19],[51,21,38,21],[52,6,39,8],[52,13,39,15],[52,17,39,19,"SplitIterator"],[52,30,39,32],[52,31,39,33],[52,35,39,37],[52,37,39,39,"separator"],[52,46,39,48],[52,47,39,49],[53,4,40,4],[54,2,41,0],[55,2,42,0],[56,2,43,0],[57,2,44,0],[58,2,45,0],[59,2,46,0],[60,2,47,0],[61,2,48,0],[62,2,49,0],[63,2,50,0],[64,2,51,0],[64,8,51,6,"SplitIterator"],[64,21,51,19],[64,30,51,28,"StringIterator"],[64,44,51,42],[64,45,51,43],[65,4,52,4,"constructor"],[65,15,52,15,"constructor"],[65,16,52,16,"upstream"],[65,24,52,24],[65,26,52,26,"separator"],[65,35,52,35],[65,37,52,37],[66,6,53,8],[66,11,53,13],[66,12,53,14],[66,13,53,15],[67,6,54,8],[67,10,54,12],[67,11,54,13,"upstream"],[67,19,54,21],[67,22,54,24,"upstream"],[67,30,54,32],[68,6,55,8],[68,10,55,12],[68,11,55,13,"impl"],[68,15,55,17],[68,18,55,20],[68,22,55,24,"SplitIteratorImpl"],[68,39,55,41],[68,40,55,42,"upstream"],[68,48,55,50],[68,50,55,52,"separator"],[68,59,55,61],[68,60,55,62],[69,4,56,4],[70,4,57,4,"summary"],[70,11,57,11,"summary"],[70,12,57,11],[70,14,57,14],[71,6,58,8],[71,13,58,15],[71,17,58,19],[71,18,58,20,"impl"],[71,22,58,24],[71,23,58,25,"summary"],[71,30,58,32],[71,31,58,33],[71,32,58,34],[72,4,59,4],[73,4,60,4],[73,10,60,10,"next"],[73,14,60,14,"next"],[73,15,60,14],[73,17,60,17],[74,6,61,8],[74,13,61,15],[74,17,61,19],[74,18,61,20,"impl"],[74,22,61,24],[74,23,61,25,"next"],[74,27,61,29],[74,28,61,30],[74,29,61,31],[75,4,62,4],[76,2,63,0],[77,2,64,0],[77,8,64,6,"SplitIteratorImpl"],[77,25,64,23],[77,34,64,32,"OneToManyIterator"],[77,48,64,49],[77,49,64,49,"OneToManyIterator"],[77,66,64,49],[77,67,64,50],[78,4,65,4,"constructor"],[78,15,65,15,"constructor"],[78,16,65,16,"upstream"],[78,24,65,24],[78,26,65,26,"separator"],[78,35,65,35],[78,37,65,37],[79,6,66,8],[79,11,66,13],[79,12,66,14],[79,13,66,15],[80,6,67,8],[80,10,67,12],[80,11,67,13,"upstream"],[80,19,67,21],[80,22,67,24,"upstream"],[80,30,67,32],[81,6,68,8],[81,10,68,12],[81,11,68,13,"separator"],[81,20,68,22],[81,23,68,25,"separator"],[81,32,68,34],[82,6,69,8],[83,6,70,8],[83,10,70,12],[83,11,70,13,"carryover"],[83,20,70,22],[83,23,70,25],[83,25,70,27],[84,4,71,4],[85,4,72,4,"summary"],[85,11,72,11,"summary"],[85,12,72,11],[85,14,72,14],[86,6,73,8],[86,13,73,15],[86,16,73,18],[86,20,73,22],[86,21,73,23,"upstream"],[86,29,73,31],[86,30,73,32,"summary"],[86,37,73,39],[86,38,73,40],[86,39,73,41],[86,53,73,55],[86,57,73,59],[86,58,73,60,"separator"],[86,67,73,69],[86,71,73,73],[87,4,74,4],[88,4,75,4],[88,10,75,10,"pump"],[88,14,75,14,"pump"],[88,15,75,14],[88,17,75,17],[89,6,76,8],[89,12,76,14,"chunkResult"],[89,23,76,25],[89,26,76,28],[89,32,76,34],[89,36,76,38],[89,37,76,39,"upstream"],[89,45,76,47],[89,46,76,48,"next"],[89,50,76,52],[89,51,76,53],[89,52,76,54],[90,6,77,8],[90,10,77,12,"chunkResult"],[90,21,77,23],[90,22,77,24,"done"],[90,26,77,28],[90,28,77,30],[91,8,78,12],[91,12,78,16],[91,16,78,20],[91,17,78,21,"carryover"],[91,26,78,30],[91,31,78,35],[91,33,78,37],[91,35,78,39],[92,10,79,16],[92,17,79,23],[92,22,79,28],[93,8,80,12],[94,8,81,12],[95,8,82,12],[96,8,83,12],[96,12,83,16],[96,13,83,17,"outputQueue"],[96,24,83,28],[96,25,83,29,"push"],[96,29,83,33],[96,30,83,34],[96,34,83,38],[96,35,83,39,"carryover"],[96,44,83,48],[96,45,83,49],[97,8,84,12],[97,12,84,16],[97,13,84,17,"carryover"],[97,22,84,26],[97,25,84,29],[97,27,84,31],[98,8,85,12],[98,15,85,19],[98,19,85,23],[99,6,86,8],[100,6,87,8],[100,12,87,14,"lines"],[100,17,87,19],[100,20,87,22,"chunkResult"],[100,31,87,33],[100,32,87,34,"value"],[100,37,87,39],[100,38,87,40,"split"],[100,43,87,45],[100,44,87,46],[100,48,87,50],[100,49,87,51,"separator"],[100,58,87,60],[100,59,87,61],[101,6,88,8],[102,6,89,8],[103,6,90,8],[104,6,91,8,"lines"],[104,11,91,13],[104,12,91,14],[104,13,91,15],[104,14,91,16],[104,17,91,19],[104,21,91,23],[104,22,91,24,"carryover"],[104,31,91,33],[104,34,91,36,"lines"],[104,39,91,41],[104,40,91,42],[104,41,91,43],[104,42,91,44],[105,6,92,8],[105,11,92,13],[105,17,92,19,"line"],[105,21,92,23],[105,25,92,27,"lines"],[105,30,92,32],[105,31,92,33,"slice"],[105,36,92,38],[105,37,92,39],[105,38,92,40],[105,40,92,42],[105,41,92,43],[105,42,92,44],[105,43,92,45],[105,45,92,47],[106,8,93,12],[106,12,93,16],[106,13,93,17,"outputQueue"],[106,24,93,28],[106,25,93,29,"push"],[106,29,93,33],[106,30,93,34,"line"],[106,34,93,38],[106,35,93,39],[107,6,94,8],[108,6,95,8],[108,10,95,12],[108,11,95,13,"carryover"],[108,20,95,22],[108,23,95,25,"lines"],[108,28,95,30],[108,29,95,31,"lines"],[108,34,95,36],[108,35,95,37,"length"],[108,41,95,43],[108,44,95,46],[108,45,95,47],[108,46,95,48],[109,6,96,8],[109,13,96,15],[109,17,96,19],[110,4,97,4],[111,2,98,0],[112,0,98,1],[112,3]],"functionMap":{"names":["<global>","StringIterator","StringIterator#split","SplitIterator","SplitIterator#constructor","SplitIterator#summary","SplitIterator#next","SplitIteratorImpl","SplitIteratorImpl#constructor","SplitIteratorImpl#summary","SplitIteratorImpl#pump"],"mappings":"AAA;OCkB;ICmB;KDE;CDC;AGU;ICC;KDI;IEC;KFE;IGC;KHE;CHC;AOC;ICC;KDM;IEC;KFE;IGC;KHsB;CPC"},"hasCjsExports":false},"type":"js/module"}]}