{"dependencies":[],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"LRNPackedProgram\", {\n    enumerable: true,\n    get: function () {\n      return LRNPackedProgram;\n    }\n  });\n  /**\n   * @license\n   * Copyright 2019 Google LLC. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   */\n  class LRNPackedProgram {\n    constructor(xShape, radius, bias, alpha, beta) {\n      this.variableNames = ['x'];\n      this.outputShape = [];\n      this.packedInputs = true;\n      this.packedOutput = true;\n      const rad = radius;\n      const maxD = xShape[3] - 1;\n      this.outputShape = xShape;\n      // optimize pow(bias + alpha * sum, -beta)\n      // src: https://github.com/tensorflow/tensorflow/..\n      // blob/26033a1644a9c4a5fbe3170ab2e864b6a4ccd4ca/..\n      // tensorflow/core/kernels/mkl_lrn_op.cc#L320\n      let powOperator;\n      const basis = `float(${bias}) + float(${alpha}) * sum`;\n      if (beta === 0.5) {\n        powOperator = `inversesqrt(${basis})`;\n      } else if (beta === 1.0) {\n        powOperator = `1.0/(${basis})`;\n      } else {\n        powOperator = `exp(log(${basis}) * float(-${beta}));`;\n      }\n      this.userCode = `\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ${this.outputShape[3]};\n        bool hasNextRow = c < ${this.outputShape[2]};\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ${rad};\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ${rad}; j <= ${rad}; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${maxD}));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ${powOperator};\n        setOutput(result);\n      }\n    `;\n    }\n  }\n});","lineCount":116,"map":[[7,2,17,0,"Object"],[7,8,17,0],[7,9,17,0,"defineProperty"],[7,23,17,0],[7,24,17,0,"exports"],[7,31,17,0],[8,4,17,0,"enumerable"],[8,14,17,0],[9,4,17,0,"get"],[9,7,17,0],[9,18,17,0,"get"],[9,19,17,0],[10,6,17,0],[10,13,17,0,"LRNPackedProgram"],[10,29,17,0],[11,4,17,0],[12,2,17,0],[13,2,1,0],[14,0,2,0],[15,0,3,0],[16,0,4,0],[17,0,5,0],[18,0,6,0],[19,0,7,0],[20,0,8,0],[21,0,9,0],[22,0,10,0],[23,0,11,0],[24,0,12,0],[25,0,13,0],[26,0,14,0],[27,0,15,0],[28,0,16,0],[29,2,17,7],[29,8,17,13,"LRNPackedProgram"],[29,24,17,29],[29,25,17,30],[30,4,18,4,"constructor"],[30,15,18,15,"constructor"],[30,16,18,16,"xShape"],[30,22,18,22],[30,24,18,24,"radius"],[30,30,18,30],[30,32,18,32,"bias"],[30,36,18,36],[30,38,18,38,"alpha"],[30,43,18,43],[30,45,18,45,"beta"],[30,49,18,49],[30,51,18,51],[31,6,19,8],[31,10,19,12],[31,11,19,13,"variableNames"],[31,24,19,26],[31,27,19,29],[31,28,19,30],[31,31,19,33],[31,32,19,34],[32,6,20,8],[32,10,20,12],[32,11,20,13,"outputShape"],[32,22,20,24],[32,25,20,27],[32,27,20,29],[33,6,21,8],[33,10,21,12],[33,11,21,13,"packedInputs"],[33,23,21,25],[33,26,21,28],[33,30,21,32],[34,6,22,8],[34,10,22,12],[34,11,22,13,"packedOutput"],[34,23,22,25],[34,26,22,28],[34,30,22,32],[35,6,23,8],[35,12,23,14,"rad"],[35,15,23,17],[35,18,23,20,"radius"],[35,24,23,26],[36,6,24,8],[36,12,24,14,"maxD"],[36,16,24,18],[36,19,24,21,"xShape"],[36,25,24,27],[36,26,24,28],[36,27,24,29],[36,28,24,30],[36,31,24,33],[36,32,24,34],[37,6,25,8],[37,10,25,12],[37,11,25,13,"outputShape"],[37,22,25,24],[37,25,25,27,"xShape"],[37,31,25,33],[38,6,26,8],[39,6,27,8],[40,6,28,8],[41,6,29,8],[42,6,30,8],[42,10,30,12,"powOperator"],[42,21,30,23],[43,6,31,8],[43,12,31,14,"basis"],[43,17,31,19],[43,20,31,22],[43,29,31,31,"bias"],[43,33,31,35],[43,46,31,48,"alpha"],[43,51,31,53],[43,60,31,62],[44,6,32,8],[44,10,32,12,"beta"],[44,14,32,16],[44,19,32,21],[44,22,32,24],[44,24,32,26],[45,8,33,12,"powOperator"],[45,19,33,23],[45,22,33,26],[45,37,33,41,"basis"],[45,42,33,46],[45,45,33,49],[46,6,34,8],[46,7,34,9],[46,13,35,13],[46,17,35,17,"beta"],[46,21,35,21],[46,26,35,26],[46,29,35,29],[46,31,35,31],[47,8,36,12,"powOperator"],[47,19,36,23],[47,22,36,26],[47,30,36,34,"basis"],[47,35,36,39],[47,38,36,42],[48,6,37,8],[48,7,37,9],[48,13,38,13],[49,8,39,12,"powOperator"],[49,19,39,23],[49,22,39,26],[49,33,39,37,"basis"],[49,38,39,42],[49,52,39,56,"beta"],[49,56,39,60],[49,61,39,65],[50,6,40,8],[51,6,41,8],[51,10,41,12],[51,11,41,13,"userCode"],[51,19,41,21],[51,22,41,24],[52,0,42,0],[53,0,43,0],[54,0,44,0],[55,0,45,0],[56,0,46,0],[57,0,47,0],[58,0,48,0],[59,0,49,0],[59,32,49,32],[59,36,49,36],[59,37,49,37,"outputShape"],[59,48,49,48],[59,49,49,49],[59,50,49,50],[59,51,49,51],[60,0,50,0],[60,32,50,32],[60,36,50,36],[60,37,50,37,"outputShape"],[60,48,50,48],[60,49,50,49],[60,50,50,50],[60,51,50,51],[61,0,51,0],[62,0,52,0],[63,0,53,0],[64,0,54,0],[65,0,55,0],[66,0,56,0],[67,0,57,0],[68,0,58,0],[69,0,59,0],[70,0,60,0],[71,0,61,0],[72,0,62,0],[73,0,63,0],[74,0,64,0],[75,0,65,0],[75,33,65,33,"rad"],[75,36,65,36],[76,0,66,0],[77,0,67,0],[78,0,68,0],[79,0,69,0],[80,0,70,0],[81,0,71,0],[82,0,72,0],[83,0,73,0],[84,0,74,0],[85,0,75,0],[86,0,76,0],[86,25,76,25,"rad"],[86,28,76,28],[86,38,76,38,"rad"],[86,41,76,41],[87,0,77,0],[88,0,78,0],[89,0,79,0],[89,61,79,61,"maxD"],[89,65,79,65],[90,0,80,0],[91,0,81,0],[92,0,82,0],[93,0,83,0],[94,0,84,0],[95,0,85,0],[96,0,86,0],[97,0,87,0],[98,0,88,0],[99,0,89,0],[100,0,90,0],[101,0,91,0],[102,0,92,0],[103,0,93,0],[104,0,94,0],[105,0,95,0],[106,0,96,0],[107,0,97,0],[108,0,98,0],[109,0,99,0],[110,0,100,0],[110,42,100,42,"powOperator"],[110,53,100,53],[111,0,101,0],[112,0,102,0],[113,0,103,0],[113,5,103,5],[114,4,104,4],[115,2,105,0],[116,0,105,1],[116,3]],"functionMap":{"names":["<global>","LRNPackedProgram","LRNPackedProgram#constructor"],"mappings":"AAA;OCgB;ICC;KDsF;CDC"},"hasCjsExports":false},"type":"js/module"}]}