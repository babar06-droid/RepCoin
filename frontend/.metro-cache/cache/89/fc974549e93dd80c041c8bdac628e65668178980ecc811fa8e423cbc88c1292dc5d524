{"dependencies":[{"name":"./gpgpu_math","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":17,"column":0,"index":703},"end":{"line":17,"column":48,"index":751}}],"key":"r7nFADTf/sGcqNrAYkmj7Z35J80=","exportNames":["*"],"imports":1}},{"name":"./shader_compiler_util","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":18,"column":0,"index":752},"end":{"line":18,"column":54,"index":806}}],"key":"MRaYEFt5V5oNumhqJDPCX030gRk=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopNamespace(e) {\n    if (e && e.__esModule) return e;\n    var n = {};\n    if (e) Object.keys(e).forEach(function (k) {\n      var d = Object.getOwnPropertyDescriptor(e, k);\n      Object.defineProperty(n, k, d.get ? d : {\n        enumerable: true,\n        get: function () {\n          return e[k];\n        }\n      });\n    });\n    n.default = e;\n    return n;\n  }\n  Object.defineProperty(exports, \"ReshapePackedProgram\", {\n    enumerable: true,\n    get: function () {\n      return ReshapePackedProgram;\n    }\n  });\n  var _gpgpu_math = require(_dependencyMap[0], \"./gpgpu_math\");\n  var _shader_compiler_util = require(_dependencyMap[1], \"./shader_compiler_util\");\n  var shader_util = _interopNamespace(_shader_compiler_util);\n  /**\n   * @license\n   * Copyright 2018 Google LLC. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   */\n\n  class ReshapePackedProgram {\n    constructor(outputShape, inputShape) {\n      this.variableNames = ['A'];\n      this.packedInputs = true;\n      this.packedOutput = true;\n      this.customUniforms = [{\n        name: 'inputShape',\n        type: 'ivec3'\n      }];\n      this.outputShape = outputShape;\n      this.enableShapeUniforms = (0, _gpgpu_math.useShapeUniforms)(this.outputShape.length);\n      let mainLoop = ``;\n      for (let i = 0; i < 4; i++) {\n        let thisRC = `thisRC = rc;`;\n        if (i % 2 === 1) {\n          thisRC += `thisRC.z += 1;`;\n        }\n        if (i > 1) {\n          thisRC += `thisRC.y += 1;`;\n        }\n        mainLoop += `\n        ${thisRC}\n        ${i > 0 ? `if(thisRC.y < rows && thisRC.z < cols){` : ''}\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[${i}] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ${i > 0 ? '}' : ''}\n      `;\n      }\n      this.userCode = `\n      ${getReshapedInputCoords(inputShape, this.enableShapeUniforms)}\n      ${this.enableShapeUniforms ? shader_util.getFlatIndexFrom3DOutput() : shader_util.getFlatIndexFrom3D(outputShape)}\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ${this.enableShapeUniforms ? 'outShape[1]' : outputShape[1]};\n        int cols = ${this.enableShapeUniforms ? 'outShape[2]' : outputShape[2]};\n\n        ${mainLoop}\n\n        setOutput(result);\n      }\n    `;\n    }\n  }\n  function getReshapedInputCoords(shape, enableShapeUniforms) {\n    const coordsFromIndexSnippet = enableShapeUniforms ? shader_util.getLogicalCoordinatesFromFlatIndexByUniform(['r', 'c', 'd'], 'inputShape') : shader_util.getLogicalCoordinatesFromFlatIndex(['r', 'c', 'd'], shape);\n    return `\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ${coordsFromIndexSnippet}\n      return ivec3(r, c, d);\n    }\n  `;\n  }\n});","lineCount":110,"map":[[22,2,19,0,"Object"],[22,8,19,0],[22,9,19,0,"defineProperty"],[22,23,19,0],[22,24,19,0,"exports"],[22,31,19,0],[23,4,19,0,"enumerable"],[23,14,19,0],[24,4,19,0,"get"],[24,7,19,0],[24,18,19,0,"get"],[24,19,19,0],[25,6,19,0],[25,13,19,0,"ReshapePackedProgram"],[25,33,19,0],[26,4,19,0],[27,2,19,0],[28,2,17,0],[28,6,17,0,"_gpgpu_math"],[28,17,17,0],[28,20,17,0,"require"],[28,27,17,0],[28,28,17,0,"_dependencyMap"],[28,42,17,0],[29,2,18,0],[29,6,18,0,"_shader_compiler_util"],[29,27,18,0],[29,30,18,0,"require"],[29,37,18,0],[29,38,18,0,"_dependencyMap"],[29,52,18,0],[30,2,18,0],[30,6,18,0,"shader_util"],[30,17,18,0],[30,20,18,0,"_interopNamespace"],[30,37,18,0],[30,38,18,0,"_shader_compiler_util"],[30,59,18,0],[31,2,1,0],[32,0,2,0],[33,0,3,0],[34,0,4,0],[35,0,5,0],[36,0,6,0],[37,0,7,0],[38,0,8,0],[39,0,9,0],[40,0,10,0],[41,0,11,0],[42,0,12,0],[43,0,13,0],[44,0,14,0],[45,0,15,0],[46,0,16,0],[48,2,19,7],[48,8,19,13,"ReshapePackedProgram"],[48,28,19,33],[48,29,19,34],[49,4,20,4,"constructor"],[49,15,20,15,"constructor"],[49,16,20,16,"outputShape"],[49,27,20,27],[49,29,20,29,"inputShape"],[49,39,20,39],[49,41,20,41],[50,6,21,8],[50,10,21,12],[50,11,21,13,"variableNames"],[50,24,21,26],[50,27,21,29],[50,28,21,30],[50,31,21,33],[50,32,21,34],[51,6,22,8],[51,10,22,12],[51,11,22,13,"packedInputs"],[51,23,22,25],[51,26,22,28],[51,30,22,32],[52,6,23,8],[52,10,23,12],[52,11,23,13,"packedOutput"],[52,23,23,25],[52,26,23,28],[52,30,23,32],[53,6,24,8],[53,10,24,12],[53,11,24,13,"customUniforms"],[53,25,24,27],[53,28,24,30],[53,29,24,31],[54,8,24,33,"name"],[54,12,24,37],[54,14,24,39],[54,26,24,51],[55,8,24,53,"type"],[55,12,24,57],[55,14,24,59],[56,6,24,67],[56,7,24,68],[56,8,24,69],[57,6,25,8],[57,10,25,12],[57,11,25,13,"outputShape"],[57,22,25,24],[57,25,25,27,"outputShape"],[57,36,25,38],[58,6,26,8],[58,10,26,12],[58,11,26,13,"enableShapeUniforms"],[58,30,26,32],[58,33,26,35],[58,37,26,35,"useShapeUniforms"],[58,48,26,51],[58,49,26,51,"useShapeUniforms"],[58,65,26,51],[58,67,26,52],[58,71,26,56],[58,72,26,57,"outputShape"],[58,83,26,68],[58,84,26,69,"length"],[58,90,26,75],[58,91,26,76],[59,6,27,8],[59,10,27,12,"mainLoop"],[59,18,27,20],[59,21,27,23],[59,23,27,25],[60,6,28,8],[60,11,28,13],[60,15,28,17,"i"],[60,16,28,18],[60,19,28,21],[60,20,28,22],[60,22,28,24,"i"],[60,23,28,25],[60,26,28,28],[60,27,28,29],[60,29,28,31,"i"],[60,30,28,32],[60,32,28,34],[60,34,28,36],[61,8,29,12],[61,12,29,16,"thisRC"],[61,18,29,22],[61,21,29,25],[61,35,29,39],[62,8,30,12],[62,12,30,16,"i"],[62,13,30,17],[62,16,30,20],[62,17,30,21],[62,22,30,26],[62,23,30,27],[62,25,30,29],[63,10,31,16,"thisRC"],[63,16,31,22],[63,20,31,26],[63,36,31,42],[64,8,32,12],[65,8,33,12],[65,12,33,16,"i"],[65,13,33,17],[65,16,33,20],[65,17,33,21],[65,19,33,23],[66,10,34,16,"thisRC"],[66,16,34,22],[66,20,34,26],[66,36,34,42],[67,8,35,12],[68,8,36,12,"mainLoop"],[68,16,36,20],[68,20,36,24],[69,0,37,0],[69,10,37,10,"thisRC"],[69,16,37,16],[70,0,38,0],[70,10,38,10,"i"],[70,11,38,11],[70,14,38,14],[70,15,38,15],[70,18,38,18],[70,59,38,59],[70,62,38,62],[70,64,38,64],[71,0,39,0],[72,0,40,0],[73,0,41,0],[74,0,42,0],[75,0,43,0],[76,0,44,0],[76,19,44,19,"i"],[76,20,44,20],[77,0,45,0],[78,0,46,0],[78,10,46,10,"i"],[78,11,46,11],[78,14,46,14],[78,15,46,15],[78,18,46,18],[78,21,46,21],[78,24,46,24],[78,26,46,26],[79,0,47,0],[79,7,47,7],[80,6,48,8],[81,6,49,8],[81,10,49,12],[81,11,49,13,"userCode"],[81,19,49,21],[81,22,49,24],[82,0,50,0],[82,8,50,8,"getReshapedInputCoords"],[82,30,50,30],[82,31,50,31,"inputShape"],[82,41,50,41],[82,43,50,43],[82,47,50,47],[82,48,50,48,"enableShapeUniforms"],[82,67,50,67],[82,68,50,68],[83,0,51,0],[83,8,51,8],[83,12,51,12],[83,13,51,13,"enableShapeUniforms"],[83,32,51,32],[83,35,51,35,"shader_util"],[83,46,51,46],[83,47,51,47,"getFlatIndexFrom3DOutput"],[83,71,51,71],[83,72,51,72],[83,73,51,73],[83,76,52,12,"shader_util"],[83,87,52,23],[83,88,52,24,"getFlatIndexFrom3D"],[83,106,52,42],[83,107,52,43,"outputShape"],[83,118,52,54],[83,119,52,55],[84,0,53,0],[85,0,54,0],[86,0,55,0],[87,0,56,0],[88,0,57,0],[89,0,58,0],[90,0,59,0],[91,0,60,0],[91,21,60,21],[91,25,60,25],[91,26,60,26,"enableShapeUniforms"],[91,45,60,45],[91,48,60,48],[91,61,60,61],[91,64,60,64,"outputShape"],[91,75,60,75],[91,76,60,76],[91,77,60,77],[91,78,60,78],[92,0,61,0],[92,21,61,21],[92,25,61,25],[92,26,61,26,"enableShapeUniforms"],[92,45,61,45],[92,48,61,48],[92,61,61,61],[92,64,61,64,"outputShape"],[92,75,61,75],[92,76,61,76],[92,77,61,77],[92,78,61,78],[93,0,62,0],[94,0,63,0],[94,10,63,10,"mainLoop"],[94,18,63,18],[95,0,64,0],[96,0,65,0],[97,0,66,0],[98,0,67,0],[98,5,67,5],[99,4,68,4],[100,2,69,0],[101,2,70,0],[101,11,70,9,"getReshapedInputCoords"],[101,33,70,31,"getReshapedInputCoords"],[101,34,70,32,"shape"],[101,39,70,37],[101,41,70,39,"enableShapeUniforms"],[101,60,70,58],[101,62,70,60],[102,4,71,4],[102,10,71,10,"coordsFromIndexSnippet"],[102,32,71,32],[102,35,71,35,"enableShapeUniforms"],[102,54,71,54],[102,57,72,8,"shader_util"],[102,68,72,19],[102,69,72,20,"getLogicalCoordinatesFromFlatIndexByUniform"],[102,112,72,63],[102,113,72,64],[102,114,72,65],[102,117,72,68],[102,119,72,70],[102,122,72,73],[102,124,72,75],[102,127,72,78],[102,128,72,79],[102,130,72,81],[102,142,72,93],[102,143,72,94],[102,146,73,8,"shader_util"],[102,157,73,19],[102,158,73,20,"getLogicalCoordinatesFromFlatIndex"],[102,192,73,54],[102,193,73,55],[102,194,73,56],[102,197,73,59],[102,199,73,61],[102,202,73,64],[102,204,73,66],[102,207,73,69],[102,208,73,70],[102,210,73,72,"shape"],[102,215,73,77],[102,216,73,78],[103,4,74,4],[103,11,74,11],[104,0,75,0],[105,0,76,0],[105,8,76,8,"coordsFromIndexSnippet"],[105,30,76,30],[106,0,77,0],[107,0,78,0],[108,0,79,0],[108,3,79,3],[109,2,80,0],[110,0,80,1],[110,3]],"functionMap":{"names":["<global>","ReshapePackedProgram","ReshapePackedProgram#constructor","getReshapedInputCoords"],"mappings":"AAA;OCkB;ICC;KDgD;CDC;AGC;CHU"},"hasCjsExports":false},"type":"js/module"}]}