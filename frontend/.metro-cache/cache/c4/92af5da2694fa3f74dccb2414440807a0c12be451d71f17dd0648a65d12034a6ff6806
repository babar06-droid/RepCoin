{"dependencies":[{"name":"./glsl_version","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":17,"column":0,"index":703},"end":{"line":17,"column":52,"index":755}}],"key":"PzwIhi74LcKYbosuBjZm+h3PwII=","exportNames":["*"],"imports":1}},{"name":"./gpgpu_math","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":18,"column":0,"index":756},"end":{"line":18,"column":48,"index":804}}],"key":"r7nFADTf/sGcqNrAYkmj7Z35J80=","exportNames":["*"],"imports":1}},{"name":"./shader_compiler_util","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":19,"column":0,"index":805},"end":{"line":19,"column":54,"index":859}}],"key":"MRaYEFt5V5oNumhqJDPCX030gRk=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopNamespace(e) {\n    if (e && e.__esModule) return e;\n    var n = {};\n    if (e) Object.keys(e).forEach(function (k) {\n      var d = Object.getOwnPropertyDescriptor(e, k);\n      Object.defineProperty(n, k, d.get ? d : {\n        enumerable: true,\n        get: function () {\n          return e[k];\n        }\n      });\n    });\n    n.default = e;\n    return n;\n  }\n  Object.defineProperty(exports, \"EncodeMatrixProgram\", {\n    enumerable: true,\n    get: function () {\n      return EncodeMatrixProgram;\n    }\n  });\n  var _glsl_version = require(_dependencyMap[0], \"./glsl_version\");\n  var _gpgpu_math = require(_dependencyMap[1], \"./gpgpu_math\");\n  var _shader_compiler_util = require(_dependencyMap[2], \"./shader_compiler_util\");\n  var shader_util = _interopNamespace(_shader_compiler_util);\n  /**\n   * @license\n   * Copyright 2018 Google LLC. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   */\n\n  const CHANNEL_CHAR_TO_INDEX_MAP = {\n    'R': 0,\n    'G': 1,\n    'B': 2,\n    'A': 3\n  };\n  class EncodeMatrixProgram {\n    constructor(outputShape, inputIsUnsignedByte = false, usedChannels = 'RGBA') {\n      this.variableNames = ['A'];\n      this.customUniforms = [{\n        name: 'texShape',\n        type: 'ivec2'\n      }];\n      const glsl = (0, _glsl_version.getGlslDifferences)();\n      this.outputShape = outputShape;\n      this.enableShapeUniforms = (0, _gpgpu_math.useShapeUniforms)(this.outputShape.length);\n      let output = `result`;\n      if (inputIsUnsignedByte) {\n        output = `floor(result * 255. + 0.5)`;\n      }\n      let mainLoop = '';\n      for (let usedChannelIndex = 0; usedChannelIndex < usedChannels.length; usedChannelIndex++) {\n        const curChannel = usedChannels[usedChannelIndex];\n        mainLoop += `\n          if(offset == ${usedChannelIndex}) {\n            result = values[${CHANNEL_CHAR_TO_INDEX_MAP[curChannel]}];\n          }`;\n      }\n      this.userCode = `\n      ${this.enableShapeUniforms ? shader_util.getFlatIndexFrom3DOutput() : shader_util.getFlatIndexFrom3D(outputShape)}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int flatIndex = getFlatIndex(coords);\n        float result = 0.;\n        int offset = imod(flatIndex, ${usedChannels.length});\n\n        flatIndex = idiv(flatIndex, ${usedChannels.length}, 1.);\n\n        int r = flatIndex / texShape[1];\n        if (r < texShape[0]) {\n          int c = imod(flatIndex, texShape[1]);\n          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n          vec4 values = ${glsl.texture2D}(A, uv);\n          ${mainLoop}\n        }\n        ${glsl.output} = vec4(${output}, 0., 0., 0.);\n      }\n    `;\n    }\n  }\n});","lineCount":100,"map":[[22,2,26,0,"Object"],[22,8,26,0],[22,9,26,0,"defineProperty"],[22,23,26,0],[22,24,26,0,"exports"],[22,31,26,0],[23,4,26,0,"enumerable"],[23,14,26,0],[24,4,26,0,"get"],[24,7,26,0],[24,18,26,0,"get"],[24,19,26,0],[25,6,26,0],[25,13,26,0,"EncodeMatrixProgram"],[25,32,26,0],[26,4,26,0],[27,2,26,0],[28,2,17,0],[28,6,17,0,"_glsl_version"],[28,19,17,0],[28,22,17,0,"require"],[28,29,17,0],[28,30,17,0,"_dependencyMap"],[28,44,17,0],[29,2,18,0],[29,6,18,0,"_gpgpu_math"],[29,17,18,0],[29,20,18,0,"require"],[29,27,18,0],[29,28,18,0,"_dependencyMap"],[29,42,18,0],[30,2,19,0],[30,6,19,0,"_shader_compiler_util"],[30,27,19,0],[30,30,19,0,"require"],[30,37,19,0],[30,38,19,0,"_dependencyMap"],[30,52,19,0],[31,2,19,0],[31,6,19,0,"shader_util"],[31,17,19,0],[31,20,19,0,"_interopNamespace"],[31,37,19,0],[31,38,19,0,"_shader_compiler_util"],[31,59,19,0],[32,2,1,0],[33,0,2,0],[34,0,3,0],[35,0,4,0],[36,0,5,0],[37,0,6,0],[38,0,7,0],[39,0,8,0],[40,0,9,0],[41,0,10,0],[42,0,11,0],[43,0,12,0],[44,0,13,0],[45,0,14,0],[46,0,15,0],[47,0,16,0],[49,2,20,0],[49,8,20,6,"CHANNEL_CHAR_TO_INDEX_MAP"],[49,33,20,31],[49,36,20,34],[50,4,21,4],[50,7,21,7],[50,9,21,9],[50,10,21,10],[51,4,22,4],[51,7,22,7],[51,9,22,9],[51,10,22,10],[52,4,23,4],[52,7,23,7],[52,9,23,9],[52,10,23,10],[53,4,24,4],[53,7,24,7],[53,9,24,9],[54,2,25,0],[54,3,25,1],[55,2,26,7],[55,8,26,13,"EncodeMatrixProgram"],[55,27,26,32],[55,28,26,33],[56,4,27,4,"constructor"],[56,15,27,15,"constructor"],[56,16,27,16,"outputShape"],[56,27,27,27],[56,29,27,29,"inputIsUnsignedByte"],[56,48,27,48],[56,51,27,51],[56,56,27,56],[56,58,27,58,"usedChannels"],[56,70,27,70],[56,73,27,73],[56,79,27,79],[56,81,27,81],[57,6,28,8],[57,10,28,12],[57,11,28,13,"variableNames"],[57,24,28,26],[57,27,28,29],[57,28,28,30],[57,31,28,33],[57,32,28,34],[58,6,29,8],[58,10,29,12],[58,11,29,13,"customUniforms"],[58,25,29,27],[58,28,29,30],[58,29,29,31],[59,8,29,33,"name"],[59,12,29,37],[59,14,29,39],[59,24,29,49],[60,8,29,51,"type"],[60,12,29,55],[60,14,29,57],[61,6,29,65],[61,7,29,66],[61,8,29,67],[62,6,30,8],[62,12,30,14,"glsl"],[62,16,30,18],[62,19,30,21],[62,23,30,21,"getGlslDifferences"],[62,36,30,39],[62,37,30,39,"getGlslDifferences"],[62,55,30,39],[62,57,30,40],[62,58,30,41],[63,6,31,8],[63,10,31,12],[63,11,31,13,"outputShape"],[63,22,31,24],[63,25,31,27,"outputShape"],[63,36,31,38],[64,6,32,8],[64,10,32,12],[64,11,32,13,"enableShapeUniforms"],[64,30,32,32],[64,33,32,35],[64,37,32,35,"useShapeUniforms"],[64,48,32,51],[64,49,32,51,"useShapeUniforms"],[64,65,32,51],[64,67,32,52],[64,71,32,56],[64,72,32,57,"outputShape"],[64,83,32,68],[64,84,32,69,"length"],[64,90,32,75],[64,91,32,76],[65,6,33,8],[65,10,33,12,"output"],[65,16,33,18],[65,19,33,21],[65,27,33,29],[66,6,34,8],[66,10,34,12,"inputIsUnsignedByte"],[66,29,34,31],[66,31,34,33],[67,8,35,12,"output"],[67,14,35,18],[67,17,35,21],[67,45,35,49],[68,6,36,8],[69,6,37,8],[69,10,37,12,"mainLoop"],[69,18,37,20],[69,21,37,23],[69,23,37,25],[70,6,38,8],[70,11,38,13],[70,15,38,17,"usedChannelIndex"],[70,31,38,33],[70,34,38,36],[70,35,38,37],[70,37,38,39,"usedChannelIndex"],[70,53,38,55],[70,56,38,58,"usedChannels"],[70,68,38,70],[70,69,38,71,"length"],[70,75,38,77],[70,77,38,79,"usedChannelIndex"],[70,93,38,95],[70,95,38,97],[70,97,38,99],[71,8,39,12],[71,14,39,18,"curChannel"],[71,24,39,28],[71,27,39,31,"usedChannels"],[71,39,39,43],[71,40,39,44,"usedChannelIndex"],[71,56,39,60],[71,57,39,61],[72,8,40,12,"mainLoop"],[72,16,40,20],[72,20,40,24],[73,0,41,0],[73,25,41,25,"usedChannelIndex"],[73,41,41,41],[74,0,42,0],[74,30,42,30,"CHANNEL_CHAR_TO_INDEX_MAP"],[74,55,42,55],[74,56,42,56,"curChannel"],[74,66,42,66],[74,67,42,67],[75,0,43,0],[75,12,43,12],[76,6,44,8],[77,6,45,8],[77,10,45,12],[77,11,45,13,"userCode"],[77,19,45,21],[77,22,45,24],[78,0,46,0],[78,8,46,8],[78,12,46,12],[78,13,46,13,"enableShapeUniforms"],[78,32,46,32],[78,35,46,35,"shader_util"],[78,46,46,46],[78,47,46,47,"getFlatIndexFrom3DOutput"],[78,71,46,71],[78,72,46,72],[78,73,46,73],[78,76,47,12,"shader_util"],[78,87,47,23],[78,88,47,24,"getFlatIndexFrom3D"],[78,106,47,42],[78,107,47,43,"outputShape"],[78,118,47,54],[78,119,47,55],[79,0,48,0],[80,0,49,0],[81,0,50,0],[82,0,51,0],[83,0,52,0],[84,0,53,0],[84,39,53,39,"usedChannels"],[84,51,53,51],[84,52,53,52,"length"],[84,58,53,58],[85,0,54,0],[86,0,55,0],[86,38,55,38,"usedChannels"],[86,50,55,50],[86,51,55,51,"length"],[86,57,55,57],[87,0,56,0],[88,0,57,0],[89,0,58,0],[90,0,59,0],[91,0,60,0],[92,0,61,0],[92,26,61,26,"glsl"],[92,30,61,30],[92,31,61,31,"texture2D"],[92,40,61,40],[93,0,62,0],[93,12,62,12,"mainLoop"],[93,20,62,20],[94,0,63,0],[95,0,64,0],[95,10,64,10,"glsl"],[95,14,64,14],[95,15,64,15,"output"],[95,21,64,21],[95,32,64,32,"output"],[95,38,64,38],[96,0,65,0],[97,0,66,0],[97,5,66,5],[98,4,67,4],[99,2,68,0],[100,0,68,1],[100,3]],"functionMap":{"names":["<global>","EncodeMatrixProgram","EncodeMatrixProgram#constructor"],"mappings":"AAA;OCyB;ICC;KDwC;CDC"},"hasCjsExports":false},"type":"js/module"}]}