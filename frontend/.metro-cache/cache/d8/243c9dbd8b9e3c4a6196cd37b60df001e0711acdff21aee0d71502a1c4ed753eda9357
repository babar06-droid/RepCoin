{"dependencies":[{"name":"../gradients","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":17,"column":0,"index":703},"end":{"line":17,"column":42,"index":745}}],"key":"89Hx1subF8nAOiIk6BMSSbJL3r0=","exportNames":["*"],"imports":1}},{"name":"../tensor_util_env","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":18,"column":0,"index":746},"end":{"line":18,"column":53,"index":799}}],"key":"UCKDOr/oOGi3nbD26ZhyAVW61qk=","exportNames":["*"],"imports":1}},{"name":"./cast","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":19,"column":0,"index":800},"end":{"line":19,"column":30,"index":830}}],"key":"zLuFDMcy9OTJI8veTtIwJ7mqKPc=","exportNames":["*"],"imports":1}},{"name":"./exp","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":20,"column":0,"index":831},"end":{"line":20,"column":28,"index":859}}],"key":"jtMdSIwu+u1bXGmrC5ls/G2TS5Q=","exportNames":["*"],"imports":1}},{"name":"./log","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":21,"column":0,"index":860},"end":{"line":21,"column":28,"index":888}}],"key":"zf+SD6oa8OIE8y54WLpxZOp3BAY=","exportNames":["*"],"imports":1}},{"name":"./max","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":22,"column":0,"index":889},"end":{"line":22,"column":28,"index":917}}],"key":"hxjdRchNojNlQP8qA8o5UfwpUy4=","exportNames":["*"],"imports":1}},{"name":"./mul","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":23,"column":0,"index":918},"end":{"line":23,"column":28,"index":946}}],"key":"dGJcm1XT1xn6xqxUHy8IlN16LWU=","exportNames":["*"],"imports":1}},{"name":"./operation","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":24,"column":0,"index":947},"end":{"line":24,"column":33,"index":980}}],"key":"lmmEAb6oR3TWnrsrETceKUovfkM=","exportNames":["*"],"imports":1}},{"name":"./sub","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":25,"column":0,"index":981},"end":{"line":25,"column":28,"index":1009}}],"key":"17GB/TfX+vYDBMGz0tnC+fKFzbE=","exportNames":["*"],"imports":1}},{"name":"./sum","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":26,"column":0,"index":1010},"end":{"line":26,"column":28,"index":1038}}],"key":"z5+UEKYm7EPFOvDayPGqJL+s3oY=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"logSoftmax\", {\n    enumerable: true,\n    get: function () {\n      return logSoftmax;\n    }\n  });\n  var _gradients = require(_dependencyMap[0], \"../gradients\");\n  var _tensor_util_env = require(_dependencyMap[1], \"../tensor_util_env\");\n  var _cast = require(_dependencyMap[2], \"./cast\");\n  var _exp = require(_dependencyMap[3], \"./exp\");\n  var _log = require(_dependencyMap[4], \"./log\");\n  var _max = require(_dependencyMap[5], \"./max\");\n  var _mul = require(_dependencyMap[6], \"./mul\");\n  var _operation = require(_dependencyMap[7], \"./operation\");\n  var _sub = require(_dependencyMap[8], \"./sub\");\n  var _sum = require(_dependencyMap[9], \"./sum\");\n  /**\n   * @license\n   * Copyright 2020 Google Inc. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   */\n\n  /**\n   * Computes the log softmax.\n   *\n   * ```js\n   * const a = tf.tensor1d([1, 2, 3]);\n   *\n   * a.logSoftmax().print();  // or tf.logSoftmax(a)\n   * ```\n   *\n   * ```js\n   * const a = tf.tensor2d([2, 4, 6, 1, 2, 3], [2, 3]);\n   *\n   * a.logSoftmax().print();  // or tf.logSoftmax(a)\n   * ```\n   *\n   * @param logits The logits array.\n   * @param axis The dimension softmax would be performed on. Defaults to `-1`\n   *     which indicates the last dimension.\n   *\n   * @doc {heading: 'Operations', subheading: 'Normalization'}\n   */\n  function logSoftmax_(logits, axis = -1) {\n    const $logits = (0, _tensor_util_env.convertToTensor)(logits, 'logits', 'logSoftmax');\n    if (axis === -1) {\n      axis = $logits.rank - 1;\n    }\n    if (axis !== $logits.rank - 1) {\n      throw Error('Log Softmax along a non-last dimension is not yet supported. ' + `Logits was rank ${$logits.rank} and axis was ${axis}`);\n    }\n    // const forward: ForwardFunc<Tensor> = (backend, save) => {\n    //   const keepDims = true;\n    //   const xMax = max(logits, axis, true);\n    //   const shifted = sub(logits, xMax);\n    //   const value =\n    //       sub(cast(shifted, 'float32'), log(sum(exp(shifted), axis,\n    //       keepDims)));\n    //   save([value]);\n    //   return value;\n    // };\n    // Use a custom gradient for numerical stability.\n    const customOp = (0, _gradients.customGrad)((logits, save) => {\n      const keepDims = true;\n      const xMax = (0, _max.max)(logits, axis, true);\n      const shifted = (0, _sub.sub)(logits, xMax);\n      const value = (0, _sub.sub)((0, _cast.cast)(shifted, 'float32'), (0, _log.log)((0, _sum.sum)((0, _exp.exp)(shifted), axis, keepDims)));\n      save([value]);\n      const gradFunc = (dy, saved) => {\n        const [value] = saved;\n        const keepDims = true;\n        const softmax = (0, _exp.exp)(value);\n        return (0, _sub.sub)(dy, (0, _mul.mul)((0, _sum.sum)(dy, axis, keepDims), softmax));\n      };\n      return {\n        value,\n        gradFunc\n      };\n    });\n    return customOp($logits);\n    // TODO Use Engine.runKernel when CPU/WebGL/WASM backends implement this.\n    // const inputs: LogSoftmaxInputs = {logits: $logits};\n    // const attrs: LogSoftmaxAttrs = {axis};\n    // return ENGINE.runKernel(\n    //            LogSoftmax, inputs as unknown as NamedTensorMap,\n    //            attrs as unknown as NamedAttrMap);\n  }\n  const logSoftmax = /* @__PURE__ */(0, _operation.op)({\n    logSoftmax_\n  });\n});","lineCount":108,"map":[[7,2,90,0,"Object"],[7,8,90,0],[7,9,90,0,"defineProperty"],[7,23,90,0],[7,24,90,0,"exports"],[7,31,90,0],[8,4,90,0,"enumerable"],[8,14,90,0],[9,4,90,0,"get"],[9,7,90,0],[9,18,90,0,"get"],[9,19,90,0],[10,6,90,0],[10,13,90,0,"logSoftmax"],[10,23,90,0],[11,4,90,0],[12,2,90,0],[13,2,17,0],[13,6,17,0,"_gradients"],[13,16,17,0],[13,19,17,0,"require"],[13,26,17,0],[13,27,17,0,"_dependencyMap"],[13,41,17,0],[14,2,18,0],[14,6,18,0,"_tensor_util_env"],[14,22,18,0],[14,25,18,0,"require"],[14,32,18,0],[14,33,18,0,"_dependencyMap"],[14,47,18,0],[15,2,19,0],[15,6,19,0,"_cast"],[15,11,19,0],[15,14,19,0,"require"],[15,21,19,0],[15,22,19,0,"_dependencyMap"],[15,36,19,0],[16,2,20,0],[16,6,20,0,"_exp"],[16,10,20,0],[16,13,20,0,"require"],[16,20,20,0],[16,21,20,0,"_dependencyMap"],[16,35,20,0],[17,2,21,0],[17,6,21,0,"_log"],[17,10,21,0],[17,13,21,0,"require"],[17,20,21,0],[17,21,21,0,"_dependencyMap"],[17,35,21,0],[18,2,22,0],[18,6,22,0,"_max"],[18,10,22,0],[18,13,22,0,"require"],[18,20,22,0],[18,21,22,0,"_dependencyMap"],[18,35,22,0],[19,2,23,0],[19,6,23,0,"_mul"],[19,10,23,0],[19,13,23,0,"require"],[19,20,23,0],[19,21,23,0,"_dependencyMap"],[19,35,23,0],[20,2,24,0],[20,6,24,0,"_operation"],[20,16,24,0],[20,19,24,0,"require"],[20,26,24,0],[20,27,24,0,"_dependencyMap"],[20,41,24,0],[21,2,25,0],[21,6,25,0,"_sub"],[21,10,25,0],[21,13,25,0,"require"],[21,20,25,0],[21,21,25,0,"_dependencyMap"],[21,35,25,0],[22,2,26,0],[22,6,26,0,"_sum"],[22,10,26,0],[22,13,26,0,"require"],[22,20,26,0],[22,21,26,0,"_dependencyMap"],[22,35,26,0],[23,2,1,0],[24,0,2,0],[25,0,3,0],[26,0,4,0],[27,0,5,0],[28,0,6,0],[29,0,7,0],[30,0,8,0],[31,0,9,0],[32,0,10,0],[33,0,11,0],[34,0,12,0],[35,0,13,0],[36,0,14,0],[37,0,15,0],[38,0,16,0],[40,2,27,0],[41,0,28,0],[42,0,29,0],[43,0,30,0],[44,0,31,0],[45,0,32,0],[46,0,33,0],[47,0,34,0],[48,0,35,0],[49,0,36,0],[50,0,37,0],[51,0,38,0],[52,0,39,0],[53,0,40,0],[54,0,41,0],[55,0,42,0],[56,0,43,0],[57,0,44,0],[58,0,45,0],[59,0,46,0],[60,0,47,0],[61,2,48,0],[61,11,48,9,"logSoftmax_"],[61,22,48,20,"logSoftmax_"],[61,23,48,21,"logits"],[61,29,48,27],[61,31,48,29,"axis"],[61,35,48,33],[61,38,48,36],[61,39,48,37],[61,40,48,38],[61,42,48,40],[62,4,49,4],[62,10,49,10,"$logits"],[62,17,49,17],[62,20,49,20],[62,24,49,20,"convertToTensor"],[62,40,49,35],[62,41,49,35,"convertToTensor"],[62,56,49,35],[62,58,49,36,"logits"],[62,64,49,42],[62,66,49,44],[62,74,49,52],[62,76,49,54],[62,88,49,66],[62,89,49,67],[63,4,50,4],[63,8,50,8,"axis"],[63,12,50,12],[63,17,50,17],[63,18,50,18],[63,19,50,19],[63,21,50,21],[64,6,51,8,"axis"],[64,10,51,12],[64,13,51,15,"$logits"],[64,20,51,22],[64,21,51,23,"rank"],[64,25,51,27],[64,28,51,30],[64,29,51,31],[65,4,52,4],[66,4,53,4],[66,8,53,8,"axis"],[66,12,53,12],[66,17,53,17,"$logits"],[66,24,53,24],[66,25,53,25,"rank"],[66,29,53,29],[66,32,53,32],[66,33,53,33],[66,35,53,35],[67,6,54,8],[67,12,54,14,"Error"],[67,17,54,19],[67,18,54,20],[67,81,54,83],[67,84,55,12],[67,103,55,31,"$logits"],[67,110,55,38],[67,111,55,39,"rank"],[67,115,55,43],[67,132,55,60,"axis"],[67,136,55,64],[67,138,55,66],[67,139,55,67],[68,4,56,4],[69,4,57,4],[70,4,58,4],[71,4,59,4],[72,4,60,4],[73,4,61,4],[74,4,62,4],[75,4,63,4],[76,4,64,4],[77,4,65,4],[78,4,66,4],[79,4,67,4],[80,4,68,4],[80,10,68,10,"customOp"],[80,18,68,18],[80,21,68,21],[80,25,68,21,"customGrad"],[80,35,68,31],[80,36,68,31,"customGrad"],[80,46,68,31],[80,48,68,32],[80,49,68,33,"logits"],[80,55,68,39],[80,57,68,41,"save"],[80,61,68,45],[80,66,68,50],[81,6,69,8],[81,12,69,14,"keepDims"],[81,20,69,22],[81,23,69,25],[81,27,69,29],[82,6,70,8],[82,12,70,14,"xMax"],[82,16,70,18],[82,19,70,21],[82,23,70,21,"max"],[82,27,70,24],[82,28,70,24,"max"],[82,31,70,24],[82,33,70,25,"logits"],[82,39,70,31],[82,41,70,33,"axis"],[82,45,70,37],[82,47,70,39],[82,51,70,43],[82,52,70,44],[83,6,71,8],[83,12,71,14,"shifted"],[83,19,71,21],[83,22,71,24],[83,26,71,24,"sub"],[83,30,71,27],[83,31,71,27,"sub"],[83,34,71,27],[83,36,71,28,"logits"],[83,42,71,34],[83,44,71,36,"xMax"],[83,48,71,40],[83,49,71,41],[84,6,72,8],[84,12,72,14,"value"],[84,17,72,19],[84,20,72,22],[84,24,72,22,"sub"],[84,28,72,25],[84,29,72,25,"sub"],[84,32,72,25],[84,34,72,26],[84,38,72,26,"cast"],[84,43,72,30],[84,44,72,30,"cast"],[84,48,72,30],[84,50,72,31,"shifted"],[84,57,72,38],[84,59,72,40],[84,68,72,49],[84,69,72,50],[84,71,72,52],[84,75,72,52,"log"],[84,79,72,55],[84,80,72,55,"log"],[84,83,72,55],[84,85,72,56],[84,89,72,56,"sum"],[84,93,72,59],[84,94,72,59,"sum"],[84,97,72,59],[84,99,72,60],[84,103,72,60,"exp"],[84,107,72,63],[84,108,72,63,"exp"],[84,111,72,63],[84,113,72,64,"shifted"],[84,120,72,71],[84,121,72,72],[84,123,72,74,"axis"],[84,127,72,78],[84,129,72,80,"keepDims"],[84,137,72,88],[84,138,72,89],[84,139,72,90],[84,140,72,91],[85,6,73,8,"save"],[85,10,73,12],[85,11,73,13],[85,12,73,14,"value"],[85,17,73,19],[85,18,73,20],[85,19,73,21],[86,6,74,8],[86,12,74,14,"gradFunc"],[86,20,74,22],[86,23,74,25,"gradFunc"],[86,24,74,26,"dy"],[86,26,74,28],[86,28,74,30,"saved"],[86,33,74,35],[86,38,74,40],[87,8,75,12],[87,14,75,18],[87,15,75,19,"value"],[87,20,75,24],[87,21,75,25],[87,24,75,28,"saved"],[87,29,75,33],[88,8,76,12],[88,14,76,18,"keepDims"],[88,22,76,26],[88,25,76,29],[88,29,76,33],[89,8,77,12],[89,14,77,18,"softmax"],[89,21,77,25],[89,24,77,28],[89,28,77,28,"exp"],[89,32,77,31],[89,33,77,31,"exp"],[89,36,77,31],[89,38,77,32,"value"],[89,43,77,37],[89,44,77,38],[90,8,78,12],[90,15,78,19],[90,19,78,19,"sub"],[90,23,78,22],[90,24,78,22,"sub"],[90,27,78,22],[90,29,78,23,"dy"],[90,31,78,25],[90,33,78,27],[90,37,78,27,"mul"],[90,41,78,30],[90,42,78,30,"mul"],[90,45,78,30],[90,47,78,31],[90,51,78,31,"sum"],[90,55,78,34],[90,56,78,34,"sum"],[90,59,78,34],[90,61,78,35,"dy"],[90,63,78,37],[90,65,78,39,"axis"],[90,69,78,43],[90,71,78,45,"keepDims"],[90,79,78,53],[90,80,78,54],[90,82,78,56,"softmax"],[90,89,78,63],[90,90,78,64],[90,91,78,65],[91,6,79,8],[91,7,79,9],[92,6,80,8],[92,13,80,15],[93,8,80,17,"value"],[93,13,80,22],[94,8,80,24,"gradFunc"],[95,6,80,33],[95,7,80,34],[96,4,81,4],[96,5,81,5],[96,6,81,6],[97,4,82,4],[97,11,82,11,"customOp"],[97,19,82,19],[97,20,82,20,"$logits"],[97,27,82,27],[97,28,82,28],[98,4,83,4],[99,4,84,4],[100,4,85,4],[101,4,86,4],[102,4,87,4],[103,4,88,4],[104,2,89,0],[105,2,90,7],[105,8,90,13,"logSoftmax"],[105,18,90,23],[105,21,90,26],[105,36,90,42],[105,40,90,42,"op"],[105,50,90,44],[105,51,90,44,"op"],[105,53,90,44],[105,55,90,45],[106,4,90,47,"logSoftmax_"],[107,2,90,59],[107,3,90,60],[107,4,90,61],[108,0,90,62],[108,3]],"functionMap":{"names":["<global>","logSoftmax_","customGrad$argument_0","gradFunc"],"mappings":"AAA;AC+C;gCCoB;yBCM;SDK;KDE;CDQ"},"hasCjsExports":false},"type":"js/module"}]}