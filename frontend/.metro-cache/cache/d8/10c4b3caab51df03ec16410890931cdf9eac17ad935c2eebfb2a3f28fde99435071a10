{"dependencies":[{"name":"./gpgpu_math","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":17,"column":0,"index":703},"end":{"line":17,"column":48,"index":751}}],"key":"r7nFADTf/sGcqNrAYkmj7Z35J80=","exportNames":["*"],"imports":1}},{"name":"./packing_util","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":18,"column":0,"index":752},"end":{"line":18,"column":45,"index":797}}],"key":"XZxV38atso3t5pLpH4+paVH17Hc=","exportNames":["*"],"imports":1}},{"name":"./shader_compiler","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":19,"column":0,"index":798},"end":{"line":19,"column":54,"index":852}}],"key":"yVSKlvZSxQn3Ck2puzGVWEYPzq8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"PackProgram\", {\n    enumerable: true,\n    get: function () {\n      return PackProgram;\n    }\n  });\n  var _gpgpu_math = require(_dependencyMap[0], \"./gpgpu_math\");\n  var _packing_util = require(_dependencyMap[1], \"./packing_util\");\n  var _shader_compiler = require(_dependencyMap[2], \"./shader_compiler\");\n  /**\n   * @license\n   * Copyright 2018 Google LLC. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   */\n\n  class PackProgram {\n    constructor(outputShape) {\n      this.variableNames = ['A'];\n      this.packedInputs = false;\n      this.packedOutput = true;\n      // Only input / output 3D tensors.\n      this.outputShape = outputShape;\n      this.rank = outputShape.length;\n      this.enableShapeUniforms = (0, _gpgpu_math.useShapeUniforms)(this.outputShape.length);\n      if (this.rank === 0) {\n        this.userCode = `\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      `;\n      } else {\n        const channels = (0, _packing_util.getChannels)('rc', this.rank);\n        const dtype = (0, _shader_compiler.getCoordsDataType)(this.rank);\n        const outOfBoundsCondition = this.getOutOfBoundsCondition(channels);\n        const setup = this.getSetup(channels);\n        const output = this.getOutput(channels);\n        this.userCode = `\n        void main() {\n          ${dtype} rc = getOutputCoords();\n\n          if(${outOfBoundsCondition}) {\n            setOutput(vec4(0));\n          } else {\n            ${setup}\n\n            setOutput(vec4(${output}));\n          }\n        }\n      `;\n      }\n    }\n    getSourceCoordsArr(dims) {\n      const coords = [];\n      for (let row = 0; row <= 1; row++) {\n        for (let col = 0; col <= 1; col++) {\n          let coord = `${row === 0 ? 'r' : 'rp1'}, ${col === 0 ? 'c' : 'cp1'}`;\n          for (let d = 2; d < this.rank; d++) {\n            coord = `${dims[dims.length - 1 - d]},` + coord;\n          }\n          coords.push(coord);\n        }\n      }\n      return coords;\n    }\n    getOutOfBoundsCondition(dims) {\n      if (this.rank === 1) {\n        return `rc > ${this.enableShapeUniforms ? 'outShape' : this.outputShape[0]}`;\n      }\n      let cond = '';\n      for (let i = this.rank - 2; i < this.rank; i++) {\n        cond += `${dims[i]} >= ${this.enableShapeUniforms ? `outShape[${i}]` : this.outputShape[i]}`;\n        if (i < this.rank - 1) {\n          cond += '||';\n        }\n      }\n      return cond;\n    }\n    getSetup(dims) {\n      if (this.rank === 1) {\n        return '';\n      }\n      const innerDims = dims.slice(-2);\n      const col = this.enableShapeUniforms ? `outShape[${this.rank} - 1]` : this.outputShape[this.rank - 1];\n      const row = this.enableShapeUniforms ? `outShape[${this.rank} - 2]` : this.outputShape[this.rank - 2];\n      return `\n      int r = ${innerDims[0]};\n      int c = ${innerDims[1]};\n      int rp1 = r + 1;\n      int cp1 = c + 1;\n\n      bool cEdge = cp1 >= ${col};\n      bool rEdge = rp1 >= ${row};\n    `;\n    }\n    getOutput(dims) {\n      const sourceCoords = this.getSourceCoordsArr(dims);\n      if (this.rank === 1) {\n        const outShape = this.enableShapeUniforms ? 'outShape' : this.outputShape[0];\n        return `getA(rc), (rc + 1 >= ${outShape} ? 0. : getA(rc + 1)), 0, 0`;\n      }\n      return `getA(${sourceCoords[0]}),\n            cEdge ? 0. : getA(${sourceCoords[1]}),\n            rEdge ? 0. : getA(${sourceCoords[2]}),\n            rEdge || cEdge ? 0. : getA(${sourceCoords[3]})`;\n    }\n  }\n});","lineCount":124,"map":[[7,2,20,0,"Object"],[7,8,20,0],[7,9,20,0,"defineProperty"],[7,23,20,0],[7,24,20,0,"exports"],[7,31,20,0],[8,4,20,0,"enumerable"],[8,14,20,0],[9,4,20,0,"get"],[9,7,20,0],[9,18,20,0,"get"],[9,19,20,0],[10,6,20,0],[10,13,20,0,"PackProgram"],[10,24,20,0],[11,4,20,0],[12,2,20,0],[13,2,17,0],[13,6,17,0,"_gpgpu_math"],[13,17,17,0],[13,20,17,0,"require"],[13,27,17,0],[13,28,17,0,"_dependencyMap"],[13,42,17,0],[14,2,18,0],[14,6,18,0,"_packing_util"],[14,19,18,0],[14,22,18,0,"require"],[14,29,18,0],[14,30,18,0,"_dependencyMap"],[14,44,18,0],[15,2,19,0],[15,6,19,0,"_shader_compiler"],[15,22,19,0],[15,25,19,0,"require"],[15,32,19,0],[15,33,19,0,"_dependencyMap"],[15,47,19,0],[16,2,1,0],[17,0,2,0],[18,0,3,0],[19,0,4,0],[20,0,5,0],[21,0,6,0],[22,0,7,0],[23,0,8,0],[24,0,9,0],[25,0,10,0],[26,0,11,0],[27,0,12,0],[28,0,13,0],[29,0,14,0],[30,0,15,0],[31,0,16,0],[33,2,20,7],[33,8,20,13,"PackProgram"],[33,19,20,24],[33,20,20,25],[34,4,21,4,"constructor"],[34,15,21,15,"constructor"],[34,16,21,16,"outputShape"],[34,27,21,27],[34,29,21,29],[35,6,22,8],[35,10,22,12],[35,11,22,13,"variableNames"],[35,24,22,26],[35,27,22,29],[35,28,22,30],[35,31,22,33],[35,32,22,34],[36,6,23,8],[36,10,23,12],[36,11,23,13,"packedInputs"],[36,23,23,25],[36,26,23,28],[36,31,23,33],[37,6,24,8],[37,10,24,12],[37,11,24,13,"packedOutput"],[37,23,24,25],[37,26,24,28],[37,30,24,32],[38,6,25,8],[39,6,26,8],[39,10,26,12],[39,11,26,13,"outputShape"],[39,22,26,24],[39,25,26,27,"outputShape"],[39,36,26,38],[40,6,27,8],[40,10,27,12],[40,11,27,13,"rank"],[40,15,27,17],[40,18,27,20,"outputShape"],[40,29,27,31],[40,30,27,32,"length"],[40,36,27,38],[41,6,28,8],[41,10,28,12],[41,11,28,13,"enableShapeUniforms"],[41,30,28,32],[41,33,28,35],[41,37,28,35,"useShapeUniforms"],[41,48,28,51],[41,49,28,51,"useShapeUniforms"],[41,65,28,51],[41,67,28,52],[41,71,28,56],[41,72,28,57,"outputShape"],[41,83,28,68],[41,84,28,69,"length"],[41,90,28,75],[41,91,28,76],[42,6,29,8],[42,10,29,12],[42,14,29,16],[42,15,29,17,"rank"],[42,19,29,21],[42,24,29,26],[42,25,29,27],[42,27,29,29],[43,8,30,12],[43,12,30,16],[43,13,30,17,"userCode"],[43,21,30,25],[43,24,30,28],[44,0,31,0],[45,0,32,0],[46,0,33,0],[47,0,34,0],[47,7,34,7],[48,6,35,8],[48,7,35,9],[48,13,36,13],[49,8,37,12],[49,14,37,18,"channels"],[49,22,37,26],[49,25,37,29],[49,29,37,29,"getChannels"],[49,42,37,40],[49,43,37,40,"getChannels"],[49,54,37,40],[49,56,37,41],[49,60,37,45],[49,62,37,47],[49,66,37,51],[49,67,37,52,"rank"],[49,71,37,56],[49,72,37,57],[50,8,38,12],[50,14,38,18,"dtype"],[50,19,38,23],[50,22,38,26],[50,26,38,26,"getCoordsDataType"],[50,42,38,43],[50,43,38,43,"getCoordsDataType"],[50,60,38,43],[50,62,38,44],[50,66,38,48],[50,67,38,49,"rank"],[50,71,38,53],[50,72,38,54],[51,8,39,12],[51,14,39,18,"outOfBoundsCondition"],[51,34,39,38],[51,37,39,41],[51,41,39,45],[51,42,39,46,"getOutOfBoundsCondition"],[51,65,39,69],[51,66,39,70,"channels"],[51,74,39,78],[51,75,39,79],[52,8,40,12],[52,14,40,18,"setup"],[52,19,40,23],[52,22,40,26],[52,26,40,30],[52,27,40,31,"getSetup"],[52,35,40,39],[52,36,40,40,"channels"],[52,44,40,48],[52,45,40,49],[53,8,41,12],[53,14,41,18,"output"],[53,20,41,24],[53,23,41,27],[53,27,41,31],[53,28,41,32,"getOutput"],[53,37,41,41],[53,38,41,42,"channels"],[53,46,41,50],[53,47,41,51],[54,8,42,12],[54,12,42,16],[54,13,42,17,"userCode"],[54,21,42,25],[54,24,42,28],[55,0,43,0],[56,0,44,0],[56,12,44,12,"dtype"],[56,17,44,17],[57,0,45,0],[58,0,46,0],[58,15,46,15,"outOfBoundsCondition"],[58,35,46,35],[59,0,47,0],[60,0,48,0],[61,0,49,0],[61,14,49,14,"setup"],[61,19,49,19],[62,0,50,0],[63,0,51,0],[63,29,51,29,"output"],[63,35,51,35],[64,0,52,0],[65,0,53,0],[66,0,54,0],[66,7,54,7],[67,6,55,8],[68,4,56,4],[69,4,57,4,"getSourceCoordsArr"],[69,22,57,22,"getSourceCoordsArr"],[69,23,57,23,"dims"],[69,27,57,27],[69,29,57,29],[70,6,58,8],[70,12,58,14,"coords"],[70,18,58,20],[70,21,58,23],[70,23,58,25],[71,6,59,8],[71,11,59,13],[71,15,59,17,"row"],[71,18,59,20],[71,21,59,23],[71,22,59,24],[71,24,59,26,"row"],[71,27,59,29],[71,31,59,33],[71,32,59,34],[71,34,59,36,"row"],[71,37,59,39],[71,39,59,41],[71,41,59,43],[72,8,60,12],[72,13,60,17],[72,17,60,21,"col"],[72,20,60,24],[72,23,60,27],[72,24,60,28],[72,26,60,30,"col"],[72,29,60,33],[72,33,60,37],[72,34,60,38],[72,36,60,40,"col"],[72,39,60,43],[72,41,60,45],[72,43,60,47],[73,10,61,16],[73,14,61,20,"coord"],[73,19,61,25],[73,22,61,28],[73,25,61,31,"row"],[73,28,61,34],[73,33,61,39],[73,34,61,40],[73,37,61,43],[73,40,61,46],[73,43,61,49],[73,48,61,54],[73,53,61,59,"col"],[73,56,61,62],[73,61,61,67],[73,62,61,68],[73,65,61,71],[73,68,61,74],[73,71,61,77],[73,76,61,82],[73,78,61,84],[74,10,62,16],[74,15,62,21],[74,19,62,25,"d"],[74,20,62,26],[74,23,62,29],[74,24,62,30],[74,26,62,32,"d"],[74,27,62,33],[74,30,62,36],[74,34,62,40],[74,35,62,41,"rank"],[74,39,62,45],[74,41,62,47,"d"],[74,42,62,48],[74,44,62,50],[74,46,62,52],[75,12,63,20,"coord"],[75,17,63,25],[75,20,63,28],[75,23,63,31,"dims"],[75,27,63,35],[75,28,63,36,"dims"],[75,32,63,40],[75,33,63,41,"length"],[75,39,63,47],[75,42,63,50],[75,43,63,51],[75,46,63,54,"d"],[75,47,63,55],[75,48,63,56],[75,51,63,59],[75,54,63,62,"coord"],[75,59,63,67],[76,10,64,16],[77,10,65,16,"coords"],[77,16,65,22],[77,17,65,23,"push"],[77,21,65,27],[77,22,65,28,"coord"],[77,27,65,33],[77,28,65,34],[78,8,66,12],[79,6,67,8],[80,6,68,8],[80,13,68,15,"coords"],[80,19,68,21],[81,4,69,4],[82,4,70,4,"getOutOfBoundsCondition"],[82,27,70,27,"getOutOfBoundsCondition"],[82,28,70,28,"dims"],[82,32,70,32],[82,34,70,34],[83,6,71,8],[83,10,71,12],[83,14,71,16],[83,15,71,17,"rank"],[83,19,71,21],[83,24,71,26],[83,25,71,27],[83,27,71,29],[84,8,72,12],[84,15,72,19],[84,23,72,27],[84,27,72,31],[84,28,72,32,"enableShapeUniforms"],[84,47,72,51],[84,50,72,54],[84,60,72,64],[84,63,72,67],[84,67,72,71],[84,68,72,72,"outputShape"],[84,79,72,83],[84,80,72,84],[84,81,72,85],[84,82,72,86],[84,84,72,88],[85,6,73,8],[86,6,74,8],[86,10,74,12,"cond"],[86,14,74,16],[86,17,74,19],[86,19,74,21],[87,6,75,8],[87,11,75,13],[87,15,75,17,"i"],[87,16,75,18],[87,19,75,21],[87,23,75,25],[87,24,75,26,"rank"],[87,28,75,30],[87,31,75,33],[87,32,75,34],[87,34,75,36,"i"],[87,35,75,37],[87,38,75,40],[87,42,75,44],[87,43,75,45,"rank"],[87,47,75,49],[87,49,75,51,"i"],[87,50,75,52],[87,52,75,54],[87,54,75,56],[88,8,76,12,"cond"],[88,12,76,16],[88,16,76,20],[88,19,76,23,"dims"],[88,23,76,27],[88,24,76,28,"i"],[88,25,76,29],[88,26,76,30],[88,33,76,37],[88,37,76,41],[88,38,76,42,"enableShapeUniforms"],[88,57,76,61],[88,60,76,64],[88,72,76,76,"i"],[88,73,76,77],[88,76,76,80],[88,79,76,83],[88,83,76,87],[88,84,76,88,"outputShape"],[88,95,76,99],[88,96,76,100,"i"],[88,97,76,101],[88,98,76,102],[88,100,76,104],[89,8,77,12],[89,12,77,16,"i"],[89,13,77,17],[89,16,77,20],[89,20,77,24],[89,21,77,25,"rank"],[89,25,77,29],[89,28,77,32],[89,29,77,33],[89,31,77,35],[90,10,78,16,"cond"],[90,14,78,20],[90,18,78,24],[90,22,78,28],[91,8,79,12],[92,6,80,8],[93,6,81,8],[93,13,81,15,"cond"],[93,17,81,19],[94,4,82,4],[95,4,83,4,"getSetup"],[95,12,83,12,"getSetup"],[95,13,83,13,"dims"],[95,17,83,17],[95,19,83,19],[96,6,84,8],[96,10,84,12],[96,14,84,16],[96,15,84,17,"rank"],[96,19,84,21],[96,24,84,26],[96,25,84,27],[96,27,84,29],[97,8,85,12],[97,15,85,19],[97,17,85,21],[98,6,86,8],[99,6,87,8],[99,12,87,14,"innerDims"],[99,21,87,23],[99,24,87,26,"dims"],[99,28,87,30],[99,29,87,31,"slice"],[99,34,87,36],[99,35,87,37],[99,36,87,38],[99,37,87,39],[99,38,87,40],[100,6,88,8],[100,12,88,14,"col"],[100,15,88,17],[100,18,88,20],[100,22,88,24],[100,23,88,25,"enableShapeUniforms"],[100,42,88,44],[100,45,88,47],[100,57,88,59],[100,61,88,63],[100,62,88,64,"rank"],[100,66,88,68],[100,73,88,75],[100,76,89,12],[100,80,89,16],[100,81,89,17,"outputShape"],[100,92,89,28],[100,93,89,29],[100,97,89,33],[100,98,89,34,"rank"],[100,102,89,38],[100,105,89,41],[100,106,89,42],[100,107,89,43],[101,6,90,8],[101,12,90,14,"row"],[101,15,90,17],[101,18,90,20],[101,22,90,24],[101,23,90,25,"enableShapeUniforms"],[101,42,90,44],[101,45,90,47],[101,57,90,59],[101,61,90,63],[101,62,90,64,"rank"],[101,66,90,68],[101,73,90,75],[101,76,91,12],[101,80,91,16],[101,81,91,17,"outputShape"],[101,92,91,28],[101,93,91,29],[101,97,91,33],[101,98,91,34,"rank"],[101,102,91,38],[101,105,91,41],[101,106,91,42],[101,107,91,43],[102,6,92,8],[102,13,92,15],[103,0,93,0],[103,16,93,16,"innerDims"],[103,25,93,25],[103,26,93,26],[103,27,93,27],[103,28,93,28],[104,0,94,0],[104,16,94,16,"innerDims"],[104,25,94,25],[104,26,94,26],[104,27,94,27],[104,28,94,28],[105,0,95,0],[106,0,96,0],[107,0,97,0],[108,0,98,0],[108,28,98,28,"col"],[108,31,98,31],[109,0,99,0],[109,28,99,28,"row"],[109,31,99,31],[110,0,100,0],[110,5,100,5],[111,4,101,4],[112,4,102,4,"getOutput"],[112,13,102,13,"getOutput"],[112,14,102,14,"dims"],[112,18,102,18],[112,20,102,20],[113,6,103,8],[113,12,103,14,"sourceCoords"],[113,24,103,26],[113,27,103,29],[113,31,103,33],[113,32,103,34,"getSourceCoordsArr"],[113,50,103,52],[113,51,103,53,"dims"],[113,55,103,57],[113,56,103,58],[114,6,104,8],[114,10,104,12],[114,14,104,16],[114,15,104,17,"rank"],[114,19,104,21],[114,24,104,26],[114,25,104,27],[114,27,104,29],[115,8,105,12],[115,14,105,18,"outShape"],[115,22,105,26],[115,25,105,29],[115,29,105,33],[115,30,105,34,"enableShapeUniforms"],[115,49,105,53],[115,52,105,56],[115,62,105,66],[115,65,105,69],[115,69,105,73],[115,70,105,74,"outputShape"],[115,81,105,85],[115,82,105,86],[115,83,105,87],[115,84,105,88],[116,8,106,12],[116,15,106,19],[116,39,106,43,"outShape"],[116,47,106,51],[116,76,106,80],[117,6,107,8],[118,6,108,8],[118,13,108,15],[118,21,108,23,"sourceCoords"],[118,33,108,35],[118,34,108,36],[118,35,108,37],[118,36,108,38],[119,0,109,0],[119,32,109,32,"sourceCoords"],[119,44,109,44],[119,45,109,45],[119,46,109,46],[119,47,109,47],[120,0,110,0],[120,32,110,32,"sourceCoords"],[120,44,110,44],[120,45,110,45],[120,46,110,46],[120,47,110,47],[121,0,111,0],[121,41,111,41,"sourceCoords"],[121,53,111,53],[121,54,111,54],[121,55,111,55],[121,56,111,56],[121,59,111,59],[122,4,112,4],[123,2,113,0],[124,0,113,1],[124,3]],"functionMap":{"names":["<global>","PackProgram","PackProgram#constructor","PackProgram#getSourceCoordsArr","PackProgram#getOutOfBoundsCondition","PackProgram#getSetup","PackProgram#getOutput"],"mappings":"AAA;OCmB;ICC;KDmC;IEC;KFY;IGC;KHY;IIC;KJkB;IKC;KLU;CDC"},"hasCjsExports":false},"type":"js/module"}]}