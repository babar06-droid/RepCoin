{"dependencies":[],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"CropAndResizeProgram\", {\n    enumerable: true,\n    get: function () {\n      return CropAndResizeProgram;\n    }\n  });\n  /**\n   * @license\n   * Copyright 2017 Google LLC. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   */\n  class CropAndResizeProgram {\n    constructor(imageShape, boxShape, cropSize, method, extrapolationValue) {\n      this.variableNames = ['Image', 'Boxes', 'BoxInd'];\n      this.outputShape = [];\n      const [batch, imageHeight, imageWidth, depth] = imageShape;\n      const [numBoxes] = boxShape;\n      const [cropHeight, cropWidth] = cropSize;\n      this.outputShape = [numBoxes, cropHeight, cropWidth, depth];\n      const methodId = method === 'bilinear' ? 1 : 0;\n      const [inputHeightFloat, inputWidthFloat] = [`${imageHeight - 1}.0`, `${imageWidth - 1}.0`];\n      const [heightRatio, heightScale, inY] = cropHeight > 1 ? [`${(imageHeight - 1) / (cropHeight - 1)}`, '(y2-y1) * height_ratio', `y1*${inputHeightFloat} + float(y)*(height_scale)`] : ['0.0', '0.0', `0.5 * (y1+y2) * ${inputHeightFloat}`];\n      const [widthRatio, widthScale, inX] = cropWidth > 1 ? [`${(imageWidth - 1) / (cropWidth - 1)}`, '(x2-x1) * width_ratio', `x1*${inputWidthFloat} + float(x)*(width_scale)`] : ['0.0', '0.0', `0.5 * (x1+x2) * ${inputWidthFloat}`];\n      // Reference implementation\n      // tslint:disable-next-line:max-line-length\n      // https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/kernels/crop_and_resize_op_gpu.cu.cc\n      this.userCode = `\n      const float height_ratio = float(${heightRatio});\n      const float width_ratio = float(${widthRatio});\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ${batch}) {\n          return;\n        }\n\n        float height_scale = ${heightScale};\n        float width_scale = ${widthScale};\n\n        float in_y = ${inY};\n        if( in_y < 0.0 || in_y > ${inputHeightFloat} ) {\n          setOutput(float(${extrapolationValue}));\n          return;\n        }\n        float in_x = ${inX};\n        if( in_x < 0.0 || in_x > ${inputWidthFloat} ) {\n          setOutput(float(${extrapolationValue}));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(${methodId} == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    `;\n    }\n  }\n});","lineCount":108,"map":[[7,2,17,0,"Object"],[7,8,17,0],[7,9,17,0,"defineProperty"],[7,23,17,0],[7,24,17,0,"exports"],[7,31,17,0],[8,4,17,0,"enumerable"],[8,14,17,0],[9,4,17,0,"get"],[9,7,17,0],[9,18,17,0,"get"],[9,19,17,0],[10,6,17,0],[10,13,17,0,"CropAndResizeProgram"],[10,33,17,0],[11,4,17,0],[12,2,17,0],[13,2,1,0],[14,0,2,0],[15,0,3,0],[16,0,4,0],[17,0,5,0],[18,0,6,0],[19,0,7,0],[20,0,8,0],[21,0,9,0],[22,0,10,0],[23,0,11,0],[24,0,12,0],[25,0,13,0],[26,0,14,0],[27,0,15,0],[28,0,16,0],[29,2,17,7],[29,8,17,13,"CropAndResizeProgram"],[29,28,17,33],[29,29,17,34],[30,4,18,4,"constructor"],[30,15,18,15,"constructor"],[30,16,18,16,"imageShape"],[30,26,18,26],[30,28,18,28,"boxShape"],[30,36,18,36],[30,38,18,38,"cropSize"],[30,46,18,46],[30,48,18,48,"method"],[30,54,18,54],[30,56,18,56,"extrapolationValue"],[30,74,18,74],[30,76,18,76],[31,6,19,8],[31,10,19,12],[31,11,19,13,"variableNames"],[31,24,19,26],[31,27,19,29],[31,28,19,30],[31,35,19,37],[31,37,19,39],[31,44,19,46],[31,46,19,48],[31,54,19,56],[31,55,19,57],[32,6,20,8],[32,10,20,12],[32,11,20,13,"outputShape"],[32,22,20,24],[32,25,20,27],[32,27,20,29],[33,6,21,8],[33,12,21,14],[33,13,21,15,"batch"],[33,18,21,20],[33,20,21,22,"imageHeight"],[33,31,21,33],[33,33,21,35,"imageWidth"],[33,43,21,45],[33,45,21,47,"depth"],[33,50,21,52],[33,51,21,53],[33,54,21,56,"imageShape"],[33,64,21,66],[34,6,22,8],[34,12,22,14],[34,13,22,15,"numBoxes"],[34,21,22,23],[34,22,22,25],[34,25,22,28,"boxShape"],[34,33,22,36],[35,6,23,8],[35,12,23,14],[35,13,23,15,"cropHeight"],[35,23,23,25],[35,25,23,27,"cropWidth"],[35,34,23,36],[35,35,23,37],[35,38,23,40,"cropSize"],[35,46,23,48],[36,6,24,8],[36,10,24,12],[36,11,24,13,"outputShape"],[36,22,24,24],[36,25,24,27],[36,26,24,28,"numBoxes"],[36,34,24,36],[36,36,24,38,"cropHeight"],[36,46,24,48],[36,48,24,50,"cropWidth"],[36,57,24,59],[36,59,24,61,"depth"],[36,64,24,66],[36,65,24,67],[37,6,25,8],[37,12,25,14,"methodId"],[37,20,25,22],[37,23,25,25,"method"],[37,29,25,31],[37,34,25,36],[37,44,25,46],[37,47,25,49],[37,48,25,50],[37,51,25,53],[37,52,25,54],[38,6,26,8],[38,12,26,14],[38,13,26,15,"inputHeightFloat"],[38,29,26,31],[38,31,26,33,"inputWidthFloat"],[38,46,26,48],[38,47,26,49],[38,50,26,52],[38,51,26,53],[38,54,26,56,"imageHeight"],[38,65,26,67],[38,68,26,70],[38,69,26,71],[38,73,26,75],[38,75,26,77],[38,78,26,80,"imageWidth"],[38,88,26,90],[38,91,26,93],[38,92,26,94],[38,96,26,98],[38,97,26,99],[39,6,27,8],[39,12,27,14],[39,13,27,15,"heightRatio"],[39,24,27,26],[39,26,27,28,"heightScale"],[39,37,27,39],[39,39,27,41,"inY"],[39,42,27,44],[39,43,27,45],[39,46,27,48,"cropHeight"],[39,56,27,58],[39,59,27,61],[39,60,27,62],[39,63,28,12],[39,64,29,16],[39,67,29,19],[39,68,29,20,"imageHeight"],[39,79,29,31],[39,82,29,34],[39,83,29,35],[39,88,29,40,"cropHeight"],[39,98,29,50],[39,101,29,53],[39,102,29,54],[39,103,29,55],[39,105,29,57],[39,107,30,16],[39,131,30,40],[39,133,31,16],[39,139,31,22,"inputHeightFloat"],[39,155,31,38],[39,183,31,66],[39,184,32,13],[39,187,33,12],[39,188,34,16],[39,193,34,21],[39,195,35,16],[39,200,35,21],[39,202,36,16],[39,221,36,35,"inputHeightFloat"],[39,237,36,51],[39,239,36,53],[39,240,37,13],[40,6,38,8],[40,12,38,14],[40,13,38,15,"widthRatio"],[40,23,38,25],[40,25,38,27,"widthScale"],[40,35,38,37],[40,37,38,39,"inX"],[40,40,38,42],[40,41,38,43],[40,44,38,46,"cropWidth"],[40,53,38,55],[40,56,38,58],[40,57,38,59],[40,60,39,12],[40,61,40,16],[40,64,40,19],[40,65,40,20,"imageWidth"],[40,75,40,30],[40,78,40,33],[40,79,40,34],[40,84,40,39,"cropWidth"],[40,93,40,48],[40,96,40,51],[40,97,40,52],[40,98,40,53],[40,100,40,55],[40,102,41,16],[40,125,41,39],[40,127,42,16],[40,133,42,22,"inputWidthFloat"],[40,148,42,37],[40,175,42,64],[40,176,43,13],[40,179,44,12],[40,180,45,16],[40,185,45,21],[40,187,46,16],[40,192,46,21],[40,194,47,16],[40,213,47,35,"inputWidthFloat"],[40,228,47,50],[40,230,47,52],[40,231,48,13],[41,6,49,8],[42,6,50,8],[43,6,51,8],[44,6,52,8],[44,10,52,12],[44,11,52,13,"userCode"],[44,19,52,21],[44,22,52,24],[45,0,53,0],[45,41,53,41,"heightRatio"],[45,52,53,52],[46,0,54,0],[46,40,54,40,"widthRatio"],[46,50,54,50],[47,0,55,0],[48,0,56,0],[49,0,57,0],[50,0,58,0],[51,0,59,0],[52,0,60,0],[53,0,61,0],[54,0,62,0],[55,0,63,0],[56,0,64,0],[57,0,65,0],[58,0,66,0],[59,0,67,0],[60,0,68,0],[61,0,69,0],[62,0,70,0],[62,33,70,33,"batch"],[62,38,70,38],[63,0,71,0],[64,0,72,0],[65,0,73,0],[66,0,74,0],[66,31,74,31,"heightScale"],[66,42,74,42],[67,0,75,0],[67,30,75,30,"widthScale"],[67,40,75,40],[68,0,76,0],[69,0,77,0],[69,23,77,23,"inY"],[69,26,77,26],[70,0,78,0],[70,35,78,35,"inputHeightFloat"],[70,51,78,51],[71,0,79,0],[71,28,79,28,"extrapolationValue"],[71,46,79,46],[72,0,80,0],[73,0,81,0],[74,0,82,0],[74,23,82,23,"inX"],[74,26,82,26],[75,0,83,0],[75,35,83,35,"inputWidthFloat"],[75,50,83,50],[76,0,84,0],[76,28,84,28,"extrapolationValue"],[76,46,84,46],[77,0,85,0],[78,0,86,0],[79,0,87,0],[80,0,88,0],[81,0,89,0],[81,13,89,13,"methodId"],[81,21,89,21],[82,0,90,0],[83,0,91,0],[84,0,92,0],[85,0,93,0],[86,0,94,0],[87,0,95,0],[88,0,96,0],[89,0,97,0],[90,0,98,0],[91,0,99,0],[92,0,100,0],[93,0,101,0],[94,0,102,0],[95,0,103,0],[96,0,104,0],[97,0,105,0],[98,0,106,0],[99,0,107,0],[100,0,108,0],[101,0,109,0],[102,0,110,0],[103,0,111,0],[104,0,112,0],[105,0,113,0],[105,5,113,5],[106,4,114,4],[107,2,115,0],[108,0,115,1],[108,3]],"functionMap":{"names":["<global>","CropAndResizeProgram","CropAndResizeProgram#constructor"],"mappings":"AAA;OCgB;ICC;KDgG;CDC"},"hasCjsExports":false},"type":"js/module"}]}