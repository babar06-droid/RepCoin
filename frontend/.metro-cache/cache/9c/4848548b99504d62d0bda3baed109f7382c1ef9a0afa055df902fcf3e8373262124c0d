{"dependencies":[],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"LRNProgram\", {\n    enumerable: true,\n    get: function () {\n      return LRNProgram;\n    }\n  });\n  /**\n   * @license\n   * Copyright 2017 Google LLC. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   */\n  class LRNProgram {\n    constructor(xShape, radius, bias, alpha, beta) {\n      this.variableNames = ['x'];\n      this.outputShape = [];\n      const rad = radius;\n      const maxD = xShape[3] - 1;\n      this.outputShape = xShape;\n      // optimize pow(bias + alpha * sum, -beta)\n      // src: https://github.com/tensorflow/tensorflow/..\n      // blob/26033a1644a9c4a5fbe3170ab2e864b6a4ccd4ca/..\n      // tensorflow/core/kernels/mkl_lrn_op.cc#L320\n      let powOperator;\n      const basis = `float(${bias}) + float(${alpha}) * sum`;\n      if (beta === 0.5) {\n        powOperator = `inversesqrt(${basis})`;\n      } else if (beta === 1.0) {\n        powOperator = `1.0/(${basis})`;\n      } else {\n        powOperator = `exp(log(${basis}) * float(-${beta}));`;\n      }\n      this.userCode = `\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -${rad}; j <= ${rad}; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ${maxD}) {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ${powOperator};\n        setOutput(val);\n      }\n    `;\n    }\n  }\n});","lineCount":71,"map":[[7,2,17,0,"Object"],[7,8,17,0],[7,9,17,0,"defineProperty"],[7,23,17,0],[7,24,17,0,"exports"],[7,31,17,0],[8,4,17,0,"enumerable"],[8,14,17,0],[9,4,17,0,"get"],[9,7,17,0],[9,18,17,0,"get"],[9,19,17,0],[10,6,17,0],[10,13,17,0,"LRNProgram"],[10,23,17,0],[11,4,17,0],[12,2,17,0],[13,2,1,0],[14,0,2,0],[15,0,3,0],[16,0,4,0],[17,0,5,0],[18,0,6,0],[19,0,7,0],[20,0,8,0],[21,0,9,0],[22,0,10,0],[23,0,11,0],[24,0,12,0],[25,0,13,0],[26,0,14,0],[27,0,15,0],[28,0,16,0],[29,2,17,7],[29,8,17,13,"LRNProgram"],[29,18,17,23],[29,19,17,24],[30,4,18,4,"constructor"],[30,15,18,15,"constructor"],[30,16,18,16,"xShape"],[30,22,18,22],[30,24,18,24,"radius"],[30,30,18,30],[30,32,18,32,"bias"],[30,36,18,36],[30,38,18,38,"alpha"],[30,43,18,43],[30,45,18,45,"beta"],[30,49,18,49],[30,51,18,51],[31,6,19,8],[31,10,19,12],[31,11,19,13,"variableNames"],[31,24,19,26],[31,27,19,29],[31,28,19,30],[31,31,19,33],[31,32,19,34],[32,6,20,8],[32,10,20,12],[32,11,20,13,"outputShape"],[32,22,20,24],[32,25,20,27],[32,27,20,29],[33,6,21,8],[33,12,21,14,"rad"],[33,15,21,17],[33,18,21,20,"radius"],[33,24,21,26],[34,6,22,8],[34,12,22,14,"maxD"],[34,16,22,18],[34,19,22,21,"xShape"],[34,25,22,27],[34,26,22,28],[34,27,22,29],[34,28,22,30],[34,31,22,33],[34,32,22,34],[35,6,23,8],[35,10,23,12],[35,11,23,13,"outputShape"],[35,22,23,24],[35,25,23,27,"xShape"],[35,31,23,33],[36,6,24,8],[37,6,25,8],[38,6,26,8],[39,6,27,8],[40,6,28,8],[40,10,28,12,"powOperator"],[40,21,28,23],[41,6,29,8],[41,12,29,14,"basis"],[41,17,29,19],[41,20,29,22],[41,29,29,31,"bias"],[41,33,29,35],[41,46,29,48,"alpha"],[41,51,29,53],[41,60,29,62],[42,6,30,8],[42,10,30,12,"beta"],[42,14,30,16],[42,19,30,21],[42,22,30,24],[42,24,30,26],[43,8,31,12,"powOperator"],[43,19,31,23],[43,22,31,26],[43,37,31,41,"basis"],[43,42,31,46],[43,45,31,49],[44,6,32,8],[44,7,32,9],[44,13,33,13],[44,17,33,17,"beta"],[44,21,33,21],[44,26,33,26],[44,29,33,29],[44,31,33,31],[45,8,34,12,"powOperator"],[45,19,34,23],[45,22,34,26],[45,30,34,34,"basis"],[45,35,34,39],[45,38,34,42],[46,6,35,8],[46,7,35,9],[46,13,36,13],[47,8,37,12,"powOperator"],[47,19,37,23],[47,22,37,26],[47,33,37,37,"basis"],[47,38,37,42],[47,52,37,56,"beta"],[47,56,37,60],[47,61,37,65],[48,6,38,8],[49,6,39,8],[49,10,39,12],[49,11,39,13,"userCode"],[49,19,39,21],[49,22,39,24],[50,0,40,0],[51,0,41,0],[52,0,42,0],[53,0,43,0],[54,0,44,0],[55,0,45,0],[56,0,46,0],[57,0,47,0],[58,0,48,0],[58,24,48,24,"rad"],[58,27,48,27],[58,37,48,37,"rad"],[58,40,48,40],[59,0,49,0],[60,0,50,0],[60,36,50,36,"maxD"],[60,40,50,40],[61,0,51,0],[62,0,52,0],[63,0,53,0],[64,0,54,0],[65,0,55,0],[65,26,55,26,"powOperator"],[65,37,55,37],[66,0,56,0],[67,0,57,0],[68,0,58,0],[68,5,58,5],[69,4,59,4],[70,2,60,0],[71,0,60,1],[71,3]],"functionMap":{"names":["<global>","LRNProgram","LRNProgram#constructor"],"mappings":"AAA;OCgB;ICC;KDyC;CDC"},"hasCjsExports":false},"type":"js/module"}]}