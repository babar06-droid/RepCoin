{"dependencies":[{"name":"./shader_compiler","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":17,"column":0,"index":703},"end":{"line":17,"column":54,"index":757}}],"key":"yVSKlvZSxQn3Ck2puzGVWEYPzq8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"ScatterProgram\", {\n    enumerable: true,\n    get: function () {\n      return ScatterProgram;\n    }\n  });\n  var _shader_compiler = require(_dependencyMap[0], \"./shader_compiler\");\n  /**\n   * @license\n   * Copyright 2018 Google LLC. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   */\n\n  class ScatterProgram {\n    constructor(updateSize, sliceDim, indicesRank, updatesRank, strides, shape, summingDupeIndex = true, defaultIsTensor = false) {\n      this.variableNames = ['updates', 'indices', 'defaultValue'];\n      this.outputShape = shape;\n      const stridesType = (0, _shader_compiler.getCoordsDataType)(strides.length);\n      const dtype = (0, _shader_compiler.getCoordsDataType)(shape.length);\n      let indicesString = '';\n      if (indicesRank === 1) {\n        indicesString = 'i';\n      } else if (indicesRank === 2) {\n        indicesString = 'i, j';\n      }\n      const indicesSnippet = `getIndices(${indicesString})`;\n      let updatesString = '';\n      if (updatesRank === 1) {\n        updatesString = 'i';\n      } else if (updatesRank === 2) {\n        updatesString = 'i, coords[1]';\n      }\n      const updatesSnippet = `getUpdates(${updatesString})`;\n      let defaultValuesString = '';\n      if (defaultIsTensor) {\n        defaultValuesString = 'coords[0], coords[1]';\n      }\n      const defaultValueSnippet = `getDefaultValue(${defaultValuesString})`;\n      const strideString = sliceDim > 1 ? 'strides[j]' : 'strides';\n      this.userCode = `\n        ${stridesType} strides = ${stridesType}(${strides});\n\n        void main() {\n          ${dtype} coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ${updateSize}; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ${sliceDim}; j++) {\n              int index = round(${indicesSnippet});\n              flattenedIndex += index * ${strideString};\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ${updatesSnippet};\n              found = true;\n            }\n          }\n          setOutput(mix(${defaultValueSnippet}, sum, float(found)));\n        }\n      `;\n    }\n  }\n});","lineCount":80,"map":[[7,2,18,0,"Object"],[7,8,18,0],[7,9,18,0,"defineProperty"],[7,23,18,0],[7,24,18,0,"exports"],[7,31,18,0],[8,4,18,0,"enumerable"],[8,14,18,0],[9,4,18,0,"get"],[9,7,18,0],[9,18,18,0,"get"],[9,19,18,0],[10,6,18,0],[10,13,18,0,"ScatterProgram"],[10,27,18,0],[11,4,18,0],[12,2,18,0],[13,2,17,0],[13,6,17,0,"_shader_compiler"],[13,22,17,0],[13,25,17,0,"require"],[13,32,17,0],[13,33,17,0,"_dependencyMap"],[13,47,17,0],[14,2,1,0],[15,0,2,0],[16,0,3,0],[17,0,4,0],[18,0,5,0],[19,0,6,0],[20,0,7,0],[21,0,8,0],[22,0,9,0],[23,0,10,0],[24,0,11,0],[25,0,12,0],[26,0,13,0],[27,0,14,0],[28,0,15,0],[29,0,16,0],[31,2,18,7],[31,8,18,13,"ScatterProgram"],[31,22,18,27],[31,23,18,28],[32,4,19,4,"constructor"],[32,15,19,15,"constructor"],[32,16,19,16,"updateSize"],[32,26,19,26],[32,28,19,28,"sliceDim"],[32,36,19,36],[32,38,19,38,"indicesRank"],[32,49,19,49],[32,51,19,51,"updatesRank"],[32,62,19,62],[32,64,19,64,"strides"],[32,71,19,71],[32,73,19,73,"shape"],[32,78,19,78],[32,80,19,80,"summingDupeIndex"],[32,96,19,96],[32,99,19,99],[32,103,19,103],[32,105,19,105,"defaultIsTensor"],[32,120,19,120],[32,123,19,123],[32,128,19,128],[32,130,19,130],[33,6,20,8],[33,10,20,12],[33,11,20,13,"variableNames"],[33,24,20,26],[33,27,20,29],[33,28,20,30],[33,37,20,39],[33,39,20,41],[33,48,20,50],[33,50,20,52],[33,64,20,66],[33,65,20,67],[34,6,21,8],[34,10,21,12],[34,11,21,13,"outputShape"],[34,22,21,24],[34,25,21,27,"shape"],[34,30,21,32],[35,6,22,8],[35,12,22,14,"stridesType"],[35,23,22,25],[35,26,22,28],[35,30,22,28,"getCoordsDataType"],[35,46,22,45],[35,47,22,45,"getCoordsDataType"],[35,64,22,45],[35,66,22,46,"strides"],[35,73,22,53],[35,74,22,54,"length"],[35,80,22,60],[35,81,22,61],[36,6,23,8],[36,12,23,14,"dtype"],[36,17,23,19],[36,20,23,22],[36,24,23,22,"getCoordsDataType"],[36,40,23,39],[36,41,23,39,"getCoordsDataType"],[36,58,23,39],[36,60,23,40,"shape"],[36,65,23,45],[36,66,23,46,"length"],[36,72,23,52],[36,73,23,53],[37,6,24,8],[37,10,24,12,"indicesString"],[37,23,24,25],[37,26,24,28],[37,28,24,30],[38,6,25,8],[38,10,25,12,"indicesRank"],[38,21,25,23],[38,26,25,28],[38,27,25,29],[38,29,25,31],[39,8,26,12,"indicesString"],[39,21,26,25],[39,24,26,28],[39,27,26,31],[40,6,27,8],[40,7,27,9],[40,13,28,13],[40,17,28,17,"indicesRank"],[40,28,28,28],[40,33,28,33],[40,34,28,34],[40,36,28,36],[41,8,29,12,"indicesString"],[41,21,29,25],[41,24,29,28],[41,30,29,34],[42,6,30,8],[43,6,31,8],[43,12,31,14,"indicesSnippet"],[43,26,31,28],[43,29,31,31],[43,43,31,45,"indicesString"],[43,56,31,58],[43,59,31,61],[44,6,32,8],[44,10,32,12,"updatesString"],[44,23,32,25],[44,26,32,28],[44,28,32,30],[45,6,33,8],[45,10,33,12,"updatesRank"],[45,21,33,23],[45,26,33,28],[45,27,33,29],[45,29,33,31],[46,8,34,12,"updatesString"],[46,21,34,25],[46,24,34,28],[46,27,34,31],[47,6,35,8],[47,7,35,9],[47,13,36,13],[47,17,36,17,"updatesRank"],[47,28,36,28],[47,33,36,33],[47,34,36,34],[47,36,36,36],[48,8,37,12,"updatesString"],[48,21,37,25],[48,24,37,28],[48,38,37,42],[49,6,38,8],[50,6,39,8],[50,12,39,14,"updatesSnippet"],[50,26,39,28],[50,29,39,31],[50,43,39,45,"updatesString"],[50,56,39,58],[50,59,39,61],[51,6,40,8],[51,10,40,12,"defaultValuesString"],[51,29,40,31],[51,32,40,34],[51,34,40,36],[52,6,41,8],[52,10,41,12,"defaultIsTensor"],[52,25,41,27],[52,27,41,29],[53,8,42,12,"defaultValuesString"],[53,27,42,31],[53,30,42,34],[53,52,42,56],[54,6,43,8],[55,6,44,8],[55,12,44,14,"defaultValueSnippet"],[55,31,44,33],[55,34,44,36],[55,53,44,55,"defaultValuesString"],[55,72,44,74],[55,75,44,77],[56,6,45,8],[56,12,45,14,"strideString"],[56,24,45,26],[56,27,45,29,"sliceDim"],[56,35,45,37],[56,38,45,40],[56,39,45,41],[56,42,45,44],[56,54,45,56],[56,57,45,59],[56,66,45,68],[57,6,46,8],[57,10,46,12],[57,11,46,13,"userCode"],[57,19,46,21],[57,22,46,24],[58,0,47,0],[58,10,47,10,"stridesType"],[58,21,47,21],[58,35,47,35,"stridesType"],[58,46,47,46],[58,50,47,50,"strides"],[58,57,47,57],[59,0,48,0],[60,0,49,0],[61,0,50,0],[61,12,50,12,"dtype"],[61,17,50,17],[62,0,51,0],[63,0,52,0],[64,0,53,0],[64,32,53,32,"updateSize"],[64,42,53,42],[65,0,54,0],[66,0,55,0],[66,34,55,34,"sliceDim"],[66,42,55,42],[67,0,56,0],[67,34,56,34,"indicesSnippet"],[67,48,56,48],[68,0,57,0],[68,42,57,42,"strideString"],[68,54,57,54],[69,0,58,0],[70,0,59,0],[71,0,60,0],[71,23,60,23,"updatesSnippet"],[71,37,60,37],[72,0,61,0],[73,0,62,0],[74,0,63,0],[75,0,64,0],[75,26,64,26,"defaultValueSnippet"],[75,45,64,45],[76,0,65,0],[77,0,66,0],[77,7,66,7],[78,4,67,4],[79,2,68,0],[80,0,68,1],[80,3]],"functionMap":{"names":["<global>","ScatterProgram","ScatterProgram#constructor"],"mappings":"AAA;OCiB;ICC;KDgD;CDC"},"hasCjsExports":false},"type":"js/module"}]}