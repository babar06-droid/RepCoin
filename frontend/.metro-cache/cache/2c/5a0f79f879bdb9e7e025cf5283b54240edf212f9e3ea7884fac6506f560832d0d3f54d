{"dependencies":[{"name":"@tensorflow/tfjs-core","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":17,"column":0,"index":703},"end":{"line":17,"column":74,"index":777}}],"key":"qIleUpSDMUXFynEGc51k60/pDSs=","exportNames":["*"],"imports":1}},{"name":"../cpu_util","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":18,"column":0,"index":778},"end":{"line":18,"column":47,"index":825}}],"key":"5L5S4GXlh/uJh1MrXQbkPSVOWm4=","exportNames":["*"],"imports":1}},{"name":"../utils/pool_utils","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":19,"column":0,"index":826},"end":{"line":19,"column":55,"index":881}}],"key":"GoGtPjcyECC/LiGq99QBE0/eHC0=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.maxPoolGrad = maxPoolGrad;\n  Object.defineProperty(exports, \"maxPoolGradConfig\", {\n    enumerable: true,\n    get: function () {\n      return maxPoolGradConfig;\n    }\n  });\n  var _tensorflowTfjsCore = require(_dependencyMap[0], \"@tensorflow/tfjs-core\");\n  var _cpu_util = require(_dependencyMap[1], \"../cpu_util\");\n  var _utilsPool_utils = require(_dependencyMap[2], \"../utils/pool_utils\");\n  /**\n   * @license\n   * Copyright 2020 Google LLC. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   */\n\n  function maxPoolGrad(args) {\n    const {\n      inputs,\n      backend,\n      attrs\n    } = args;\n    const {\n      dy,\n      input,\n      output\n    } = inputs;\n    const x = input;\n    (0, _cpu_util.assertNotComplex)([input, output], 'maxPoolGrad');\n    const {\n      filterSize,\n      strides,\n      pad,\n      dimRoundingMode\n    } = attrs;\n    const convInfo = _tensorflowTfjsCore.backend_util.computePool2DInfo(x.shape, filterSize, strides, 1 /* dilations */, pad, dimRoundingMode);\n    const xValues = backend.data.get(x.dataId).values;\n    const maxPosBuf = (0, _tensorflowTfjsCore.buffer)(convInfo.outShape, x.dtype, (0, _utilsPool_utils.maxPoolPositions)(xValues, x.shape, x.dtype, convInfo).values);\n    const strideHeight = convInfo.strideHeight;\n    const strideWidth = convInfo.strideWidth;\n    const dilationHeight = convInfo.dilationHeight;\n    const dilationWidth = convInfo.dilationWidth;\n    const effectiveFilterHeight = convInfo.effectiveFilterHeight;\n    const effectiveFilterWidth = convInfo.effectiveFilterWidth;\n    const padLeft = effectiveFilterWidth - 1 - convInfo.padInfo.left;\n    const padTop = effectiveFilterHeight - 1 - convInfo.padInfo.top;\n    const dx = (0, _tensorflowTfjsCore.buffer)(x.shape, 'float32');\n    const dyData = backend.data.get(dy.dataId).values;\n    const dyBuf = (0, _tensorflowTfjsCore.buffer)(dy.shape, 'float32', dyData);\n    for (let b = 0; b < convInfo.batchSize; ++b) {\n      for (let d = 0; d < convInfo.inChannels; ++d) {\n        for (let dxR = 0; dxR < convInfo.inHeight; ++dxR) {\n          for (let dxC = 0; dxC < convInfo.inWidth; ++dxC) {\n            // Shader code begins.\n            const dyRCorner = dxR - padTop;\n            const dyCCorner = dxC - padLeft;\n            let dotProd = 0;\n            for (let wR = 0; wR < effectiveFilterHeight; wR += dilationHeight) {\n              const dyR = (dyRCorner + wR) / strideHeight;\n              if (dyR < 0 || dyR >= convInfo.outHeight || Math.floor(dyR) !== dyR) {\n                continue;\n              }\n              for (let wC = 0; wC < effectiveFilterWidth; wC += dilationWidth) {\n                const dyC = (dyCCorner + wC) / strideWidth;\n                if (dyC < 0 || dyC >= convInfo.outWidth || Math.floor(dyC) !== dyC) {\n                  continue;\n                }\n                const maxPos = effectiveFilterHeight * effectiveFilterWidth - 1 - maxPosBuf.get(b, dyR, dyC, d);\n                const curPos = wR * effectiveFilterWidth + wC;\n                const mask = maxPos === curPos ? 1 : 0;\n                if (mask === 0) {\n                  continue;\n                }\n                const pixel = dyBuf.get(b, dyR, dyC, d);\n                dotProd += pixel * mask;\n              }\n            }\n            dx.set(dotProd, b, dxR, dxC, d);\n          }\n        }\n      }\n    }\n    return backend.makeTensorInfo(dx.shape, dx.dtype, dx.values);\n  }\n  const maxPoolGradConfig = {\n    kernelName: _tensorflowTfjsCore.MaxPoolGrad,\n    backendName: 'cpu',\n    kernelFunc: maxPoolGrad\n  };\n});","lineCount":107,"map":[[7,2,20,0,"exports"],[7,9,20,0],[7,10,20,0,"maxPoolGrad"],[7,21,20,0],[7,24,20,0,"maxPoolGrad"],[7,35,20,0],[8,2,78,0,"Object"],[8,8,78,0],[8,9,78,0,"defineProperty"],[8,23,78,0],[8,24,78,0,"exports"],[8,31,78,0],[9,4,78,0,"enumerable"],[9,14,78,0],[10,4,78,0,"get"],[10,7,78,0],[10,18,78,0,"get"],[10,19,78,0],[11,6,78,0],[11,13,78,0,"maxPoolGradConfig"],[11,30,78,0],[12,4,78,0],[13,2,78,0],[14,2,17,0],[14,6,17,0,"_tensorflowTfjsCore"],[14,25,17,0],[14,28,17,0,"require"],[14,35,17,0],[14,36,17,0,"_dependencyMap"],[14,50,17,0],[15,2,18,0],[15,6,18,0,"_cpu_util"],[15,15,18,0],[15,18,18,0,"require"],[15,25,18,0],[15,26,18,0,"_dependencyMap"],[15,40,18,0],[16,2,19,0],[16,6,19,0,"_utilsPool_utils"],[16,22,19,0],[16,25,19,0,"require"],[16,32,19,0],[16,33,19,0,"_dependencyMap"],[16,47,19,0],[17,2,1,0],[18,0,2,0],[19,0,3,0],[20,0,4,0],[21,0,5,0],[22,0,6,0],[23,0,7,0],[24,0,8,0],[25,0,9,0],[26,0,10,0],[27,0,11,0],[28,0,12,0],[29,0,13,0],[30,0,14,0],[31,0,15,0],[32,0,16,0],[34,2,20,7],[34,11,20,16,"maxPoolGrad"],[34,22,20,27,"maxPoolGrad"],[34,23,20,28,"args"],[34,27,20,32],[34,29,20,34],[35,4,21,4],[35,10,21,10],[36,6,21,12,"inputs"],[36,12,21,18],[37,6,21,20,"backend"],[37,13,21,27],[38,6,21,29,"attrs"],[39,4,21,35],[39,5,21,36],[39,8,21,39,"args"],[39,12,21,43],[40,4,22,4],[40,10,22,10],[41,6,22,12,"dy"],[41,8,22,14],[42,6,22,16,"input"],[42,11,22,21],[43,6,22,23,"output"],[44,4,22,30],[44,5,22,31],[44,8,22,34,"inputs"],[44,14,22,40],[45,4,23,4],[45,10,23,10,"x"],[45,11,23,11],[45,14,23,14,"input"],[45,19,23,19],[46,4,24,4],[46,8,24,4,"assertNotComplex"],[46,17,24,20],[46,18,24,20,"assertNotComplex"],[46,34,24,20],[46,36,24,21],[46,37,24,22,"input"],[46,42,24,27],[46,44,24,29,"output"],[46,50,24,35],[46,51,24,36],[46,53,24,38],[46,66,24,51],[46,67,24,52],[47,4,25,4],[47,10,25,10],[48,6,25,12,"filterSize"],[48,16,25,22],[49,6,25,24,"strides"],[49,13,25,31],[50,6,25,33,"pad"],[50,9,25,36],[51,6,25,38,"dimRoundingMode"],[52,4,25,54],[52,5,25,55],[52,8,25,58,"attrs"],[52,13,25,63],[53,4,26,4],[53,10,26,10,"convInfo"],[53,18,26,18],[53,21,26,21,"backend_util"],[53,40,26,33],[53,41,26,33,"backend_util"],[53,53,26,33],[53,54,26,34,"computePool2DInfo"],[53,71,26,51],[53,72,26,52,"x"],[53,73,26,53],[53,74,26,54,"shape"],[53,79,26,59],[53,81,26,61,"filterSize"],[53,91,26,71],[53,93,26,73,"strides"],[53,100,26,80],[53,102,26,82],[53,103,26,83],[53,104,26,84],[53,121,26,101,"pad"],[53,124,26,104],[53,126,26,106,"dimRoundingMode"],[53,141,26,121],[53,142,26,122],[54,4,27,4],[54,10,27,10,"xValues"],[54,17,27,17],[54,20,27,20,"backend"],[54,27,27,27],[54,28,27,28,"data"],[54,32,27,32],[54,33,27,33,"get"],[54,36,27,36],[54,37,27,37,"x"],[54,38,27,38],[54,39,27,39,"dataId"],[54,45,27,45],[54,46,27,46],[54,47,27,47,"values"],[54,53,27,53],[55,4,28,4],[55,10,28,10,"maxPosBuf"],[55,19,28,19],[55,22,28,22],[55,26,28,22,"buffer"],[55,45,28,28],[55,46,28,28,"buffer"],[55,52,28,28],[55,54,28,29,"convInfo"],[55,62,28,37],[55,63,28,38,"outShape"],[55,71,28,46],[55,73,28,48,"x"],[55,74,28,49],[55,75,28,50,"dtype"],[55,80,28,55],[55,82,28,57],[55,86,28,57,"maxPoolPositions"],[55,102,28,73],[55,103,28,73,"maxPoolPositions"],[55,119,28,73],[55,121,28,74,"xValues"],[55,128,28,81],[55,130,28,83,"x"],[55,131,28,84],[55,132,28,85,"shape"],[55,137,28,90],[55,139,28,92,"x"],[55,140,28,93],[55,141,28,94,"dtype"],[55,146,28,99],[55,148,28,101,"convInfo"],[55,156,28,109],[55,157,28,110],[55,158,28,111,"values"],[55,164,28,117],[55,165,28,118],[56,4,29,4],[56,10,29,10,"strideHeight"],[56,22,29,22],[56,25,29,25,"convInfo"],[56,33,29,33],[56,34,29,34,"strideHeight"],[56,46,29,46],[57,4,30,4],[57,10,30,10,"strideWidth"],[57,21,30,21],[57,24,30,24,"convInfo"],[57,32,30,32],[57,33,30,33,"strideWidth"],[57,44,30,44],[58,4,31,4],[58,10,31,10,"dilationHeight"],[58,24,31,24],[58,27,31,27,"convInfo"],[58,35,31,35],[58,36,31,36,"dilationHeight"],[58,50,31,50],[59,4,32,4],[59,10,32,10,"dilationWidth"],[59,23,32,23],[59,26,32,26,"convInfo"],[59,34,32,34],[59,35,32,35,"dilationWidth"],[59,48,32,48],[60,4,33,4],[60,10,33,10,"effectiveFilterHeight"],[60,31,33,31],[60,34,33,34,"convInfo"],[60,42,33,42],[60,43,33,43,"effectiveFilterHeight"],[60,64,33,64],[61,4,34,4],[61,10,34,10,"effectiveFilterWidth"],[61,30,34,30],[61,33,34,33,"convInfo"],[61,41,34,41],[61,42,34,42,"effectiveFilterWidth"],[61,62,34,62],[62,4,35,4],[62,10,35,10,"padLeft"],[62,17,35,17],[62,20,35,20,"effectiveFilterWidth"],[62,40,35,40],[62,43,35,43],[62,44,35,44],[62,47,35,47,"convInfo"],[62,55,35,55],[62,56,35,56,"padInfo"],[62,63,35,63],[62,64,35,64,"left"],[62,68,35,68],[63,4,36,4],[63,10,36,10,"padTop"],[63,16,36,16],[63,19,36,19,"effectiveFilterHeight"],[63,40,36,40],[63,43,36,43],[63,44,36,44],[63,47,36,47,"convInfo"],[63,55,36,55],[63,56,36,56,"padInfo"],[63,63,36,63],[63,64,36,64,"top"],[63,67,36,67],[64,4,37,4],[64,10,37,10,"dx"],[64,12,37,12],[64,15,37,15],[64,19,37,15,"buffer"],[64,38,37,21],[64,39,37,21,"buffer"],[64,45,37,21],[64,47,37,22,"x"],[64,48,37,23],[64,49,37,24,"shape"],[64,54,37,29],[64,56,37,31],[64,65,37,40],[64,66,37,41],[65,4,38,4],[65,10,38,10,"dyData"],[65,16,38,16],[65,19,38,19,"backend"],[65,26,38,26],[65,27,38,27,"data"],[65,31,38,31],[65,32,38,32,"get"],[65,35,38,35],[65,36,38,36,"dy"],[65,38,38,38],[65,39,38,39,"dataId"],[65,45,38,45],[65,46,38,46],[65,47,38,47,"values"],[65,53,38,53],[66,4,39,4],[66,10,39,10,"dyBuf"],[66,15,39,15],[66,18,39,18],[66,22,39,18,"buffer"],[66,41,39,24],[66,42,39,24,"buffer"],[66,48,39,24],[66,50,39,25,"dy"],[66,52,39,27],[66,53,39,28,"shape"],[66,58,39,33],[66,60,39,35],[66,69,39,44],[66,71,39,46,"dyData"],[66,77,39,52],[66,78,39,53],[67,4,40,4],[67,9,40,9],[67,13,40,13,"b"],[67,14,40,14],[67,17,40,17],[67,18,40,18],[67,20,40,20,"b"],[67,21,40,21],[67,24,40,24,"convInfo"],[67,32,40,32],[67,33,40,33,"batchSize"],[67,42,40,42],[67,44,40,44],[67,46,40,46,"b"],[67,47,40,47],[67,49,40,49],[68,6,41,8],[68,11,41,13],[68,15,41,17,"d"],[68,16,41,18],[68,19,41,21],[68,20,41,22],[68,22,41,24,"d"],[68,23,41,25],[68,26,41,28,"convInfo"],[68,34,41,36],[68,35,41,37,"inChannels"],[68,45,41,47],[68,47,41,49],[68,49,41,51,"d"],[68,50,41,52],[68,52,41,54],[69,8,42,12],[69,13,42,17],[69,17,42,21,"dxR"],[69,20,42,24],[69,23,42,27],[69,24,42,28],[69,26,42,30,"dxR"],[69,29,42,33],[69,32,42,36,"convInfo"],[69,40,42,44],[69,41,42,45,"inHeight"],[69,49,42,53],[69,51,42,55],[69,53,42,57,"dxR"],[69,56,42,60],[69,58,42,62],[70,10,43,16],[70,15,43,21],[70,19,43,25,"dxC"],[70,22,43,28],[70,25,43,31],[70,26,43,32],[70,28,43,34,"dxC"],[70,31,43,37],[70,34,43,40,"convInfo"],[70,42,43,48],[70,43,43,49,"inWidth"],[70,50,43,56],[70,52,43,58],[70,54,43,60,"dxC"],[70,57,43,63],[70,59,43,65],[71,12,44,20],[72,12,45,20],[72,18,45,26,"dyRCorner"],[72,27,45,35],[72,30,45,38,"dxR"],[72,33,45,41],[72,36,45,44,"padTop"],[72,42,45,50],[73,12,46,20],[73,18,46,26,"dyCCorner"],[73,27,46,35],[73,30,46,38,"dxC"],[73,33,46,41],[73,36,46,44,"padLeft"],[73,43,46,51],[74,12,47,20],[74,16,47,24,"dotProd"],[74,23,47,31],[74,26,47,34],[74,27,47,35],[75,12,48,20],[75,17,48,25],[75,21,48,29,"wR"],[75,23,48,31],[75,26,48,34],[75,27,48,35],[75,29,48,37,"wR"],[75,31,48,39],[75,34,48,42,"effectiveFilterHeight"],[75,55,48,63],[75,57,48,65,"wR"],[75,59,48,67],[75,63,48,71,"dilationHeight"],[75,77,48,85],[75,79,48,87],[76,14,49,24],[76,20,49,30,"dyR"],[76,23,49,33],[76,26,49,36],[76,27,49,37,"dyRCorner"],[76,36,49,46],[76,39,49,49,"wR"],[76,41,49,51],[76,45,49,55,"strideHeight"],[76,57,49,67],[77,14,50,24],[77,18,50,28,"dyR"],[77,21,50,31],[77,24,50,34],[77,25,50,35],[77,29,50,39,"dyR"],[77,32,50,42],[77,36,50,46,"convInfo"],[77,44,50,54],[77,45,50,55,"outHeight"],[77,54,50,64],[77,58,51,28,"Math"],[77,62,51,32],[77,63,51,33,"floor"],[77,68,51,38],[77,69,51,39,"dyR"],[77,72,51,42],[77,73,51,43],[77,78,51,48,"dyR"],[77,81,51,51],[77,83,51,53],[78,16,52,28],[79,14,53,24],[80,14,54,24],[80,19,54,29],[80,23,54,33,"wC"],[80,25,54,35],[80,28,54,38],[80,29,54,39],[80,31,54,41,"wC"],[80,33,54,43],[80,36,54,46,"effectiveFilterWidth"],[80,56,54,66],[80,58,54,68,"wC"],[80,60,54,70],[80,64,54,74,"dilationWidth"],[80,77,54,87],[80,79,54,89],[81,16,55,28],[81,22,55,34,"dyC"],[81,25,55,37],[81,28,55,40],[81,29,55,41,"dyCCorner"],[81,38,55,50],[81,41,55,53,"wC"],[81,43,55,55],[81,47,55,59,"strideWidth"],[81,58,55,70],[82,16,56,28],[82,20,56,32,"dyC"],[82,23,56,35],[82,26,56,38],[82,27,56,39],[82,31,56,43,"dyC"],[82,34,56,46],[82,38,56,50,"convInfo"],[82,46,56,58],[82,47,56,59,"outWidth"],[82,55,56,67],[82,59,57,32,"Math"],[82,63,57,36],[82,64,57,37,"floor"],[82,69,57,42],[82,70,57,43,"dyC"],[82,73,57,46],[82,74,57,47],[82,79,57,52,"dyC"],[82,82,57,55],[82,84,57,57],[83,18,58,32],[84,16,59,28],[85,16,60,28],[85,22,60,34,"maxPos"],[85,28,60,40],[85,31,60,43,"effectiveFilterHeight"],[85,52,60,64],[85,55,60,67,"effectiveFilterWidth"],[85,75,60,87],[85,78,60,90],[85,79,60,91],[85,82,61,32,"maxPosBuf"],[85,91,61,41],[85,92,61,42,"get"],[85,95,61,45],[85,96,61,46,"b"],[85,97,61,47],[85,99,61,49,"dyR"],[85,102,61,52],[85,104,61,54,"dyC"],[85,107,61,57],[85,109,61,59,"d"],[85,110,61,60],[85,111,61,61],[86,16,62,28],[86,22,62,34,"curPos"],[86,28,62,40],[86,31,62,43,"wR"],[86,33,62,45],[86,36,62,48,"effectiveFilterWidth"],[86,56,62,68],[86,59,62,71,"wC"],[86,61,62,73],[87,16,63,28],[87,22,63,34,"mask"],[87,26,63,38],[87,29,63,41,"maxPos"],[87,35,63,47],[87,40,63,52,"curPos"],[87,46,63,58],[87,49,63,61],[87,50,63,62],[87,53,63,65],[87,54,63,66],[88,16,64,28],[88,20,64,32,"mask"],[88,24,64,36],[88,29,64,41],[88,30,64,42],[88,32,64,44],[89,18,65,32],[90,16,66,28],[91,16,67,28],[91,22,67,34,"pixel"],[91,27,67,39],[91,30,67,42,"dyBuf"],[91,35,67,47],[91,36,67,48,"get"],[91,39,67,51],[91,40,67,52,"b"],[91,41,67,53],[91,43,67,55,"dyR"],[91,46,67,58],[91,48,67,60,"dyC"],[91,51,67,63],[91,53,67,65,"d"],[91,54,67,66],[91,55,67,67],[92,16,68,28,"dotProd"],[92,23,68,35],[92,27,68,39,"pixel"],[92,32,68,44],[92,35,68,47,"mask"],[92,39,68,51],[93,14,69,24],[94,12,70,20],[95,12,71,20,"dx"],[95,14,71,22],[95,15,71,23,"set"],[95,18,71,26],[95,19,71,27,"dotProd"],[95,26,71,34],[95,28,71,36,"b"],[95,29,71,37],[95,31,71,39,"dxR"],[95,34,71,42],[95,36,71,44,"dxC"],[95,39,71,47],[95,41,71,49,"d"],[95,42,71,50],[95,43,71,51],[96,10,72,16],[97,8,73,12],[98,6,74,8],[99,4,75,4],[100,4,76,4],[100,11,76,11,"backend"],[100,18,76,18],[100,19,76,19,"makeTensorInfo"],[100,33,76,33],[100,34,76,34,"dx"],[100,36,76,36],[100,37,76,37,"shape"],[100,42,76,42],[100,44,76,44,"dx"],[100,46,76,46],[100,47,76,47,"dtype"],[100,52,76,52],[100,54,76,54,"dx"],[100,56,76,56],[100,57,76,57,"values"],[100,63,76,63],[100,64,76,64],[101,2,77,0],[102,2,78,7],[102,8,78,13,"maxPoolGradConfig"],[102,25,78,30],[102,28,78,33],[103,4,79,4,"kernelName"],[103,14,79,14],[103,16,79,16,"MaxPoolGrad"],[103,35,79,27],[103,36,79,27,"MaxPoolGrad"],[103,47,79,27],[104,4,80,4,"backendName"],[104,15,80,15],[104,17,80,17],[104,22,80,22],[105,4,81,4,"kernelFunc"],[105,14,81,14],[105,16,81,16,"maxPoolGrad"],[106,2,82,0],[106,3,82,1],[107,0,82,2],[107,3]],"functionMap":{"names":["<global>","maxPoolGrad"],"mappings":"AAA;OCmB;CDyD"},"hasCjsExports":false},"type":"js/module"}]}