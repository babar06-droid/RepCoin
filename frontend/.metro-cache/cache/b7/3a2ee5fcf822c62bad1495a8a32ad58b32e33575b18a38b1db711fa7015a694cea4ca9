{"dependencies":[{"name":"@tensorflow/tfjs-core","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":17,"column":0,"index":703},"end":{"line":17,"column":59,"index":762}}],"key":"qIleUpSDMUXFynEGc51k60/pDSs=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.sparseSegmentReductionImpl = sparseSegmentReductionImpl;\n  var _tensorflowTfjsCore = require(_dependencyMap[0], \"@tensorflow/tfjs-core\");\n  /**\n   * @license\n   * Copyright 2021 Google LLC. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   */\n\n  function sparseSegmentReductionImpl(input, inputShape, inputDType, indices, segmentIds, isMean = false, defaultValue = 0) {\n    const numIndices = indices.length;\n    // Flatten the array to two dimensions\n    const inputFlat = [inputShape[0], input.length / inputShape[0]];\n    const numCol = inputFlat[1];\n    // Note that the current implementation assumes that segmentIds values are\n    // sorted.\n    const lastSegmentIdPlusOne = numIndices > 0 ? segmentIds[numIndices - 1] + 1 : 0;\n    const outputRows = lastSegmentIdPlusOne;\n    if (outputRows < 0) {\n      throw new Error(_tensorflowTfjsCore.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());\n    }\n    const outputShape = inputShape.slice();\n    outputShape[0] = outputRows;\n    const outputLength = outputShape.reduce((product, value) => product * value, 1);\n    // Output array is initialized with the value 0 by default.\n    const output = _tensorflowTfjsCore.util.getArrayFromDType(inputDType, outputLength);\n    // Note that we do not initialize the output buffer with a default value, so\n    // we need to explicitly set missing indices to the default value.\n    if (numIndices === 0) {\n      if (outputRows > 0) {\n        output.fill(defaultValue);\n      }\n      return [output, outputShape];\n    }\n    if (outputRows <= 0) {\n      throw new Error(_tensorflowTfjsCore.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());\n    }\n    let start = 0,\n      end = 1;\n    // Index from which the output is not initialized.\n    let uninitializedIndex = 0;\n    let outIndex = segmentIds[start];\n    while (true) {\n      // We initialize nextIndex to 0 to avoid may be uninitialized warning\n      let nextIndex = 0;\n      if (end < numIndices) {\n        nextIndex = segmentIds[end];\n        if (outIndex === nextIndex) {\n          ++end;\n          continue;\n        }\n        // We have a new segment here.  Verify that the segment ids are growing.\n        if (outIndex >= nextIndex) {\n          throw new Error(_tensorflowTfjsCore.backend_util.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage());\n        }\n      }\n      if (outIndex < 0 || outIndex >= outputRows) {\n        throw new Error(_tensorflowTfjsCore.backend_util.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(outIndex, outputRows));\n      }\n      // If there is a gap between two indices, we need to set that gap to the\n      // default value.\n      if (outIndex > uninitializedIndex) {\n        output.fill(defaultValue, uninitializedIndex * numCol, outIndex * numCol);\n      }\n      for (let i = start; i < end; ++i) {\n        const index = indices[i];\n        if (index < 0 || index >= inputFlat[0]) {\n          throw new Error(_tensorflowTfjsCore.backend_util.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(i, indices[i], inputFlat[0]));\n        }\n        for (let j = 0; j < numCol; j++) {\n          output[outIndex * numCol + j] += input[index * numCol + j];\n        }\n      }\n      if (isMean) {\n        for (let j = 0; j < numCol; j++) {\n          output[outIndex * numCol + j] /= end - start;\n        }\n      }\n      start = end;\n      ++end;\n      uninitializedIndex = outIndex + 1;\n      outIndex = nextIndex;\n      if (end > numIndices) {\n        break;\n      }\n    }\n    // Fill the gap at the end with the default value.\n    if (uninitializedIndex < outputRows) {\n      output.fill(defaultValue, uninitializedIndex * numCol, outputRows * numCol);\n    }\n    return [output, outputShape];\n  }\n});","lineCount":109,"map":[[7,2,18,0,"exports"],[7,9,18,0],[7,10,18,0,"sparseSegmentReductionImpl"],[7,36,18,0],[7,39,18,0,"sparseSegmentReductionImpl"],[7,65,18,0],[8,2,17,0],[8,6,17,0,"_tensorflowTfjsCore"],[8,25,17,0],[8,28,17,0,"require"],[8,35,17,0],[8,36,17,0,"_dependencyMap"],[8,50,17,0],[9,2,1,0],[10,0,2,0],[11,0,3,0],[12,0,4,0],[13,0,5,0],[14,0,6,0],[15,0,7,0],[16,0,8,0],[17,0,9,0],[18,0,10,0],[19,0,11,0],[20,0,12,0],[21,0,13,0],[22,0,14,0],[23,0,15,0],[24,0,16,0],[26,2,18,7],[26,11,18,16,"sparseSegmentReductionImpl"],[26,37,18,42,"sparseSegmentReductionImpl"],[26,38,18,43,"input"],[26,43,18,48],[26,45,18,50,"inputShape"],[26,55,18,60],[26,57,18,62,"inputDType"],[26,67,18,72],[26,69,18,74,"indices"],[26,76,18,81],[26,78,18,83,"segmentIds"],[26,88,18,93],[26,90,18,95,"isMean"],[26,96,18,101],[26,99,18,104],[26,104,18,109],[26,106,18,111,"defaultValue"],[26,118,18,123],[26,121,18,126],[26,122,18,127],[26,124,18,129],[27,4,19,4],[27,10,19,10,"numIndices"],[27,20,19,20],[27,23,19,23,"indices"],[27,30,19,30],[27,31,19,31,"length"],[27,37,19,37],[28,4,20,4],[29,4,21,4],[29,10,21,10,"inputFlat"],[29,19,21,19],[29,22,21,22],[29,23,21,23,"inputShape"],[29,33,21,33],[29,34,21,34],[29,35,21,35],[29,36,21,36],[29,38,21,38,"input"],[29,43,21,43],[29,44,21,44,"length"],[29,50,21,50],[29,53,21,53,"inputShape"],[29,63,21,63],[29,64,21,64],[29,65,21,65],[29,66,21,66],[29,67,21,67],[30,4,22,4],[30,10,22,10,"numCol"],[30,16,22,16],[30,19,22,19,"inputFlat"],[30,28,22,28],[30,29,22,29],[30,30,22,30],[30,31,22,31],[31,4,23,4],[32,4,24,4],[33,4,25,4],[33,10,25,10,"lastSegmentIdPlusOne"],[33,30,25,30],[33,33,25,33,"numIndices"],[33,43,25,43],[33,46,25,46],[33,47,25,47],[33,50,25,50,"segmentIds"],[33,60,25,60],[33,61,25,61,"numIndices"],[33,71,25,71],[33,74,25,74],[33,75,25,75],[33,76,25,76],[33,79,25,79],[33,80,25,80],[33,83,25,83],[33,84,25,84],[34,4,26,4],[34,10,26,10,"outputRows"],[34,20,26,20],[34,23,26,23,"lastSegmentIdPlusOne"],[34,43,26,43],[35,4,27,4],[35,8,27,8,"outputRows"],[35,18,27,18],[35,21,27,21],[35,22,27,22],[35,24,27,24],[36,6,28,8],[36,12,28,14],[36,16,28,18,"Error"],[36,21,28,23],[36,22,28,24,"backend_util"],[36,41,28,36],[36,42,28,36,"backend_util"],[36,54,28,36],[36,55,28,37,"getSparseSegmentReductionNegativeSegmentIdsErrorMessage"],[36,110,28,92],[36,111,28,93],[36,112,28,94],[36,113,28,95],[37,4,29,4],[38,4,30,4],[38,10,30,10,"outputShape"],[38,21,30,21],[38,24,30,24,"inputShape"],[38,34,30,34],[38,35,30,35,"slice"],[38,40,30,40],[38,41,30,41],[38,42,30,42],[39,4,31,4,"outputShape"],[39,15,31,15],[39,16,31,16],[39,17,31,17],[39,18,31,18],[39,21,31,21,"outputRows"],[39,31,31,31],[40,4,32,4],[40,10,32,10,"outputLength"],[40,22,32,22],[40,25,32,25,"outputShape"],[40,36,32,36],[40,37,32,37,"reduce"],[40,43,32,43],[40,44,32,44],[40,45,32,45,"product"],[40,52,32,52],[40,54,32,54,"value"],[40,59,32,59],[40,64,32,64,"product"],[40,71,32,71],[40,74,32,74,"value"],[40,79,32,79],[40,81,32,81],[40,82,32,82],[40,83,32,83],[41,4,33,4],[42,4,34,4],[42,10,34,10,"output"],[42,16,34,16],[42,19,34,19,"util"],[42,38,34,23],[42,39,34,23,"util"],[42,43,34,23],[42,44,34,24,"getArrayFromDType"],[42,61,34,41],[42,62,34,42,"inputDType"],[42,72,34,52],[42,74,34,54,"outputLength"],[42,86,34,66],[42,87,34,67],[43,4,35,4],[44,4,36,4],[45,4,37,4],[45,8,37,8,"numIndices"],[45,18,37,18],[45,23,37,23],[45,24,37,24],[45,26,37,26],[46,6,38,8],[46,10,38,12,"outputRows"],[46,20,38,22],[46,23,38,25],[46,24,38,26],[46,26,38,28],[47,8,39,12,"output"],[47,14,39,18],[47,15,39,19,"fill"],[47,19,39,23],[47,20,39,24,"defaultValue"],[47,32,39,36],[47,33,39,37],[48,6,40,8],[49,6,41,8],[49,13,41,15],[49,14,41,16,"output"],[49,20,41,22],[49,22,41,24,"outputShape"],[49,33,41,35],[49,34,41,36],[50,4,42,4],[51,4,43,4],[51,8,43,8,"outputRows"],[51,18,43,18],[51,22,43,22],[51,23,43,23],[51,25,43,25],[52,6,44,8],[52,12,44,14],[52,16,44,18,"Error"],[52,21,44,23],[52,22,44,24,"backend_util"],[52,41,44,36],[52,42,44,36,"backend_util"],[52,54,44,36],[52,55,44,37,"getSparseSegmentReductionNegativeSegmentIdsErrorMessage"],[52,110,44,92],[52,111,44,93],[52,112,44,94],[52,113,44,95],[53,4,45,4],[54,4,46,4],[54,8,46,8,"start"],[54,13,46,13],[54,16,46,16],[54,17,46,17],[55,6,46,19,"end"],[55,9,46,22],[55,12,46,25],[55,13,46,26],[56,4,47,4],[57,4,48,4],[57,8,48,8,"uninitializedIndex"],[57,26,48,26],[57,29,48,29],[57,30,48,30],[58,4,49,4],[58,8,49,8,"outIndex"],[58,16,49,16],[58,19,49,19,"segmentIds"],[58,29,49,29],[58,30,49,30,"start"],[58,35,49,35],[58,36,49,36],[59,4,50,4],[59,11,50,11],[59,15,50,15],[59,17,50,17],[60,6,51,8],[61,6,52,8],[61,10,52,12,"nextIndex"],[61,19,52,21],[61,22,52,24],[61,23,52,25],[62,6,53,8],[62,10,53,12,"end"],[62,13,53,15],[62,16,53,18,"numIndices"],[62,26,53,28],[62,28,53,30],[63,8,54,12,"nextIndex"],[63,17,54,21],[63,20,54,24,"segmentIds"],[63,30,54,34],[63,31,54,35,"end"],[63,34,54,38],[63,35,54,39],[64,8,55,12],[64,12,55,16,"outIndex"],[64,20,55,24],[64,25,55,29,"nextIndex"],[64,34,55,38],[64,36,55,40],[65,10,56,16],[65,12,56,18,"end"],[65,15,56,21],[66,10,57,16],[67,8,58,12],[68,8,59,12],[69,8,60,12],[69,12,60,16,"outIndex"],[69,20,60,24],[69,24,60,28,"nextIndex"],[69,33,60,37],[69,35,60,39],[70,10,61,16],[70,16,61,22],[70,20,61,26,"Error"],[70,25,61,31],[70,26,61,32,"backend_util"],[70,45,61,44],[70,46,61,44,"backend_util"],[70,58,61,44],[70,59,62,21,"getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage"],[70,119,62,81],[70,120,62,82],[70,121,62,83],[70,122,62,84],[71,8,63,12],[72,6,64,8],[73,6,65,8],[73,10,65,12,"outIndex"],[73,18,65,20],[73,21,65,23],[73,22,65,24],[73,26,65,28,"outIndex"],[73,34,65,36],[73,38,65,40,"outputRows"],[73,48,65,50],[73,50,65,52],[74,8,66,12],[74,14,66,18],[74,18,66,22,"Error"],[74,23,66,27],[74,24,66,28,"backend_util"],[74,43,66,40],[74,44,66,40,"backend_util"],[74,56,66,40],[74,57,66,41,"getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage"],[74,113,66,97],[74,114,66,98,"outIndex"],[74,122,66,106],[74,124,66,108,"outputRows"],[74,134,66,118],[74,135,66,119],[74,136,66,120],[75,6,67,8],[76,6,68,8],[77,6,69,8],[78,6,70,8],[78,10,70,12,"outIndex"],[78,18,70,20],[78,21,70,23,"uninitializedIndex"],[78,39,70,41],[78,41,70,43],[79,8,71,12,"output"],[79,14,71,18],[79,15,71,19,"fill"],[79,19,71,23],[79,20,71,24,"defaultValue"],[79,32,71,36],[79,34,71,38,"uninitializedIndex"],[79,52,71,56],[79,55,71,59,"numCol"],[79,61,71,65],[79,63,71,67,"outIndex"],[79,71,71,75],[79,74,71,78,"numCol"],[79,80,71,84],[79,81,71,85],[80,6,72,8],[81,6,73,8],[81,11,73,13],[81,15,73,17,"i"],[81,16,73,18],[81,19,73,21,"start"],[81,24,73,26],[81,26,73,28,"i"],[81,27,73,29],[81,30,73,32,"end"],[81,33,73,35],[81,35,73,37],[81,37,73,39,"i"],[81,38,73,40],[81,40,73,42],[82,8,74,12],[82,14,74,18,"index"],[82,19,74,23],[82,22,74,26,"indices"],[82,29,74,33],[82,30,74,34,"i"],[82,31,74,35],[82,32,74,36],[83,8,75,12],[83,12,75,16,"index"],[83,17,75,21],[83,20,75,24],[83,21,75,25],[83,25,75,29,"index"],[83,30,75,34],[83,34,75,38,"inputFlat"],[83,43,75,47],[83,44,75,48],[83,45,75,49],[83,46,75,50],[83,48,75,52],[84,10,76,16],[84,16,76,22],[84,20,76,26,"Error"],[84,25,76,31],[84,26,76,32,"backend_util"],[84,45,76,44],[84,46,76,44,"backend_util"],[84,58,76,44],[84,59,76,45,"getSparseSegmentReductionIndicesOutOfRangeErrorMessage"],[84,113,76,99],[84,114,76,100,"i"],[84,115,76,101],[84,117,76,103,"indices"],[84,124,76,110],[84,125,76,111,"i"],[84,126,76,112],[84,127,76,113],[84,129,76,115,"inputFlat"],[84,138,76,124],[84,139,76,125],[84,140,76,126],[84,141,76,127],[84,142,76,128],[84,143,76,129],[85,8,77,12],[86,8,78,12],[86,13,78,17],[86,17,78,21,"j"],[86,18,78,22],[86,21,78,25],[86,22,78,26],[86,24,78,28,"j"],[86,25,78,29],[86,28,78,32,"numCol"],[86,34,78,38],[86,36,78,40,"j"],[86,37,78,41],[86,39,78,43],[86,41,78,45],[87,10,79,16,"output"],[87,16,79,22],[87,17,79,23,"outIndex"],[87,25,79,31],[87,28,79,34,"numCol"],[87,34,79,40],[87,37,79,43,"j"],[87,38,79,44],[87,39,79,45],[87,43,79,49,"input"],[87,48,79,54],[87,49,79,55,"index"],[87,54,79,60],[87,57,79,63,"numCol"],[87,63,79,69],[87,66,79,72,"j"],[87,67,79,73],[87,68,79,74],[88,8,80,12],[89,6,81,8],[90,6,82,8],[90,10,82,12,"isMean"],[90,16,82,18],[90,18,82,20],[91,8,83,12],[91,13,83,17],[91,17,83,21,"j"],[91,18,83,22],[91,21,83,25],[91,22,83,26],[91,24,83,28,"j"],[91,25,83,29],[91,28,83,32,"numCol"],[91,34,83,38],[91,36,83,40,"j"],[91,37,83,41],[91,39,83,43],[91,41,83,45],[92,10,84,16,"output"],[92,16,84,22],[92,17,84,23,"outIndex"],[92,25,84,31],[92,28,84,34,"numCol"],[92,34,84,40],[92,37,84,43,"j"],[92,38,84,44],[92,39,84,45],[92,43,84,49,"end"],[92,46,84,52],[92,49,84,55,"start"],[92,54,84,60],[93,8,85,12],[94,6,86,8],[95,6,87,8,"start"],[95,11,87,13],[95,14,87,16,"end"],[95,17,87,19],[96,6,88,8],[96,8,88,10,"end"],[96,11,88,13],[97,6,89,8,"uninitializedIndex"],[97,24,89,26],[97,27,89,29,"outIndex"],[97,35,89,37],[97,38,89,40],[97,39,89,41],[98,6,90,8,"outIndex"],[98,14,90,16],[98,17,90,19,"nextIndex"],[98,26,90,28],[99,6,91,8],[99,10,91,12,"end"],[99,13,91,15],[99,16,91,18,"numIndices"],[99,26,91,28],[99,28,91,30],[100,8,92,12],[101,6,93,8],[102,4,94,4],[103,4,95,4],[104,4,96,4],[104,8,96,8,"uninitializedIndex"],[104,26,96,26],[104,29,96,29,"outputRows"],[104,39,96,39],[104,41,96,41],[105,6,97,8,"output"],[105,12,97,14],[105,13,97,15,"fill"],[105,17,97,19],[105,18,97,20,"defaultValue"],[105,30,97,32],[105,32,97,34,"uninitializedIndex"],[105,50,97,52],[105,53,97,55,"numCol"],[105,59,97,61],[105,61,97,63,"outputRows"],[105,71,97,73],[105,74,97,76,"numCol"],[105,80,97,82],[105,81,97,83],[106,4,98,4],[107,4,99,4],[107,11,99,11],[107,12,99,12,"output"],[107,18,99,18],[107,20,99,20,"outputShape"],[107,31,99,31],[107,32,99,32],[108,2,100,0],[109,0,100,1],[109,3]],"functionMap":{"names":["<global>","sparseSegmentReductionImpl","outputShape.reduce$argument_0"],"mappings":"AAA;OCiB;4CCc,mCD;CDoE"},"hasCjsExports":false},"type":"js/module"}]}