{"dependencies":[{"name":"@tensorflow/tfjs-core","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":17,"column":0,"index":703},"end":{"line":17,"column":74,"index":777}}],"key":"qIleUpSDMUXFynEGc51k60/pDSs=","exportNames":["*"],"imports":1}},{"name":"../cpu_util","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":18,"column":0,"index":778},"end":{"line":18,"column":47,"index":825}}],"key":"5L5S4GXlh/uJh1MrXQbkPSVOWm4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.avgPoolGrad = avgPoolGrad;\n  Object.defineProperty(exports, \"avgPoolGradConfig\", {\n    enumerable: true,\n    get: function () {\n      return avgPoolGradConfig;\n    }\n  });\n  var _tensorflowTfjsCore = require(_dependencyMap[0], \"@tensorflow/tfjs-core\");\n  var _cpu_util = require(_dependencyMap[1], \"../cpu_util\");\n  /**\n   * @license\n   * Copyright 2020 Google LLC. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   */\n\n  function avgPoolGrad(args) {\n    const {\n      inputs,\n      backend,\n      attrs\n    } = args;\n    const {\n      dy,\n      input\n    } = inputs;\n    const x = input;\n    (0, _cpu_util.assertNotComplex)([dy, input], 'avgPoolGrad');\n    const {\n      filterSize,\n      strides,\n      pad\n    } = attrs;\n    const convInfo = _tensorflowTfjsCore.backend_util.computePool2DInfo(x.shape, filterSize, strides, 1 /* dilations */, pad);\n    const strideHeight = convInfo.strideHeight;\n    const strideWidth = convInfo.strideWidth;\n    const filterHeight = convInfo.filterHeight;\n    const filterWidth = convInfo.filterWidth;\n    const dilationHeight = convInfo.dilationHeight;\n    const dilationWidth = convInfo.dilationWidth;\n    const effectiveFilterHeight = convInfo.effectiveFilterHeight;\n    const effectiveFilterWidth = convInfo.effectiveFilterWidth;\n    const padLeft = effectiveFilterWidth - 1 - convInfo.padInfo.left;\n    const padTop = effectiveFilterHeight - 1 - convInfo.padInfo.top;\n    const dx = (0, _tensorflowTfjsCore.buffer)(x.shape, 'float32');\n    const avgMultiplier = 1 / (filterHeight * filterWidth);\n    const dyData = backend.data.get(dy.dataId).values;\n    const dyBuf = (0, _tensorflowTfjsCore.buffer)(dy.shape, 'float32', dyData);\n    for (let b = 0; b < convInfo.batchSize; ++b) {\n      for (let d = 0; d < convInfo.inChannels; ++d) {\n        for (let dxR = 0; dxR < convInfo.inHeight; ++dxR) {\n          for (let dxC = 0; dxC < convInfo.inWidth; ++dxC) {\n            // Shader code begins.\n            const dyRCorner = dxR - padTop;\n            const dyCCorner = dxC - padLeft;\n            let dotProd = 0;\n            for (let wR = 0; wR < effectiveFilterHeight; wR += dilationHeight) {\n              const dyR = (dyRCorner + wR) / strideHeight;\n              if (dyR < 0 || dyR >= convInfo.outHeight || Math.floor(dyR) !== dyR) {\n                continue;\n              }\n              for (let wC = 0; wC < effectiveFilterWidth; wC += dilationWidth) {\n                const dyC = (dyCCorner + wC) / strideWidth;\n                if (dyC < 0 || dyC >= convInfo.outWidth || Math.floor(dyC) !== dyC) {\n                  continue;\n                }\n                const pixel = dyBuf.get(b, dyR, dyC, d);\n                dotProd += pixel;\n              }\n            }\n            dx.set(dotProd * avgMultiplier, b, dxR, dxC, d);\n          }\n        }\n      }\n    }\n    return backend.makeTensorInfo(dx.shape, dx.dtype, dx.values);\n  }\n  const avgPoolGradConfig = {\n    kernelName: _tensorflowTfjsCore.AvgPoolGrad,\n    backendName: 'cpu',\n    kernelFunc: avgPoolGrad\n  };\n});","lineCount":99,"map":[[7,2,19,0,"exports"],[7,9,19,0],[7,10,19,0,"avgPoolGrad"],[7,21,19,0],[7,24,19,0,"avgPoolGrad"],[7,35,19,0],[8,2,71,0,"Object"],[8,8,71,0],[8,9,71,0,"defineProperty"],[8,23,71,0],[8,24,71,0,"exports"],[8,31,71,0],[9,4,71,0,"enumerable"],[9,14,71,0],[10,4,71,0,"get"],[10,7,71,0],[10,18,71,0,"get"],[10,19,71,0],[11,6,71,0],[11,13,71,0,"avgPoolGradConfig"],[11,30,71,0],[12,4,71,0],[13,2,71,0],[14,2,17,0],[14,6,17,0,"_tensorflowTfjsCore"],[14,25,17,0],[14,28,17,0,"require"],[14,35,17,0],[14,36,17,0,"_dependencyMap"],[14,50,17,0],[15,2,18,0],[15,6,18,0,"_cpu_util"],[15,15,18,0],[15,18,18,0,"require"],[15,25,18,0],[15,26,18,0,"_dependencyMap"],[15,40,18,0],[16,2,1,0],[17,0,2,0],[18,0,3,0],[19,0,4,0],[20,0,5,0],[21,0,6,0],[22,0,7,0],[23,0,8,0],[24,0,9,0],[25,0,10,0],[26,0,11,0],[27,0,12,0],[28,0,13,0],[29,0,14,0],[30,0,15,0],[31,0,16,0],[33,2,19,7],[33,11,19,16,"avgPoolGrad"],[33,22,19,27,"avgPoolGrad"],[33,23,19,28,"args"],[33,27,19,32],[33,29,19,34],[34,4,20,4],[34,10,20,10],[35,6,20,12,"inputs"],[35,12,20,18],[36,6,20,20,"backend"],[36,13,20,27],[37,6,20,29,"attrs"],[38,4,20,35],[38,5,20,36],[38,8,20,39,"args"],[38,12,20,43],[39,4,21,4],[39,10,21,10],[40,6,21,12,"dy"],[40,8,21,14],[41,6,21,16,"input"],[42,4,21,22],[42,5,21,23],[42,8,21,26,"inputs"],[42,14,21,32],[43,4,22,4],[43,10,22,10,"x"],[43,11,22,11],[43,14,22,14,"input"],[43,19,22,19],[44,4,23,4],[44,8,23,4,"assertNotComplex"],[44,17,23,20],[44,18,23,20,"assertNotComplex"],[44,34,23,20],[44,36,23,21],[44,37,23,22,"dy"],[44,39,23,24],[44,41,23,26,"input"],[44,46,23,31],[44,47,23,32],[44,49,23,34],[44,62,23,47],[44,63,23,48],[45,4,24,4],[45,10,24,10],[46,6,24,12,"filterSize"],[46,16,24,22],[47,6,24,24,"strides"],[47,13,24,31],[48,6,24,33,"pad"],[49,4,24,37],[49,5,24,38],[49,8,24,41,"attrs"],[49,13,24,46],[50,4,25,4],[50,10,25,10,"convInfo"],[50,18,25,18],[50,21,25,21,"backend_util"],[50,40,25,33],[50,41,25,33,"backend_util"],[50,53,25,33],[50,54,25,34,"computePool2DInfo"],[50,71,25,51],[50,72,25,52,"x"],[50,73,25,53],[50,74,25,54,"shape"],[50,79,25,59],[50,81,25,61,"filterSize"],[50,91,25,71],[50,93,25,73,"strides"],[50,100,25,80],[50,102,25,82],[50,103,25,83],[50,104,25,84],[50,121,25,101,"pad"],[50,124,25,104],[50,125,25,105],[51,4,26,4],[51,10,26,10,"strideHeight"],[51,22,26,22],[51,25,26,25,"convInfo"],[51,33,26,33],[51,34,26,34,"strideHeight"],[51,46,26,46],[52,4,27,4],[52,10,27,10,"strideWidth"],[52,21,27,21],[52,24,27,24,"convInfo"],[52,32,27,32],[52,33,27,33,"strideWidth"],[52,44,27,44],[53,4,28,4],[53,10,28,10,"filterHeight"],[53,22,28,22],[53,25,28,25,"convInfo"],[53,33,28,33],[53,34,28,34,"filterHeight"],[53,46,28,46],[54,4,29,4],[54,10,29,10,"filterWidth"],[54,21,29,21],[54,24,29,24,"convInfo"],[54,32,29,32],[54,33,29,33,"filterWidth"],[54,44,29,44],[55,4,30,4],[55,10,30,10,"dilationHeight"],[55,24,30,24],[55,27,30,27,"convInfo"],[55,35,30,35],[55,36,30,36,"dilationHeight"],[55,50,30,50],[56,4,31,4],[56,10,31,10,"dilationWidth"],[56,23,31,23],[56,26,31,26,"convInfo"],[56,34,31,34],[56,35,31,35,"dilationWidth"],[56,48,31,48],[57,4,32,4],[57,10,32,10,"effectiveFilterHeight"],[57,31,32,31],[57,34,32,34,"convInfo"],[57,42,32,42],[57,43,32,43,"effectiveFilterHeight"],[57,64,32,64],[58,4,33,4],[58,10,33,10,"effectiveFilterWidth"],[58,30,33,30],[58,33,33,33,"convInfo"],[58,41,33,41],[58,42,33,42,"effectiveFilterWidth"],[58,62,33,62],[59,4,34,4],[59,10,34,10,"padLeft"],[59,17,34,17],[59,20,34,20,"effectiveFilterWidth"],[59,40,34,40],[59,43,34,43],[59,44,34,44],[59,47,34,47,"convInfo"],[59,55,34,55],[59,56,34,56,"padInfo"],[59,63,34,63],[59,64,34,64,"left"],[59,68,34,68],[60,4,35,4],[60,10,35,10,"padTop"],[60,16,35,16],[60,19,35,19,"effectiveFilterHeight"],[60,40,35,40],[60,43,35,43],[60,44,35,44],[60,47,35,47,"convInfo"],[60,55,35,55],[60,56,35,56,"padInfo"],[60,63,35,63],[60,64,35,64,"top"],[60,67,35,67],[61,4,36,4],[61,10,36,10,"dx"],[61,12,36,12],[61,15,36,15],[61,19,36,15,"buffer"],[61,38,36,21],[61,39,36,21,"buffer"],[61,45,36,21],[61,47,36,22,"x"],[61,48,36,23],[61,49,36,24,"shape"],[61,54,36,29],[61,56,36,31],[61,65,36,40],[61,66,36,41],[62,4,37,4],[62,10,37,10,"avgMultiplier"],[62,23,37,23],[62,26,37,26],[62,27,37,27],[62,31,37,31,"filterHeight"],[62,43,37,43],[62,46,37,46,"filterWidth"],[62,57,37,57],[62,58,37,58],[63,4,38,4],[63,10,38,10,"dyData"],[63,16,38,16],[63,19,38,19,"backend"],[63,26,38,26],[63,27,38,27,"data"],[63,31,38,31],[63,32,38,32,"get"],[63,35,38,35],[63,36,38,36,"dy"],[63,38,38,38],[63,39,38,39,"dataId"],[63,45,38,45],[63,46,38,46],[63,47,38,47,"values"],[63,53,38,53],[64,4,39,4],[64,10,39,10,"dyBuf"],[64,15,39,15],[64,18,39,18],[64,22,39,18,"buffer"],[64,41,39,24],[64,42,39,24,"buffer"],[64,48,39,24],[64,50,39,25,"dy"],[64,52,39,27],[64,53,39,28,"shape"],[64,58,39,33],[64,60,39,35],[64,69,39,44],[64,71,39,46,"dyData"],[64,77,39,52],[64,78,39,53],[65,4,40,4],[65,9,40,9],[65,13,40,13,"b"],[65,14,40,14],[65,17,40,17],[65,18,40,18],[65,20,40,20,"b"],[65,21,40,21],[65,24,40,24,"convInfo"],[65,32,40,32],[65,33,40,33,"batchSize"],[65,42,40,42],[65,44,40,44],[65,46,40,46,"b"],[65,47,40,47],[65,49,40,49],[66,6,41,8],[66,11,41,13],[66,15,41,17,"d"],[66,16,41,18],[66,19,41,21],[66,20,41,22],[66,22,41,24,"d"],[66,23,41,25],[66,26,41,28,"convInfo"],[66,34,41,36],[66,35,41,37,"inChannels"],[66,45,41,47],[66,47,41,49],[66,49,41,51,"d"],[66,50,41,52],[66,52,41,54],[67,8,42,12],[67,13,42,17],[67,17,42,21,"dxR"],[67,20,42,24],[67,23,42,27],[67,24,42,28],[67,26,42,30,"dxR"],[67,29,42,33],[67,32,42,36,"convInfo"],[67,40,42,44],[67,41,42,45,"inHeight"],[67,49,42,53],[67,51,42,55],[67,53,42,57,"dxR"],[67,56,42,60],[67,58,42,62],[68,10,43,16],[68,15,43,21],[68,19,43,25,"dxC"],[68,22,43,28],[68,25,43,31],[68,26,43,32],[68,28,43,34,"dxC"],[68,31,43,37],[68,34,43,40,"convInfo"],[68,42,43,48],[68,43,43,49,"inWidth"],[68,50,43,56],[68,52,43,58],[68,54,43,60,"dxC"],[68,57,43,63],[68,59,43,65],[69,12,44,20],[70,12,45,20],[70,18,45,26,"dyRCorner"],[70,27,45,35],[70,30,45,38,"dxR"],[70,33,45,41],[70,36,45,44,"padTop"],[70,42,45,50],[71,12,46,20],[71,18,46,26,"dyCCorner"],[71,27,46,35],[71,30,46,38,"dxC"],[71,33,46,41],[71,36,46,44,"padLeft"],[71,43,46,51],[72,12,47,20],[72,16,47,24,"dotProd"],[72,23,47,31],[72,26,47,34],[72,27,47,35],[73,12,48,20],[73,17,48,25],[73,21,48,29,"wR"],[73,23,48,31],[73,26,48,34],[73,27,48,35],[73,29,48,37,"wR"],[73,31,48,39],[73,34,48,42,"effectiveFilterHeight"],[73,55,48,63],[73,57,48,65,"wR"],[73,59,48,67],[73,63,48,71,"dilationHeight"],[73,77,48,85],[73,79,48,87],[74,14,49,24],[74,20,49,30,"dyR"],[74,23,49,33],[74,26,49,36],[74,27,49,37,"dyRCorner"],[74,36,49,46],[74,39,49,49,"wR"],[74,41,49,51],[74,45,49,55,"strideHeight"],[74,57,49,67],[75,14,50,24],[75,18,50,28,"dyR"],[75,21,50,31],[75,24,50,34],[75,25,50,35],[75,29,50,39,"dyR"],[75,32,50,42],[75,36,50,46,"convInfo"],[75,44,50,54],[75,45,50,55,"outHeight"],[75,54,50,64],[75,58,51,28,"Math"],[75,62,51,32],[75,63,51,33,"floor"],[75,68,51,38],[75,69,51,39,"dyR"],[75,72,51,42],[75,73,51,43],[75,78,51,48,"dyR"],[75,81,51,51],[75,83,51,53],[76,16,52,28],[77,14,53,24],[78,14,54,24],[78,19,54,29],[78,23,54,33,"wC"],[78,25,54,35],[78,28,54,38],[78,29,54,39],[78,31,54,41,"wC"],[78,33,54,43],[78,36,54,46,"effectiveFilterWidth"],[78,56,54,66],[78,58,54,68,"wC"],[78,60,54,70],[78,64,54,74,"dilationWidth"],[78,77,54,87],[78,79,54,89],[79,16,55,28],[79,22,55,34,"dyC"],[79,25,55,37],[79,28,55,40],[79,29,55,41,"dyCCorner"],[79,38,55,50],[79,41,55,53,"wC"],[79,43,55,55],[79,47,55,59,"strideWidth"],[79,58,55,70],[80,16,56,28],[80,20,56,32,"dyC"],[80,23,56,35],[80,26,56,38],[80,27,56,39],[80,31,56,43,"dyC"],[80,34,56,46],[80,38,56,50,"convInfo"],[80,46,56,58],[80,47,56,59,"outWidth"],[80,55,56,67],[80,59,57,32,"Math"],[80,63,57,36],[80,64,57,37,"floor"],[80,69,57,42],[80,70,57,43,"dyC"],[80,73,57,46],[80,74,57,47],[80,79,57,52,"dyC"],[80,82,57,55],[80,84,57,57],[81,18,58,32],[82,16,59,28],[83,16,60,28],[83,22,60,34,"pixel"],[83,27,60,39],[83,30,60,42,"dyBuf"],[83,35,60,47],[83,36,60,48,"get"],[83,39,60,51],[83,40,60,52,"b"],[83,41,60,53],[83,43,60,55,"dyR"],[83,46,60,58],[83,48,60,60,"dyC"],[83,51,60,63],[83,53,60,65,"d"],[83,54,60,66],[83,55,60,67],[84,16,61,28,"dotProd"],[84,23,61,35],[84,27,61,39,"pixel"],[84,32,61,44],[85,14,62,24],[86,12,63,20],[87,12,64,20,"dx"],[87,14,64,22],[87,15,64,23,"set"],[87,18,64,26],[87,19,64,27,"dotProd"],[87,26,64,34],[87,29,64,37,"avgMultiplier"],[87,42,64,50],[87,44,64,52,"b"],[87,45,64,53],[87,47,64,55,"dxR"],[87,50,64,58],[87,52,64,60,"dxC"],[87,55,64,63],[87,57,64,65,"d"],[87,58,64,66],[87,59,64,67],[88,10,65,16],[89,8,66,12],[90,6,67,8],[91,4,68,4],[92,4,69,4],[92,11,69,11,"backend"],[92,18,69,18],[92,19,69,19,"makeTensorInfo"],[92,33,69,33],[92,34,69,34,"dx"],[92,36,69,36],[92,37,69,37,"shape"],[92,42,69,42],[92,44,69,44,"dx"],[92,46,69,46],[92,47,69,47,"dtype"],[92,52,69,52],[92,54,69,54,"dx"],[92,56,69,56],[92,57,69,57,"values"],[92,63,69,63],[92,64,69,64],[93,2,70,0],[94,2,71,7],[94,8,71,13,"avgPoolGradConfig"],[94,25,71,30],[94,28,71,33],[95,4,72,4,"kernelName"],[95,14,72,14],[95,16,72,16,"AvgPoolGrad"],[95,35,72,27],[95,36,72,27,"AvgPoolGrad"],[95,47,72,27],[96,4,73,4,"backendName"],[96,15,73,15],[96,17,73,17],[96,22,73,22],[97,4,74,4,"kernelFunc"],[97,14,74,14],[97,16,74,16,"avgPoolGrad"],[98,2,75,0],[98,3,75,1],[99,0,75,2],[99,3]],"functionMap":{"names":["<global>","avgPoolGrad"],"mappings":"AAA;OCkB;CDmD"},"hasCjsExports":false},"type":"js/module"}]}