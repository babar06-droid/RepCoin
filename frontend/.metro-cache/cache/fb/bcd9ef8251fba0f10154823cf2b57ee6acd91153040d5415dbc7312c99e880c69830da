{"dependencies":[{"name":"./packing_util","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":17,"column":0,"index":703},"end":{"line":17,"column":48,"index":751}}],"key":"XZxV38atso3t5pLpH4+paVH17Hc=","exportNames":["*"],"imports":1}},{"name":"./shader_compiler","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":18,"column":0,"index":752},"end":{"line":18,"column":54,"index":806}}],"key":"yVSKlvZSxQn3Ck2puzGVWEYPzq8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"TransposePackedProgram\", {\n    enumerable: true,\n    get: function () {\n      return TransposePackedProgram;\n    }\n  });\n  var _packing_util = require(_dependencyMap[0], \"./packing_util\");\n  var _shader_compiler = require(_dependencyMap[1], \"./shader_compiler\");\n  /**\n   * @license\n   * Copyright 2019 Google LLC. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   */\n\n  class TransposePackedProgram {\n    constructor(aShape, newDim) {\n      this.variableNames = ['A'];\n      this.packedInputs = true;\n      this.packedOutput = true;\n      const outputShape = new Array(aShape.length);\n      for (let i = 0; i < outputShape.length; i++) {\n        outputShape[i] = aShape[newDim[i]];\n      }\n      this.outputShape = outputShape;\n      this.rank = outputShape.length;\n      if (this.rank > 6) {\n        throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);\n      }\n      const dtype = (0, _shader_compiler.getCoordsDataType)(this.rank);\n      const outputOrder = (0, _packing_util.getVecChannels)('rc', this.rank);\n      const switchedOrder = new Array(this.rank);\n      for (let i = 0; i < newDim.length; i++) {\n        switchedOrder[newDim[i]] = outputOrder[i];\n      }\n      const innerDims = `vec2(${switchedOrder.slice(-2).join()})`;\n      const nextColumn = `++${outputOrder[this.rank - 1]} < ${outputShape[this.rank - 1]}`;\n      const getc = `getChannel(getA(${switchedOrder.join()}), ${innerDims})`;\n      this.userCode = `\n    void main() {\n      ${dtype} rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ${getc};\n      if(${nextColumn}) {\n        result[1] = ${getc};\n      }\n      --${outputOrder[this.rank - 1]};\n      if(++${outputOrder[this.rank - 2]} < ${outputShape[this.rank - 2]}) {\n        result[2] = ${getc};\n        if(${nextColumn}) {\n          result[3] = ${getc};\n        }\n      }\n      setOutput(result);\n    }\n    `;\n    }\n  }\n});","lineCount":75,"map":[[7,2,19,0,"Object"],[7,8,19,0],[7,9,19,0,"defineProperty"],[7,23,19,0],[7,24,19,0,"exports"],[7,31,19,0],[8,4,19,0,"enumerable"],[8,14,19,0],[9,4,19,0,"get"],[9,7,19,0],[9,18,19,0,"get"],[9,19,19,0],[10,6,19,0],[10,13,19,0,"TransposePackedProgram"],[10,35,19,0],[11,4,19,0],[12,2,19,0],[13,2,17,0],[13,6,17,0,"_packing_util"],[13,19,17,0],[13,22,17,0,"require"],[13,29,17,0],[13,30,17,0,"_dependencyMap"],[13,44,17,0],[14,2,18,0],[14,6,18,0,"_shader_compiler"],[14,22,18,0],[14,25,18,0,"require"],[14,32,18,0],[14,33,18,0,"_dependencyMap"],[14,47,18,0],[15,2,1,0],[16,0,2,0],[17,0,3,0],[18,0,4,0],[19,0,5,0],[20,0,6,0],[21,0,7,0],[22,0,8,0],[23,0,9,0],[24,0,10,0],[25,0,11,0],[26,0,12,0],[27,0,13,0],[28,0,14,0],[29,0,15,0],[30,0,16,0],[32,2,19,7],[32,8,19,13,"TransposePackedProgram"],[32,30,19,35],[32,31,19,36],[33,4,20,4,"constructor"],[33,15,20,15,"constructor"],[33,16,20,16,"aShape"],[33,22,20,22],[33,24,20,24,"newDim"],[33,30,20,30],[33,32,20,32],[34,6,21,8],[34,10,21,12],[34,11,21,13,"variableNames"],[34,24,21,26],[34,27,21,29],[34,28,21,30],[34,31,21,33],[34,32,21,34],[35,6,22,8],[35,10,22,12],[35,11,22,13,"packedInputs"],[35,23,22,25],[35,26,22,28],[35,30,22,32],[36,6,23,8],[36,10,23,12],[36,11,23,13,"packedOutput"],[36,23,23,25],[36,26,23,28],[36,30,23,32],[37,6,24,8],[37,12,24,14,"outputShape"],[37,23,24,25],[37,26,24,28],[37,30,24,32,"Array"],[37,35,24,37],[37,36,24,38,"aShape"],[37,42,24,44],[37,43,24,45,"length"],[37,49,24,51],[37,50,24,52],[38,6,25,8],[38,11,25,13],[38,15,25,17,"i"],[38,16,25,18],[38,19,25,21],[38,20,25,22],[38,22,25,24,"i"],[38,23,25,25],[38,26,25,28,"outputShape"],[38,37,25,39],[38,38,25,40,"length"],[38,44,25,46],[38,46,25,48,"i"],[38,47,25,49],[38,49,25,51],[38,51,25,53],[39,8,26,12,"outputShape"],[39,19,26,23],[39,20,26,24,"i"],[39,21,26,25],[39,22,26,26],[39,25,26,29,"aShape"],[39,31,26,35],[39,32,26,36,"newDim"],[39,38,26,42],[39,39,26,43,"i"],[39,40,26,44],[39,41,26,45],[39,42,26,46],[40,6,27,8],[41,6,28,8],[41,10,28,12],[41,11,28,13,"outputShape"],[41,22,28,24],[41,25,28,27,"outputShape"],[41,36,28,38],[42,6,29,8],[42,10,29,12],[42,11,29,13,"rank"],[42,15,29,17],[42,18,29,20,"outputShape"],[42,29,29,31],[42,30,29,32,"length"],[42,36,29,38],[43,6,30,8],[43,10,30,12],[43,14,30,16],[43,15,30,17,"rank"],[43,19,30,21],[43,22,30,24],[43,23,30,25],[43,25,30,27],[44,8,31,12],[44,14,31,18,"Error"],[44,19,31,23],[44,20,31,24],[44,49,31,53],[44,53,31,57],[44,54,31,58,"rank"],[44,58,31,62],[44,82,31,86],[44,83,31,87],[45,6,32,8],[46,6,33,8],[46,12,33,14,"dtype"],[46,17,33,19],[46,20,33,22],[46,24,33,22,"getCoordsDataType"],[46,40,33,39],[46,41,33,39,"getCoordsDataType"],[46,58,33,39],[46,60,33,40],[46,64,33,44],[46,65,33,45,"rank"],[46,69,33,49],[46,70,33,50],[47,6,34,8],[47,12,34,14,"outputOrder"],[47,23,34,25],[47,26,34,28],[47,30,34,28,"getVecChannels"],[47,43,34,42],[47,44,34,42,"getVecChannels"],[47,58,34,42],[47,60,34,43],[47,64,34,47],[47,66,34,49],[47,70,34,53],[47,71,34,54,"rank"],[47,75,34,58],[47,76,34,59],[48,6,35,8],[48,12,35,14,"switchedOrder"],[48,25,35,27],[48,28,35,30],[48,32,35,34,"Array"],[48,37,35,39],[48,38,35,40],[48,42,35,44],[48,43,35,45,"rank"],[48,47,35,49],[48,48,35,50],[49,6,36,8],[49,11,36,13],[49,15,36,17,"i"],[49,16,36,18],[49,19,36,21],[49,20,36,22],[49,22,36,24,"i"],[49,23,36,25],[49,26,36,28,"newDim"],[49,32,36,34],[49,33,36,35,"length"],[49,39,36,41],[49,41,36,43,"i"],[49,42,36,44],[49,44,36,46],[49,46,36,48],[50,8,37,12,"switchedOrder"],[50,21,37,25],[50,22,37,26,"newDim"],[50,28,37,32],[50,29,37,33,"i"],[50,30,37,34],[50,31,37,35],[50,32,37,36],[50,35,37,39,"outputOrder"],[50,46,37,50],[50,47,37,51,"i"],[50,48,37,52],[50,49,37,53],[51,6,38,8],[52,6,39,8],[52,12,39,14,"innerDims"],[52,21,39,23],[52,24,39,26],[52,32,39,34,"switchedOrder"],[52,45,39,47],[52,46,39,48,"slice"],[52,51,39,53],[52,52,39,54],[52,53,39,55],[52,54,39,56],[52,55,39,57],[52,56,39,58,"join"],[52,60,39,62],[52,61,39,63],[52,62,39,64],[52,65,39,67],[53,6,40,8],[53,12,40,14,"nextColumn"],[53,22,40,24],[53,25,40,27],[53,30,40,32,"outputOrder"],[53,41,40,43],[53,42,40,44],[53,46,40,48],[53,47,40,49,"rank"],[53,51,40,53],[53,54,40,56],[53,55,40,57],[53,56,40,58],[53,62,40,64,"outputShape"],[53,73,40,75],[53,74,40,76],[53,78,40,80],[53,79,40,81,"rank"],[53,83,40,85],[53,86,40,88],[53,87,40,89],[53,88,40,90],[53,90,40,92],[54,6,41,8],[54,12,41,14,"getc"],[54,16,41,18],[54,19,41,21],[54,38,41,40,"switchedOrder"],[54,51,41,53],[54,52,41,54,"join"],[54,56,41,58],[54,57,41,59],[54,58,41,60],[54,64,41,66,"innerDims"],[54,73,41,75],[54,76,41,78],[55,6,42,8],[55,10,42,12],[55,11,42,13,"userCode"],[55,19,42,21],[55,22,42,24],[56,0,43,0],[57,0,44,0],[57,8,44,8,"dtype"],[57,13,44,13],[58,0,45,0],[59,0,46,0],[59,20,46,20,"getc"],[59,24,46,24],[60,0,47,0],[60,11,47,11,"nextColumn"],[60,21,47,21],[61,0,48,0],[61,22,48,22,"getc"],[61,26,48,26],[62,0,49,0],[63,0,50,0],[63,10,50,10,"outputOrder"],[63,21,50,21],[63,22,50,22],[63,26,50,26],[63,27,50,27,"rank"],[63,31,50,31],[63,34,50,34],[63,35,50,35],[63,36,50,36],[64,0,51,0],[64,13,51,13,"outputOrder"],[64,24,51,24],[64,25,51,25],[64,29,51,29],[64,30,51,30,"rank"],[64,34,51,34],[64,37,51,37],[64,38,51,38],[64,39,51,39],[64,45,51,45,"outputShape"],[64,56,51,56],[64,57,51,57],[64,61,51,61],[64,62,51,62,"rank"],[64,66,51,66],[64,69,51,69],[64,70,51,70],[64,71,51,71],[65,0,52,0],[65,22,52,22,"getc"],[65,26,52,26],[66,0,53,0],[66,13,53,13,"nextColumn"],[66,23,53,23],[67,0,54,0],[67,24,54,24,"getc"],[67,28,54,28],[68,0,55,0],[69,0,56,0],[70,0,57,0],[71,0,58,0],[72,0,59,0],[72,5,59,5],[73,4,60,4],[74,2,61,0],[75,0,61,1],[75,3]],"functionMap":{"names":["<global>","TransposePackedProgram","TransposePackedProgram#constructor"],"mappings":"AAA;OCkB;ICC;KDwC;CDC"},"hasCjsExports":false},"type":"js/module"}]}