{"dependencies":[{"name":"./gpgpu_math","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":17,"column":0,"index":703},"end":{"line":17,"column":48,"index":751}}],"key":"r7nFADTf/sGcqNrAYkmj7Z35J80=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"DepthwiseConv2DProgram\", {\n    enumerable: true,\n    get: function () {\n      return DepthwiseConv2DProgram;\n    }\n  });\n  var _gpgpu_math = require(_dependencyMap[0], \"./gpgpu_math\");\n  /**\n   * @license\n   * Copyright 2017 Google LLC. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   */\n\n  class DepthwiseConv2DProgram {\n    constructor(convInfo, addBias = false, activation = null, hasPreluActivation = false, hasLeakyReluAlpha = false) {\n      this.variableNames = ['x', 'W'];\n      this.customUniforms = [{\n        name: 'pads',\n        type: 'ivec2'\n      }, {\n        name: 'strides',\n        type: 'ivec2'\n      }, {\n        name: 'dilations',\n        type: 'ivec2'\n      }, {\n        name: 'inDims',\n        type: 'ivec2'\n      }];\n      this.outputShape = convInfo.outShape;\n      this.enableShapeUniforms = (0, _gpgpu_math.useShapeUniforms)(this.outputShape.length);\n      const filterHeight = convInfo.filterHeight;\n      const filterWidth = convInfo.filterWidth;\n      const channelMul = convInfo.outChannels / convInfo.inChannels;\n      let activationSnippet = '',\n        applyActivationSnippet = '';\n      if (activation) {\n        if (hasPreluActivation) {\n          activationSnippet = `float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${activation}\n        }`;\n        } else if (hasLeakyReluAlpha) {\n          activationSnippet = `float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ${activation}\n        }`;\n        } else {\n          activationSnippet = `\n          float activation(float x) {\n            ${activation}\n          }\n        `;\n        }\n        applyActivationSnippet = `result = activation(result);`;\n      }\n      const addBiasSnippet = addBias ? 'result += getBiasAtOutCoords();' : '';\n      if (addBias) {\n        this.variableNames.push('bias');\n      }\n      if (hasPreluActivation) {\n        this.variableNames.push('preluActivationWeights');\n      }\n      if (hasLeakyReluAlpha) {\n        this.variableNames.push('leakyreluAlpha');\n      }\n      this.userCode = `\n      ${activationSnippet}\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ${channelMul};\n        int q = d2 - d1 * ${channelMul};\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ${filterHeight}; wR++) {\n          int xR = xRCorner + wR * dilations[0];\n\n          if (xR < 0 || xR >= inDims[0]) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${filterWidth}; wC++) {\n            int xC = xCCorner + wC * dilations[1];\n\n            if (xC < 0 || xC >= inDims[1]) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ${addBiasSnippet}\n        ${applyActivationSnippet}\n        setOutput(result);\n      }\n    `;\n    }\n  }\n});","lineCount":130,"map":[[7,2,18,0,"Object"],[7,8,18,0],[7,9,18,0,"defineProperty"],[7,23,18,0],[7,24,18,0,"exports"],[7,31,18,0],[8,4,18,0,"enumerable"],[8,14,18,0],[9,4,18,0,"get"],[9,7,18,0],[9,18,18,0,"get"],[9,19,18,0],[10,6,18,0],[10,13,18,0,"DepthwiseConv2DProgram"],[10,35,18,0],[11,4,18,0],[12,2,18,0],[13,2,17,0],[13,6,17,0,"_gpgpu_math"],[13,17,17,0],[13,20,17,0,"require"],[13,27,17,0],[13,28,17,0,"_dependencyMap"],[13,42,17,0],[14,2,1,0],[15,0,2,0],[16,0,3,0],[17,0,4,0],[18,0,5,0],[19,0,6,0],[20,0,7,0],[21,0,8,0],[22,0,9,0],[23,0,10,0],[24,0,11,0],[25,0,12,0],[26,0,13,0],[27,0,14,0],[28,0,15,0],[29,0,16,0],[31,2,18,7],[31,8,18,13,"DepthwiseConv2DProgram"],[31,30,18,35],[31,31,18,36],[32,4,19,4,"constructor"],[32,15,19,15,"constructor"],[32,16,19,16,"convInfo"],[32,24,19,24],[32,26,19,26,"addBias"],[32,33,19,33],[32,36,19,36],[32,41,19,41],[32,43,19,43,"activation"],[32,53,19,53],[32,56,19,56],[32,60,19,60],[32,62,19,62,"hasPreluActivation"],[32,80,19,80],[32,83,19,83],[32,88,19,88],[32,90,19,90,"hasLeakyReluAlpha"],[32,107,19,107],[32,110,19,110],[32,115,19,115],[32,117,19,117],[33,6,20,8],[33,10,20,12],[33,11,20,13,"variableNames"],[33,24,20,26],[33,27,20,29],[33,28,20,30],[33,31,20,33],[33,33,20,35],[33,36,20,38],[33,37,20,39],[34,6,21,8],[34,10,21,12],[34,11,21,13,"customUniforms"],[34,25,21,27],[34,28,21,30],[34,29,22,12],[35,8,22,14,"name"],[35,12,22,18],[35,14,22,20],[35,20,22,26],[36,8,22,28,"type"],[36,12,22,32],[36,14,22,34],[37,6,22,42],[37,7,22,43],[37,9,23,12],[38,8,23,14,"name"],[38,12,23,18],[38,14,23,20],[38,23,23,29],[39,8,23,31,"type"],[39,12,23,35],[39,14,23,37],[40,6,23,45],[40,7,23,46],[40,9,24,12],[41,8,24,14,"name"],[41,12,24,18],[41,14,24,20],[41,25,24,31],[42,8,24,33,"type"],[42,12,24,37],[42,14,24,39],[43,6,24,47],[43,7,24,48],[43,9,25,12],[44,8,25,14,"name"],[44,12,25,18],[44,14,25,20],[44,22,25,28],[45,8,25,30,"type"],[45,12,25,34],[45,14,25,36],[46,6,25,44],[46,7,25,45],[46,8,26,9],[47,6,27,8],[47,10,27,12],[47,11,27,13,"outputShape"],[47,22,27,24],[47,25,27,27,"convInfo"],[47,33,27,35],[47,34,27,36,"outShape"],[47,42,27,44],[48,6,28,8],[48,10,28,12],[48,11,28,13,"enableShapeUniforms"],[48,30,28,32],[48,33,28,35],[48,37,28,35,"useShapeUniforms"],[48,48,28,51],[48,49,28,51,"useShapeUniforms"],[48,65,28,51],[48,67,28,52],[48,71,28,56],[48,72,28,57,"outputShape"],[48,83,28,68],[48,84,28,69,"length"],[48,90,28,75],[48,91,28,76],[49,6,29,8],[49,12,29,14,"filterHeight"],[49,24,29,26],[49,27,29,29,"convInfo"],[49,35,29,37],[49,36,29,38,"filterHeight"],[49,48,29,50],[50,6,30,8],[50,12,30,14,"filterWidth"],[50,23,30,25],[50,26,30,28,"convInfo"],[50,34,30,36],[50,35,30,37,"filterWidth"],[50,46,30,48],[51,6,31,8],[51,12,31,14,"channelMul"],[51,22,31,24],[51,25,31,27,"convInfo"],[51,33,31,35],[51,34,31,36,"outChannels"],[51,45,31,47],[51,48,31,50,"convInfo"],[51,56,31,58],[51,57,31,59,"inChannels"],[51,67,31,69],[52,6,32,8],[52,10,32,12,"activationSnippet"],[52,27,32,29],[52,30,32,32],[52,32,32,34],[53,8,32,36,"applyActivationSnippet"],[53,30,32,58],[53,33,32,61],[53,35,32,63],[54,6,33,8],[54,10,33,12,"activation"],[54,20,33,22],[54,22,33,24],[55,8,34,12],[55,12,34,16,"hasPreluActivation"],[55,30,34,34],[55,32,34,36],[56,10,35,16,"activationSnippet"],[56,27,35,33],[56,30,35,36],[57,0,36,0],[58,0,37,0],[58,12,37,12,"activation"],[58,22,37,22],[59,0,38,0],[59,10,38,10],[60,8,39,12],[60,9,39,13],[60,15,40,17],[60,19,40,21,"hasLeakyReluAlpha"],[60,36,40,38],[60,38,40,40],[61,10,41,16,"activationSnippet"],[61,27,41,33],[61,30,41,36],[62,0,42,0],[63,0,43,0],[63,12,43,12,"activation"],[63,22,43,22],[64,0,44,0],[64,10,44,10],[65,8,45,12],[65,9,45,13],[65,15,46,17],[66,10,47,16,"activationSnippet"],[66,27,47,33],[66,30,47,36],[67,0,48,0],[68,0,49,0],[68,14,49,14,"activation"],[68,24,49,24],[69,0,50,0],[70,0,51,0],[70,9,51,9],[71,8,52,12],[72,8,53,12,"applyActivationSnippet"],[72,30,53,34],[72,33,53,37],[72,63,53,67],[73,6,54,8],[74,6,55,8],[74,12,55,14,"addBiasSnippet"],[74,26,55,28],[74,29,55,31,"addBias"],[74,36,55,38],[74,39,55,41],[74,72,55,74],[74,75,55,77],[74,77,55,79],[75,6,56,8],[75,10,56,12,"addBias"],[75,17,56,19],[75,19,56,21],[76,8,57,12],[76,12,57,16],[76,13,57,17,"variableNames"],[76,26,57,30],[76,27,57,31,"push"],[76,31,57,35],[76,32,57,36],[76,38,57,42],[76,39,57,43],[77,6,58,8],[78,6,59,8],[78,10,59,12,"hasPreluActivation"],[78,28,59,30],[78,30,59,32],[79,8,60,12],[79,12,60,16],[79,13,60,17,"variableNames"],[79,26,60,30],[79,27,60,31,"push"],[79,31,60,35],[79,32,60,36],[79,56,60,60],[79,57,60,61],[80,6,61,8],[81,6,62,8],[81,10,62,12,"hasLeakyReluAlpha"],[81,27,62,29],[81,29,62,31],[82,8,63,12],[82,12,63,16],[82,13,63,17,"variableNames"],[82,26,63,30],[82,27,63,31,"push"],[82,31,63,35],[82,32,63,36],[82,48,63,52],[82,49,63,53],[83,6,64,8],[84,6,65,8],[84,10,65,12],[84,11,65,13,"userCode"],[84,19,65,21],[84,22,65,24],[85,0,66,0],[85,8,66,8,"activationSnippet"],[85,25,66,25],[86,0,67,0],[87,0,68,0],[88,0,69,0],[89,0,70,0],[90,0,71,0],[91,0,72,0],[92,0,73,0],[92,24,73,24,"channelMul"],[92,34,73,34],[93,0,74,0],[93,28,74,28,"channelMul"],[93,38,74,38],[94,0,75,0],[95,0,76,0],[96,0,77,0],[97,0,78,0],[98,0,79,0],[99,0,80,0],[100,0,81,0],[101,0,82,0],[102,0,83,0],[102,32,83,32,"filterHeight"],[102,44,83,44],[103,0,84,0],[104,0,85,0],[105,0,86,0],[106,0,87,0],[107,0,88,0],[108,0,89,0],[109,0,90,0],[109,34,90,34,"filterWidth"],[109,45,90,45],[110,0,91,0],[111,0,92,0],[112,0,93,0],[113,0,94,0],[114,0,95,0],[115,0,96,0],[116,0,97,0],[117,0,98,0],[118,0,99,0],[119,0,100,0],[120,0,101,0],[121,0,102,0],[122,0,103,0],[123,0,104,0],[123,10,104,10,"addBiasSnippet"],[123,24,104,24],[124,0,105,0],[124,10,105,10,"applyActivationSnippet"],[124,32,105,32],[125,0,106,0],[126,0,107,0],[127,0,108,0],[127,5,108,5],[128,4,109,4],[129,2,110,0],[130,0,110,1],[130,3]],"functionMap":{"names":["<global>","DepthwiseConv2DProgram","DepthwiseConv2DProgram#constructor"],"mappings":"AAA;OCiB;ICC;KD0F;CDC"},"hasCjsExports":false},"type":"js/module"}]}