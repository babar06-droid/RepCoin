{"dependencies":[],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"ResizeBilinearBackpropProgram\", {\n    enumerable: true,\n    get: function () {\n      return ResizeBilinearBackpropProgram;\n    }\n  });\n  /**\n   * @license\n   * Copyright 2018 Google LLC. All Rights Reserved.\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   * http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   * =============================================================================\n   */\n  class ResizeBilinearBackpropProgram {\n    constructor(dyShape, inputShape, alignCorners) {\n      this.variableNames = ['dy'];\n      this.outputShape = [];\n      this.outputShape = inputShape;\n      const [, xHeight, xWidth] = inputShape;\n      const [, yHeight, yWidth] = dyShape;\n      // In the backwards pass, we want to find the pixels that were generated for\n      // each pixel in the input image the forward pass and add the corresponding\n      // coefficient from dy to the gradient (with some interpolation).\n      const effectiveXSize = [alignCorners && yHeight > 1 ? xHeight - 1 : xHeight, alignCorners && yWidth > 1 ? xWidth - 1 : xWidth];\n      const effectiveYSize = [alignCorners && yHeight > 1 ? yHeight - 1 : yHeight, alignCorners && yWidth > 1 ? yWidth - 1 : yWidth];\n      const heightScale = effectiveXSize[0] / effectiveYSize[0];\n      const widthScale = effectiveXSize[1] / effectiveYSize[1];\n      const invHeightScale = 1 / heightScale;\n      const invWidthScale = 1 / widthScale;\n      // This defines the size of the window of values around a particular\n      // index in dy that we want to search for contributions to dx.\n      const winHeight = Math.ceil(invHeightScale) * 2 + 2;\n      const winWidth = Math.ceil(invWidthScale) * 2 + 2;\n      this.userCode = `\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(${heightScale});\n        const float widthScale = float(${widthScale});\n\n        const float invHeightScale = float(${invHeightScale});\n        const float invWidthScale = float(${invWidthScale});\n\n        const int winHeight = int(${winHeight});\n        const int winWidth = int(${winWidth});\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ${yHeight}) {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ${yWidth}) {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ${xHeight - 1}.0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ${xWidth - 1}.0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    `;\n    }\n  }\n});","lineCount":133,"map":[[7,2,17,0,"Object"],[7,8,17,0],[7,9,17,0,"defineProperty"],[7,23,17,0],[7,24,17,0,"exports"],[7,31,17,0],[8,4,17,0,"enumerable"],[8,14,17,0],[9,4,17,0,"get"],[9,7,17,0],[9,18,17,0,"get"],[9,19,17,0],[10,6,17,0],[10,13,17,0,"ResizeBilinearBackpropProgram"],[10,42,17,0],[11,4,17,0],[12,2,17,0],[13,2,1,0],[14,0,2,0],[15,0,3,0],[16,0,4,0],[17,0,5,0],[18,0,6,0],[19,0,7,0],[20,0,8,0],[21,0,9,0],[22,0,10,0],[23,0,11,0],[24,0,12,0],[25,0,13,0],[26,0,14,0],[27,0,15,0],[28,0,16,0],[29,2,17,7],[29,8,17,13,"ResizeBilinearBackpropProgram"],[29,37,17,42],[29,38,17,43],[30,4,18,4,"constructor"],[30,15,18,15,"constructor"],[30,16,18,16,"dyShape"],[30,23,18,23],[30,25,18,25,"inputShape"],[30,35,18,35],[30,37,18,37,"alignCorners"],[30,49,18,49],[30,51,18,51],[31,6,19,8],[31,10,19,12],[31,11,19,13,"variableNames"],[31,24,19,26],[31,27,19,29],[31,28,19,30],[31,32,19,34],[31,33,19,35],[32,6,20,8],[32,10,20,12],[32,11,20,13,"outputShape"],[32,22,20,24],[32,25,20,27],[32,27,20,29],[33,6,21,8],[33,10,21,12],[33,11,21,13,"outputShape"],[33,22,21,24],[33,25,21,27,"inputShape"],[33,35,21,37],[34,6,22,8],[34,12,22,14],[34,15,22,17,"xHeight"],[34,22,22,24],[34,24,22,26,"xWidth"],[34,30,22,32],[34,31,22,34],[34,34,22,37,"inputShape"],[34,44,22,47],[35,6,23,8],[35,12,23,14],[35,15,23,17,"yHeight"],[35,22,23,24],[35,24,23,26,"yWidth"],[35,30,23,32],[35,31,23,33],[35,34,23,36,"dyShape"],[35,41,23,43],[36,6,24,8],[37,6,25,8],[38,6,26,8],[39,6,27,8],[39,12,27,14,"effectiveXSize"],[39,26,27,28],[39,29,27,31],[39,30,28,13,"alignCorners"],[39,42,28,25],[39,46,28,29,"yHeight"],[39,53,28,36],[39,56,28,39],[39,57,28,40],[39,60,28,44,"xHeight"],[39,67,28,51],[39,70,28,54],[39,71,28,55],[39,74,28,58,"xHeight"],[39,81,28,65],[39,83,29,13,"alignCorners"],[39,95,29,25],[39,99,29,29,"yWidth"],[39,105,29,35],[39,108,29,38],[39,109,29,39],[39,112,29,43,"xWidth"],[39,118,29,49],[39,121,29,52],[39,122,29,53],[39,125,29,56,"xWidth"],[39,131,29,62],[39,132,30,9],[40,6,31,8],[40,12,31,14,"effectiveYSize"],[40,26,31,28],[40,29,31,31],[40,30,32,13,"alignCorners"],[40,42,32,25],[40,46,32,29,"yHeight"],[40,53,32,36],[40,56,32,39],[40,57,32,40],[40,60,32,44,"yHeight"],[40,67,32,51],[40,70,32,54],[40,71,32,55],[40,74,32,58,"yHeight"],[40,81,32,65],[40,83,33,13,"alignCorners"],[40,95,33,25],[40,99,33,29,"yWidth"],[40,105,33,35],[40,108,33,38],[40,109,33,39],[40,112,33,43,"yWidth"],[40,118,33,49],[40,121,33,52],[40,122,33,53],[40,125,33,56,"yWidth"],[40,131,33,62],[40,132,34,9],[41,6,35,8],[41,12,35,14,"heightScale"],[41,23,35,25],[41,26,35,28,"effectiveXSize"],[41,40,35,42],[41,41,35,43],[41,42,35,44],[41,43,35,45],[41,46,35,48,"effectiveYSize"],[41,60,35,62],[41,61,35,63],[41,62,35,64],[41,63,35,65],[42,6,36,8],[42,12,36,14,"widthScale"],[42,22,36,24],[42,25,36,27,"effectiveXSize"],[42,39,36,41],[42,40,36,42],[42,41,36,43],[42,42,36,44],[42,45,36,47,"effectiveYSize"],[42,59,36,61],[42,60,36,62],[42,61,36,63],[42,62,36,64],[43,6,37,8],[43,12,37,14,"invHeightScale"],[43,26,37,28],[43,29,37,31],[43,30,37,32],[43,33,37,35,"heightScale"],[43,44,37,46],[44,6,38,8],[44,12,38,14,"invWidthScale"],[44,25,38,27],[44,28,38,30],[44,29,38,31],[44,32,38,34,"widthScale"],[44,42,38,44],[45,6,39,8],[46,6,40,8],[47,6,41,8],[47,12,41,14,"winHeight"],[47,21,41,23],[47,24,41,27,"Math"],[47,28,41,31],[47,29,41,32,"ceil"],[47,33,41,36],[47,34,41,37,"invHeightScale"],[47,48,41,51],[47,49,41,52],[47,52,41,55],[47,53,41,56],[47,56,41,60],[47,57,41,61],[48,6,42,8],[48,12,42,14,"winWidth"],[48,20,42,22],[48,23,42,26,"Math"],[48,27,42,30],[48,28,42,31,"ceil"],[48,32,42,35],[48,33,42,36,"invWidthScale"],[48,46,42,49],[48,47,42,50],[48,50,42,53],[48,51,42,54],[48,54,42,58],[48,55,42,59],[49,6,43,8],[49,10,43,12],[49,11,43,13,"userCode"],[49,19,43,21],[49,22,43,24],[50,0,44,0],[51,0,45,0],[52,0,46,0],[53,0,47,0],[54,0,48,0],[55,0,49,0],[56,0,50,0],[57,0,51,0],[58,0,52,0],[59,0,53,0],[59,42,53,42,"heightScale"],[59,53,53,53],[60,0,54,0],[60,41,54,41,"widthScale"],[60,51,54,51],[61,0,55,0],[62,0,56,0],[62,45,56,45,"invHeightScale"],[62,59,56,59],[63,0,57,0],[63,44,57,44,"invWidthScale"],[63,57,57,57],[64,0,58,0],[65,0,59,0],[65,36,59,36,"winHeight"],[65,45,59,45],[66,0,60,0],[66,35,60,35,"winWidth"],[66,43,60,43],[67,0,61,0],[68,0,62,0],[69,0,63,0],[70,0,64,0],[71,0,65,0],[72,0,66,0],[73,0,67,0],[74,0,68,0],[75,0,69,0],[76,0,70,0],[77,0,71,0],[78,0,72,0],[79,0,73,0],[80,0,74,0],[80,34,74,34,"yHeight"],[80,41,74,41],[81,0,75,0],[82,0,76,0],[83,0,77,0],[84,0,78,0],[85,0,79,0],[86,0,80,0],[87,0,81,0],[88,0,82,0],[88,36,82,36,"yWidth"],[88,42,82,42],[89,0,83,0],[90,0,84,0],[91,0,85,0],[92,0,86,0],[93,0,87,0],[94,0,88,0],[94,54,88,54,"xHeight"],[94,61,88,61],[94,64,88,64],[94,65,88,65],[95,0,89,0],[96,0,90,0],[97,0,91,0],[98,0,92,0],[99,0,93,0],[100,0,94,0],[100,53,94,53,"xWidth"],[100,59,94,59],[100,62,94,62],[100,63,94,63],[101,0,95,0],[102,0,96,0],[103,0,97,0],[104,0,98,0],[105,0,99,0],[106,0,100,0],[107,0,101,0],[108,0,102,0],[109,0,103,0],[110,0,104,0],[111,0,105,0],[112,0,106,0],[113,0,107,0],[114,0,108,0],[115,0,109,0],[116,0,110,0],[117,0,111,0],[118,0,112,0],[119,0,113,0],[120,0,114,0],[121,0,115,0],[122,0,116,0],[123,0,117,0],[124,0,118,0],[125,0,119,0],[126,0,120,0],[127,0,121,0],[128,0,122,0],[129,0,123,0],[130,0,124,0],[130,5,124,5],[131,4,125,4],[132,2,126,0],[133,0,126,1],[133,3]],"functionMap":{"names":["<global>","ResizeBilinearBackpropProgram","ResizeBilinearBackpropProgram#constructor"],"mappings":"AAA;OCgB;ICC;KD2G;CDC"},"hasCjsExports":false},"type":"js/module"}]}